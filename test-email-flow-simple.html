<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Email Flow - Simple</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./dist/onairos.bundle.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div id="root" class="p-8 max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                🧠 Test Email Flow - Simple Version
            </h1>
            <p class="text-gray-600 text-lg">Testing the updated email and verification code flow</p>
        </div>
        
        <div class="mb-8 p-6 bg-white border border-gray-200 rounded-xl shadow-lg">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Expected Flow:</h2>
            <ol class="space-y-2 text-gray-700">
                <li class="flex items-start">
                    <span class="mr-2 text-blue-500 font-bold">1.</span>
                    <span><strong>"Your AI persona is getting closer"</strong> - Email entry page</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2 text-blue-500 font-bold">2.</span>
                    <span><strong>"Enter verification code"</strong> - 6-digit code entry</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2 text-blue-500 font-bold">3.</span>
                    <span><strong>Onboarding</strong> (new users) or <strong>Data Request</strong> (existing users)</span>
                </li>
            </ol>
        </div>

        <!-- Test Mode Notice -->
        <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <h3 class="font-semibold mb-2 text-yellow-800">🧪 Test Mode Active:</h3>
            <ul class="text-yellow-700 text-sm space-y-1">
                <li>• Any valid email format will work</li>
                <li>• Use verification code: <strong>123456</strong></li>
                <li>• Flow will proceed through email → code → onboarding/data request</li>
            </ul>
        </div>

        <!-- Onairos Button -->
        <div class="text-center mb-6">
            <h3 class="text-lg font-semibold mb-4">Click to Test New Email Flow:</h3>
            <div id="button-container" class="inline-block"></div>
        </div>

        <!-- Status -->
        <div id="status" class="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg">
            <h3 class="font-semibold mb-2">Status:</h3>
            <div id="status-content">Loading...</div>
        </div>

        <!-- Results -->
        <div id="result" class="mt-6 p-6 bg-white border border-gray-200 rounded-xl shadow-lg hidden">
            <h3 class="font-semibold mb-4 text-lg text-gray-800">
                📊 Flow Completion Result:
            </h3>
            <pre id="result-data" class="text-sm text-gray-700 bg-gray-50 p-4 rounded-lg overflow-auto max-h-96"></pre>
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status-content');
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            status.className = colors[type] || colors.info;
            status.textContent = message;
            console.log(message);
        }

        function renderButton() {
            const { OnairosButton } = window.Onairos || {};
            
            if (!OnairosButton) {
                updateStatus('❌ OnairosButton not found in window.Onairos', 'error');
                return;
            }

            updateStatus('✅ OnairosButton found, rendering...', 'success');

            const buttonElement = React.createElement(OnairosButton, {
                requestData: ['basic', 'personality', 'preferences'],
                webpageName: 'Email Flow Test',
                onComplete: handleComplete,
                autoFetch: false,
                testMode: true,
                buttonType: 'pill',
                visualType: 'full',
                textColor: 'black',
                appIcon: 'https://onairos.sirv.com/Images/OnairosBlack.png'
            });

            ReactDOM.render(buttonElement, document.getElementById('button-container'));
            updateStatus('🚀 Button rendered successfully! Click to test the flow.', 'success');
        }

        function handleComplete(result) {
            updateStatus('🎉 Flow completed successfully!', 'success');
            
            // Show results
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('result-data').textContent = JSON.stringify(result, null, 2);
        }

        // Initialize
        updateStatus('🔄 Checking for Onairos SDK...', 'info');
        
        // Check if Onairos is available
        if (window.Onairos) {
            updateStatus('✅ Onairos SDK found immediately', 'success');
            renderButton();
        } else {
            // Wait a bit for it to load
            let attempts = 0;
            const checkInterval = setInterval(() => {
                attempts++;
                
                if (window.Onairos) {
                    clearInterval(checkInterval);
                    updateStatus('✅ Onairos SDK loaded successfully', 'success');
                    renderButton();
                } else if (attempts > 30) { // 3 seconds
                    clearInterval(checkInterval);
                    updateStatus('❌ Failed to load Onairos SDK. Check browser console for errors.', 'error');
                    
                    // Try to provide helpful debugging info
                    const scripts = Array.from(document.scripts);
                    const onairosScript = scripts.find(s => s.src.includes('onairos'));
                    if (onairosScript) {
                        console.log('Onairos script found:', onairosScript.src);
                        console.log('Script loaded:', !onairosScript.defer);
                    } else {
                        console.log('No Onairos script found in page');
                    }
                    
                    console.log('Available globals:', Object.keys(window).filter(k => k.toLowerCase().includes('onairos')));
                }
            }, 100);
        }
    </script>
</body>
</html> 