{"version":3,"file":"821.js","mappings":"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","sources":["webpack://OnairosLaravel/./src/components/WelcomeScreen.jsx","webpack://OnairosLaravel/./src/theme/colors.js","webpack://OnairosLaravel/./src/components/ui/PrimaryButton.jsx","webpack://OnairosLaravel/./src/utils/capacitorDetection.js","webpack://OnairosLaravel/./src/components/EmailAuth.js","webpack://OnairosLaravel/./src/components/ConnectChatGPTModal.jsx","webpack://OnairosLaravel/./src/components/UniversalOnboarding.jsx","webpack://OnairosLaravel/./src/components/PinSetup.js","webpack://OnairosLaravel/./src/components/DataRequest.js","webpack://OnairosLaravel/./src/components/TrainingComponent.jsx","webpack://OnairosLaravel/./src/components/TrainingScreen.jsx","webpack://OnairosLaravel/./src/components/LoadingScreen.jsx","webpack://OnairosLaravel/./src/components/WrappedLoadingPage.jsx","webpack://OnairosLaravel/./src/utils/responseFormatter.js","webpack://OnairosLaravel/./src/utils/userDataFormatter.js","webpack://OnairosLaravel/./src/components/ui/PageLayout.jsx","webpack://OnairosLaravel/./src/utils/sessionManager.js","webpack://OnairosLaravel/./src/onairosButton.jsx","webpack://OnairosLaravel/./src/utils/apiResponseLogger.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { COLORS } from '../theme/colors.js';\r\n\r\nexport default function WelcomeScreen({ onContinue, onClose }) {\r\n  // Load Sirv script for responsive images\r\n  useEffect(() => {\r\n    const script = document.createElement('script');\r\n    script.src = 'https://scripts.sirv.com/sirvjs/v3/sirv.js';\r\n    script.async = true;\r\n    document.head.appendChild(script);\r\n    \r\n    return () => {\r\n      const existingScript = document.querySelector('script[src=\"https://scripts.sirv.com/sirvjs/v3/sirv.js\"]');\r\n      if (existingScript) {\r\n        document.head.removeChild(existingScript);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"w-full flex flex-col\" style={{ height: '100%' }}>\r\n      {/* Content - Flexible center area */}\r\n      <div className=\"px-6 pt-16 text-center flex-1 flex flex-col\">\r\n        {/* Logo */}\r\n        <div className=\"mb-8 flex justify-center\">\r\n          <div className=\"w-20 h-20 flex items-center justify-center\">\r\n            <img \r\n              className=\"Sirv w-full h-full object-contain\" \r\n              data-src=\"https://anushkasirv.sirv.com/OnairosBlack.png\" \r\n              alt=\"Onairos Logo\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Welcome Text */}\r\n        <p className=\"text-gray-500 text-sm mb-2\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Welcome to</p>\r\n\r\n        {/* Main Title */}\r\n        <h1 className=\"text-4xl font-bold text-gray-900 mb-6 text-balance\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>Onairos</h1>\r\n\r\n        {/* Description */}\r\n        <p className=\"text-gray-600 text-base leading-relaxed mb-12 text-pretty px-2\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n          The secure, portable persona built form your data. Every app personalized while your data stays yours.\r\n        </p>\r\n      </div>\r\n\r\n      {/* Get Started Button - Fixed at bottom */}\r\n      <div className=\"px-6 pb-8 flex-shrink-0\">\r\n        <button\r\n          className=\"w-full bg-gray-900 hover:bg-gray-800 text-white rounded-full py-4 text-base font-medium flex items-center justify-center gap-2 transition-colors\"\r\n          style={{ fontFamily: 'Inter, system-ui, sans-serif' }}\r\n          onClick={onContinue}\r\n        >\r\n          Get Started\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// Theme colors for Onairos SDK - derived from mobile design\r\nexport const COLORS = {\r\n  // Button gradient colors\r\n  btnGradStart: '#1A1A1A',\r\n  btnGradEnd: '#000000',\r\n  \r\n  // Button text and icon colors\r\n  btnLabel: '#FFFFFF',\r\n  btnBorder: 'rgba(0, 0, 0, 0.2)',\r\n  \r\n  // Icon circle gradient colors\r\n  iconCircleGradientStart: '#333333',\r\n  iconCircleGradientEnd: '#1A1A1A',\r\n  \r\n  // Background colors\r\n  background: '#FFFFFF',\r\n  backgroundSecondary: '#F8F9FA',\r\n  \r\n  // Text colors\r\n  textPrimary: '#1A1A1A',\r\n  textSecondary: '#6B7280',\r\n  textMuted: '#9CA3AF',\r\n  \r\n  // Border colors\r\n  border: '#E5E7EB',\r\n  borderLight: '#F3F4F6',\r\n  \r\n  // Status colors\r\n  success: '#10B981',\r\n  error: '#EF4444',\r\n  warning: '#F59E0B',\r\n  info: '#3B82F6',\r\n  \r\n  // Interactive states\r\n  hover: 'rgba(0, 0, 0, 0.05)',\r\n  pressed: 'rgba(0, 0, 0, 0.1)',\r\n  focus: 'rgba(59, 130, 246, 0.1)',\r\n};\r\n\r\nexport default COLORS; ","import React, { useState } from 'react';\r\nimport { COLORS } from '../../theme/colors.js';\r\n\r\n// Icon Circle component matching the React Native version\r\nconst IconCircle = ({ \r\n  size = 40, \r\n  children,\r\n  className = ''\r\n}) => {\r\n  return (\r\n    <div \r\n      className={`relative flex items-center justify-center border border-black border-opacity-25 ${className}`}\r\n      style={{\r\n        width: size,\r\n        height: size,\r\n        borderRadius: size / 2,\r\n        background: `linear-gradient(to bottom, ${COLORS.iconCircleGradientStart}, ${COLORS.iconCircleGradientEnd})`\r\n      }}\r\n    >\r\n      {children || (\r\n        <span \r\n          className=\"font-semibold opacity-95\"\r\n          style={{\r\n            fontSize: '20px',\r\n            color: COLORS.btnLabel,\r\n            backgroundColor: 'transparent',\r\n            fontFamily: 'Inter, system-ui, sans-serif'\r\n          }}\r\n        >\r\n          \r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Primary Button component matching the React Native design\r\nconst PrimaryButton = ({\r\n  label = \"Get Started\",\r\n  onClick,\r\n  iconRight,\r\n  loading = false,\r\n  disabled = false,\r\n  testId,\r\n  className = '',\r\n  style = {},\r\n  textStyle = {},\r\n  centered = false,\r\n  ...props\r\n}) => {\r\n  const [pressed, setPressed] = useState(false);\r\n\r\n  const handleMouseDown = () => setPressed(true);\r\n  const handleMouseUp = () => setPressed(false);\r\n  const handleMouseLeave = () => setPressed(false);\r\n\r\n  const buttonStyle = {\r\n    height: '48px',\r\n    borderRadius: '100px',\r\n    border: `1px solid ${COLORS.btnBorder}`,\r\n    background: `linear-gradient(to bottom, ${COLORS.btnGradStart}, ${COLORS.btnGradEnd})`,\r\n    position: 'relative',\r\n    overflow: 'hidden',\r\n    width: centered ? 'auto' : '100%',\r\n    minWidth: centered ? '250px' : 'auto',\r\n    maxWidth: centered ? '350px' : 'none',\r\n    margin: centered ? '0 auto' : '0',\r\n    cursor: disabled ? 'not-allowed' : 'pointer',\r\n    opacity: disabled ? 0.65 : 1,\r\n    boxShadow: disabled ? 'none' : '20px 30px 40px rgba(0,0,0,0.10)',\r\n    transition: 'all 0.2s ease',\r\n    ...style\r\n  };\r\n\r\n  const pressedOverlayStyle = {\r\n    position: 'absolute',\r\n    top: 0,\r\n    left: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    backgroundColor: 'rgba(0,0,0,0.1)',\r\n    borderRadius: '100px',\r\n    opacity: pressed ? 1 : 0,\r\n    transition: 'opacity 0.1s ease'\r\n  };\r\n\r\n  const textContainerStyle = {\r\n    position: 'absolute',\r\n    left: 0,\r\n    right: 0,\r\n    top: 0,\r\n    bottom: 0,\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    backgroundColor: 'transparent'\r\n  };\r\n\r\n  const iconPositionStyle = {\r\n    position: 'absolute',\r\n    right: '4px',\r\n    top: '4px',\r\n    bottom: '4px',\r\n    width: '40px',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    backgroundColor: 'transparent'\r\n  };\r\n\r\n  const labelStyle = {\r\n    fontFamily: 'Inter, system-ui, sans-serif',\r\n    fontWeight: '600',\r\n    fontSize: '16px',\r\n    color: COLORS.btnLabel,\r\n    textAlign: 'center',\r\n    backgroundColor: 'transparent',\r\n    ...textStyle\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className={`relative ${className}`}\r\n      style={buttonStyle}\r\n      onClick={onClick}\r\n      onMouseDown={handleMouseDown}\r\n      onMouseUp={handleMouseUp}\r\n      onMouseLeave={handleMouseLeave}\r\n      disabled={disabled || loading}\r\n      data-testid={testId}\r\n      aria-label={label}\r\n      {...props}\r\n    >\r\n      {/* Pressed state overlay */}\r\n      <div style={pressedOverlayStyle} />\r\n\r\n      {/* Centered text container */}\r\n      <div style={textContainerStyle}>\r\n        {loading ? (\r\n          <div \r\n            className=\"animate-spin rounded-full border-2 border-white border-t-transparent\"\r\n            style={{ width: '20px', height: '20px' }}\r\n          />\r\n        ) : (\r\n          <span style={labelStyle}>{label}</span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Icon in fixed position on right */}\r\n      <div style={iconPositionStyle}>\r\n        {!loading && (iconRight || <IconCircle />)}\r\n      </div>\r\n    </button>\r\n  );\r\n};\r\n\r\nexport { IconCircle };\r\nexport default PrimaryButton; ","/**\r\n * Capacitor/Mobile Environment Detection Utility\r\n * \r\n * Detects if the app is running in a Capacitor environment\r\n * and provides mobile-specific functionality\r\n */\r\n\r\n/**\r\n * Detect if running in Capacitor environment\r\n * @returns {boolean} True if running in Capacitor\r\n */\r\nexport const isCapacitor = () => {\r\n  // Check for Capacitor global object\r\n  if (typeof window !== 'undefined' && window.Capacitor) {\r\n    return true;\r\n  }\r\n  \r\n  // Check for Capacitor plugins\r\n  if (typeof window !== 'undefined' && window.Capacitor?.Plugins) {\r\n    return true;\r\n  }\r\n  \r\n  // Check for Capacitor native bridge\r\n  if (typeof window !== 'undefined' && window.webkit?.messageHandlers?.bridge) {\r\n    return true;\r\n  }\r\n  \r\n  return false;\r\n};\r\n\r\n/**\r\n * Detect if running in React Native environment\r\n * @returns {boolean} True if running in React Native\r\n */\r\nexport const isReactNative = () => {\r\n  return typeof navigator !== 'undefined' && navigator.product === 'ReactNative' ||\r\n         typeof global !== 'undefined' && global.nativeModuleProxy !== undefined;\r\n};\r\n\r\n/**\r\n * Detect if running in any mobile app environment (Capacitor or React Native)\r\n * @returns {boolean} True if running in a mobile app\r\n */\r\nexport const isMobileApp = () => {\r\n  return isCapacitor() || isReactNative();\r\n};\r\n\r\n/**\r\n * Detect if running on iOS\r\n * @returns {boolean} True if running on iOS\r\n */\r\nexport const isIOS = () => {\r\n  if (typeof window !== 'undefined' && window.Capacitor) {\r\n    return window.Capacitor.getPlatform() === 'ios';\r\n  }\r\n  \r\n  // Fallback to user agent detection\r\n  return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n};\r\n\r\n/**\r\n * Detect if running on Android\r\n * @returns {boolean} True if running on Android\r\n */\r\nexport const isAndroid = () => {\r\n  if (typeof window !== 'undefined' && window.Capacitor) {\r\n    return window.Capacitor.getPlatform() === 'android';\r\n  }\r\n  \r\n  // Fallback to user agent detection\r\n  return /Android/.test(navigator.userAgent);\r\n};\r\n\r\n/**\r\n * Get platform information\r\n * @returns {Object} Platform details\r\n */\r\nexport const getPlatformInfo = () => {\r\n  return {\r\n    isCapacitor: isCapacitor(),\r\n    isReactNative: isReactNative(),\r\n    isMobileApp: isMobileApp(),\r\n    isIOS: isIOS(),\r\n    isAndroid: isAndroid(),\r\n    platform: window.Capacitor ? window.Capacitor.getPlatform() : 'web',\r\n    userAgent: navigator.userAgent\r\n  };\r\n};\r\n\r\n/**\r\n * Detect if mobile browser (not Capacitor, just mobile web browser)\r\n * @returns {boolean} True if mobile browser\r\n */\r\nexport const isMobileBrowser = () => {\r\n  if (isMobileApp()) {\r\n    return false; // Capacitor/RN apps are not browsers\r\n  }\r\n  \r\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\r\n         (window.innerWidth <= 768);\r\n};\r\n\r\n/**\r\n * Get environment type\r\n * @returns {string} Environment type: 'capacitor', 'react-native', 'mobile-browser', 'desktop-browser'\r\n */\r\nexport const getEnvironmentType = () => {\r\n  if (isCapacitor()) return 'capacitor';\r\n  if (isReactNative()) return 'react-native';\r\n  if (isMobileBrowser()) return 'mobile-browser';\r\n  return 'desktop-browser';\r\n};\r\n\r\n/**\r\n * Check if browser extension support is available\r\n * Browser extensions don't work in Capacitor/React Native\r\n * @returns {boolean} True if browser extensions are supported\r\n */\r\nexport const supportsBrowserExtensions = () => {\r\n  return !isMobileApp();\r\n};\r\n\r\n/**\r\n * Log platform information for debugging\r\n */\r\nexport const logPlatformInfo = () => {\r\n  const info = getPlatformInfo();\r\n  console.log(' Platform Detection:', info);\r\n  console.log(' Environment Type:', getEnvironmentType());\r\n  console.log(' Browser Extensions Supported:', supportsBrowserExtensions());\r\n  return info;\r\n};\r\n\r\n\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { Mail, ArrowRight, Check } from 'lucide-react';\r\nimport PrimaryButton from './ui/PrimaryButton.jsx';\r\nimport { COLORS } from '../theme/colors.js';\r\nimport { Browser } from '@capacitor/browser';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport { isMobileBrowser } from '../utils/capacitorDetection';\r\nimport { useGoogleLogin } from '@react-oauth/google';\r\n\r\n// Custom Google Button for consistent dimensions\r\nconst GoogleButton = ({ onPress, disabled }) => {\r\n  const [isPressed, setIsPressed] = useState(false);\r\n\r\n  return (\r\n    <button\r\n      onClick={onPress}\r\n      disabled={disabled}\r\n      onMouseDown={() => setIsPressed(true)}\r\n      onMouseUp={() => setIsPressed(false)}\r\n      onMouseLeave={() => setIsPressed(false)}\r\n      onTouchStart={() => setIsPressed(true)}\r\n      onTouchEnd={() => setIsPressed(false)}\r\n      className={`w-full h-14 bg-[#FAFAFA] rounded-lg border border-[#E5E5E5] flex items-center justify-center px-4 transition-all ${isPressed ? 'bg-[#F0F0F0] border-[#D0D0D0] scale-[0.98]' : 'shadow-sm'}`}\r\n      style={{ \r\n        outline: 'none',\r\n        // Match dimensions of the email input (h-14 = 3.5rem = 56px)\r\n        height: '56px'\r\n      }}\r\n      type=\"button\"\r\n    >\r\n      <img \r\n        src=\"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg\" \r\n        alt=\"Google\" \r\n        className=\"w-5 h-5 mr-3\" \r\n      />\r\n      <span \r\n        className=\"text-base font-medium text-[#1F242F]\"\r\n        style={{ fontFamily: 'Inter, system-ui, sans-serif' }}\r\n      >\r\n        Continue with Google\r\n      </span>\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default function EmailAuth({ onSuccess, testMode = false }) {\r\n  const [email, setEmail] = useState('');\r\n  // Store verification code as per-digit state\r\n  const [codeDigits, setCodeDigits] = useState(() => Array(6).fill(''));\r\n  const [step, setStep] = useState('email'); // 'email' | 'code' | 'success'\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [emailSent, setEmailSent] = useState(true);\r\n  const [emailServiceMessage, setEmailServiceMessage] = useState('');\r\n  \r\n  const isCodeComplete = codeDigits.every((d) => typeof d === 'string' && d.length === 1);\r\n  const resetCodeDigits = () => setCodeDigits(Array(6).fill(''));\r\n  const isMobileWeb = isMobileBrowser();\r\n\r\n  const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\n  const postJson = async (url, apiKey, body) => {\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'x-api-key': apiKey,\r\n        'Authorization': `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify(body),\r\n    });\r\n    return response;\r\n  };\r\n\r\n  const requestEmailVerification = async ({ baseUrl, apiKey, email: rawEmail }) => {\r\n    const normalizedEmail = (rawEmail || '').trim().toLowerCase();\r\n\r\n    // New endpoint\r\n    try {\r\n      const res = await postJson(`${baseUrl}/email/verification`, apiKey, {\r\n        email: normalizedEmail,\r\n        action: 'request',\r\n      });\r\n      if (res.ok) return await res.json();\r\n    } catch {\r\n      // ignore and fall back\r\n    }\r\n\r\n    // Legacy endpoint\r\n    const legacyRes = await postJson(`${baseUrl}/email/verify`, apiKey, { email: normalizedEmail });\r\n    if (!legacyRes.ok) {\r\n      let msg = 'Failed to send verification code';\r\n      try {\r\n        const err = await legacyRes.json();\r\n        if (err?.error) msg = err.error;\r\n      } catch {}\r\n      throw new Error(msg);\r\n    }\r\n    return await legacyRes.json();\r\n  };\r\n\r\n  const verifyEmailCode = async ({ baseUrl, apiKey, email: rawEmail, code: rawCode }) => {\r\n    const normalizedEmail = (rawEmail || '').trim().toLowerCase();\r\n    const normalizedCode = String(rawCode || '').trim();\r\n\r\n    // New endpoint\r\n    try {\r\n      const res = await postJson(`${baseUrl}/email/verification`, apiKey, {\r\n        email: normalizedEmail,\r\n        action: 'verify',\r\n        code: normalizedCode,\r\n      });\r\n      if (res.ok) return await res.json();\r\n      try {\r\n        const err = await res.json();\r\n        throw new Error(err?.error || err?.message || 'Verification failed');\r\n      } catch (e) {\r\n        if (e instanceof Error) throw e;\r\n      }\r\n    } catch (e) {\r\n      const msg = e?.message || '';\r\n      if (msg && !msg.toLowerCase().includes('not found') && !msg.toLowerCase().includes('cannot')) {\r\n        // Keep going to legacy\r\n      }\r\n    }\r\n\r\n    // Legacy endpoint with retry\r\n    const maxAttempts = 5;\r\n    for (let attempt = 1; attempt <= maxAttempts; attempt++) {\r\n      const res = await postJson(`${baseUrl}/email/verify/confirm`, apiKey, {\r\n        email: normalizedEmail,\r\n        code: normalizedCode,\r\n      });\r\n\r\n      if (res.ok) return await res.json();\r\n\r\n      let errMsg = 'Invalid verification code';\r\n      try {\r\n        const err = await res.json();\r\n        if (err?.error) errMsg = err.error;\r\n        if (typeof err?.attemptsRemaining === 'number') {\r\n          errMsg = `${errMsg} (attempts remaining: ${err.attemptsRemaining})`;\r\n        }\r\n      } catch {}\r\n\r\n      if (errMsg.toLowerCase().includes('no verification code found') && attempt < maxAttempts) {\r\n        await sleep(150 * attempt);\r\n        continue;\r\n      }\r\n\r\n      throw new Error(errMsg);\r\n    }\r\n\r\n    throw new Error('Verification failed');\r\n  };\r\n\r\n  const handleOAuthSuccess = async (gmailEmail, credential) => {\r\n    try {\r\n      setIsLoading(true);\r\n      console.log(' Google OAuth completed successfully, email:', gmailEmail);\r\n\r\n      const normalizedEmail = (gmailEmail || '').trim().toLowerCase();\r\n      setEmail(normalizedEmail);\r\n\r\n      const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\r\n      const apiKey = (typeof window !== 'undefined' && window.onairosApiKey) || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey';\r\n\r\n      // STEP 1: Call backend to create/login account\r\n      console.log(' Authenticating with backend via /google/google...');\r\n      \r\n      try {\r\n        const authResponse = await fetch(`${baseUrl}/google/google`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'x-api-key': apiKey,\r\n          },\r\n          body: JSON.stringify({\r\n            credential: credential  // Google access token from SDK\r\n          })\r\n        });\r\n\r\n        if (!authResponse.ok) {\r\n          const errorData = await authResponse.json();\r\n          throw new Error(errorData.body?.message || 'Failed to authenticate with backend');\r\n        }\r\n\r\n        const authData = await authResponse.json();\r\n        console.log(' Backend authentication successful:', {\r\n          username: authData.body?.username,\r\n          isNewUser: authData.body?.isNewUser\r\n        });\r\n\r\n        // Extract data from backend response\r\n        const jwtToken = authData.body?.token;\r\n        const username = authData.body?.username || normalizedEmail;\r\n        const isNewUser = authData.body?.isNewUser !== false; // Default to true if not specified\r\n\r\n        // STEP 2: Check account status for additional info\r\n        let accountInfo = null;\r\n        let accountStatus = null;\r\n\r\n        try {\r\n          console.log(' Fetching account status...');\r\n          const accountCheckResponse = await fetch(`${baseUrl}/getAccountInfo/email`, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              'x-api-key': apiKey,\r\n            },\r\n            body: JSON.stringify({\r\n              Info: {\r\n                identifier: normalizedEmail\r\n              }\r\n            })\r\n          });\r\n\r\n          if (accountCheckResponse.ok) {\r\n            const accountData = await accountCheckResponse.json();\r\n            if (accountData.AccountInfo) {\r\n              accountInfo = accountData.AccountInfo;\r\n              accountStatus = accountData.accountStatus;\r\n              console.log(' Account status retrieved:', {\r\n                exists: accountStatus?.exists,\r\n                connectedPlatforms: accountStatus?.connectedPlatforms\r\n              });\r\n            }\r\n          }\r\n        } catch (accountCheckError) {\r\n          console.warn(' Could not fetch account status (non-critical):', accountCheckError);\r\n        }\r\n\r\n        setStep('success');\r\n        setIsLoading(false);\r\n\r\n        // STEP 3: Return success with token and user data\r\n        setTimeout(() => {\r\n          onSuccess({\r\n            email: normalizedEmail,\r\n            verified: true,\r\n            token: jwtToken,  //  NOW we have a JWT token from backend!\r\n            jwtToken: jwtToken,\r\n            userName: username,\r\n            username: username,\r\n            existingUser: !isNewUser,\r\n            accountInfo: accountInfo,\r\n            accountStatus: accountStatus,\r\n            isNewUser: isNewUser,\r\n            flowType: isNewUser ? 'onboarding' : 'dataRequest',\r\n            adminMode: false,\r\n            userCreated: isNewUser,\r\n            provider: 'google',\r\n            accountDetails: accountInfo || {\r\n              email: normalizedEmail,\r\n              createdAt: new Date().toISOString(),\r\n              ssoProvider: 'google'\r\n            }\r\n          });\r\n        }, 400);\r\n\r\n      } catch (authError) {\r\n        console.error(' Backend authentication failed:', authError);\r\n        setError(authError.message || 'Failed to authenticate with backend. Please try again.');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n    \r\n    } catch (error) {\r\n      console.error(' Error handling OAuth success:', error);\r\n      setError('Failed to continue with Google authentication. Please try again.');\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Note: No OAuth callback checking needed - frontend SDK handles everything automatically\r\n\r\n  // Google Sign-In using frontend SDK\r\n  // Only requests basic scopes: openid, email, profile (NO Gmail reading permissions)\r\n  const googleLogin = useGoogleLogin({\r\n    onSuccess: async (tokenResponse) => {\r\n      try {\r\n        console.log(' Google OAuth successful');\r\n        console.log(' Access token received from Google');\r\n        \r\n        // Get user info from Google\r\n        const userInfoResponse = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {\r\n          headers: { Authorization: `Bearer ${tokenResponse.access_token}` }\r\n        });\r\n        \r\n        if (!userInfoResponse.ok) {\r\n          throw new Error('Failed to get user info from Google');\r\n        }\r\n        \r\n        const userInfo = await userInfoResponse.json();\r\n        console.log(' Google user info retrieved:', { email: userInfo.email, name: userInfo.name });\r\n        \r\n        // Handle OAuth success with user email AND access token (credential)\r\n        // Backend needs the access token to verify and create account\r\n        await handleOAuthSuccess(userInfo.email, tokenResponse.access_token);\r\n        \r\n      } catch (error) {\r\n        console.error(' Error fetching Google user info:', error);\r\n        setError('Failed to get your Google account information. Please try again.');\r\n        setIsLoading(false);\r\n      }\r\n    },\r\n    onError: (error) => {\r\n      console.error(' Google Sign In failed:', error);\r\n      setError('Failed to sign in with Google. Please try again.');\r\n      setIsLoading(false);\r\n    },\r\n    scope: 'openid email profile', // Basic scopes only - NO Gmail reading permissions\r\n    flow: 'implicit'\r\n  });\r\n\r\n  const handleGoogleSignIn = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError('');\r\n      console.log(' Initiating Google Sign-In (basic auth only)...');\r\n      \r\n      // Trigger Google login\r\n      googleLogin();\r\n      \r\n    } catch (e) {\r\n      console.error(' Google Sign In failed:', e);\r\n      setError('Failed to initialize Google Sign In. Please try again.');\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Auto-focus code input\r\n  useEffect(() => {\r\n    if (step === 'code') {\r\n      setTimeout(() => {\r\n        const firstInput = document.querySelector('input.onairos-verification-digit');\r\n        if (firstInput) firstInput.focus();\r\n      }, 100);\r\n    }\r\n  }, [step]);\r\n\r\n  const validateEmail = (email) => {\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    return emailRegex.test(email);\r\n  };\r\n\r\n  const handleEmailSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setEmailSent(true);\r\n    setEmailServiceMessage('');\r\n    resetCodeDigits();\r\n\r\n    if (!validateEmail(email)) {\r\n      setError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (testMode) {\r\n        setTimeout(() => {\r\n          setStep('code');\r\n          setIsLoading(false);\r\n        }, 800);\r\n      } else {\r\n        const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\r\n        const apiKey = (typeof window !== 'undefined' && window.onairosApiKey) || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey';\r\n        const data = await requestEmailVerification({ baseUrl, apiKey, email });\r\n\r\n        setEmailSent(data.emailSent !== false);\r\n        setEmailServiceMessage(data.message || '');\r\n\r\n        setStep('code');\r\n        setIsLoading(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Email request error:', error);\r\n      setError(error.message);\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCodeSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (testMode) {\r\n        const code = codeDigits.join('');\r\n        if (code === '123456' || isCodeComplete) {\r\n          setStep('success');\r\n          setTimeout(() => {\r\n            onSuccess({ \r\n              email, \r\n              verified: true, \r\n              token: 'test-token',\r\n              userName: email.split('@')[0],\r\n              existingUser: false,\r\n              isNewUser: true,\r\n              flowType: 'onboarding',\r\n              accountDetails: {\r\n                email: email,\r\n                createdAt: new Date().toISOString(),\r\n                testAccount: true\r\n              }\r\n            });\r\n          }, 600);\r\n        } else {\r\n          setError('Invalid code.');\r\n          setIsLoading(false);\r\n        }\r\n      } else {\r\n        const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\r\n        const apiKey = (typeof window !== 'undefined' && window.onairosApiKey) || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey';\r\n        const codeToSubmit = codeDigits.join('');\r\n\r\n        if (!isCodeComplete) {\r\n          throw new Error('Please enter the full 6-digit code.');\r\n        }\r\n\r\n        const data = await verifyEmailCode({ baseUrl, apiKey, email, code: codeToSubmit.trim() });\r\n        \r\n        if (!data.success) {\r\n          throw new Error(data.error || 'Verification failed');\r\n        }\r\n\r\n        // Email-code verification responses are not always consistent about returning accountStatus,\r\n        // especially for existing users. To keep DataRequest connected apps accurate, we perform the\r\n        // same accountStatus lookup that Google OAuth uses.\r\n        let accountInfo = data.user || data.accountInfo || null;\r\n        let accountStatus = data.accountStatus || null;\r\n        let existingUser = false;\r\n        let isNewUser = data.isNewUser !== undefined ? data.isNewUser : true;\r\n\r\n        try {\r\n          const normalizedEmail = String(email || '').trim().toLowerCase();\r\n          if (normalizedEmail) {\r\n            console.log(' (Email) Checking account status via /getAccountInfo/email for:', normalizedEmail);\r\n            const accountCheckResponse = await fetch(`${baseUrl}/getAccountInfo/email`, {\r\n              method: 'POST',\r\n              headers: {\r\n                'Content-Type': 'application/json',\r\n                'x-api-key': apiKey,\r\n              },\r\n              body: JSON.stringify({\r\n                Info: {\r\n                  identifier: normalizedEmail,\r\n                },\r\n              }),\r\n            });\r\n\r\n            if (accountCheckResponse.ok) {\r\n              const accountData = await accountCheckResponse.json();\r\n              // Explicit \"no account\" response -> force onboarding for truly new users\r\n              const noAccount =\r\n                !accountData?.AccountInfo ||\r\n                accountData?.AccountInfo === 'No Account Found' ||\r\n                (typeof accountData?.accountStatus?.exists === 'boolean' && accountData.accountStatus.exists === false);\r\n\r\n              if (noAccount) {\r\n                accountInfo = null;\r\n                accountStatus = accountData?.accountStatus || { exists: false, connectedPlatforms: [] };\r\n                existingUser = false;\r\n                isNewUser = true;\r\n              } else if (accountData?.AccountInfo) {\r\n                accountInfo = accountInfo || accountData.AccountInfo;\r\n              }\r\n              if (accountData?.accountStatus) {\r\n                accountStatus = accountData.accountStatus;\r\n              }\r\n              if (typeof accountStatus?.exists === 'boolean') {\r\n                existingUser = accountStatus.exists;\r\n                isNewUser = !accountStatus.exists;\r\n              }\r\n            } else {\r\n              console.log(' (Email) /getAccountInfo/email returned non-OK; continuing with verification response');\r\n            }\r\n          }\r\n        } catch (accountCheckError) {\r\n          console.warn(' (Email) Could not check account status; continuing with verification response:', accountCheckError);\r\n        }\r\n\r\n        // Fall back if accountStatus didn't provide an exists boolean\r\n        if (typeof accountStatus?.exists !== 'boolean') {\r\n          existingUser = !isNewUser;\r\n        }\r\n\r\n        setStep('success');\r\n        setTimeout(() => {\r\n          onSuccess({ \r\n            email, \r\n            verified: true, \r\n            token: data.token || data.jwtToken,\r\n            userName: data.userName || accountInfo?.userName,\r\n            existingUser: existingUser,\r\n            isNewUser: isNewUser,\r\n            flowType: isNewUser ? 'onboarding' : 'dataRequest',\r\n            accountInfo: accountInfo,\r\n            accountStatus: accountStatus,\r\n            accountDetails: accountInfo || {\r\n              email: email,\r\n              createdAt: data.createdAt || new Date().toISOString(),\r\n              provider: 'email'\r\n            }\r\n          });\r\n        }, 1000);\r\n      }\r\n    } catch (error) {\r\n      console.error('Email verification error:', error);\r\n      setError(error.message || 'Invalid code. Please try again.');\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // --- RENDER HELPERS ---\r\n\r\n  const renderEmailStep = () => {\r\n    // Mobile Web Layout (OnairosEvents Style)\r\n    if (isMobileWeb) {\r\n      return (\r\n        <div className=\"w-full flex flex-col h-full px-6 pt-8\">\r\n          <div className=\"flex-1 flex flex-col\">\r\n            <div className=\"mb-8 w-full text-left\">\r\n              <h1 className=\"text-2xl font-bold mb-2 leading-tight\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif', color: '#000000' }}>\r\n                Build your Onairos persona to own your digital identity\r\n          </h1>\r\n              <p className=\"text-base\" style={{ fontFamily: 'Inter, system-ui, sans-serif', color: '#62646C' }}>\r\n                Sign in or create an account\r\n              </p>\r\n        </div>\r\n\r\n            {/* Email Input */}\r\n            <div className=\"mb-4 w-full\">\r\n          <input\r\n            type=\"email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            placeholder=\"Enter your email\"\r\n                className=\"w-full outline-none transition-all placeholder-gray-500 bg-[#F5F5F5] rounded-lg border border-[#E5E5E5] text-[#1F242F]\"\r\n            style={{ \r\n                  height: '56px', \r\n                  paddingLeft: 16, \r\n                  paddingRight: 16, \r\n                  fontSize: 16, \r\n                  fontFamily: 'Inter, system-ui, sans-serif',\r\n                  color: '#000000',\r\n                  WebkitTextFillColor: '#000000'\r\n                }}\r\n                onKeyDown={(e) => { if (e.key === 'Enter') handleEmailSubmit(e); }}\r\n                disabled={isLoading}\r\n                autoFocus\r\n          />\r\n        </div>\r\n\r\n            {/* Continue Button (Below Email Input) */}\r\n            <div className=\"mb-6 w-full\">\r\n              <PrimaryButton\r\n                label={isLoading ? 'Loading...' : 'Continue'}\r\n                onClick={handleEmailSubmit}\r\n                disabled={isLoading || !email.trim()}\r\n                loading={isLoading}\r\n                className=\"!text-white w-full h-14 rounded-full\"\r\n                textStyle={{ color: '#FFFFFF' }}\r\n              />\r\n            </div>\r\n\r\n            {/* Divider */}\r\n            <div className=\"flex items-center gap-4 mb-6\">\r\n              <div className=\"h-[1px] bg-[#E5E5E5] flex-1\" />\r\n              <span className=\"text-sm text-[#86888E]\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Or</span>\r\n              <div className=\"h-[1px] bg-[#E5E5E5] flex-1\" />\r\n            </div>\r\n\r\n            {/* Google Button */}\r\n            <div className=\"mb-8 w-full\">\r\n              <GoogleButton onPress={handleGoogleSignIn} disabled={isLoading} />\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-6\">\r\n            <p className=\"text-sm text-center\" style={{ color: COLORS.error }}>{error}</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Desktop Layout (Centered Card)\r\n    return (\r\n      <div className=\"flex flex-col h-full items-center justify-center p-6 text-center max-w-sm mx-auto\">\r\n        <h1 className=\"text-2xl font-bold mb-2 text-gray-900\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>Sign in to Onairos</h1>\r\n        <p className=\"text-gray-600 mb-8\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Access your digital persona</p>\r\n\r\n        <div className=\"w-full space-y-4\">\r\n          <input\r\n            type=\"email\"\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            placeholder=\"name@example.com\"\r\n            className=\"w-full px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\r\n            style={{ color: '#000000', WebkitTextFillColor: '#000000', fontFamily: 'Inter, system-ui, sans-serif' }}\r\n            onKeyDown={(e) => { if (e.key === 'Enter') handleEmailSubmit(e); }}\r\n            disabled={isLoading}\r\n            autoFocus\r\n          />\r\n        <button\r\n          onClick={handleEmailSubmit}\r\n          disabled={isLoading || !email.trim()}\r\n            className=\"w-full bg-black text-white font-medium py-2 rounded hover:bg-gray-800 transition-colors disabled:opacity-50\"\r\n            style={{ fontFamily: 'Inter, system-ui, sans-serif' }}\r\n        >\r\n            {isLoading ? 'Sending...' : 'Continue with Email'}\r\n        </button>\r\n          \r\n          <div className=\"relative flex py-2 items-center\">\r\n            <div className=\"flex-grow border-t border-gray-300\"></div>\r\n            <span className=\"flex-shrink-0 mx-4 text-gray-400 text-sm\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Or</span>\r\n            <div className=\"flex-grow border-t border-gray-300\"></div>\r\n          </div>\r\n\r\n          <GoogleButton onPress={handleGoogleSignIn} disabled={isLoading} />\r\n          \r\n          {error && <p className=\"mt-2 text-sm text-red-500\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>{error}</p>}\r\n      </div>\r\n    </div>\r\n  );\r\n  };\r\n\r\n  const renderCodeStep = () => (\r\n    <div className=\"w-full flex flex-col h-full px-6 pt-16 text-center\">\r\n      <h1 className=\"text-2xl font-bold mb-2\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif', color: COLORS.textPrimary }}>\r\n          Enter verification code\r\n        </h1>\r\n      <p className=\"mb-6\" style={{ fontFamily: 'Inter, system-ui, sans-serif', color: COLORS.textSecondary }}>\r\n        {emailSent ? `We've sent a 6-digit code to ${email}` : `Code generated for ${email}`}\r\n        </p>\r\n\r\n      <div className=\"flex justify-center space-x-3 mb-8\">\r\n          {Array.from({ length: 6 }, (_, index) => (\r\n            <input\r\n              key={index}\r\n              type=\"text\"\r\n              inputMode=\"numeric\"\r\n              maxLength=\"1\"\r\n            value={codeDigits[index] || ''}\r\n              onChange={(e) => {\r\n              const val = e.target.value.replace(/\\D/g, '');\r\n              const next = [...codeDigits];\r\n              next[index] = val;\r\n              setCodeDigits(next);\r\n              if (val && index < 5) e.target.parentElement.children[index + 1].focus();\r\n              }}\r\n              onKeyDown={(e) => {\r\n              if (e.key === 'Backspace' && !codeDigits[index] && index > 0) {\r\n                e.target.parentElement.children[index - 1].focus();\r\n                }\r\n              }}\r\n            className=\"onairos-verification-digit w-12 h-12 border rounded-lg text-center text-lg font-medium focus:ring-2 focus:ring-blue-500 outline-none\"\r\n            style={{ borderColor: COLORS.border, backgroundColor: '#F5F5F5', color: '#000000', WebkitTextFillColor: '#000000', caretColor: '#000000' }}\r\n            />\r\n          ))}\r\n      </div>\r\n\r\n      {error && <p className=\"mb-6 text-sm text-red-500\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>{error}</p>}\r\n\r\n      <div className=\"max-w-sm mx-auto w-full\">\r\n          <PrimaryButton\r\n            label=\"Continue\"\r\n            onClick={handleCodeSubmit}\r\n            loading={isLoading}\r\n          disabled={isLoading || !isCodeComplete}\r\n            className=\"!text-white\"\r\n            textStyle={{ color: '#FFFFFF' }}\r\n          />\r\n        </div>\r\n\r\n          <button\r\n        onClick={() => { resetCodeDigits(); setStep('email'); }}\r\n        className=\"mt-6 text-sm text-gray-500 font-medium\"\r\n        style={{ fontFamily: 'Inter, system-ui, sans-serif' }}\r\n          >\r\n            Use a different email\r\n          </button>\r\n    </div>\r\n  );\r\n\r\n  const renderSuccessStep = () => (\r\n    <div className=\"w-full flex flex-col items-center pt-16 px-12 space-y-6\">\r\n      <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-green-100\">\r\n        <Check className=\"w-8 h-8 text-green-600\" />\r\n      </div>\r\n      <div className=\"text-center\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>Email verified!</h2>\r\n        <p className=\"text-gray-500\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Setting up your account...</p>\r\n      </div>\r\n        <div className=\"animate-spin h-8 w-8 border-2 border-blue-600 rounded-full border-t-transparent\"></div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"w-full h-full\">\r\n      {step === 'email' && renderEmailStep()}\r\n      {step === 'code' && renderCodeStep()}\r\n      {step === 'success' && renderSuccessStep()}\r\n    </div>\r\n  );\r\n} \r\n","import React from 'react';\r\nimport { createPortal } from 'react-dom';\r\n\r\nconst BOOKMARKLET_HREF =\r\n  \"javascript:(async()=>{let loader=null;function showLoader(msg){if(!loader){loader=document.createElement('div');loader.style.cssText='position:fixed;top:20px;right:20px;width:280px;background:rgba(15,23,42,0.95);color:white;padding:14px 20px;border-radius:12px;font-family:-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,sans-serif;font-size:13px;font-weight:500;z-index:999999;box-shadow:0 8px 24px rgba(0,0,0,0.4),0 2px 8px rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.1);backdrop-filter:blur(12px);line-height:1.4;text-align:center';document.body.appendChild(loader)}loader.textContent=msg}function hideLoader(){if(loader){loader.remove();loader=null}}function h(){try{const e=window.location.hostname||'';return e==='chat.openai.com'||e==='chatgpt.com'||e.endsWith('.chatgpt.com')}catch{return false}}function getDeviceId(){try{const c=document.cookie.match(/oai-did=([^;]+)/);return c?c[1]:null}catch{return null}}async function getAccessToken(){const url=`${window.location.origin}/api/auth/session`;const r=await fetch(url,{method:'GET',credentials:'include',headers:{'Accept':'application/json','Referer':window.location.origin}});if(!r.ok)return null;const data=await r.json();return data?.accessToken||null}async function fetchList(token,deviceId){const url=`${window.location.origin}/backend-api/conversations?offset=0&limit=10`;const headers={'Accept':'*/*','oai-language':'en-US'};if(token)headers['Authorization']=`Bearer ${token}`;if(deviceId)headers['oai-device-id']=deviceId;const r=await fetch(url,{method:'GET',credentials:'include',headers});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}async function fetchConvo(id,token,deviceId){const url=`${window.location.origin}/backend-api/conversation/${id}`;const headers={'Accept':'*/*','oai-language':'en-US','Referer':window.location.origin};if(token)headers['Authorization']=`Bearer ${token}`;if(deviceId)headers['oai-device-id']=deviceId;const r=await fetch(url,{method:'GET',credentials:'include',headers});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}async function fetchMemories(token,deviceId){const url=`${window.location.origin}/backend-api/memories?include_memory_entries=true&memory_entries_filter=all`;const headers={'Accept':'application/json','Referer':window.location.origin};if(token)headers['Authorization']=`Bearer ${token}`;if(deviceId)headers['oai-device-id']=deviceId;try{const r=await fetch(url,{method:'GET',credentials:'include',headers});if(!r.ok)return null;return r.json()}catch{return null}}function extractUserMessages(data){const mapping=data?.mapping||{};const msgs=[];for(const node of Object.values(mapping)){const msg=node?.message;if(!msg||!msg.author)continue;if(msg.author.role!=='user')continue;const time=msg.create_time?new Date(msg.create_time*1000).toISOString():null;let text='';const content=msg.content||{};if(Array.isArray(content.parts)){text=content.parts.join('\\\\n').trim()}else if(content.text){text=content.text.trim()}if(text){msgs.push({content:text,timestamp:time})}}return msgs}if(!h()){alert(' Please open ChatGPT and try again.');return}const popup=window.open('about:blank','OnairosSync','width=500,height=600');if(!popup){alert(' Please allow popups for ChatGPT to sync with Onairos!\\\\n\\\\nEnable popups and try again.');return}popup.document.write('<html><head><title>Onairos Sync</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:\\\"Shne\\\",-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Helvetica,Arial,sans-serif;background:#0D0D0D;color:#ECECEC;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}.container{max-width:450px;width:100%;background:#212121;border-radius:16px;padding:32px;box-shadow:0 4px 24px rgba(0,0,0,0.4)}h1{font-size:24px;font-weight:600;text-align:center;margin-bottom:8px}.subtitle{font-size:14px;color:#8E8EA0;text-align:center;margin-bottom:32px}.status-text{text-align:center;font-size:16px;margin-bottom:16px}.spinner{width:40px;height:40px;border:3px solid #2F2F2F;border-top-color:#10A37F;border-radius:50%;animation:spin 0.6s linear infinite;margin:0 auto 16px}@keyframes spin{to{transform:rotate(360deg)}}</style></head><body><div class=\\\"container\\\"><h1> Onairos Sync</h1><p class=\\\"subtitle\\\">Collecting your ChatGPT data</p><div class=\\\"spinner\\\"></div><div class=\\\"status-text\\\" id=\\\"status\\\">Starting...</div></div></body></html>');popup.document.close();function updatePopup(msg){try{if(popup&&!popup.closed){popup.document.getElementById('status').textContent=msg}}catch(e){}}showLoader(' Starting export...');console.log('[Onairos]  Starting export...');(async()=>{try{updatePopup(' Getting access token...');showLoader(' Getting access token...');const token=await getAccessToken();const deviceId=getDeviceId();if(!token){hideLoader();updatePopup(' Could not get access token. Make sure you\\\\'re logged into ChatGPT.');setTimeout(()=>popup.close(),5000);return}updatePopup(' Fetching conversations...');showLoader(' Fetching conversations...');let list;try{list=await fetchList(token,deviceId)}catch(err){hideLoader();updatePopup(' Failed: '+err.message);setTimeout(()=>popup.close(),5000);return}const items=(list?.items||[]).slice(0,10);if(items.length===0){hideLoader();updatePopup(' No conversations found');setTimeout(()=>popup.close(),3000);return}const convos=[];for(let i=0;i<items.length;i++){const c=items[i];updatePopup(` ${i+1}/${items.length}: ${c.title||'Untitled'}...`);showLoader(` ${i+1}/${items.length}: ${c.title||'Untitled'}...`);try{const data=await fetchConvo(c.id,token,deviceId);const userMsgs=extractUserMessages(data);convos.push({id:c.id,title:c.title||'Untitled',url:`${window.location.origin}/c/${c.id}`,messageCount:userMsgs.length,messages:userMsgs})}catch(err){convos.push({id:c.id,title:c.title||'Untitled',error:err.message})}}updatePopup(' Fetching memories...');showLoader(' Fetching memories...');const memories=await fetchMemories(token,deviceId);updatePopup(' Syncing to Onairos...');showLoader(' Syncing to Onairos...');const userData=JSON.parse(localStorage.getItem('onairosUser')||'{}');let jwtToken=userData.token||localStorage.getItem('onairos_user_token');if(!jwtToken){hideLoader();updatePopup(' Please log into Onairos first');setTimeout(()=>popup.close(),5000);return}const syncData={convos,memories,token:jwtToken};updatePopup(' Opening sync page...');const form=popup.document.createElement('form');form.method='POST';form.action='https://api2.onairos.uk/chatgpt-sync';form.style.display='none';const input=popup.document.createElement('input');input.type='hidden';input.name='data';input.value=JSON.stringify(syncData);form.appendChild(input);popup.document.body.appendChild(form);form.submit();hideLoader();console.log(' [Onairos] Submitting sync form')}catch(e){hideLoader();updatePopup(' Error: '+e.message);console.error(e);setTimeout(()=>popup.close(),5000)}})()})();\";\r\n\r\nexport const getOnairosChatGPTBookmarklet = () => BOOKMARKLET_HREF;\r\n\r\nexport default function ConnectChatGPTModal({ open, onClose, onConnected }) {\r\n  // Debug log to confirm render attempt\r\n  if (open) {\r\n    console.log(' ConnectChatGPTModal rendering! Open:', open);\r\n  }\r\n\r\n  if (!open) return null;\r\n\r\n  // Get user token from localStorage to embed in bookmarklet\r\n  const getUserToken = () => {\r\n    try {\r\n      // Try onairos_user_token first\r\n      const directToken = localStorage.getItem('onairos_user_token');\r\n      if (directToken) return directToken;\r\n      \r\n      // Try onairosUser.token\r\n      const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n      if (userData.token) return userData.token;\r\n      \r\n      return null;\r\n    } catch (e) {\r\n      console.error('Error getting token:', e);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const userToken = getUserToken();\r\n  console.log(' User token for bookmarklet:', userToken ? userToken.substring(0, 20) + '...' : 'NOT FOUND');\r\n\r\n  // Create bookmarklet with embedded token\r\n  const createBookmarkletWithToken = (token) => {\r\n    if (!token) {\r\n      // Fallback to original bookmarklet that checks localStorage\r\n      return BOOKMARKLET_HREF;\r\n    }\r\n    \r\n    // Embed the token directly in the bookmarklet\r\n    return BOOKMARKLET_HREF.replace(\r\n      'const userData=JSON.parse(localStorage.getItem(\\'onairosUser\\')||\\'{}\\')',\r\n      `const userData={token:'${token}'}`\r\n    );\r\n  };\r\n\r\n  const bookmarkletHref = createBookmarkletWithToken(userToken);\r\n\r\n  const handleGotIt = () => {\r\n    if (typeof onConnected === 'function') {\r\n      onConnected();\r\n    }\r\n    if (typeof onClose === 'function') {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  // Use a portal to break out of any parent transforms/overflows\r\n  return createPortal(\r\n    <div style={{ position: 'fixed', inset: 0, zIndex: 2147483647, pointerEvents: 'auto' }}>\r\n      <style>{`\r\n        @keyframes gentlePulse {\r\n          0%, 100% {\r\n            box-shadow: 0 0 0 0 rgba(148, 163, 184, 0.35);\r\n          }\r\n          50% {\r\n            box-shadow: 0 0 0 10px rgba(148, 163, 184, 0);\r\n          }\r\n        }\r\n        .bookmarklet-button {\r\n          background: rgba(15, 23, 42, 0.85);\r\n          border-radius: 9999px;\r\n          border: 1px solid rgba(255,255,255,0.16);\r\n          backdrop-filter: blur(18px);\r\n        }\r\n        .bookmarklet-button:hover {\r\n          background: rgba(15, 23, 42, 0.92);\r\n        }\r\n        @keyframes fadeInScale {\r\n          0% { opacity: 0; transform: translateY(8px) scale(0.96); }\r\n          100% { opacity: 1; transform: translateY(0) scale(1); }\r\n        }\r\n        .chatgpt-modal-card {\r\n          animation: fadeInScale 200ms cubic-bezier(0.16, 1, 0.3, 1);\r\n        }\r\n        .step-circle {\r\n          background: rgba(15, 23, 42, 0.9);\r\n          min-width: 28px;\r\n          width: 28px;\r\n          height: 28px;\r\n        }\r\n        .chatgpt-got-it-button {\r\n          color: #FFFFFF !important;\r\n          background-color: rgba(15, 23, 42, 0.8) !important;\r\n        }\r\n        .chatgpt-got-it-button:hover {\r\n          background-color: rgba(15, 23, 42, 0.9) !important;\r\n        }\r\n        .chatgpt-got-it-button * {\r\n          color: #FFFFFF !important;\r\n        }\r\n        .chatgpt-got-it-button span {\r\n          color: #FFFFFF !important;\r\n        }\r\n        /* Mobile browser specific styling */\r\n        @media (max-width: 768px) {\r\n          .chatgpt-modal-backdrop {\r\n            align-items: flex-end !important;\r\n            padding: 0 !important;\r\n          }\r\n          .chatgpt-modal-card {\r\n            max-width: 100% !important;\r\n            height: 100% !important;\r\n            max-height: 100% !important;\r\n            border-radius: 24px 24px 0 0 !important;\r\n            animation: slideUpFromBottom 300ms cubic-bezier(0.16, 1, 0.3, 1) !important;\r\n          }\r\n        }\r\n        @keyframes slideUpFromBottom {\r\n          0% { transform: translateY(100%); }\r\n          100% { transform: translateY(0); }\r\n        }\r\n      `}</style>\r\n\r\n      <div \r\n        className=\"chatgpt-modal-backdrop fixed inset-0 flex items-center justify-center p-4 bg-black/60\" \r\n        style={{ zIndex: 2147483647 }}\r\n      >\r\n        <div \r\n          className=\"chatgpt-modal-card w-full max-w-md rounded-3xl shadow-2xl border border-white/10 overflow-hidden text-white relative\"\r\n          style={{\r\n            background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.92) 50%, rgba(15, 23, 42, 0.95) 100%)',\r\n            boxShadow: 'inset 0 1px 0 0 rgba(255, 255, 255, 0.1), 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(148, 163, 184, 0.15)'\r\n          }}\r\n        >\r\n            <div className=\"relative px-5 py-4 border-b border-white/10 bg-white/5\">\r\n              <button\r\n                onClick={onClose}\r\n                className=\"absolute right-4 top-4 p-2 hover:bg-white/10 rounded-full transition-colors z-50 cursor-pointer\"\r\n                aria-label=\"Close\"\r\n              >\r\n                <svg\r\n                  className=\"w-5 h-5 text-slate-300\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M6 18L18 6M6 6l12 12\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n\r\n              <h2 className=\"text-xl font-semibold pr-8 text-white\">\r\n                Connect ChatGPT\r\n              </h2>\r\n              <p className=\"text-sm mt-0.5 text-white\">\r\n                Three quick steps to import your conversations\r\n              </p>\r\n\r\n              <div className=\"mt-3 flex items-start gap-2 bg-white/12 rounded-2xl px-3 py-2\">\r\n                <svg\r\n                  className=\"w-4 h-4 text-emerald-300 mt-0.5 flex-shrink-0\"\r\n                  fill=\"currentColor\"\r\n                  viewBox=\"0 0 20 20\"\r\n                >\r\n                  <path\r\n                    fillRule=\"evenodd\"\r\n                    d=\"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\"\r\n                    clipRule=\"evenodd\"\r\n                  />\r\n                </svg>\r\n                <p className=\"text-xs leading-relaxed text-white\">\r\n                  <strong className=\"font-semibold\">Private &amp; secure.</strong>{' '}\r\n                  We only access your chat history. No one else sees this data.\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"px-5 py-4 space-y-4\">\r\n              <div className=\"flex gap-3\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <div className=\"step-circle rounded-full flex items-center justify-center\">\r\n                    <span className=\"text-white font-bold text-sm\">1</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex-1 pt-0.5\">\r\n                  <h3 className=\"text-sm font-semibold mb-1 text-white\">\r\n                    Drag this button to your bookmarks bar\r\n                  </h3>\r\n                  <div className=\"relative inline-block mt-2\">\r\n                    <div\r\n                      className=\"absolute inset-0 rounded-full\"\r\n                      style={{ animation: 'gentlePulse 2s ease-in-out infinite' }}\r\n                    />\r\n                    <a\r\n                      href={bookmarkletHref}\r\n                      title=\" Onairos ChatGPT Sync\"\r\n                      draggable=\"true\"\r\n                      onDragStart={(e) => {\r\n                        try {\r\n                          // Set the bookmark URL\r\n                          e.dataTransfer.setData('text/uri-list', bookmarkletHref);\r\n                          e.dataTransfer.setData('text/plain', bookmarkletHref);\r\n                          \r\n                          // IMPORTANT: Set bookmark title for different browsers\r\n                          // Firefox uses text/x-moz-url format: URL\\nTitle\r\n                          e.dataTransfer.setData('text/x-moz-url', `${bookmarkletHref}\\n Onairos ChatGPT`);\r\n                          \r\n                          // Chrome/Safari: Set via DownloadURL\r\n                          e.dataTransfer.setData('DownloadURL', `application/javascript: Onairos ChatGPT:${bookmarkletHref}`);\r\n                          \r\n                          e.dataTransfer.effectAllowed = 'copy';\r\n                          console.log(' Bookmarklet drag started with title:  Onairos ChatGPT');\r\n                        } catch (err) {\r\n                          console.warn('Drag start error:', err);\r\n                        }\r\n                      }}\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        alert(' Please drag this button to your bookmarks bar!\\n\\nTip: Press Ctrl+Shift+B (or Cmd+Shift+B on Mac) to show your bookmarks bar.');\r\n                      }}\r\n                      className=\"bookmarklet-button relative inline-flex items-center gap-1.5 px-4 py-2 font-medium cursor-move select-none transition-all hover:scale-[1.03]\"\r\n                      suppressHydrationWarning\r\n                    >\r\n                      <span className=\"text-base\"></span>\r\n                      <span className=\"text-sm\">Onairos ChatGPT</span>\r\n                    </a>\r\n                  </div>\r\n                  <p className=\"text-xs mt-2 text-slate-200\">\r\n                    <kbd className=\"px-1.5 py-0.5 bg-white/10 rounded-full text-[10px] font-mono border border-white/10 text-slate-50\">\r\n                      Ctrl+Shift+B\r\n                    </kbd>{' '}\r\n                    (or{' '}\r\n                    <kbd className=\"px-1.5 py-0.5 bg-white/10 rounded-full text-[10px] font-mono border border-white/10 text-slate-50\">\r\n                      Cmd+Shift+B\r\n                    </kbd>{' '}\r\n                    on Mac) to show bookmarks bar\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"border-t border-white/10 ml-10\" />\r\n\r\n              <div className=\"flex gap-3\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <div className=\"step-circle rounded-full flex items-center justify-center\">\r\n                    <span className=\"text-white font-bold text-sm\">2</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex-1 pt-0.5\">\r\n                  <h3 className=\"text-sm font-semibold mb-1 text-white\">\r\n                    Open ChatGPT and log in\r\n                  </h3>\r\n                  <p className=\"text-xs mb-2 text-slate-200\">\r\n                    Make sure you're logged into your ChatGPT account\r\n                  </p>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      window.open('https://chat.openai.com', '_blank', 'noopener,noreferrer');\r\n                    }}\r\n                    className=\"inline-flex items-center gap-1.5 px-4 py-2 rounded-full text-xs font-medium transition-all hover:scale-[1.02] active:scale-[0.98]\"\r\n                    style={{\r\n                      background: 'linear-gradient(135deg, #10a37f 0%, #0d9270 100%)',\r\n                      color: '#ffffff',\r\n                      boxShadow: '0 0 25px rgba(16, 163, 127, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2)'\r\n                    }}\r\n                  >\r\n                    <svg\r\n                      className=\"w-3.5 h-3.5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"\r\n                      />\r\n                    </svg>\r\n                    Open ChatGPT\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"border-t border-white/10 ml-10\" />\r\n\r\n              <div className=\"flex gap-3\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <div className=\"step-circle rounded-full flex items-center justify-center\">\r\n                    <span className=\"text-white font-bold text-sm\">3</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex-1 pt-0.5\">\r\n                  <h3 className=\"text-sm font-semibold mb-1 text-white\">\r\n                    Click the bookmark on ChatGPT\r\n                  </h3>\r\n                  <p className=\"text-xs text-slate-200\">\r\n                    Click the <strong className=\"text-white\">&quot;Onairos ChatGPT&quot;</strong>{' '}\r\n                    bookmark you added. We&apos;ll securely import your last 10 conversations.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"px-5 py-4 bg-white/5 border-t border-white/10\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleGotIt}\r\n                className=\"w-full px-4 py-2.5 rounded-full font-medium text-sm transition-all hover:scale-[1.01] active:scale-[0.99] shadow-[0_10px_30px_rgba(15,23,42,0.45)] border border-white/40 chatgpt-got-it-button\"\r\n              >\r\n                <span>Got it! </span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n}\r\n\r\n\r\n","import React, { useEffect, useId, useState, useRef } from 'react';\r\nimport { Browser } from '@capacitor/browser';\r\nimport Lottie from 'lottie-react';\r\nimport personaAnim from '../../public/persona-anim.json';\r\nimport { isMobileApp, isMobileBrowser } from '../utils/capacitorDetection';\r\nimport ConnectChatGPTModal from './ConnectChatGPTModal.jsx';\r\n\r\n// Mobile detection\r\nconst isMobile = () => {\r\n  if (typeof window === 'undefined') return false;\r\n  return isMobileApp() || isMobileBrowser() || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n};\r\nconst chatgptIcon = 'https://anushkasirv.sirv.com/openai.png';\r\nconst claudeIcon = 'https://anushkasirv.sirv.com/claude-color.png';\r\nconst geminiIcon = 'https://anushkasirv.sirv.com/gemini-color.png';\r\nconst grokIcon = 'https://anushkasirv.sirv.com/grok.png';\r\nconst pinterestIcon = 'https://upload.wikimedia.org/wikipedia/commons/0/08/Pinterest-logo.png';\r\n\r\nconst sdkConfig = {\r\n  apiKey: process.env.REACT_APP_ONAIROS_API_KEY || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey',\r\n  baseUrl: process.env.REACT_APP_ONAIROS_BASE_URL || 'https://api2.onairos.uk',\r\n  sdkType: 'web',\r\n  enableHealthMonitoring: true,\r\n  enableAutoRefresh: true,\r\n  enableConnectionValidation: true,\r\n};\r\n\r\nconst fadeSlideInKeyframes = `\r\n@keyframes fadeSlideIn {\r\n  from { opacity: 0; transform: translateX(var(--slide-x)); }\r\n  to { opacity: 1; transform: translateX(0); }\r\n}\r\n`;\r\n\r\nexport default function UniversalOnboarding({ onComplete, onBack, appIcon, appName, username, testMode, priorityPlatform, rawMemoriesOnly, rawMemoriesConfig, isMobile: isMobileProp = false, initialConnectedAccounts = [] }) {\r\n  const lottieRef = useRef(null);\r\n  const lastFrameRef = useRef(0);\r\n  const rafRef = useRef(null);\r\n  const initialLoadDone = useRef(false);\r\n\r\n  // Normalize platform names for initial state\r\n  const getInitialState = () => {\r\n    // If props provided, use them as source of truth\r\n    if (initialConnectedAccounts && Array.isArray(initialConnectedAccounts) && initialConnectedAccounts.length > 0) {\r\n      return initialConnectedAccounts.reduce((acc, p) => ({ \r\n        ...acc, \r\n        [p]: true \r\n      }), {});\r\n    }\r\n    // Otherwise fallback to empty (will check localStorage in useEffect)\r\n    return {};\r\n  };\r\n\r\n  const [connectedAccounts, setConnectedAccounts] = useState(getInitialState);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const [connectingPlatform, setConnectingPlatform] = useState(null);\r\n  const [selected, setSelected] = useState('Instagram');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [showChatGPTModal, setShowChatGPTModal] = useState(false);\r\n\r\n  // Sync with initialConnectedAccounts prop changes (e.g. navigation back/forth)\r\n  // This useEffect must be AFTER the platform definitions so it can canonicalize names\r\n  // It's defined here but will run after component setup\r\n\r\n  // swipe state\r\n  const touchStartX = useRef(0);\r\n  const touchDeltaX = useRef(0);\r\n\r\n  // Mobile detection - use prop if provided (from layout), else detect\r\n  // Only use actual mobile device detection, not window width (to avoid false positives from dev tools)\r\n  const isActualMobileDevice = typeof navigator !== 'undefined' && \r\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n  const isNativePlatform = typeof window !== 'undefined' && \r\n    window.Capacitor?.isNativePlatform?.() === true;\r\n  const isMobile = isMobileProp || isNativePlatform || isActualMobileDevice;\r\n\r\n  const [vh, setVh] = useState(() => (typeof window !== 'undefined' ? window.innerHeight : 800));\r\n  useEffect(() => {\r\n    const onResize = () => setVh(window.innerHeight);\r\n    window.addEventListener('resize', onResize);\r\n    return () => window.removeEventListener('resize', onResize);\r\n  }, []);\r\n\r\n  // Cap the info card height so the bottom stack (icons + card + Continue)\r\n  // can stay anchored to the bottom without introducing scrollbars.\r\n  const INFO_SHEET_MAX_H = isMobile ? (vh * 0.18) : Math.min(200, Math.round(vh * 0.22));\r\n\r\n  const FOOTER_H = 88;\r\n\r\n  // MOBILE ONLY: persona placement / sizing - GIVE MORE SPACE TO PERSONA\r\n  const isSmallMobile = isMobile && vh < 700;\r\n  // Desktop adjustments: Reduce persona size and top position to fit modal without scroll\r\n  // We allow overlap on desktop if needed\r\n  const personaSide = isMobile \r\n    ? (isSmallMobile ? Math.min(vh * 0.42, 380) : Math.min(vh * 0.45, 420))\r\n    : Math.min(vh * 0.45, 420); // Desktop: allow larger size, will position absolutely\r\n  \r\n  // Adjusted to prevent text overlap\r\n  const PERSONA_TOP = isMobile \r\n    ? (isSmallMobile ? 70 : 90) \r\n    : 80; // Desktop: raised up higher to sit behind header/text (z-index 0)\r\n\r\n  // MOBILE ONLY: icon layout - PUSH ICONS DOWN significantly\r\n  // Desktop: Adjust spacing to fit\r\n  const SLOT = isMobile \r\n    ? Math.max(50, Math.min(60, Math.floor(vh * 0.07)))\r\n    : 60; // Desktop: fixed reasonable size\r\n  const CIRCLE = isMobile \r\n    ? (isSmallMobile ? 36 : 40)\r\n    : 40; // Desktop: fixed reasonable size\r\n  const GAP_PAGE1 = isMobile ? 10 : 12; // Desktop: original\r\n  const GAP_PAGE2 = isMobile ? 18 : 20; // Desktop: original\r\n  const ACTIVE_SCALE = isMobile \r\n    ? (vh < 760 ? 1.15 : 1.25)\r\n    : 1.2; // Desktop: standard scale\r\n\r\n  const ICONS_H = isMobile \r\n    ? (isSmallMobile ? 70 : 80)\r\n    : 64; // Desktop: tighter height to avoid overflow/scroll\r\n  const ICONS_TOP_OFFSET = isMobile \r\n    ? Math.max(200, Math.min(280, Math.round(vh * 0.32)))\r\n    : 200; // Desktop: unused but kept for ref\r\n\r\n  const igGradId = useId();\r\n\r\n  // ---- official brand SVGs (compact, consistent viewboxes) ----\r\n  const Brand = {\r\n    ChatGPT: <img src={chatgptIcon} alt=\"ChatGPT\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\r\n    Claude: <img src={claudeIcon} alt=\"Claude\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\r\n    Gemini: <img src={geminiIcon} alt=\"Gemini\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\r\n    Grok: <img src={grokIcon} alt=\"Grok\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\r\n    Instagram: (\r\n      <svg viewBox=\"0 0 24 24\" aria-hidden width=\"100%\" height=\"100%\">\r\n        <defs>\r\n          <radialGradient id={igGradId} cx=\"0.5\" cy=\"1\" r=\"1\">\r\n            <stop offset=\"0%\" stopColor=\"#FDBB4B\"/>\r\n            <stop offset=\"40%\" stopColor=\"#E95950\"/>\r\n            <stop offset=\"70%\" stopColor=\"#BC2A8D\"/>\r\n            <stop offset=\"100%\" stopColor=\"#4C68D7\"/>\r\n          </radialGradient>\r\n        </defs>\r\n        <path fill={`url(#${igGradId})`} d=\"M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5.5A4.5 4.5 0 1 0 16.5 12 4.5 4.5 0 0 0 12 7.5zm0 7.4A2.9 2.9 0 1 1 14.9 12 2.9 2.9 0 0 1 12 14.9Zm5.35-8.25a1.15 1.15 0 1 0 1.15 1.15 1.15 1.15 0 0 0-1.15-1.15Z\"/>\r\n      </svg>\r\n    ),\r\n    YouTube: (\r\n      <svg viewBox=\"0 0 24 24\" aria-hidden width=\"100%\" height=\"100%\">\r\n        <path fill=\"#FF0000\" d=\"M22.54 6.42a3 3 0 0 0-2.11-2.12C18.49 3.75 12 3.75 12 3.75s-6.49 0-8.43.55A3 3 0 0 0 1.46 6.42 31.63 31.63 0 0 0 1 12a31.63 31.63 0 0 0 .46 5.58 3 3 0 0 0 2.11 2.12C5.51 20.25 12 20.25 12 20.25s6.49 0 8.43-.55a3 3 0 0 0 2.11-2.12A31.63 31.63 0 0 0 23 12a31.63 31.63 0 0 0-.46-5.58z\"/>\r\n        <path fill=\"#FFF\" d=\"M10 8.75v6.5l6-3.25-6-3.25z\"/>\r\n        </svg>\r\n      ),\r\n    Reddit: (\r\n      <img src=\"https://upload.wikimedia.org/wikipedia/en/b/bd/Reddit_Logo_Icon.svg\" alt=\"Reddit\" width=\"100%\" height=\"100%\" />\r\n      ),\r\n    LinkedIn: (\r\n      <img src=\"https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png\" alt=\"LinkedIn\" width=\"100%\" height=\"100%\" />\r\n      ),\r\n    Pinterest: (\r\n      <img src={pinterestIcon} alt=\"Pinterest\" width=\"100%\" height=\"100%\" />\r\n      ),\r\n    Twitter: (\r\n      <svg viewBox=\"0 0 24 24\" aria-hidden width=\"100%\" height=\"100%\">\r\n        <path fill=\"#1DA1F2\" d=\"M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z\"/>\r\n        </svg>\r\n      ),\r\n  };\r\n\r\n  const aiLinks = {\r\n    ChatGPT: 'https://chat.openai.com',\r\n    Claude: 'https://claude.ai',\r\n    Gemini: 'https://gemini.google.com',\r\n    Grok: 'https://grok.x.ai',\r\n  };\r\n\r\n  const descriptions = {\r\n    ChatGPT: <>We analyze your <strong className=\"font-semibold\">prompt style</strong> and <strong className=\"font-semibold\">chat history</strong> to match your writing and thinking patterns.</>,\r\n    Claude: <>We learn your <strong className=\"font-semibold\">document workflow</strong> and <strong className=\"font-semibold\">reasoning preferences</strong> to tune output format and detail.</>,\r\n    Gemini: <>We study your <strong className=\"font-semibold\">search patterns</strong> and <strong className=\"font-semibold\">multimodal usage</strong> to improve response accuracy.</>,\r\n    Grok: <>We adapt to your <strong className=\"font-semibold\">X posting style</strong> and <strong className=\"font-semibold\">meme literacy</strong> to match your tone.</>,\r\n    Twitter: <>We analyze your <strong className=\"font-semibold\">tweets</strong> and <strong className=\"font-semibold\">interests</strong> to understand your preferences.</>,\r\n    YouTube: <>We study your <strong className=\"font-semibold\">watch history</strong> and <strong className=\"font-semibold\">interactions</strong> to learn your interests.</>,\r\n    Reddit: <>We examine your <strong className=\"font-semibold\">search history</strong> and <strong className=\"font-semibold\">discussions</strong> to understand your interests.</>,\r\n    Instagram: <>We analyze your <strong className=\"font-semibold\">photos</strong> and <strong className=\"font-semibold\">interactions</strong> to learn visual preferences.</>,\r\n    LinkedIn: <>We study your <strong className=\"font-semibold\">professional graph</strong> and <strong className=\"font-semibold\">content</strong> to understand career interests.</>,\r\n    Pinterest: <>We analyze your <strong className=\"font-semibold\">boards</strong> and <strong className=\"font-semibold\">pins</strong> to understand your creative interests and style.</>,\r\n  };\r\n\r\n  // Full platform list for all apps\r\n  const allPlatformsDefault = [\r\n    // Page 1\r\n    { name: 'Instagram', connector: 'instagram', icon: Brand.Instagram },\r\n    { name: 'YouTube', connector: 'youtube', icon: Brand.YouTube },\r\n    { name: 'ChatGPT', connector: 'chatgpt', icon: Brand.ChatGPT, directLink: aiLinks.ChatGPT },\r\n    // Page 2\r\n    { name: 'Claude', connector: 'claude', icon: Brand.Claude, directLink: aiLinks.Claude },\r\n    { name: 'Gemini', connector: 'gemini', icon: Brand.Gemini, directLink: aiLinks.Gemini },\r\n    { name: 'Twitter', connector: 'twitter', icon: Brand.Twitter },\r\n    // Page 3\r\n    { name: 'LinkedIn', connector: 'linkedin', icon: Brand.LinkedIn },\r\n    { name: 'Reddit', connector: 'reddit', icon: Brand.Reddit },\r\n    { name: 'Grok', connector: 'grok', icon: Brand.Grok, directLink: aiLinks.Grok },\r\n  ];\r\n\r\n  // Restricted platform list for onairos-wrapped only\r\n  const wrappedPlatforms = [\r\n    { name: 'YouTube', connector: 'youtube', icon: Brand.YouTube },\r\n    { name: 'Pinterest', connector: 'pinterest', icon: Brand.Pinterest },\r\n    { name: 'Reddit', connector: 'reddit', icon: Brand.Reddit },\r\n  ];\r\n\r\n    const isWrappedApp = typeof appName === 'string' && appName.toLowerCase().includes('onairos-wrapped');\r\n  \r\n  const allPlatforms = isWrappedApp ? wrappedPlatforms : allPlatformsDefault;\r\n\r\n  // Normalize platform strings coming from various sources (connector ids like \"linkedin\"\r\n  // vs display names like \"LinkedIn\") so connected rings render reliably.\r\n  const canonicalizePlatformName = (value) => {\r\n    const raw = String(value || '').trim();\r\n    if (!raw) return '';\r\n    const lower = raw.toLowerCase();\r\n    const byConnector = allPlatforms.find((p) => String(p.connector).toLowerCase() === lower);\r\n    if (byConnector) return byConnector.name;\r\n    const byName = allPlatforms.find((p) => String(p.name).toLowerCase() === lower);\r\n    if (byName) return byName.name;\r\n    return raw.charAt(0).toUpperCase() + raw.slice(1);\r\n  };\r\n\r\n  // Helper to notify DataRequest when connected accounts change\r\n  const notifyConnectedAccountsUpdate = () => {\r\n    if (typeof window !== 'undefined') {\r\n      window.dispatchEvent(new CustomEvent('onairos-connected-accounts-update'));\r\n    }\r\n  };\r\n\r\n  // Sync with initialConnectedAccounts prop changes (e.g. navigation back/forth)\r\n  // This MUST be after canonicalizePlatformName is defined\r\n  useEffect(() => {\r\n    if (initialConnectedAccounts && Array.isArray(initialConnectedAccounts) && initialConnectedAccounts.length > 0) {\r\n      setConnectedAccounts((prev) => {\r\n        // Create map from props - MUST canonicalize platform names to match local state format\r\n        const propState = initialConnectedAccounts.reduce((acc, p) => {\r\n          const canonical = canonicalizePlatformName(p);\r\n          if (canonical) {\r\n            acc[canonical] = true;\r\n          }\r\n          return acc;\r\n        }, {});\r\n        console.log(' Syncing connected accounts from props:', propState);\r\n        // Merge with current state (preserving local toggles if any, but ensuring props are respected)\r\n        // If the user just navigated back, propState is the source of truth for already-connected accounts\r\n        const merged = { ...prev, ...propState };\r\n        return merged;\r\n      });\r\n    }\r\n  }, [initialConnectedAccounts]);\r\n\r\n  // Debug: Log connectedAccounts state changes\r\n  useEffect(() => {\r\n    console.log(' connectedAccounts state changed:', connectedAccounts);\r\n  }, [connectedAccounts]);\r\n\r\n  // Auto-persist connected accounts to localStorage whenever they change\r\n  useEffect(() => {\r\n    console.log(' Persistence useEffect triggered. connectedAccounts:', connectedAccounts, 'length:', Object.keys(connectedAccounts).length);\r\n    \r\n    // Skip initial mount if connectedAccounts is empty\r\n    if (Object.keys(connectedAccounts).length === 0) {\r\n      console.log(' Skipping persistence (empty state)');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n      const connectedArray = Object.entries(connectedAccounts)\r\n        .filter(([, v]) => !!v)\r\n        .map(([k]) => canonicalizePlatformName(k))\r\n        .filter(Boolean);\r\n      userData.connectedAccounts = connectedArray;\r\n      localStorage.setItem('onairosUser', JSON.stringify(userData));\r\n      console.log(' Auto-persisted connected accounts:', connectedArray);\r\n      notifyConnectedAccountsUpdate();\r\n    } catch (e) {\r\n      console.error(' Error auto-persisting connected accounts:', e);\r\n    }\r\n  }, [connectedAccounts]);\r\n\r\n  const getPlatformsForPage = (page) => {\r\n    // If wrapped app, show all platforms on one page (no pagination)\r\n    if (isWrappedApp) return allPlatforms;\r\n    \r\n    // For other apps, use pagination\r\n    if (page === 1) return allPlatforms.slice(0, 3);\r\n    if (page === 2) return allPlatforms.slice(3, 6);\r\n    return allPlatforms.slice(6);\r\n  };\r\n\r\n  const platforms = getPlatformsForPage(currentPage);\r\n\r\n  // Wrapped-only: ensure we never show a default selection that isn't available (e.g. Instagram),\r\n  // and keep paging locked to a single page.\r\n  useEffect(() => {\r\n    if (!isWrappedApp) return;\r\n    if (currentPage !== 1) setCurrentPage(1);\r\n    const allowed = new Set(wrappedPlatforms.map((p) => p.name));\r\n    if (!allowed.has(selected)) {\r\n      // For wrapped apps, set a valid default selection if current one is invalid\r\n      // Do NOT set connectedAccounts state here, just the UI selection\r\n      setSelected('YouTube');\r\n    }\r\n  }, [isWrappedApp, currentPage, selected]);\r\n\r\n  useEffect(() => {\r\n    // Listener for immediate UI update from deep link (when component is already mounted)\r\n    const handleAuthSuccess = (e) => {\r\n       const { platform } = e.detail;\r\n       console.log(` Event received: OAuth success for ${platform}`);\r\n       const plat = allPlatforms.find((p) => p.connector === platform);\r\n       if (plat) {\r\n          // Mark that we just processed OAuth (for 5 seconds)\r\n          sessionStorage.setItem('onairos_just_connected', Date.now().toString());\r\n          // Update state (persistence happens automatically via useEffect)\r\n          setConnectedAccounts((currentState) => {\r\n            const updated = { ...currentState, [plat.name]: true };\r\n            console.log(` Connected ${plat.name} (event) - adding to:`, currentState, ' result:', updated);\r\n            return updated;\r\n          });\r\n       }\r\n    };\r\n    if (typeof window !== 'undefined') {\r\n      window.addEventListener('onairos-oauth-success', handleAuthSuccess);\r\n    }\r\n\r\n    // Check for OAuth success on mount (after redirect back from mobile)\r\n    const checkOAuthSuccess = () => {\r\n      // 1. Check URL-based return signal (from OnairosButton or direct URL params)\r\n      // Note: OnairosButton cleans up URL params, so we might check sessionStorage set by it\r\n      const sessionSuccess = sessionStorage.getItem('onairos_oauth_return_success');\r\n      const sessionPlatform = sessionStorage.getItem('onairos_oauth_return_platform');\r\n      \r\n      if (sessionSuccess === 'true' && sessionPlatform) {\r\n        console.log(` ${sessionPlatform} OAuth detected via session signal`);\r\n        const plat = allPlatforms.find((p) => p.connector === sessionPlatform);\r\n        if (plat) {\r\n          // Mark that we just processed OAuth (for 5 seconds)\r\n          sessionStorage.setItem('onairos_just_connected', Date.now().toString());\r\n          // Update state (persistence happens automatically via useEffect)\r\n          setConnectedAccounts((currentState) => {\r\n            const updated = { ...currentState, [plat.name]: true };\r\n            console.log(` Connected ${plat.name} (session) - adding to:`, currentState, ' result:', updated);\r\n            return updated;\r\n          });\r\n        }\r\n        // Clean up\r\n        sessionStorage.removeItem('onairos_oauth_return_success');\r\n        sessionStorage.removeItem('onairos_oauth_return_platform');\r\n        return true; // Signal that OAuth was processed\r\n      }\r\n      return false;\r\n\r\n      // 2. Fallback to existing localStorage logic (same-domain or preserved state)\r\n      const oauthContext = localStorage.getItem('onairos_oauth_context');\r\n      const platformConnector = localStorage.getItem('onairos_oauth_platform');\r\n      \r\n      // Only process if we're coming back from platform connector flow\r\n      if (oauthContext === 'platform-connector' && platformConnector) {\r\n        const localStorageKey = `onairos_${platformConnector}_success`;\r\n        const timestampKey = `onairos_${platformConnector}_timestamp`;\r\n        const success = localStorage.getItem(localStorageKey);\r\n        const timestamp = localStorage.getItem(timestampKey);\r\n        \r\n        if (success === 'true' && timestamp) {\r\n          const timestampNum = parseInt(timestamp, 10);\r\n          const now = Date.now();\r\n          \r\n          // Only process if timestamp is recent (within last 30 seconds)\r\n          if (now - timestampNum < 30000) {\r\n            console.log(` ${platformConnector} OAuth completed - processing redirect back`);\r\n            \r\n            // Find platform by connector\r\n            const plat = allPlatforms.find((p) => p.connector === platformConnector);\r\n            if (plat) {\r\n              // Mark that we just processed OAuth (for 5 seconds)\r\n              sessionStorage.setItem('onairos_just_connected', Date.now().toString());\r\n              // Update state (persistence happens automatically via useEffect)\r\n              setConnectedAccounts((currentState) => {\r\n                const updated = { ...currentState, [plat.name]: true };\r\n                console.log(` Connected ${plat.name} (context) - adding to:`, currentState, ' result:', updated);\r\n                return updated;\r\n              });\r\n            }\r\n            \r\n            // Clean up localStorage\r\n            localStorage.removeItem(localStorageKey);\r\n            localStorage.removeItem(timestampKey);\r\n            localStorage.removeItem('onairos_oauth_context');\r\n            localStorage.removeItem('onairos_oauth_platform');\r\n            localStorage.removeItem('onairos_return_url');\r\n            return true; // Signal that OAuth was processed\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    // Check if we're in the middle of an OAuth flow (within last 2 seconds)\r\n    const justConnectedTime = sessionStorage.getItem('onairos_just_connected');\r\n    const inOAuthFlow = justConnectedTime && (Date.now() - parseInt(justConnectedTime, 10) < 2000);\r\n    \r\n    // ALWAYS load from localStorage on mount UNLESS we're actively processing OAuth right now\r\n    // (to avoid overwriting the OAuth update that just happened)\r\n    if (!inOAuthFlow) {\r\n    try {\r\n      const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n      console.log(' UniversalOnboarding mount: Loading persisted accounts from localStorage:', userData.connectedAccounts);\r\n      if (userData.connectedAccounts && Array.isArray(userData.connectedAccounts)) {\r\n        // Convert array to object format\r\n        const accountsObj = userData.connectedAccounts.reduce((acc, platform) => {\r\n            acc[canonicalizePlatformName(platform)] = true;\r\n          return acc;\r\n        }, {});\r\n          console.log(' Loaded connected accounts:', accountsObj);\r\n        setConnectedAccounts(accountsObj);\r\n      } else {\r\n        console.log(' No valid connectedAccounts in localStorage');\r\n        // CRITICAL FIX: Ensure no auto-toggles for new users.\r\n        // If localStorage is empty, we default to empty state.\r\n        setConnectedAccounts({});\r\n      }\r\n    } catch (error) {\r\n      console.error(' Failed to load persisted connected accounts:', error);\r\n      }\r\n    } else {\r\n      console.log(' Skipping localStorage load (OAuth just completed)');\r\n    }\r\n    \r\n    initialLoadDone.current = true;\r\n    \r\n    // THEN: Check for OAuth success (which will ADD to existing connections)\r\n    checkOAuthSuccess();\r\n    \r\n    // Legacy: Load OAuth platform returns (for backward compatibility)\r\n    const p = localStorage.getItem('onairos_oauth_platform');\r\n    if (p && !localStorage.getItem('onairos_oauth_context')) {\r\n      // Only accept legacy signals if there is a *real* recent success marker.\r\n      // Otherwise this can auto-toggle a platform for \"new users\" from stale leftovers.\r\n      const legacySuccess = localStorage.getItem(`onairos_${String(p).toLowerCase()}_success`) || localStorage.getItem(`onairos_${p}_success`);\r\n      const legacyTs = localStorage.getItem(`onairos_${String(p).toLowerCase()}_timestamp`) || localStorage.getItem(`onairos_${p}_timestamp`);\r\n      const legacyTsNum = legacyTs ? parseInt(legacyTs, 10) : NaN;\r\n      const legacyOk = legacySuccess === 'true' && Number.isFinite(legacyTsNum) && (Date.now() - legacyTsNum < 30000);\r\n\r\n      if (!legacyOk) {\r\n        // Clean up stale keys and do nothing.\r\n        localStorage.removeItem('onairos_oauth_platform');\r\n        localStorage.removeItem('onairos_oauth_return');\r\n      } else {\r\n        localStorage.removeItem('onairos_oauth_platform');\r\n        localStorage.removeItem('onairos_oauth_return');\r\n        \r\n        // Mark that we just processed OAuth (for 5 seconds)\r\n        sessionStorage.setItem('onairos_just_connected', Date.now().toString());\r\n        // Update state (persistence happens automatically via useEffect)\r\n        const canonical = canonicalizePlatformName(p);\r\n        setConnectedAccounts((currentState) => {\r\n          const updated = { ...currentState, [canonical]: true };\r\n          console.log(` Connected ${canonical} (legacy) - adding to:`, currentState);\r\n          return updated;\r\n        });\r\n      }\r\n    }\r\n    \r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        window.removeEventListener('onairos-oauth-success', handleAuthSuccess);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  async function connectToPlatform(name) {\r\n    const plat = allPlatforms.find((p) => p.name === name);\r\n    if (!plat) return false;\r\n    try {\r\n      // For direct-link platforms (no OAuth), mark connected immediately and return\r\n      if (plat.directLink) {\r\n        setConnectedAccounts((s) => ({ ...s, [name]: true }));\r\n        setIsConnecting(false);\r\n        setConnectingPlatform(null);\r\n        return true;\r\n      }\r\n\r\n      // IMPORTANT: do NOT optimistically mark as connected before OAuth completes.\r\n      // Otherwise users can hit \"Update\" and persist a fake connection.\r\n      console.log(` Connecting to ${name} - starting OAuth (no optimistic connected state)`);\r\n      setIsConnecting(true);\r\n      setConnectingPlatform(name);\r\n      \r\n      // BYPASS: Twitter endpoint is 404, so just keep toggle ON without API call\r\n      if (name === 'Twitter') {\r\n        console.log(' Twitter: Bypassing API call (endpoint not available), keeping toggle ON');\r\n        setIsConnecting(false);\r\n        setConnectingPlatform(null);\r\n        return true;\r\n      }\r\n      \r\n      // IMPORTANT: Backend connectors (notably Reddit) validate the Onairos account by username/email.\r\n      // If we accidentally send the fallback 'user@example.com', the backend will respond with\r\n      // `oauth-callback.html?success=false&error=Account%20Doesn%27t%20Exist` even when the user exists.\r\n      //\r\n      // Prefer the prop `username` passed from `onairosButton.jsx` (derived from the verified session),\r\n      // then fall back to stored values. Avoid hardcoded placeholder emails.\r\n      const resolvedUsername =\r\n        (typeof username === 'string' && username.trim().length > 0 ? username.trim() : '') ||\r\n        (typeof localStorage !== 'undefined' ? (localStorage.getItem('username') || '') : '') ||\r\n        (() => {\r\n          try {\r\n            const u = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n            return u?.email || u?.username || '';\r\n          } catch {\r\n            return '';\r\n          }\r\n        })();\r\n\r\n      if (!resolvedUsername) {\r\n        console.warn(' No username/email available for OAuth authorize payload; aborting connect to avoid backend Account Does Not Exist.');\r\n        throw new Error('missing username');\r\n      }\r\n\r\n      // Determine return URL based on platform\r\n      // For Desktop/Web: Send empty string/null to prevent backend from generating a redirect URL\r\n      // This forces oauth-callback.html to NOT redirect, allowing the popup/iframe to close naturally via postMessage or window.close()\r\n      const isCapacitorNative = typeof window !== 'undefined' && \r\n        window.Capacitor && \r\n        typeof window.Capacitor.isNativePlatform === 'function' && \r\n        window.Capacitor.isNativePlatform();\r\n      \r\n      const isMobileBrowser = typeof navigator !== 'undefined' &&\r\n        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n\r\n      // Effective mobile check for flow control (use prop or detection)\r\n      const effectiveMobile = isMobileProp || isMobileBrowser;\r\n\r\n      let returnUrl = ''; // Default to empty for Desktop Web\r\n      \r\n      if (isCapacitorNative) {\r\n        returnUrl = `mobiletest://oauth-callback?success=true&platform=${plat.connector}`;\r\n      } else if (effectiveMobile) {\r\n        // Mobile Web needs redirect back to self\r\n        // Sanitize URL to prevent recursive params if user is already on a return URL\r\n        const cleanUrl = window.location.origin + window.location.pathname;\r\n        returnUrl = cleanUrl;\r\n      }\r\n\r\n      console.log(` Authorizing ${plat.connector} with returnUrl:`, returnUrl || '(none/desktop)');\r\n\r\n      // Build session payload for backend (SDK-aware)\r\n      const sessionPayload = { username: resolvedUsername };\r\n\r\n      // For mobile web flows, let backend know this is coming from the web SDK\r\n      // and pass returnUrl inside session for connectors that use parseEnhancedSession (e.g. Reddit)\r\n      if (effectiveMobile) {\r\n        sessionPayload.sdkType = 'web';\r\n        sessionPayload.returnUrl = returnUrl;\r\n      }\r\n\r\n      const bodyPayload = {\r\n        session: sessionPayload,\r\n      };\r\n\r\n      // Backward compatibility for YouTube route which currently reads req.body.returnUrl\r\n      // Desktop flows don't need a returnUrl; only send it for mobile web\r\n      if (!isCapacitorNative && effectiveMobile) {\r\n        bodyPayload.returnUrl = returnUrl;\r\n      }\r\n\r\n      const res = await fetch(`${sdkConfig.baseUrl}/${plat.connector}/authorize`, {\r\n        method: 'POST',\r\n        headers: { 'x-api-key': sdkConfig.apiKey, 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(bodyPayload),\r\n      });\r\n      if (!res.ok) throw new Error('auth failed');\r\n      const data = await res.json();\r\n\r\n      const candidates = (\r\n        {\r\n          youtube: ['youtubeURL','youtubeUrl','youtube_url'],\r\n          linkedin: ['linkedinURL','linkedinUrl','linkedin_url'],\r\n          reddit: ['redditURL','redditUrl','reddit_url'],\r\n          pinterest: ['pinterestURL','pinterestUrl','pinterest_url'],\r\n          instagram: ['instagramURL','instagramUrl','instagram_url'],\r\n          github: ['githubURL','githubUrl','github_url'],\r\n          facebook: ['facebookURL','facebookUrl','facebook_url'],\r\n          gmail: ['gmailURL','gmailUrl','gmail_url'],\r\n        }[plat.connector]\r\n      ) || [`${plat.connector}URL`, `${plat.connector}Url`, `${plat.connector}_url`, 'platformURL', 'authUrl', 'url'];\r\n\r\n      let oauthUrl = null;\r\n      console.log(` [DEBUG] ${plat.connector} candidates:`, candidates, 'Response keys:', Object.keys(data));\r\n      \r\n      // Fallback: Check for URL in data object (case-insensitive)\r\n      if (!oauthUrl) {\r\n         const keys = Object.keys(data);\r\n         const candidateLower = candidates.map(c => c.toLowerCase());\r\n         for (const key of keys) {\r\n            if (candidateLower.includes(key.toLowerCase()) && data[key]) {\r\n               console.log(` [DEBUG] Found fuzzy match for ${plat.connector}: ${key}`);\r\n               oauthUrl = data[key];\r\n               break;\r\n            }\r\n         }\r\n      }\r\n\r\n      for (const k of candidates) {\r\n        if (data[k]) {\r\n          oauthUrl = data[k];\r\n          break;\r\n        }\r\n      }\r\n      \r\n      if (!oauthUrl) {\r\n        console.error(` No URL found for ${plat.connector} in response:`, data);\r\n        throw new Error('no url');\r\n      }\r\n\r\n      // Mobile-only: ensure the OAuth URL can always bring us back to the app even on failure.\r\n      // On mobile Safari/Chrome the OAuth flow often runs in a full tab (no window.opener) and\r\n      // window.close() is blocked. Our `public/oauth-callback.html` will redirect back if it can\r\n      // resolve `returnUrl` (query param) or decode it from `state`.\r\n      const withMobileReturnUrl = (rawUrl) => {\r\n        if (!rawUrl || typeof window === 'undefined') return rawUrl;\r\n        try {\r\n          const u = new URL(rawUrl);\r\n          const cleanReturnUrl = `${window.location.origin}${window.location.pathname}`;\r\n          // Put returnUrl directly on callback URL if we're already pointing at oauth-callback.html\r\n          if ((u.pathname || '').includes('oauth-callback.html') && !u.searchParams.get('returnUrl')) {\r\n            u.searchParams.set('returnUrl', cleanReturnUrl);\r\n          }\r\n          // Also embed returnUrl into OAuth state so the provider echoes it back to the callback.\r\n          // (Many backends don't propagate returnUrl on early errors; state keeps it round-trippable.)\r\n          if (!u.searchParams.get('state')) {\r\n            const statePayload = { returnUrl: cleanReturnUrl, platform: plat.connector, ts: Date.now() };\r\n            const encoded = btoa(JSON.stringify(statePayload));\r\n            u.searchParams.set('state', encoded);\r\n          }\r\n          return u.toString();\r\n        } catch (_) {\r\n          // Fallback for non-URL strings: best-effort append returnUrl when callback is already in the URL\r\n          try {\r\n            const cleanReturnUrl = `${window.location.origin}${window.location.pathname}`;\r\n            if (String(rawUrl).includes('oauth-callback.html') && !String(rawUrl).includes('returnUrl=')) {\r\n              const sep = String(rawUrl).includes('?') ? '&' : '?';\r\n              return `${rawUrl}${sep}returnUrl=${encodeURIComponent(cleanReturnUrl)}`;\r\n            }\r\n          } catch (_) {}\r\n          return rawUrl;\r\n        }\r\n      };\r\n\r\n      // Always store a return URL/context before launching OAuth.\r\n      // On iOS Safari, \"popup\" often becomes a new tab with no window.opener,\r\n      // so oauth-callback must rely on localStorage to navigate back.\r\n      try {\r\n        // Hint to the SDK: after OAuth completes, reopen the modal on UniversalOnboarding\r\n        // (otherwise existing users can get auto-routed to DataRequest on reload).\r\n        localStorage.setItem('onairos_post_oauth_flow', 'onboarding');\r\n        const returnUrl = window.location.href;\r\n        localStorage.setItem('onairos_return_url', returnUrl);\r\n        localStorage.setItem('onairos_oauth_context', 'platform-connector');\r\n        localStorage.setItem('onairos_oauth_platform', plat.connector);\r\n        console.log(` Stored return URL for ${plat.connector}:`, returnUrl);\r\n      } catch (e) {\r\n        // ignore storage failures\r\n      }\r\n\r\n      // PRIORITY 1: Use Capacitor Browser for native apps\r\n\r\n      if (isCapacitorNative) {\r\n        console.log(` Capacitor Native: opening ${plat.connector} OAuth with Browser plugin`);\r\n        try {\r\n          // Store context for when user returns\r\n          const localStorageKey = `onairos_${plat.connector}_success`;\r\n          \r\n          // Try to set up listener, but don't let it block\r\n          // Note: 'browserFinished' is fired when the browser is closed by the user or programmatically\r\n          try {\r\n            await Browser.addListener('browserFinished', () => {\r\n              console.log(` Browser closed for ${plat.connector}`);\r\n              // Only reset if we haven't already detected success\r\n              if (!localStorage.getItem(localStorageKey)) {\r\n                 setIsConnecting(false);\r\n                 setConnectingPlatform(null);\r\n              }\r\n            });\r\n          } catch (listenerError) {\r\n             console.warn('Browser listener setup failed:', listenerError);\r\n          }\r\n          \r\n          // Ensure Browser.open is awaited and errors caught\r\n          await Browser.open({ \r\n            url: oauthUrl,\r\n            windowName: '_blank',\r\n            presentationStyle: 'fullscreen'\r\n          });\r\n          console.log(` Opened ${plat.connector} OAuth URL in Capacitor Browser`);\r\n          \r\n          return true;\r\n        } catch (err) {\r\n          console.error(` Capacitor Browser failed for ${plat.connector}:`, err);\r\n          // Fall through to mobile browser redirect if plugin fails\r\n        }\r\n      }\r\n\r\n      // PRIORITY 2: Mobile browser - use same-page redirect\r\n      if (effectiveMobile) {\r\n        console.log(` Mobile browser/view: redirecting to ${plat.connector} OAuth in same page`);\r\n        \r\n        // Store return URL and context for redirect back\r\n        const returnUrl = window.location.href;\r\n        localStorage.setItem('onairos_post_oauth_flow', 'onboarding');\r\n        localStorage.setItem('onairos_return_url', returnUrl);\r\n        localStorage.setItem('onairos_oauth_context', 'platform-connector');\r\n        localStorage.setItem('onairos_oauth_platform', plat.connector);\r\n        console.log(` Stored return URL for ${plat.connector}:`, returnUrl);\r\n        \r\n        // Use same-page redirect on mobile (ensure oauthUrl carries returnUrl/state so callback can redirect back)\r\n        setIsConnecting(false);\r\n        setConnectingPlatform(null);\r\n        window.location.href = withMobileReturnUrl(oauthUrl);\r\n        return true;\r\n      }\r\n\r\n      // Desktop: open popup\r\n      // Note: User requested \"popup iframes\". Standard OAuth uses window.open (popup window).\r\n      // Iframes are typically blocked by providers (X-Frame-Options: DENY).\r\n      // We ensure it opens as a popup and we monitor it.\r\n      const width = 600;\r\n      const height = 700;\r\n      const left = window.screenX + (window.outerWidth - width) / 2;\r\n      const top = window.screenY + (window.outerHeight - height) / 2;\r\n      \r\n      const popup = window.open(\r\n        oauthUrl,\r\n        'onairos_oauth_popup', \r\n        `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`\r\n      );\r\n\r\n      if (!popup || popup.closed || typeof popup.closed === 'undefined') {\r\n        console.warn(` ${plat.connector} popup blocked, falling back to full-page redirect`);\r\n        setIsConnecting(false);\r\n        setConnectingPlatform(null);\r\n        window.location.href = oauthUrl;\r\n        return true;\r\n      }\r\n\r\n      // Set up postMessage listener for cross-origin communication\r\n      const messageHandler = (event) => {\r\n        // Only accept messages from onairos.uk origin\r\n        // Allow localhost for dev testing as well\r\n        const allowedOrigins = ['https://api2.onairos.uk', 'https://onairos.uk'];\r\n        const isAllowed = allowedOrigins.includes(event.origin) || \r\n                          event.origin.includes('onairos.uk') || \r\n                          event.origin.includes('localhost') || \r\n                          event.origin.includes('127.0.0.1');\r\n        \r\n        if (!isAllowed) {\r\n          console.log(` Ignoring postMessage from unknown origin: ${event.origin}`);\r\n          return;\r\n        }\r\n\r\n        if (event.data && event.data.type === 'oauth-success' && (event.data.platform === plat.connector || event.data.platform === name)) {\r\n          console.log(` ${plat.connector} OAuth success received via postMessage:`, event.data);\r\n          window.removeEventListener('message', messageHandler);\r\n          clearInterval(pollInterval);\r\n          setIsConnecting(false);\r\n          setConnectingPlatform(null);\r\n          \r\n          // Mark connected ONLY after actual OAuth success (persistence happens automatically via useEffect)\r\n          setConnectedAccounts((currentState) => {\r\n            const updated = { ...currentState, [plat.name]: true };\r\n            console.log(` Connected ${plat.name} (postMessage) - Current:`, currentState, ' Updated:', updated);\r\n            return updated;\r\n          });\r\n\r\n          // Clean up any OAuth markers so they can't incorrectly affect future sessions.\r\n          try {\r\n            localStorage.removeItem(localStorageKey);\r\n            localStorage.removeItem(timestampKey);\r\n            localStorage.removeItem('onairos_oauth_context');\r\n            localStorage.removeItem('onairos_oauth_platform');\r\n            localStorage.removeItem('onairos_return_url');\r\n          } catch (e) {}\r\n          \r\n          // Close popup immediately\r\n          try {\r\n            if (popup && !popup.closed) {\r\n              popup.close();\r\n              console.log(' Closed popup via postMessage handler');\r\n            }\r\n          } catch (e) {\r\n            // Ignore errors closing popup\r\n          }\r\n        } else if (event.data && event.data.type === 'oauth-failure' && (event.data.platform === plat.connector || event.data.platform === name)) {\r\n            console.warn(` ${plat.connector} OAuth failure received via postMessage:`, event.data);\r\n            window.removeEventListener('message', messageHandler);\r\n            clearInterval(pollInterval);\r\n            \r\n            // Revert state\r\n            setIsConnecting(false);\r\n            setConnectingPlatform(null);\r\n            setConnectedAccounts((s) => ({ ...s, [plat.name]: false }));\r\n            \r\n             // Clean up\r\n             try {\r\n                localStorage.removeItem(localStorageKey);\r\n                localStorage.removeItem(timestampKey);\r\n                localStorage.removeItem('onairos_oauth_context');\r\n                localStorage.removeItem('onairos_oauth_platform');\r\n                localStorage.removeItem('onairos_return_url');\r\n             } catch(e) {}\r\n\r\n             // Close popup\r\n             try {\r\n                if (popup && !popup.closed) {\r\n                   popup.close();\r\n                }\r\n             } catch(e) {}\r\n        }\r\n      };\r\n\r\n      window.addEventListener('message', messageHandler);\r\n\r\n      // Poll localStorage for OAuth completion (oauth-callback.html sets this)\r\n      // Note: Only works if same-origin or shared storage strategies are used.\r\n      // For cross-origin (app on onairos.uk vs api2.onairos.uk), this relies on postMessage or redirect.\r\n      const localStorageKey = `onairos_${plat.connector}_success`;\r\n      const timestampKey = `onairos_${plat.connector}_timestamp`;\r\n      let pollCount = 0;\r\n      const maxPolls = 300; // 5 minutes max\r\n\r\n      const pollInterval = setInterval(() => {\r\n        pollCount++;\r\n        \r\n        try {\r\n          // Check if popup is closed (works for popups, not tabs)\r\n          if (popup.closed && pollCount > 10) {\r\n            clearInterval(pollInterval);\r\n            window.removeEventListener('message', messageHandler);\r\n            setIsConnecting(false);\r\n            setConnectingPlatform(null);\r\n            console.log(` ${plat.connector} popup was closed`);\r\n            return;\r\n          }\r\n\r\n          // Check localStorage for success signal\r\n          const success = localStorage.getItem(localStorageKey);\r\n          const timestamp = localStorage.getItem(timestampKey);\r\n          const errorSignal = localStorage.getItem(`onairos_${plat.connector}_error`);\r\n          \r\n          if (errorSignal) {\r\n             console.warn(` ${plat.connector} error signal detected in localStorage`);\r\n             clearInterval(pollInterval);\r\n             window.removeEventListener('message', messageHandler);\r\n             \r\n             // Revert state\r\n             setIsConnecting(false);\r\n             setConnectingPlatform(null);\r\n             setConnectedAccounts((s) => ({ ...s, [plat.name]: false }));\r\n             \r\n             // Cleanup\r\n             try {\r\n                localStorage.removeItem(`onairos_${plat.connector}_error`);\r\n                localStorage.removeItem(localStorageKey);\r\n                localStorage.removeItem(timestampKey);\r\n                localStorage.removeItem('onairos_oauth_context');\r\n                localStorage.removeItem('onairos_oauth_platform');\r\n                localStorage.removeItem('onairos_return_url');\r\n             } catch(e) {}\r\n             \r\n             // Close popup\r\n             try {\r\n                if (!popup.closed) popup.close();\r\n             } catch(e) {}\r\n             return;\r\n          }\r\n          \r\n          if (success === 'true' && timestamp) {\r\n            const timestampNum = parseInt(timestamp, 10);\r\n            const now = Date.now();\r\n            \r\n            // Only process if timestamp is recent (within last 30 seconds)\r\n            if (now - timestampNum < 30000) {\r\n              console.log(` ${plat.connector} OAuth completed successfully`);\r\n              clearInterval(pollInterval);\r\n              window.removeEventListener('message', messageHandler);\r\n              setIsConnecting(false);\r\n              setConnectingPlatform(null);\r\n              \r\n              // Mark connected ONLY after actual OAuth success (persistence happens automatically via useEffect)\r\n              setConnectedAccounts((currentState) => {\r\n                const updated = { ...currentState, [plat.name]: true };\r\n                console.log(` Connected ${plat.name} (localStorage poll) - adding to:`, currentState, ' result:', updated);\r\n                return updated;\r\n              });\r\n\r\n              // Clean up success markers + oauth context so they don't cause auto-toggles later.\r\n              try {\r\n                localStorage.removeItem(localStorageKey);\r\n                localStorage.removeItem(timestampKey);\r\n                localStorage.removeItem('onairos_oauth_context');\r\n                localStorage.removeItem('onairos_oauth_platform');\r\n                localStorage.removeItem('onairos_return_url');\r\n              } catch (e) {}\r\n              \r\n              // Close popup immediately\r\n              try {\r\n                if (!popup.closed) {\r\n                  popup.close();\r\n                  console.log(' Closed popup via localStorage polling');\r\n                }\r\n              } catch (e) {\r\n                // Ignore errors closing popup\r\n              }\r\n              return;\r\n            }\r\n          }\r\n\r\n          // Timeout after max polls\r\n          if (pollCount >= maxPolls) {\r\n            clearInterval(pollInterval);\r\n            window.removeEventListener('message', messageHandler);\r\n            setIsConnecting(false);\r\n            setConnectingPlatform(null);\r\n            console.log(` [TIMEOUT] ${plat.connector} OAuth polling timed out after 5 minutes`);\r\n            \r\n            // Try to close popup if still open\r\n            try {\r\n              if (!popup.closed) {\r\n                popup.close();\r\n              }\r\n            } catch (e) {\r\n              // Ignore errors closing popup\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error(`Error in ${plat.connector} OAuth polling:`, error);\r\n        }\r\n      }, 1000);\r\n\r\n      return true;\r\n    } catch (e) {\r\n      console.error(` Error connecting to ${name}:`, e);\r\n      // On failure, revert the optimistic toggle\r\n      setConnectedAccounts((s) => ({ ...s, [name]: false }));\r\n      setIsConnecting(false); setConnectingPlatform(null); return false;\r\n    }\r\n  }\r\n\r\n  const handleSwitch = async (name) => {\r\n    // Mobile: AI direct-link platforms are display-only (no-op on tap)\r\n    const aiNoopOnMobile = ['ChatGPT', 'Claude', 'Gemini', 'Grok'];\r\n    if (isMobile && aiNoopOnMobile.includes(name)) {\r\n      console.log(` ${name} disabled on mobile - no action`);\r\n      return;\r\n    }\r\n    if (isConnecting && connectingPlatform !== name) return;\r\n    const on = !!connectedAccounts[name];\r\n    if (on) {\r\n      // Toggle OFF - disconnect from backend AND local state\r\n      setConnectedAccounts((currentState) => {\r\n        const updated = { ...currentState, [name]: false };\r\n        console.log(` Disconnected ${name}`);\r\n        return updated;\r\n      });\r\n      \r\n      // Call backend /revoke to actually remove the connection from database\r\n      // This ensures wrapped dashboard signature changes and forces regeneration\r\n      try {\r\n        const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\r\n        const userToken = localStorage.getItem('onairos_user_token');\r\n        const savedUser = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n        const userIdentifier = username || savedUser.username || savedUser.email || '';\r\n        \r\n        if (!userIdentifier) {\r\n          console.warn(` Cannot revoke ${name} - no user identifier found`);\r\n          return;\r\n        }\r\n        \r\n        console.log(` Calling backend /revoke for ${name}...`);\r\n        await fetch(`${baseUrl}/revoke`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            ...(userToken && { 'Authorization': `Bearer ${userToken}` })\r\n          },\r\n          body: JSON.stringify({\r\n            Info: {\r\n              connection: name,\r\n              username: userIdentifier\r\n            }\r\n          })\r\n        });\r\n        console.log(` Backend revoke successful for ${name}`);\r\n      } catch (revokeError) {\r\n        console.warn(` Backend revoke failed for ${name}:`, revokeError);\r\n        // Don't block UI - disconnection still works locally\r\n      }\r\n      \r\n      return;\r\n    }\r\n    else await connectToPlatform(name);\r\n  };\r\n\r\n  const connectedCount = Object.values(connectedAccounts).filter(Boolean).length;\r\n\r\n  useEffect(() => {\r\n    if (!lottieRef.current) return;\r\n    const totalFrames = (personaAnim.op || 0) - (personaAnim.ip || 0);\r\n    const TOTAL_PLATFORMS = isWrappedApp ? 3 : 9; // 3 for wrapped app, 9 for other apps\r\n    const progress = connectedCount / TOTAL_PLATFORMS;\r\n    const target = Math.max(0, Math.floor(progress * totalFrames));\r\n    const start = lastFrameRef.current || 0;\r\n    const duration = 420; const startTs = performance.now();\r\n    const step = (now) => {\r\n      const t = Math.min(1, (now - startTs) / duration);\r\n      const eased = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;\r\n      const frame = Math.floor(start + (target - start) * eased);\r\n      lottieRef.current.goToAndStop(frame, true);\r\n      if (t < 1) rafRef.current = requestAnimationFrame(step); else lastFrameRef.current = target;\r\n    };\r\n    if (rafRef.current) cancelAnimationFrame(rafRef.current);\r\n    rafRef.current = requestAnimationFrame(step);\r\n    return () => { if (rafRef.current) cancelAnimationFrame(rafRef.current); };\r\n  }, [connectedCount]);\r\n\r\n  // swipe handlers for smooth paging\r\n  const onTouchStart = (e) => { touchStartX.current = e.touches[0].clientX; touchDeltaX.current = 0; };\r\n  const onTouchMove  = (e) => { touchDeltaX.current = e.touches[0].clientX - touchStartX.current; };\r\n  const onTouchEnd   = () => {\r\n    const dx = touchDeltaX.current; const THRESH = 40;\r\n    // Disable pagination swipe for wrapped app\r\n    if (!isWrappedApp) {\r\n    if (dx < -THRESH && currentPage < 3) setCurrentPage(currentPage + 1);\r\n    else if (dx > THRESH && currentPage > 1) setCurrentPage(currentPage - 1);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full h-full relative\" style={{ \r\n      // CRITICAL: Ensure this screen stretches to the available modal height on desktop.\r\n      // Relying on `height: 100%` can fail when ancestors don't have an explicit height,\r\n      // which makes the CTA appear to \"float\" instead of sitting on the bottom.\r\n      flex: 1,\r\n      minHeight: 0,\r\n      height: '100%',\r\n      // Hide scrollbars for mobile browser only\r\n      ...(isMobile && {\r\n        scrollbarWidth: 'none', /* Firefox */\r\n        msOverflowStyle: 'none', /* IE/Edge */\r\n      })\r\n    }}>\r\n      <style>\r\n        {fadeSlideInKeyframes}\r\n        {/* Hide scrollbar for webkit browsers on mobile */}\r\n        {isMobile && `\r\n          .w-full::-webkit-scrollbar,\r\n          *::-webkit-scrollbar {\r\n            display: none;\r\n            width: 0;\r\n            height: 0;\r\n          }\r\n        `}\r\n      </style>\r\n\r\n      {/* persona as background (unchanged) */}\r\n      <div aria-hidden style={{ \r\n        position: 'absolute', \r\n        left: '50%', \r\n        top: PERSONA_TOP, \r\n        transform: 'translateX(-50%)', \r\n        width: personaSide, \r\n        height: personaSide, \r\n        zIndex: 0, \r\n        pointerEvents: 'none', \r\n        opacity: 0.95 \r\n      }}>\r\n        <div className=\"overflow-hidden rounded-[28px] w-full h-full\">\r\n          <Lottie lottieRef={lottieRef} animationData={personaAnim} autoplay={false} loop={false} style={{ width: '100%', height: '100%' }} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* content above persona */}\r\n      <div\r\n        className=\"relative z-10 h-full flex flex-col\"\r\n        style={{\r\n        minHeight: 0,\r\n        overflow: 'hidden',\r\n        }}\r\n      >\r\n        {/* header - MOVED TO TOP Z-INDEX to sit above persona if overlapped */}\r\n        {/* Desktop: Reduced padding to fit everything */}\r\n        <div\r\n          className=\"px-6 text-center flex-shrink-0 relative z-20\"\r\n          style={{\r\n            paddingTop: isMobile ? (isSmallMobile ? '2.5rem' : '3rem') : '1.5rem',\r\n            paddingBottom: isMobile ? '0.5rem' : '0.25rem',\r\n          }}\r\n        >\r\n          {/* Nudge header/subheader up slightly on mobile without affecting layout below (transform doesn't affect flow). */}\r\n          <div style={{ transform: isMobile ? 'translateY(-6px)' : 'translateY(0px)' }}>\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2 leading-tight\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>\r\n              Connect App Data\r\n            </h1>\r\n            <p className=\"text-gray-600 text-base\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n              More Connections, Better Personalization.\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Spacer - MOBILE ONLY: push icons/card WAY down so PERSONA SHINES */}\r\n        {/* Desktop: Push content to bottom of modal */}\r\n        {isMobile && <div className=\"flex-1\" style={{ minHeight: isSmallMobile ? 80 : 100 }} />}\r\n        {!isMobile && <div className=\"flex-1\" />}\r\n\r\n        {/* icons band */}\r\n        <div className=\"px-6 flex-shrink-0\" style={{ height: ICONS_H }}>\r\n          {/* Web-only: nudge icon band down slightly without affecting layout below */}\r\n          <div className=\"h-full flex items-center justify-center\" style={{ transform: isMobile ? 'none' : 'translateY(0px)' }}>\r\n            <div\r\n              className=\"grid w-full box-border relative\"\r\n              onTouchStart={onTouchStart}\r\n              onTouchMove={onTouchMove}\r\n              onTouchEnd={onTouchEnd}\r\n                    style={{\r\n                gridAutoFlow: 'column',\r\n                gridTemplateColumns: `repeat(${platforms.length}, minmax(0,1fr))`,\r\n                columnGap: currentPage === 1 ? GAP_PAGE1 : GAP_PAGE2,\r\n                alignItems: 'center',\r\n                justifyItems: 'center',\r\n                paddingInline: 8,\r\n                overflow: 'hidden',\r\n              }}\r\n            >\r\n              {platforms.map((p, idx) => {\r\n                const on = !!connectedAccounts[p.name];\r\n                const showConnectedStyling = on;\r\n                const busy = false; // keep icon static visually per request\r\n                const isSel = selected === p.name;\r\n                \r\n                // Debug: Log connection state for each platform\r\n                if (on) {\r\n                  console.log(` ${p.name} is connected:`, { on, showConnectedStyling, connectedAccounts });\r\n                }\r\n                const shift = (currentPage === 1 ? idx : idx - 2) * 14;\r\n                return (\r\n                  <div key={p.name} className=\"transition-all duration-300\" style={{ opacity: 0, transform: `translateX(${shift}px)`, animation: 'fadeSlideIn 0.28s forwards', ['--slide-x']: `${shift}px` }}>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => { \r\n                        // Mobile: AI direct-link platforms are display-only (no-op on tap)\r\n                        const aiNoopOnMobile = ['chatgpt', 'claude', 'gemini', 'grok'];\r\n                        if (isMobile && aiNoopOnMobile.includes(p.connector)) {\r\n                          console.log(` ${p.name} disabled on mobile - no action`);\r\n                          return;\r\n                        }\r\n\r\n                        setSelected(p.name);\r\n                        \r\n                        // Properly detect native platform (not just Capacitor presence)\r\n                        const isNativePlatform = typeof window !== 'undefined' && \r\n                          window.Capacitor?.isNativePlatform?.() === true;\r\n                        \r\n                        // Detect mobile browser (not Capacitor native)\r\n                        const isMobileBrowser = typeof window !== 'undefined' && \r\n                          window.innerWidth <= 768 && \r\n                          !isNativePlatform;\r\n                        \r\n                        // Debug logging\r\n                        console.log('UniversalOnboarding Click:', { \r\n                          platform: p.name, \r\n                          isMobile, \r\n                          isMobileProp, \r\n                          isNativePlatform,\r\n                          isMobileBrowser,\r\n                          hasCapacitor: typeof window !== 'undefined' && !!window.Capacitor,\r\n                          userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown'\r\n                        });\r\n\r\n                        // MOBILE BROWSER ONLY: Disable Instagram clicks (show visual selection but don't connect)\r\n                        if (p.name === 'Instagram' && isMobileBrowser) {\r\n                          console.log(' Instagram disabled on mobile browser - visual selection only');\r\n                          return;\r\n                        }\r\n\r\n                        // For ChatGPT, show modal ONLY on DESKTOP (not mobile browser or native app)\r\n                        if (p.connector === 'chatgpt' && !isNativePlatform && !isMobileBrowser) {\r\n                          console.log(' Opening ChatGPT Connect Modal (Desktop Only)');\r\n                          setShowChatGPTModal(true);\r\n                          return;\r\n                        }\r\n                        \r\n                        // On mobile browser, ChatGPT card is visible but clicking does nothing (like Instagram)\r\n                        if (p.connector === 'chatgpt' && isMobileBrowser) {\r\n                          console.log(' ChatGPT disabled on mobile browser - visual selection only');\r\n                          return;\r\n                        }\r\n\r\n                        if (p.directLink) {\r\n                          // For direct-link AI tools, just select (don't open)\r\n                          console.log(`Selecting ${p.name} (direct link platform)`);\r\n                          setSelected(p.name);\r\n                        } else {\r\n                          // For all platforms, icon click should ONLY select, not toggle\r\n                          console.log(`Selecting ${p.name}`);\r\n                          setSelected(p.name);\r\n                        }\r\n                      }}\r\n                      className=\"relative grid place-items-center outline-none\"\r\n                      style={{ width: SLOT, height: SLOT }}\r\n                      title={p.name}\r\n                    >\r\n                      <div \r\n                        className={`rounded-full transition-all duration-200 ease-out flex items-center justify-center shadow-lg ${showConnectedStyling ? 'ring-4 ring-blue-600 border-2 border-white bg-white text-black' : 'border-2 border-gray-300 hover:border-gray-400 bg-white text-black'}`}\r\n                        style={{ \r\n                          width: CIRCLE, \r\n                          height: CIRCLE, \r\n                          transform: `scale(${isSel ? ACTIVE_SCALE : 1})`, \r\n                          transformOrigin: 'center',\r\n                          boxShadow: showConnectedStyling ? '0 0 0 4px rgb(37 99 235), 0 4px 6px -1px rgba(0, 0, 0, 0.1)' : undefined\r\n                        }}\r\n                      >\r\n                        <div className=\"flex items-center justify-center\" style={{ width: 20, height: 20 }}>\r\n                          {p.icon}\r\n                        </div>\r\n                      </div>\r\n                    </button>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Pagination dots - hidden for wrapped app */}\r\n        {!isWrappedApp && (\r\n        <div className=\"relative flex items-center justify-center gap-3 select-none flex-shrink-0\" style={{ marginTop: isMobile ? 12 : 10, marginBottom: isMobile ? 20 : 10, zIndex: 25 }}>\r\n          {[1,2,3].map(n => (\r\n            <button key={n} onClick={() => setCurrentPage(n)} aria-label={`page ${n}`} className=\"relative\" style={{ width: isMobile ? 6 : 8, height: isMobile ? 6 : 8 }}>\r\n              <span className={`block rounded-full ${currentPage === n ? 'bg-blue-600 scale-125' : 'bg-gray-300'} transition-transform`} style={{ width: isMobile ? 6 : 8, height: isMobile ? 6 : 8 }} />\r\n            </button>\r\n          ))}\r\n        </div>\r\n        )}\r\n\r\n        {/* info sheet  positioned using flex */}\r\n        <div className=\"px-6 flex-shrink-0\" style={{ marginBottom: isMobile ? 24 : 12, zIndex: 20 }}>\r\n          <div\r\n            className=\"mx-auto rounded-2xl bg-white shadow-sm border border-gray-200 px-4 py-2.5\"\r\n            style={{ \r\n              width: 'min(680px,92%)', \r\n              maxHeight: INFO_SHEET_MAX_H,\r\n              overflowY: 'auto',\r\n              overflowX: 'hidden'\r\n            }}\r\n          >\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"text-gray-900 font-medium\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>{selected}</div>\r\n              <button\r\n                type=\"button\"\r\n                role=\"switch\"\r\n                aria-checked={!!connectedAccounts[selected]}\r\n                aria-label={`toggle ${selected}`}\r\n                onClick={(e) => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  handleSwitch(selected);\r\n                }}\r\n                onTouchEnd={(e) => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  handleSwitch(selected);\r\n                }}\r\n                disabled={isConnecting && connectingPlatform !== selected}\r\n                className={`relative inline-flex items-center transition-colors disabled:opacity-50 ${connectedAccounts[selected] ? 'bg-black' : 'bg-gray-200'} rounded-full touch-manipulation`}\r\n                style={{ width: 56, height: 32, WebkitTapHighlightColor: 'transparent', userSelect: 'none', touchAction: 'manipulation' }}\r\n              >\r\n                <span\r\n                  className=\"absolute bg-white rounded-full shadow pointer-events-none\"\r\n                  style={{\r\n                    width: 24,\r\n                    height: 24,\r\n                    transform: connectedAccounts[selected] ? 'translateX(26px)' : 'translateX(6px)',\r\n                    transition: 'transform 160ms ease',\r\n                  }}\r\n                />\r\n              </button>\r\n            </div>\r\n            {/* Description text - Gray box removed, text kept */}\r\n            <div className={`mt-3 ${isMobile ? 'text-sm leading-6' : 'text-xs leading-5'} text-gray-700 px-1`}>\r\n               {descriptions[selected] || null}\r\n            </div>\r\n            <div className=\"mt-3\">\r\n              {!isMobileBrowser && !isNativePlatform && selected === 'ChatGPT' && (\r\n                <div className=\"mt-3 flex justify-end\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowChatGPTModal(true)}\r\n                    className=\"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-900\"\r\n                  >\r\n                    <span style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Connect ChatGPT</span>\r\n                    <svg\r\n                      xmlns=\"http://www.w3.org/2000/svg\"\r\n                      width=\"16\"\r\n                      height=\"16\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M10 6h8m0 0v8m0-8L6 18\"\r\n                      />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* footer  anchored at bottom (CTA always pinned; content above scrolls) */}\r\n        <div\r\n          className=\"px-6 flex-shrink-0\"\r\n          style={{\r\n            position: 'sticky',\r\n            bottom: 0,\r\n            marginTop: 'auto',\r\n            paddingBottom: isMobile ? 12 : 18,\r\n            paddingTop: 10,\r\n            background: isMobile ? 'transparent' : 'linear-gradient(to top, white 60%, rgba(255,255,255,0.9) 85%, rgba(255,255,255,0))',\r\n            zIndex: 30,\r\n          }}\r\n        >\r\n          {(() => {\r\n            const connected = Object.entries(connectedAccounts).filter(([, v]) => v).map(([k]) => k);\r\n            const hasConnections = connected.length > 0;\r\n            \r\n            return (\r\n              <div \r\n                className={`w-full rounded-full text-base font-medium flex items-center justify-center gap-2 transition-colors ${\r\n                  hasConnections \r\n                    ? 'bg-gray-900 hover:bg-gray-800 cursor-pointer' \r\n                    : 'bg-gray-300 cursor-not-allowed'\r\n                }`}\r\n                style={{ \r\n                  fontFamily: 'Inter, system-ui, sans-serif',\r\n                  paddingTop: isMobile ? (isSmallMobile ? 12 : 16) : 14,\r\n                  paddingBottom: isMobile ? (isSmallMobile ? 12 : 16) : 14,\r\n                  color: hasConnections ? '#ffffff' : '#9CA3AF',\r\n                  opacity: hasConnections ? 1 : 0.6\r\n                }}\r\n                onClick={() => {\r\n                  if (!hasConnections) {\r\n                    console.log(' UniversalOnboarding: Cannot continue - no platforms connected');\r\n                    return;\r\n                  }\r\n                  console.log(' UniversalOnboarding: Continue clicked');\r\n                  console.log(' Current connectedAccounts state:', connectedAccounts);\r\n                  // Ensure we pass the latest canonical names (capitalized) to parent\r\n                  const connectedList = Object.entries(connectedAccounts)\r\n                    .filter(([, v]) => !!v)\r\n                    .map(([k]) => canonicalizePlatformName(k))\r\n                    .filter(Boolean);\r\n                  \r\n                  console.log(' Sending to onComplete:', { connectedAccounts: connectedList, totalConnections: connectedList.length });\r\n                  onComplete?.({ connectedAccounts: connectedList, totalConnections: connectedList.length });\r\n                }}\r\n              >\r\n                Continue\r\n                <svg \r\n                  xmlns=\"http://www.w3.org/2000/svg\" \r\n                  width=\"16\" \r\n                  height=\"16\" \r\n                  fill=\"none\" \r\n                  stroke={hasConnections ? '#ffffff' : '#9CA3AF'} \r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                </svg>\r\n              </div>\r\n            );\r\n          })()}\r\n        </div>\r\n      </div>\r\n      {/* Modal - Always render if state is true, regardless of isMobile prop */}\r\n      <ConnectChatGPTModal\r\n        open={showChatGPTModal}\r\n        onClose={() => setShowChatGPTModal(false)}\r\n        onConnected={() => {\r\n          setConnectedAccounts((s) => ({ ...s, ChatGPT: true }));\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}","import React, { useEffect, useMemo, useRef, useState } from 'react';\r\n\r\nexport default function PinSetup({ onComplete, onBack, userEmail }) {\r\n  const [pin, setPin] = useState('');\r\n  const [pinRequirements, setPinRequirements] = useState({\r\n    length: false,\r\n    uppercase: false,\r\n    number: false,\r\n  });\r\n  const [keyboardOffset, setKeyboardOffset] = useState(0);\r\n  const scrollAreaRef = useRef(null);\r\n  const inputRef = useRef(null);\r\n\r\n  const isMobileViewport = useMemo(() => {\r\n    if (typeof window === 'undefined') return false;\r\n    return window.innerWidth <= 768;\r\n  }, []);\r\n\r\n  // Check PIN requirements\r\n  useEffect(() => {\r\n    setPinRequirements({\r\n      length: pin.length >= 6,\r\n      uppercase: /[A-Z]/.test(pin),\r\n      number: /\\d/.test(pin),\r\n    });\r\n  }, [pin]);\r\n\r\n  // Mobile keyboard handling: keep requirements/CTA accessible while typing.\r\n  // Many mobile browsers block/resist `window.close()` and also overlay the keyboard on top of fixed-height modals.\r\n  // We detect keyboard height via visualViewport and add bottom padding + lift the footer.\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    if (!isMobileViewport) return;\r\n    if (!window.visualViewport) return;\r\n\r\n    const vv = window.visualViewport;\r\n    const update = () => {\r\n      // On most mobile browsers, keyboard reduces visualViewport.height while window.innerHeight stays stable-ish.\r\n      // Clamp to [0, ...] to avoid negative offsets.\r\n      const raw = window.innerHeight - vv.height;\r\n      const next = Number.isFinite(raw) ? Math.max(0, Math.round(raw)) : 0;\r\n      setKeyboardOffset(next);\r\n    };\r\n\r\n    update();\r\n    vv.addEventListener('resize', update);\r\n    vv.addEventListener('scroll', update);\r\n    window.addEventListener('resize', update);\r\n\r\n    return () => {\r\n      vv.removeEventListener('resize', update);\r\n      vv.removeEventListener('scroll', update);\r\n      window.removeEventListener('resize', update);\r\n    };\r\n  }, [isMobileViewport]);\r\n\r\n  const allRequirementsMet = pinRequirements.length && pinRequirements.uppercase && pinRequirements.number;\r\n\r\n  const handleSubmit = () => {\r\n    if (allRequirementsMet) {\r\n      onComplete({\r\n        pin: pin, // This should be hashed in production\r\n        pinCreated: true,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full h-full flex flex-col\" style={{ height: '100%', minHeight: 0 }}>\r\n      {/* Content - Flexible center area */}\r\n      <div\r\n        ref={scrollAreaRef}\r\n        className=\"px-6 pt-16 flex-1 flex flex-col overflow-y-auto\"\r\n        style={{\r\n          minHeight: 0,\r\n          // Ensure content can scroll above the on-screen keyboard + bottom CTA.\r\n          paddingBottom: isMobileViewport ? Math.max(16, keyboardOffset + 16) : undefined,\r\n        }}\r\n      >\r\n        <div className=\"mb-6 flex-shrink-0\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>Create a PIN</h1>\r\n          <p className=\"text-gray-600 text-base\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>A PIN so only you have the access to your data</p>\r\n        </div>\r\n\r\n        <div className=\"mb-6 flex-shrink-0\">\r\n          <input\r\n            ref={inputRef}\r\n            type=\"password\"\r\n            value={pin}\r\n            onChange={(e) => setPin(e.target.value)}\r\n            className=\"w-full px-4 py-4 border-2 border-gray-300 rounded-xl text-center text-lg font-medium focus:border-gray-900 focus:outline-none bg-white !text-black\"\r\n            placeholder=\"Enter your PIN\"\r\n            maxLength={20}\r\n            onFocus={() => {\r\n              if (!isMobileViewport) return;\r\n              // Give the keyboard a beat to appear, then ensure the input stays visible.\r\n              window.setTimeout(() => {\r\n                try {\r\n                  inputRef.current?.scrollIntoView?.({ block: 'start', behavior: 'smooth' });\r\n                } catch (_) {}\r\n              }, 200);\r\n            }}\r\n            style={{\r\n              WebkitTextFillColor: '#000000',\r\n              backgroundColor: '#FFFFFF',\r\n              color: '#000000',\r\n              caretColor: '#000000',\r\n              fontFamily: 'Inter, system-ui, sans-serif'\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        {/* Requirements list - NO SCROLL ISOLATION to prevent nesting issues */}\r\n        <div className=\"pb-4\">\r\n          <p className=\"text-gray-900 font-medium mb-4\">Your PIN must:</p>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div\r\n                className={`w-5 h-5 rounded-full border-2 ${pinRequirements.length ? \"border-green-500 bg-green-500\" : \"border-gray-300 bg-white\"}`}\r\n              >\r\n                {pinRequirements.length && (\r\n                  <svg className=\"w-3 h-3 text-white m-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                )}\r\n              </div>\r\n              <span className=\"text-gray-700\">Be at least 6 characters in length.</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <div\r\n                className={`w-5 h-5 rounded-full border-2 ${pinRequirements.uppercase ? \"border-green-500 bg-green-500\" : \"border-gray-300 bg-white\"}`}\r\n              >\r\n                {pinRequirements.uppercase && (\r\n                  <svg className=\"w-3 h-3 text-white m-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                )}\r\n              </div>\r\n              <span className=\"text-gray-700\">Contain an uppercase letter.</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <div\r\n                className={`w-5 h-5 rounded-full border-2 ${pinRequirements.number ? \"border-green-500 bg-green-500\" : \"border-gray-300 bg-white\"}`}\r\n              >\r\n                {pinRequirements.number && (\r\n                  <svg className=\"w-3 h-3 text-white m-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                  </svg>\r\n                )}\r\n              </div>\r\n              <span className=\"text-gray-700\">Contain a number.</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Buttons - Fixed at bottom */}\r\n      <div\r\n        className=\"px-6 pb-6 pt-4 flex-shrink-0 space-y-3 bg-white\"\r\n        style={{\r\n          minHeight: 'auto',\r\n          // Lift footer above the mobile keyboard so the requirements list isn't \"trapped\" underneath.\r\n          transform: isMobileViewport && keyboardOffset > 0 ? `translateY(-${keyboardOffset}px)` : undefined,\r\n          transition: isMobileViewport ? 'transform 160ms ease-out' : undefined,\r\n          willChange: isMobileViewport ? 'transform' : undefined,\r\n        }}\r\n      >\r\n        <div\r\n          className={`w-full rounded-full py-4 text-base font-medium flex items-center justify-center gap-2 transition-colors ${\r\n            allRequirementsMet \r\n              ? \"bg-gray-900 hover:bg-gray-800 cursor-pointer\" \r\n              : \"bg-gray-300 text-gray-500 cursor-not-allowed\"\r\n          }`}\r\n          style={allRequirementsMet ? { color: '#ffffff' } : {}}\r\n          onClick={allRequirementsMet ? handleSubmit : undefined}\r\n        >\r\n          Continue\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n          </svg>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} ","import React, { useState, useEffect } from \"react\";\r\n// import personaImg from \"../assets/persona.png\";\r\n// Use remote URL to avoid 403 Forbidden on local asset during dev/prod mismatch\r\nconst personaImg = \"https://anushkasirv.sirv.com/persona.jpg\";\r\n\r\n/* -------------------------\r\n   ICON COMPONENTS\r\n-------------------------- */\r\nconst Icon = ({ type }) => {\r\n  const base = \"w-4 h-4 text-gray-700\";\r\n\r\n  switch (type) {\r\n    case \"User\":\r\n      return (\r\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4\r\n           1.79-4 4 1.79 4 4 4zm0 2c-2.67\r\n           0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/>\r\n        </svg>\r\n      );\r\n    case \"Memory\":\r\n      return (\r\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M12 2C6.48 2 2 6.48 2\r\n           12s4.48 10 10 10 10-4.48 10-10S17.52\r\n           2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z\"/>\r\n        </svg>\r\n      );\r\n    case \"Grid3X3\":\r\n      return (\r\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10\r\n           0h8V11h-8v10zm0-18v6h8V3h-8z\"/>\r\n        </svg>\r\n      );\r\n    case \"Brain\":\r\n      return (\r\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n          <path d=\"M11.99 2C6.47 2 2 6.48 2\r\n           12s4.47 10 9.99 10C17.52\r\n           22 22 17.52 22 12S17.52\r\n           2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8\r\n           8-8 8 3.58 8 8-3.58 8-8\r\n           8zm3.5-9c.83 0 1.5-.67\r\n           1.5-1.5S16.33 8 15.5\r\n           8 14 8.67 14 9.5s.67 1.5\r\n           1.5 1.5zm-7 0c.83 0 1.5-.67\r\n           1.5-1.5S9.33 8 8.5\r\n           8 7 8.67 7 9.5s.67 1.5\r\n           1.5 1.5zm3.5 6.5c2.33\r\n           0 4.31-1.46 5.11-3.5H6.89c.8\r\n           2.04 2.78 3.5 5.11 3.5z\"/>\r\n        </svg>\r\n      );\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\n/* -------------------------\r\n   TOGGLE (soft apple style)\r\n-------------------------- */\r\nconst DataTypeToggle = ({ dataType, enabled, onToggle, isNative }) => {\r\n  const handle = () => {\r\n    // Required items (like \"basic\") are always on and can't be toggled off\r\n    if (dataType.required) return;\r\n    onToggle(dataType.id, !enabled);\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={handle}\r\n      className={`\r\n        w-full flex items-center justify-between\r\n        py-2 px-2\r\n        bg-white/40 backdrop-blur-sm\r\n        ${dataType.required ? 'cursor-not-allowed opacity-75' : 'hover:bg-white/70 cursor-pointer'}\r\n        transition rounded-xl shadow-sm\r\n      `}\r\n      title={dataType.required ? 'Required - cannot be disabled' : ''}\r\n    >\r\n      <div className=\"flex items-center gap-2.5\">\r\n        <div className=\"w-6 h-6 flex items-center justify-center rounded-full bg-gray-100\">\r\n          <Icon type={dataType.icon} />\r\n        </div>\r\n        <span className={`${isNative ? 'text-[14px]' : 'text-[13px]'} text-gray-900 font-medium`} style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n          {dataType.name}\r\n          {dataType.required && <span className=\"ml-1.5 text-[11px] text-gray-500\">(Required)</span>}\r\n        </span>\r\n      </div>\r\n\r\n      <div\r\n        className={`w-5 h-5 rounded-md border flex items-center justify-center shadow-sm\r\n          transition\r\n          ${enabled\r\n            ? \"bg-gray-900 border-gray-900\"\r\n            : \"bg-white border-gray-300\"\r\n          }`}\r\n      >\r\n        {enabled && (\r\n          <svg className=\"w-3 h-3 text-white\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n            <path d=\"M16.707 5.293a1 1 0 010\r\n            1.414l-8 8a1 1 0 01-1.414\r\n            0l-4-4a1 1 0 011.414-1.414L8\r\n            12.586l7.293-7.293a1 1 0\r\n            011.414 0z\"/>\r\n          </svg>\r\n        )}\r\n      </div>\r\n    </button>\r\n  );\r\n};\r\n\r\n/* -------------------------\r\n   MAIN COMPONENT\r\n-------------------------- */\r\n\r\nconst options = [\r\n  { id: \"basic\", name: \"Basic Profile\", icon: \"User\", required: true },\r\n  { id: \"rawMemories\", name: \"Raw Memory Data\", icon: \"Memory\" },\r\n  { id: \"preferences\", name: \"User Preferences\", icon: \"Grid3X3\" },\r\n  { id: \"personality\", name: \"Personality Traits\", icon: \"Brain\" },\r\n];\r\n\r\nconst DataRequest = ({ appName = \"My App\", onComplete, onConnectMoreApps, connectedPlatforms = [], showTime = false, userEmail = null, onLogout = null }) => {\r\n  const [selected, setSelected] = useState({\r\n    basic: true,\r\n    rawMemories: false,\r\n    preferences: false,\r\n    personality: false,\r\n  });\r\n\r\n  const [freq, setFreq] = useState(\"weekly\");\r\n  const [platformIconFailed, setPlatformIconFailed] = useState({});\r\n  const [platforms, setPlatforms] = useState([]);\r\n\r\n  const isWrappedApp = typeof appName === 'string' && appName.toLowerCase().includes('wrapped');\r\n\r\n  // Normalize platform ids/names coming from different sources (SDK, backend, localStorage)\r\n  // so logos always render (e.g. \"linkedin\" -> \"LinkedIn\").\r\n  const normalizePlatformName = (p) => {\r\n    const key = String(p || '').trim();\r\n    const lower = key.toLowerCase();\r\n    const map = {\r\n      instagram: 'Instagram',\r\n      youtube: 'YouTube',\r\n      linkedin: 'LinkedIn',\r\n      reddit: 'Reddit',\r\n      pinterest: 'Pinterest',\r\n      github: 'GitHub',\r\n      facebook: 'Facebook',\r\n      gmail: 'Gmail',\r\n      twitter: 'Twitter',\r\n      x: 'Twitter',\r\n      chatgpt: 'ChatGPT',\r\n      claude: 'Claude',\r\n      gemini: 'Gemini',\r\n      grok: 'Grok',\r\n    };\r\n    return map[lower] || (key ? key.charAt(0).toUpperCase() + key.slice(1) : '');\r\n  };\r\n\r\n  const toggle = (id, val) => {\r\n    // Ensure \"basic\" is always true (required)\r\n    const option = options.find(opt => opt.id === id);\r\n    if (option?.required) {\r\n      return; // Don't allow toggling off required options\r\n    }\r\n    setSelected((p) => ({ ...p, [id]: val }));\r\n  };\r\n\r\n  const selectedCount = Object.values(selected).filter(Boolean).length;\r\n\r\n  // Ensure we actually show connected platforms even if prop isn't passed\r\n  const getConnected = () => {\r\n    console.log(' DataRequest getConnected:', { \r\n      connectedPlatforms, \r\n      isArray: Array.isArray(connectedPlatforms),\r\n      type: typeof connectedPlatforms \r\n    });\r\n    \r\n    // Prefer localStorage as the source of truth (it is updated by UniversalOnboarding on OAuth return).\r\n    // This avoids stale props causing \"added platforms\" to not show up until a full refresh.\r\n    try {\r\n      const u = JSON.parse(localStorage.getItem(\"onairosUser\") || \"{}\");\r\n      if (u && u.connectedAccounts) {\r\n        // Check if it's an array\r\n        if (Array.isArray(u.connectedAccounts)) {\r\n          const normalized = u.connectedAccounts.map(normalizePlatformName).filter(Boolean);\r\n          console.log(' Using localStorage connectedAccounts (array):', u.connectedAccounts, '', normalized);\r\n          return normalized;\r\n        }\r\n        // Check if it's an object\r\n        if (typeof u.connectedAccounts === \"object\") {\r\n          const mappedRaw = Object.entries(u.connectedAccounts).filter(([_, v]) => Boolean(v)).map(([k]) => k);\r\n          const mapped = mappedRaw.map(normalizePlatformName).filter(Boolean);\r\n          console.log(' Using localStorage connectedAccounts (object):', mappedRaw, '', mapped);\r\n          return mapped;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(' Failed to read localStorage:', e);\r\n    }\r\n\r\n    // Fall back to prop if localStorage isn't available / doesn't have the field.\r\n    // If array provided, use it\r\n    if (Array.isArray(connectedPlatforms) && connectedPlatforms.length > 0) {\r\n      const normalized = connectedPlatforms.map(normalizePlatformName).filter(Boolean);\r\n      console.log(' Using connectedPlatforms prop (array):', connectedPlatforms, '', normalized);\r\n      return normalized;\r\n    }\r\n    \r\n    // If object provided, map truthy keys\r\n    if (connectedPlatforms && typeof connectedPlatforms === \"object\" && !Array.isArray(connectedPlatforms)) {\r\n      const mappedRaw = Object.entries(connectedPlatforms).filter(([_, v]) => Boolean(v)).map(([k]) => k);\r\n      const mapped = mappedRaw.map(normalizePlatformName).filter(Boolean);\r\n      console.log(' Using connectedPlatforms prop (object):', mappedRaw, '', mapped);\r\n      return mapped;\r\n    }\r\n    \r\n    console.log(' No connected platforms found');\r\n    return [];\r\n  };\r\n\r\n  // Refresh platforms list on mount and when connectedPlatforms changes\r\n  useEffect(() => {\r\n    const refreshPlatforms = () => {\r\n      // Small delay to allow localStorage to update if coming from another component\r\n      setTimeout(() => {\r\n        const newPlatforms = getConnected();\r\n        console.log(' DataRequest refreshing platforms:', newPlatforms);\r\n        setPlatforms(newPlatforms);\r\n      }, 50);\r\n    };\r\n\r\n    // Initial load\r\n    refreshPlatforms();\r\n\r\n    // Listen for custom event from UniversalOnboarding\r\n    const handleConnectedAccountsUpdate = () => {\r\n      console.log(' DataRequest received connectedAccountsUpdate event');\r\n      refreshPlatforms();\r\n    };\r\n    \r\n    // Listen for storage events (cross-tab/window updates)\r\n    const handleStorageChange = (e) => {\r\n      if (e.key === 'onairosUser') {\r\n        console.log(' DataRequest detected storage change');\r\n        refreshPlatforms();\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('onairos-connected-accounts-update', handleConnectedAccountsUpdate);\r\n    window.addEventListener('storage', handleStorageChange);\r\n\r\n    return () => {\r\n      window.removeEventListener('onairos-connected-accounts-update', handleConnectedAccountsUpdate);\r\n      window.removeEventListener('storage', handleStorageChange);\r\n    };\r\n  }, [connectedPlatforms]); // Re-run if connectedPlatforms prop changes\r\n\r\n  console.log(' Final platforms to display:', platforms);\r\n\r\n  const isCapacitorNative = typeof window !== 'undefined' && \r\n    window.Capacitor && \r\n    typeof window.Capacitor.isNativePlatform === 'function' && \r\n    window.Capacitor.isNativePlatform();\r\n\r\n  // Check if user has any LLM connections\r\n  const hasLLMConnections = () => {\r\n    const llmPlatforms = ['chatgpt', 'claude', 'gemini', 'grok', 'ChatGPT', 'Claude', 'Gemini', 'Grok'];\r\n    return platforms.some(p => llmPlatforms.includes(p));\r\n  };\r\n\r\n  // Filter options based on LLM connections\r\n  const availableOptions = options.filter(opt => {\r\n    if (opt.id === 'rawMemories') {\r\n      return hasLLMConnections();\r\n    }\r\n    return true;\r\n  });\r\n\r\n  const freqToPercent = (f) => (f === \"once\" ? 0 : f === \"weekly\" ? 50 : 100);\r\n  const handleRailClick = (e) => {\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));\r\n    const ratio = x / rect.width;\r\n    if (ratio < 1 / 3) setFreq(\"once\");\r\n    else if (ratio < 2 / 3) setFreq(\"weekly\");\r\n    else setFreq(\"daily\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full max-h-full md:max-h-[90vh] bg-white/70 backdrop-blur-2xl rounded-3xl overflow-hidden\">\r\n\r\n      {/* USER INFO HEADER */}\r\n      {userEmail && (\r\n        <div className=\"px-6 pt-2 pb-2 border-b border-gray-200/50\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n              </svg>\r\n              <span className=\"font-medium no-underline\">{userEmail}</span>\r\n            </div>\r\n            {onLogout && (\r\n              <button\r\n                onClick={onLogout}\r\n                className=\"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors no-underline\"\r\n                title=\"Logout\"\r\n                style={{ textDecoration: 'none' }}\r\n              >\r\n                <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                </svg>\r\n                <span className=\"no-underline\" style={{ textDecoration: 'none' }}>Logout</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* CONTENT */}\r\n      <div className=\"flex-1 overflow-y-auto px-6 pt-3 md:pt-6 pb-2\">\r\n\r\n        {/* ICONS */}\r\n        <div className=\"flex justify-center items-center gap-3 mb-3 md:mb-4\">\r\n          {/* Wrapped: Onairos -> Persona. Non-wrapped: Onairos -> app placeholder */}\r\n          <div className={`${isCapacitorNative ? 'w-12 h-12' : 'w-10 h-10'} rounded-2xl bg-white shadow flex items-center justify-center`}>\r\n            {isWrappedApp ? (\r\n              <img \r\n                src=\"https://onairos.sirv.com/Images/OnairosBlack.png\" \r\n                alt=\"Onairos\"\r\n                className={`${isCapacitorNative ? 'w-8 h-8' : 'w-6 h-6'} object-contain`}\r\n              />\r\n            ) : (\r\n            <img \r\n              src=\"https://onairos.sirv.com/Images/OnairosBlack.png\" \r\n              alt=\"Onairos\"\r\n                className={`${isCapacitorNative ? 'w-8 h-8' : 'w-6 h-6'} object-contain`}\r\n            />\r\n            )}\r\n          </div>\r\n          <svg className={`${isCapacitorNative ? 'w-6 h-6' : 'w-5 h-5'} text-gray-400`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M14 5l7 7m0 0l-7 7m7-7H3\" />\r\n          </svg>\r\n          <div className={`${isCapacitorNative ? 'w-12 h-12' : 'w-10 h-10'} rounded-2xl bg-white shadow flex items-center justify-center`}>\r\n            {isWrappedApp ? (\r\n              <img \r\n                src={personaImg}\r\n                alt=\"Persona\"\r\n                className={`${isCapacitorNative ? 'w-8 h-8' : 'w-6 h-6'} object-contain rounded-xl`}\r\n                onError={(e) => { \r\n                  e.currentTarget.style.display = 'none';\r\n                  e.currentTarget.parentElement.innerHTML = '<span class=\"text-xl\"></span>';\r\n                }}\r\n              />\r\n            ) : (\r\n              <span className={`${isCapacitorNative ? 'text-xl' : 'text-lg'} font-serif font-bold`} style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>J</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* TITLE */}\r\n        <div className=\"text-center mb-4 md:mb-5\">\r\n          <h1 className={`${isCapacitorNative ? 'text-[22px] md:text-[24px]' : 'text-[20px] md:text-[22px]'} font-semibold text-gray-900 leading-tight tracking-tight`} style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>\r\n            {appName} wants to personalize your experience\r\n          </h1>\r\n          <p className={`${isCapacitorNative ? 'text-[13px]' : 'text-[12px]'} text-gray-500 mt-1`} style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>choose what to share</p>\r\n        </div>\r\n\r\n        {/* TOGGLES */}\r\n        <div className={`${isCapacitorNative ? 'flex flex-col gap-2' : 'flex flex-col sm:grid sm:grid-cols-2 gap-2 sm:gap-3'} mb-4 md:mb-6`}>\r\n          {availableOptions.map((opt) => (\r\n            <DataTypeToggle\r\n              key={opt.id}\r\n              dataType={opt}\r\n              enabled={selected[opt.id]}\r\n              onToggle={toggle}\r\n              isNative={isCapacitorNative}\r\n            />\r\n          ))}\r\n        </div>\r\n\r\n        {/* FREQUENCY PANEL - Only shown if showTime is true */}\r\n        {showTime && (\r\n          <div className=\"p-5 rounded-3xl bg-white/50 backdrop-blur-md border border-black/5 shadow-sm\">\r\n            <div className=\"flex justify-between items-center mb-3\">\r\n              <span className=\"text-sm font-medium text-gray-900\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n                How often can {appName} receive updates?\r\n              </span>\r\n              <span className=\"text-[11px] text-gray-500\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n                {freq === \"once\"\r\n                  ? \"one-time only\"\r\n                  : freq === \"weekly\"\r\n                  ? \"once per week\"\r\n                  : \"once per day\"}\r\n              </span>\r\n            </div>\r\n\r\n            {/* SLIDER: subtle rail, monochrome progress, click-to-set */}\r\n            <div\r\n              className=\"relative h-2.5 rounded-full bg-gray-200/90 overflow-hidden mb-4 border border-black/5 shadow-inner cursor-pointer\"\r\n              onClick={handleRailClick}\r\n            >\r\n              <div\r\n                className=\"absolute h-full transition-all rounded-full\"\r\n                style={{\r\n                  width: `${freqToPercent(freq)}%`,\r\n                  background: \"linear-gradient(90deg, rgba(31,41,55,0.95) 0%, rgba(107,114,128,0.9) 60%, rgba(209,213,219,0.85) 100%)\",\r\n                }}\r\n              />\r\n              {/* Tick marks for 3 stops */}\r\n              <span className=\"absolute left-0 top-1/2 -translate-y-1/2 w-[2px] h-3 bg-black/10\" />\r\n              <span className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[2px] h-3 bg-black/10\" />\r\n              <span className=\"absolute right-0 top-1/2 -translate-y-1/2 w-[2px] h-3 bg-black/10\" />\r\n              {/* Thumb indicator (sleek) */}\r\n              <span\r\n                className=\"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-4.5 h-4.5 rounded-full bg-white border border-black/20 shadow-md\"\r\n                style={{\r\n                  left: `${freqToPercent(freq)}%`,\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-3 text-center text-[12px] font-medium\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n              <button onClick={() => setFreq(\"once\")} className=\"text-gray-700\">1 only</button>\r\n              <button onClick={() => setFreq(\"weekly\")} className=\"text-gray-900 font-semibold\">1 weekly</button>\r\n              <button onClick={() => setFreq(\"daily\")} className=\"text-gray-700\">1 daily</button>\r\n            </div>\r\n\r\n            <p className=\"text-[11px] text-gray-500 mt-3 leading-snug\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>\r\n              This only controls update frequency; It does not grant more access.\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n      </div>\r\n\r\n      {/* FOOTER */}\r\n      <div className=\"px-6 py-3 md:py-4 bg-white/80 backdrop-blur border-t border-black/5\">\r\n        {/* Connected platforms pinned above CTAs so it never gets cropped on mobile */}\r\n        {platforms && platforms.length > 0 && (\r\n          <div className=\"mb-3 rounded-2xl bg-white/60 backdrop-blur border border-black/5 px-3 py-2.5\">\r\n            <div className=\"text-center mb-1\">\r\n              <div className=\"text-[13px] font-semibold text-gray-900\" style={{ fontFamily: 'IBM Plex Sans, system-ui, sans-serif' }}>Connect Platforms</div>\r\n              <div className=\"text-[11px] text-gray-500\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>more connections, smarter personalization</div>\r\n            </div>\r\n            <div className=\"flex items-center justify-center gap-2 overflow-x-auto whitespace-nowrap pb-1\" style={{ WebkitOverflowScrolling: 'touch' }}>\r\n              {platforms.map((platform, index) => {\r\n                const logoMap = {\r\n                  Instagram: 'https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png',\r\n                  YouTube: 'https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg',\r\n                  LinkedIn: 'https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png',\r\n                  Reddit: 'https://upload.wikimedia.org/wikipedia/en/b/bd/Reddit_Logo_Icon.svg',\r\n                  Pinterest: 'https://upload.wikimedia.org/wikipedia/commons/0/08/Pinterest-logo.png',\r\n                  GitHub: 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png',\r\n                  Facebook: 'https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg',\r\n                  Gmail: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg',\r\n                  Twitter: 'https://upload.wikimedia.org/wikipedia/commons/6/6f/Logo_of_Twitter.svg',\r\n                  ChatGPT: 'https://anushkasirv.sirv.com/openai.png',\r\n                  Claude: 'https://anushkasirv.sirv.com/claude-color.png',\r\n                  Gemini: 'https://anushkasirv.sirv.com/gemini-color.png',\r\n                  Grok: 'https://anushkasirv.sirv.com/grok.png'\r\n                };\r\n                const src = logoMap[platform] || '';\r\n                const key = `${platform}-${index}`;\r\n                const failed = !!platformIconFailed[key];\r\n                const fallbackText = (() => {\r\n                  if (platform === 'LinkedIn') return 'in';\r\n                  if (platform === 'YouTube') return 'YT';\r\n                  if (platform === 'ChatGPT') return 'AI';\r\n                  return String(platform || '?').slice(0, 2).toUpperCase();\r\n                })();\r\n                return (\r\n                  failed || !src ? (\r\n                    <div\r\n                      key={key}\r\n                      title={platform}\r\n                      className=\"w-6 h-6 rounded-md shadow-sm flex-shrink-0 bg-gray-100 text-gray-700 flex items-center justify-center text-[10px] font-semibold\"\r\n                    >\r\n                      {fallbackText}\r\n                    </div>\r\n                  ) : (\r\n                    <img\r\n                      key={key}\r\n                    src={src}\r\n                    alt={platform}\r\n                    title={platform}\r\n                      className=\"w-6 h-6 rounded-md shadow-sm flex-shrink-0\"\r\n                      onError={() => setPlatformIconFailed((p) => ({ ...p, [key]: true }))}\r\n                  />\r\n                  )\r\n                );\r\n              })}\r\n            </div>\r\n            {typeof onConnectMoreApps === 'function' && (\r\n              <div className=\"mt-1 flex justify-center\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={onConnectMoreApps}\r\n                  className=\"text-[11px] font-medium text-gray-700 hover:text-gray-900 inline-flex items-center gap-1.5\"\r\n                  style={{ WebkitTextFillColor: '#111827', fontFamily: 'Inter, system-ui, sans-serif' }}\r\n                >\r\n                  <span style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>Connect more</span>\r\n                  <span\r\n                    aria-hidden=\"true\"\r\n                    className=\"inline-flex items-center justify-center w-4 h-4 rounded-full border border-gray-400 text-gray-800 leading-none\"\r\n                    style={{ WebkitTextFillColor: '#111827' }}\r\n                  >\r\n                    +\r\n                  </span>\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* If no platforms are connected yet, still allow user to go connect apps */}\r\n        {(!platforms || platforms.length === 0) && typeof onConnectMoreApps === 'function' && (\r\n          <div className=\"mb-3 rounded-2xl bg-white/60 backdrop-blur border border-black/5 px-3 py-2 text-center\">\r\n            <div className=\"text-[11px] text-gray-500 mb-1\" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>No apps connected yet</div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={onConnectMoreApps}\r\n              className=\"text-[12px] font-medium underline underline-offset-2 text-gray-700 hover:text-gray-900\"\r\n              style={{ WebkitTextFillColor: '#111827', fontFamily: 'Inter, system-ui, sans-serif' }}\r\n            >\r\n              Connect apps?\r\n            </button>\r\n      </div>\r\n        )}\r\n        <button\r\n          className=\"w-full rounded-full py-3 bg-gray-900 text-sm font-medium shadow-sm flex items-center justify-center\"\r\n          style={{ color: '#ffffff', fontFamily: 'Inter, system-ui, sans-serif' }}\r\n          disabled={selectedCount === 0}\r\n          onClick={() => {\r\n            if (selectedCount === 0) return;\r\n            onComplete?.({\r\n              approved: Object.keys(selected).filter(id => selected[id]),\r\n              freq,\r\n            });\r\n          }}\r\n        >\r\n          Accept & Continue\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DataRequest;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { COLORS } from '../theme/colors.js';\r\n\r\nexport default function TrainingComponent({ onComplete, userEmail, appName = 'App', testMode = false }) {\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [progress, setProgress] = useState(0);\r\n  const [isComplete, setIsComplete] = useState(false);\r\n\r\n  const steps = [\r\n    {\r\n      title: 'Setting up your personal AI',\r\n      description: 'Initializing your secure data model',\r\n      icon: '',\r\n      duration: testMode ? 800 : 2000 // Much faster in test mode\r\n    },\r\n    {\r\n      title: 'Processing your connections',\r\n      description: 'Analyzing your social media patterns',\r\n      icon: '',\r\n      duration: testMode ? 600 : 2500\r\n    },\r\n    {\r\n      title: 'Training your model',\r\n      description: 'Building your personalized insights',\r\n      icon: '',\r\n      duration: testMode ? 700 : 3000\r\n    },\r\n    {\r\n      title: 'Finalizing setup',\r\n      description: 'Preparing your Onairos experience',\r\n      icon: '',\r\n      duration: testMode ? 500 : 2000\r\n    }\r\n  ];\r\n\r\n  useEffect(() => {\r\n    let interval;\r\n    let stepTimeout;\r\n\r\n    if (currentStep < steps.length) {\r\n      const stepDuration = steps[currentStep].duration;\r\n      const stepProgress = 100 / steps.length;\r\n\r\n      // Update progress gradually\r\n      interval = setInterval(() => {\r\n        setProgress(prev => {\r\n          const newProgress = prev + (stepProgress / (stepDuration / 100));\r\n          return Math.min(newProgress, (currentStep + 1) * stepProgress);\r\n        });\r\n      }, 100);\r\n\r\n      // Move to next step after duration\r\n      stepTimeout = setTimeout(() => {\r\n        if (currentStep < steps.length - 1) {\r\n          setCurrentStep(prev => prev + 1);\r\n        } else {\r\n          setIsComplete(true);\r\n          const completionDelay = testMode ? 400 : 1000; // Faster completion in test mode\r\n          \r\n          if (testMode) {\r\n            console.log(' Test mode: Training simulation completed');\r\n          }\r\n          \r\n          setTimeout(() => {\r\n            onComplete({\r\n              trainingComplete: true,\r\n              timestamp: new Date().toISOString(),\r\n              userEmail: userEmail,\r\n              appName: appName,\r\n              testMode: testMode,\r\n              simulatedTraining: testMode\r\n            });\r\n          }, completionDelay);\r\n        }\r\n      }, stepDuration);\r\n    }\r\n\r\n    return () => {\r\n      if (interval) clearInterval(interval);\r\n      if (stepTimeout) clearTimeout(stepTimeout);\r\n    };\r\n  }, [currentStep, onComplete, userEmail, appName]);\r\n\r\n  return (\r\n    <div className=\"w-full flex flex-col items-center space-y-8\">\r\n      <div className=\"text-center\">\r\n        <div \r\n          className=\"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4\"\r\n          style={{\r\n            background: `linear-gradient(135deg, ${COLORS.info}, #8B5CF6)`\r\n          }}\r\n        >\r\n          <div className=\"text-3xl\">\r\n            {isComplete ? '' : steps[currentStep]?.icon}\r\n          </div>\r\n        </div>\r\n        <h2 \r\n          className=\"text-2xl font-bold mb-2\"\r\n          style={{ color: COLORS.textPrimary }}\r\n        >\r\n          {isComplete ? 'All set!' : steps[currentStep]?.title}\r\n        </h2>\r\n        <p style={{ color: COLORS.textSecondary }}>\r\n          {isComplete \r\n            ? 'Your personal AI is ready to use' \r\n            : steps[currentStep]?.description\r\n          }\r\n        </p>\r\n      </div>\r\n\r\n      {/* Progress Bar */}\r\n      <div className=\"w-full\">\r\n        <div \r\n          className=\"flex justify-between text-sm mb-2\"\r\n          style={{ color: COLORS.textSecondary }}\r\n        >\r\n          <span>Progress</span>\r\n          <span>{Math.round(progress)}%</span>\r\n        </div>\r\n        <div \r\n          className=\"w-full rounded-full h-2\"\r\n          style={{ backgroundColor: COLORS.borderLight }}\r\n        >\r\n          <div \r\n            className=\"h-2 rounded-full transition-all duration-300 ease-out\"\r\n            style={{ \r\n              width: `${progress}%`,\r\n              background: `linear-gradient(90deg, ${COLORS.info}, #8B5CF6)`\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Steps Indicator */}\r\n      <div className=\"flex justify-center space-x-2\">\r\n        {steps.map((_, index) => (\r\n          <div\r\n            key={index}\r\n            className=\"w-3 h-3 rounded-full transition-all duration-300\"\r\n            style={{\r\n              backgroundColor: index <= currentStep ? COLORS.info : COLORS.border\r\n            }}\r\n          />\r\n        ))}\r\n      </div>\r\n\r\n      {/* Current Step Details */}\r\n      <div \r\n        className=\"p-4 rounded-lg w-full\"\r\n        style={{ backgroundColor: COLORS.backgroundSecondary }}\r\n      >\r\n        <div className=\"flex items-center space-x-3\">\r\n          <div \r\n            className=\"w-8 h-8 rounded-full flex items-center justify-center\"\r\n            style={{ backgroundColor: '#DBEAFE' }}\r\n          >\r\n            <div className=\"text-sm\">\r\n              {isComplete ? '' : steps[currentStep]?.icon}\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <h3 \r\n              className=\"font-medium\"\r\n              style={{ color: COLORS.textPrimary }}\r\n            >\r\n              {isComplete ? 'Training Complete' : `Step ${currentStep + 1} of ${steps.length}`}\r\n            </h3>\r\n            <p \r\n              className=\"text-sm\"\r\n              style={{ color: COLORS.textSecondary }}\r\n            >\r\n              {isComplete \r\n                ? 'Your Onairos experience is ready' \r\n                : steps[currentStep]?.description\r\n              }\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* App Info */}\r\n      <div className=\"text-center\">\r\n        <p \r\n          className=\"text-sm\"\r\n          style={{ color: COLORS.textSecondary }}\r\n        >\r\n          Setting up for <span className=\"font-medium\">{appName}</span>\r\n        </p>\r\n        {userEmail && (\r\n          <p \r\n            className=\"text-xs mt-1\"\r\n            style={{ color: COLORS.textMuted }}\r\n          >\r\n            {userEmail}\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n} ","import React, { useEffect, useState, useRef } from 'react';\r\nimport Lottie from 'lottie-react';\r\nimport rainAnim from '../../public/rain-anim.json';\r\nimport io from 'socket.io-client';\r\n\r\nconst trainingPhrases = [\r\n  \"Training your data...\",\r\n  \"Gathering your traits...\",\r\n  \"Building your profile...\",\r\n  \"Analyzing patterns...\",\r\n  \"Creating insights...\",\r\n  \"Finalizing...\",\r\n  \"Almost done...\"\r\n];\r\n\r\nexport default function TrainingScreen({ onComplete, onTrainingStart, userEmail, connectedAccounts = [], userToken }) {\r\n  const [progress, setProgress] = useState(0);\r\n  const [currentPhrase, setCurrentPhrase] = useState(trainingPhrases[0]);\r\n  const lottieRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    let socket = null;\r\n    let progressTimer = null;\r\n    let didSignalStart = false;\r\n    let watchdogTimer = null;\r\n    let phraseTimer = null;\r\n    let phraseIndex = 0;\r\n\r\n    const signalTrainingStarted = () => {\r\n      if (didSignalStart) return;\r\n      didSignalStart = true;\r\n      try {\r\n        onTrainingStart?.();\r\n      } catch (e) {\r\n        // never block training due to callback issues\r\n      }\r\n    };\r\n\r\n    // UI should stay vague; do NOT surface backend trainingUpdate/status strings.\r\n    const startVaguePhraseRotation = () => {\r\n      if (phraseTimer) return;\r\n      phraseTimer = setInterval(() => {\r\n        phraseIndex = (phraseIndex + 1) % trainingPhrases.length;\r\n        setCurrentPhrase(trainingPhrases[phraseIndex]);\r\n      }, 4000);\r\n    };\r\n\r\n    const resetWatchdog = () => {\r\n      // We keep a long watchdog to avoid infinite hangs, but we do not scare the user\r\n      // and we do not auto-complete while backend is actively sending updates.\r\n      if (watchdogTimer) clearTimeout(watchdogTimer);\r\n      watchdogTimer = setTimeout(() => {\r\n        // Silent timeout -> complete with fallback so flow can proceed,\r\n        // but keep UI vague.\r\n        try { if (progressTimer) clearInterval(progressTimer); } catch {}\r\n        setProgress(100);\r\n        setCurrentPhrase('Finalizing...');\r\n        try { if (socket) socket.disconnect(); } catch {}\r\n        setTimeout(() => {\r\n          onComplete?.({\r\n            fallback: true,\r\n            message: 'Training timed out (watchdog)',\r\n            autoCompleted: true\r\n          });\r\n        }, 800);\r\n      }, 10 * 60 * 1000); // 10 minutes\r\n    };\r\n    \r\n    // ACTUALLY run training + inference using Socket.IO\r\n    const runTrainingAndInference = async () => {\r\n      console.log(' Starting REAL training for:', userEmail);\r\n      console.log(' Connected accounts:', connectedAccounts);\r\n      console.log(' userToken prop received:', userToken ? `${userToken.substring(0, 20)}...` : 'UNDEFINED');\r\n\r\n      try {\r\n        // Use token passed from parent component, fallback to localStorage\r\n        let token = userToken;\r\n        \r\n        if (!token) {\r\n          console.warn(' Token not passed as prop, checking localStorage...');\r\n          try {\r\n            const storedToken = localStorage.getItem('onairos_user_token');\r\n            if (storedToken) {\r\n              token = storedToken;\r\n              console.log(' Found token in localStorage');\r\n            } else {\r\n              const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n              token = userData.token;\r\n              if (token) {\r\n                console.log(' Found token in onairosUser localStorage');\r\n              }\r\n            }\r\n          } catch (e) {\r\n            console.error(' Error reading from localStorage:', e);\r\n          }\r\n        }\r\n\r\n        if (!token) {\r\n          console.error(' No token found anywhere - cannot run training');\r\n          console.error(' Token should be passed from parent component OR stored in localStorage');\r\n          throw new Error('No authentication token');\r\n        }\r\n        \r\n        console.log(' Token found, starting Socket.IO training...', token.substring(0, 20) + '...');\r\n\r\n        // Phase 1: Connect to Socket.IO\r\n        setCurrentPhrase(trainingPhrases[0]);\r\n        startVaguePhraseRotation();\r\n        resetWatchdog();\r\n        console.log(' Connecting to Socket.IO server...');\r\n\r\n        socket = io('https://api2.onairos.uk', {\r\n          auth: { token },\r\n          transports: ['websocket', 'polling'],\r\n          reconnection: false, // Don't reconnect automatically for this one-time operation\r\n          timeout: 60000 // 60 second timeout\r\n        });\r\n\r\n        // Handle connection\r\n        socket.on('connect', () => {\r\n          console.log(' Socket connected:', socket.id);\r\n          // At this point, training can actually start (server reachable).\r\n          signalTrainingStarted();\r\n          startVaguePhraseRotation();\r\n          resetWatchdog();\r\n          \r\n          // Start progress animation (slow + steady; completion comes from backend event)\r\n          progressTimer = setInterval(() => {\r\n            setProgress(prev => {\r\n              if (prev < 95) return prev + 0.5; // Slower progress\r\n              return prev;\r\n            });\r\n          }, 300);\r\n\r\n          // Trigger training\r\n          console.log(' Emitting start-training event with:', {\r\n            socketId: socket.id,\r\n            email: userEmail,\r\n            platforms: connectedAccounts\r\n          });\r\n\r\n          socket.emit('start-training', {\r\n            socketId: socket.id,\r\n            email: userEmail,\r\n            username: userEmail,\r\n            platforms: connectedAccounts,\r\n            connectedAccounts: connectedAccounts\r\n          });\r\n          resetWatchdog();\r\n        });\r\n\r\n        // Handle training progress updates\r\n        socket.on('training-progress', (data) => {\r\n          console.log(' Training progress:', data);\r\n          // Progress events mean training has definitely started.\r\n          signalTrainingStarted();\r\n          startVaguePhraseRotation();\r\n          resetWatchdog();\r\n          \r\n          if (data.percentage) {\r\n            setProgress(Math.min(data.percentage, 95)); // Cap at 95% until complete\r\n          }\r\n        });\r\n\r\n        // Handle training updates (legacy event name from old mobile SDK)\r\n        socket.on('trainingUpdate', (data) => {\r\n          console.log(' Training update:', data);\r\n          // We are receiving backend updates; reset watchdog so we don't timeout mid-training.\r\n          startVaguePhraseRotation();\r\n          resetWatchdog();\r\n          \r\n          // Check if this is an error\r\n          if (data.error) {\r\n            console.error(' Training error from trainingUpdate event:', data);\r\n            \r\n            if (progressTimer) clearInterval(progressTimer);\r\n            if (watchdogTimer) clearTimeout(watchdogTimer);\r\n            if (phraseTimer) clearInterval(phraseTimer);\r\n            \r\n            // Check if it's insufficient data error\r\n            if (data.code === 'INSUFFICIENT_DATA') {\r\n              console.error(' INSUFFICIENT DATA:', {\r\n                upvoted: data.details?.upvotedCount || 0,\r\n                downvoted: data.details?.downvotedCount || 0,\r\n                total: data.details?.totalCount || 0\r\n              });\r\n              console.error(' Suggestions:', data.details?.suggestions || []);\r\n            }\r\n            \r\n            setProgress(100);\r\n            setCurrentPhrase('Finalizing...');\r\n            \r\n            socket.disconnect();\r\n            \r\n            setTimeout(() => {\r\n              // Complete anyway with fallback flag\r\n              onComplete?.({ \r\n                error: data.error,\r\n                errorCode: data.code,\r\n                errorDetails: data.details,\r\n                fallback: true \r\n              });\r\n            }, 500);\r\n            return;\r\n          }\r\n        });\r\n\r\n        // Handle old training completion event (trainingCompleted)\r\n        socket.on('trainingCompleted', (result) => {\r\n          console.log(' Training completed via trainingCompleted event:', result);\r\n          \r\n          // Clear timers\r\n          if (progressTimer) clearInterval(progressTimer);\r\n          if (watchdogTimer) clearTimeout(watchdogTimer);\r\n          if (phraseTimer) clearInterval(phraseTimer);\r\n          \r\n          setProgress(100);\r\n          setCurrentPhrase('Finalizing...');\r\n          \r\n          socket.disconnect();\r\n          \r\n          setTimeout(() => {\r\n            onComplete?.(result || { success: true, fallback: false });\r\n          }, 500);\r\n        });\r\n\r\n        // Handle training completion\r\n        socket.on('training-complete', (result) => {\r\n          console.log(' Training complete via Socket.IO:', result);\r\n          \r\n          // Clear timers\r\n          if (progressTimer) clearInterval(progressTimer);\r\n          if (watchdogTimer) clearTimeout(watchdogTimer);\r\n          if (phraseTimer) clearInterval(phraseTimer);\r\n          \r\n          setProgress(100);\r\n          setCurrentPhrase('Finalizing...');\r\n\r\n          // Log complete results to console with detailed formatting\r\n          const traits = result?.traits || result?.userTraits || {};\r\n          import('../utils/apiResponseLogger.js').then(logger => {\r\n            const responseData = {\r\n              InferenceResult: {\r\n                traits: {\r\n                  personality_traits: traits\r\n                },\r\n                output: result.inferenceResults?.output || []\r\n              },\r\n              inference_metadata: {\r\n                source: 'TrainingScreen',\r\n                completionType: 'socket-event'\r\n              }\r\n            };\r\n            logger.logOnairosResponse(responseData, 'Socket: training-complete', { detailed: true });\r\n          }).catch(e => {\r\n            // Fallback logging if dynamic import fails\r\n            console.log('\\n ===== TRAINING + INFERENCE COMPLETE =====\\n');\r\n            console.log(JSON.stringify(result, null, 2));\r\n          });\r\n\r\n          console.log('\\n Model ready for predictions!\\n');\r\n\r\n          // Disconnect socket\r\n          socket.disconnect();\r\n\r\n          // Complete after short delay\r\n          setTimeout(() => {\r\n            onComplete?.(result);\r\n          }, 500);\r\n        });\r\n\r\n        // Handle errors\r\n        socket.on('training-error', (error) => {\r\n          console.error(' Training error from Socket.IO:', error);\r\n          \r\n          if (progressTimer) clearInterval(progressTimer);\r\n          if (watchdogTimer) clearTimeout(watchdogTimer);\r\n          if (phraseTimer) clearInterval(phraseTimer);\r\n          \r\n          setProgress(100);\r\n          setCurrentPhrase('Finalizing...');\r\n          \r\n          socket.disconnect();\r\n          \r\n          setTimeout(() => {\r\n            onComplete?.({ \r\n              error: error.message || 'Training failed',\r\n              fallback: true \r\n            });\r\n          }, 500);\r\n        });\r\n\r\n        // Handle connection errors\r\n        socket.on('connect_error', (error) => {\r\n          console.error(' Socket.IO connection error:', error);\r\n          \r\n          if (progressTimer) clearInterval(progressTimer);\r\n          if (watchdogTimer) clearTimeout(watchdogTimer);\r\n          if (phraseTimer) clearInterval(phraseTimer);\r\n          \r\n          setProgress(100);\r\n          setCurrentPhrase('Finalizing...');\r\n          \r\n          socket.disconnect();\r\n          \r\n          setTimeout(() => {\r\n            onComplete?.({ \r\n              error: 'Failed to connect to training server',\r\n              fallback: true \r\n            });\r\n          }, 500);\r\n        });\r\n\r\n        // Handle disconnect\r\n        socket.on('disconnect', (reason) => {\r\n          console.log(' Socket disconnected:', reason);\r\n        });\r\n\r\n      } catch (error) {\r\n        console.error(' Training/Inference Error:', error);\r\n        \r\n        if (progressTimer) clearInterval(progressTimer);\r\n        if (watchdogTimer) clearTimeout(watchdogTimer);\r\n        if (phraseTimer) clearInterval(phraseTimer);\r\n        if (socket) socket.disconnect();\r\n        \r\n        // Fallback: still complete but show error\r\n        console.warn(' Falling back to cached data or skipping training');\r\n        setProgress(100);\r\n        setTimeout(() => {\r\n          onComplete?.({ \r\n            error: error.message,\r\n            fallback: true \r\n          });\r\n        }, 500);\r\n      }\r\n    };\r\n\r\n    runTrainingAndInference();\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      if (progressTimer) clearInterval(progressTimer);\r\n      if (watchdogTimer) clearTimeout(watchdogTimer);\r\n      if (phraseTimer) clearInterval(phraseTimer);\r\n      if (socket) {\r\n        console.log(' Cleaning up socket connection');\r\n        socket.disconnect();\r\n      }\r\n    };\r\n  }, [userEmail, connectedAccounts, userToken, onComplete]);\r\n\r\n  return (\r\n    <div className=\"h-full w-full flex flex-col items-center justify-center px-6 py-4\">\r\n      {/* Fixed layout container to prevent shifting when phrases change */}\r\n      <div\r\n        className=\"w-full max-w-md flex flex-col items-center\"\r\n        style={{\r\n          // Keep consistent vertical rhythm across devices\r\n          minHeight: 520,\r\n          justifyContent: 'center',\r\n          gap: 18\r\n        }}\r\n      >\r\n        {/* Vague message only (never show backend training/inference details) */}\r\n        <div className=\"text-center\" style={{ minHeight: 56, display: 'flex', alignItems: 'center' }}>\r\n          <h2\r\n            className=\"text-xl md:text-2xl font-semibold text-gray-900\"\r\n            style={{\r\n              fontFamily: 'IBM Plex Sans, system-ui, sans-serif',\r\n              lineHeight: 1.2,\r\n              maxWidth: 360\r\n            }}\r\n          >\r\n            {currentPhrase}\r\n          </h2>\r\n        </div>\r\n\r\n        {/* Lottie Animation */}\r\n        <div className=\"w-full flex items-center justify-center\" style={{ height: 300 }}>\r\n          <div className=\"relative\" style={{ width: 300, height: 300 }}>\r\n            <Lottie \r\n              lottieRef={lottieRef}\r\n              animationData={rainAnim}\r\n              loop={true}\r\n              autoplay={true}\r\n              className=\"absolute inset-0\"\r\n              style={{ width: '100%', height: '100%' }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Black and White Loading Bar - Below Lottie */}\r\n        <div className=\"w-full\" style={{ maxWidth: 360 }}>\r\n          <div className=\"relative w-full h-1.5 bg-gray-200 rounded-full overflow-hidden\">\r\n            <div \r\n              className=\"absolute top-0 left-0 h-full bg-gray-900 rounded-full transition-all duration-300 ease-out\"\r\n              style={{ \r\n                width: `${progress}%`\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from \"react\";\r\nimport Lottie from 'lottie-react';\r\nimport rainAnim from '../../public/rain-anim.json';\r\n\r\nexport default function LoadingScreen({ onComplete, appName }) {\r\n  const [progress, setProgress] = useState(0);\r\n\r\n  useEffect(() => {\r\n    // Smooth progress animation\r\n    const progressInterval = setInterval(() => {\r\n      setProgress((prev) => {\r\n        if (prev >= 95) return prev; // Cap at 95% until onComplete is called\r\n        return prev + 1;\r\n      });\r\n    }, 150); // Smooth increment every 150ms\r\n\r\n    // Auto-complete after reasonable time (fallback)\r\n    const completeTimer = setTimeout(() => {\r\n      setProgress(100);\r\n      setTimeout(() => {\r\n        onComplete?.();\r\n      }, 500);\r\n    }, 15000); // 15 seconds fallback\r\n\r\n    return () => {\r\n      clearInterval(progressInterval);\r\n      clearTimeout(completeTimer);\r\n    };\r\n  }, [onComplete]);\r\n\r\n  return (\r\n    <div className=\"h-full w-full flex flex-col items-center justify-center px-6 py-4\">\r\n      {/* Fixed layout container to match TrainingScreen */}\r\n      <div\r\n        className=\"w-full max-w-md flex flex-col items-center\"\r\n        style={{\r\n          minHeight: 520,\r\n          justifyContent: 'center',\r\n          gap: 18\r\n        }}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"text-center\" style={{ minHeight: 56, display: 'flex', alignItems: 'center' }}>\r\n          <h2\r\n            className=\"text-xl md:text-2xl font-semibold text-gray-900\"\r\n            style={{\r\n              fontFamily: 'IBM Plex Sans, system-ui, sans-serif',\r\n              lineHeight: 1.2,\r\n              maxWidth: 360\r\n            }}\r\n          >\r\n            Finalizing...\r\n          </h2>\r\n        </div>\r\n\r\n        {/* Lottie Animation */}\r\n        <div className=\"w-full flex items-center justify-center\" style={{ height: 300 }}>\r\n          <div className=\"relative\" style={{ width: 300, height: 300 }}>\r\n            <Lottie\r\n              animationData={rainAnim}\r\n              loop={true}\r\n              autoplay={true}\r\n              className=\"absolute inset-0\"\r\n              style={{ width: '100%', height: '100%' }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Black and White Loading Bar */}\r\n        <div className=\"w-full\" style={{ maxWidth: 360 }}>\r\n          <div className=\"relative w-full h-1.5 bg-gray-200 rounded-full overflow-hidden\">\r\n            <div\r\n              className=\"absolute top-0 left-0 h-full bg-gray-900 rounded-full transition-all duration-300 ease-out\"\r\n              style={{ width: `${progress}%` }}\r\n            ></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport Lottie from 'lottie-react';\r\n\r\nexport default function WrappedLoadingPage({ appName }) {\r\n  // CRITICAL: Do not render anything for non-wrapped apps\r\n  // This component should NEVER be called for non-wrapped apps\r\n  const isWrappedApp = appName && appName.toLowerCase().includes('wrapped');\r\n  \r\n  if (!isWrappedApp) {\r\n    console.warn(' WrappedLoadingPage should not be rendered for non-wrapped app:', appName);\r\n    return null;\r\n  }\r\n  \r\n  const [animationData, setAnimationData] = useState(null);\r\n  const [progress, setProgress] = useState(0);\r\n  const [messageIndex, setMessageIndex] = useState(0);\r\n\r\n  // Whimsical rotating messages\r\n  const messages = [\r\n    \"Reading your mind...\",\r\n    \"Connecting the dots...\",\r\n    \"Brewing insights...\",\r\n    \"Decoding your vibe...\",\r\n    \"Piecing together your story...\",\r\n    \"Finding patterns in the chaos...\",\r\n    \"Translating data to wisdom...\",\r\n    \"Analyzing your digital footprint...\",\r\n    \"Your digital fingerprint is unique...\",\r\n    \"Generating personalized metrics...\",\r\n    \"Almost done thinking...\",\r\n    \"Polishing the final details...\",\r\n    \"Applying finishing touches...\",\r\n    \"Preparing your wrapped report...\"\r\n  ];\r\n\r\n  useEffect(() => {\r\n    // Fetch the animation JSON from public folder\r\n    fetch('/rain-anim.json')\r\n      .then(res => res.json())\r\n      .then(data => setAnimationData(data))\r\n      .catch(err => {\r\n        console.error('Failed to load rain animation:', err);\r\n        // Fallback: try from the npm package public folder\r\n        fetch('https://onairos.sirv.com/rain-anim.json')\r\n          .then(res => res.json())\r\n          .then(data => setAnimationData(data))\r\n          .catch(err2 => console.error('Failed to load rain animation from fallback:', err2));\r\n      });\r\n  }, []);\r\n\r\n  // Animate progress bar over ~2 minutes (API can take 1-3 minutes)\r\n  useEffect(() => {\r\n    const duration = 120000; // 2 minutes in ms\r\n    const interval = 100; // Update every 100ms\r\n    const increment = (interval / duration) * 100;\r\n    \r\n    const timer = setInterval(() => {\r\n      setProgress(prev => {\r\n        const next = prev + increment;\r\n        // Cap at 95% to avoid reaching 100% before API completes\r\n        return next >= 95 ? 95 : next;\r\n      });\r\n    }, interval);\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  // Rotate messages every 4 seconds\r\n  useEffect(() => {\r\n    const messageTimer = setInterval(() => {\r\n      setMessageIndex(prev => (prev + 1) % messages.length);\r\n    }, 4000);\r\n\r\n    return () => clearInterval(messageTimer);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-center h-full px-4 py-4 md:px-6 overflow-hidden\">\r\n      {/* Content is centered vertically inside the modal card */}\r\n      <div className=\"flex flex-col items-center justify-center w-full max-w-2xl space-y-2 md:space-y-4 h-full max-h-[600px]\">\r\n        {/* Title */}\r\n        <div className=\"text-center flex-shrink-0 mt-0\">\r\n          <h2 className=\"text-lg md:text-2xl font-semibold text-gray-900 mb-1\">\r\n            {isWrappedApp ? 'Updating your digital brain for 2025...' : 'Processing your data...'}\r\n          </h2>\r\n          <p className=\"text-xs md:text-sm text-gray-600 px-4\">\r\n            {isWrappedApp ? 'Crafting your personalized insights from your digital footprint' : 'This will just take a moment'}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Lottie Animation */}\r\n        {animationData ? (\r\n          <div className=\"w-full max-w-[200px] md:max-w-[260px] mx-auto flex-shrink-1 min-h-0 aspect-square flex items-center justify-center\">\r\n            <Lottie \r\n              animationData={animationData}\r\n              loop={true}\r\n              autoplay={true}\r\n              className=\"w-full h-full\"\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"w-full max-w-sm h-32 md:h-48 flex items-center justify-center flex-shrink-0\">\r\n            <div className=\"animate-spin rounded-full h-10 w-10 md:h-12 md:w-12 border-b-2 border-gray-900\"></div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Black and White Loading Bar - Below Lottie */}\r\n        <div className=\"w-full max-w-md px-2 flex-shrink-0\">\r\n          <div className=\"flex justify-between text-xs font-medium text-gray-600 mb-2 px-1\">\r\n             <span>Analyzing data...</span>\r\n             <span>{Math.round(progress)}%</span>\r\n          </div>\r\n          \r\n          <div className=\"relative w-full h-4 bg-gray-200 rounded-full overflow-hidden border border-gray-100 shadow-inner\">\r\n            <div \r\n              className=\"absolute top-0 left-0 h-full bg-gray-900 rounded-full transition-all duration-300 ease-out flex items-center justify-end pr-2\"\r\n              style={{ \r\n                width: `${progress}%`\r\n              }}\r\n            >\r\n              {/* Optional: Add a subtle shine/pulse effect */}\r\n              <div className=\"w-full h-full absolute inset-0 bg-white/10 animate-pulse\"></div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Rotating message with fade transition */}\r\n          <div className=\"h-8 mt-4 flex items-center justify-center\">\r\n            <p \r\n              key={messageIndex}\r\n              className=\"text-center text-sm font-semibold text-gray-800 animate-fadeIn\"\r\n              style={{ \r\n                animation: 'fadeIn 0.5s ease-in-out'\r\n              }}\r\n            >\r\n              {messages[messageIndex]}\r\n            </p>\r\n          </div>\r\n          \r\n          {/* Explicit wait message - Minimal Design */}\r\n          <div className=\"mt-5 flex flex-col items-center gap-1.5 max-w-sm mx-auto\">\r\n            <div className=\"h-px w-12 bg-gradient-to-r from-transparent via-gray-300 to-transparent mb-1.5\"></div>\r\n            <p className=\"text-xs text-gray-600 text-center leading-relaxed font-medium\">\r\n              This runs a complex AI model and takes about 1-3 minutes.\r\n            </p>\r\n            <p className=\"text-xs text-gray-600 text-center font-medium\">\r\n              Feel free to grab a coffee while we cook! \r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <style>{`\r\n          @keyframes fadeIn {\r\n            0% { opacity: 0; transform: translateY(-4px); }\r\n            100% { opacity: 1; transform: translateY(0); }\r\n          }\r\n        `}</style>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","/**\r\n * Response formatter utility for Onairos SDK\r\n * Converts array-based responses to dictionary format for better developer experience\r\n */\r\n\r\n// Standard 16 personality types in order that the API returns them\r\nexport const PERSONALITY_TYPES = [\r\n  'Analyst',\r\n  'Diplomat', \r\n  'Sentinel',\r\n  'Explorer',\r\n  'Architect',\r\n  'Logician',\r\n  'Commander',\r\n  'Debater',\r\n  'Advocate',\r\n  'Mediator',\r\n  'Protagonist',\r\n  'Campaigner',\r\n  'Logistician',\r\n  'Defender',\r\n  'Executive',\r\n  'Consul'\r\n];\r\n\r\n// Standard trait categories that might be returned\r\nexport const TRAIT_CATEGORIES = [\r\n  'Openness',\r\n  'Conscientiousness',\r\n  'Extraversion',\r\n  'Agreeableness',\r\n  'Neuroticism'\r\n];\r\n\r\n/**\r\n * Formats API response to include both array and dictionary formats\r\n * @param {Object} apiResponse - Raw API response from Onairos\r\n * @param {Object} options - Formatting options\r\n * @param {boolean} options.includeDictionary - Whether to include dictionary format (default: true)\r\n * @param {boolean} options.includeArray - Whether to include original array format (default: true)\r\n * @returns {Object} Formatted response with both formats\r\n */\r\nexport function formatOnairosResponse(apiResponse, options = {}) {\r\n  const { includeDictionary = true, includeArray = true } = options;\r\n  \r\n  if (!apiResponse) {\r\n    return apiResponse;\r\n  }\r\n\r\n  const formatted = { ...apiResponse };\r\n\r\n  // Handle personality scores if present\r\n  if (apiResponse.InferenceResult?.traits || apiResponse.traits || apiResponse.scores) {\r\n    const scores = apiResponse.InferenceResult?.traits || apiResponse.traits || apiResponse.scores;\r\n    \r\n    if (Array.isArray(scores) && scores.length >= 16) {\r\n      if (includeDictionary) {\r\n        // Create personality dictionary\r\n        const personalityDict = {};\r\n        PERSONALITY_TYPES.forEach((type, index) => {\r\n          personalityDict[type] = scores[index];\r\n        });\r\n        \r\n        // Add to formatted response\r\n        if (formatted.InferenceResult) {\r\n          formatted.InferenceResult.personalityDict = personalityDict;\r\n        } else {\r\n          formatted.personalityDict = personalityDict;\r\n        }\r\n      }\r\n      \r\n      if (!includeArray) {\r\n        // Remove array format if not requested\r\n        if (formatted.InferenceResult?.traits) {\r\n          delete formatted.InferenceResult.traits;\r\n        }\r\n        if (formatted.traits) {\r\n          delete formatted.traits;\r\n        }\r\n        if (formatted.scores) {\r\n          delete formatted.scores;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle trait data if present (for preferences/traits)\r\n  if (apiResponse.traitResult || apiResponse.traits) {\r\n    const traits = apiResponse.traitResult || apiResponse.traits;\r\n    \r\n    if (Array.isArray(traits) && includeDictionary) {\r\n      const traitDict = {};\r\n      TRAIT_CATEGORIES.forEach((category, index) => {\r\n        if (traits[index] !== undefined) {\r\n          traitDict[category] = traits[index];\r\n        }\r\n      });\r\n      \r\n      formatted.traitDict = traitDict;\r\n    }\r\n  }\r\n\r\n  return formatted;\r\n}\r\n\r\n/**\r\n * Legacy formatter for backward compatibility\r\n * Converts scores array to personality dictionary only\r\n * @param {Array} scores - Array of personality scores\r\n * @returns {Object} Dictionary with personality type names as keys\r\n */\r\nexport function formatPersonalityScores(scores) {\r\n  if (!Array.isArray(scores) || scores.length < 16) {\r\n    console.warn('Invalid scores array provided to formatPersonalityScores');\r\n    return {};\r\n  }\r\n\r\n  const personalityDict = {};\r\n  PERSONALITY_TYPES.forEach((type, index) => {\r\n    personalityDict[type] = scores[index];\r\n  });\r\n  \r\n  return personalityDict;\r\n}\r\n\r\n/**\r\n * Get personality type names in order\r\n * @returns {Array} Array of personality type names\r\n */\r\nexport function getPersonalityTypes() {\r\n  return [...PERSONALITY_TYPES];\r\n}\r\n\r\n/**\r\n * Get trait category names in order  \r\n * @returns {Array} Array of trait category names\r\n */\r\nexport function getTraitCategories() {\r\n  return [...TRAIT_CATEGORIES];\r\n} ","/**\r\n * Enhanced User Data Formatter for onComplete Callback\r\n * Provides structured, readable formatting of Onairos user data\r\n */\r\n\r\n/**\r\n * Formats user data for better readability in onComplete callback\r\n * @param {Object} result - The complete result object from data request\r\n * @returns {Object} Enhanced result with formatted user data display\r\n */\r\nexport function formatUserDataForDisplay(result) {\r\n  if (!result) return result;\r\n\r\n  const formatted = { ...result };\r\n  \r\n  // Create a structured summary of the user data\r\n  const userDataSummary = {\r\n    // Basic request information\r\n    requestInfo: {\r\n      timestamp: result.timestamp || new Date().toISOString(),\r\n      appName: result.appName || 'Unknown App',\r\n      userHash: result.userHash || 'Unknown User',\r\n      testMode: result.testMode || false,\r\n      dataTypesRequested: Array.isArray(result.approvedData) ? result.approvedData : (result.approved || [])\r\n    },\r\n    \r\n    // Connected platforms/accounts\r\n    connectedAccounts: formatConnectedAccounts(result.userData?.connectedAccounts || []),\r\n    \r\n    // API response data (personality, preferences, etc.)\r\n    aiData: formatAIResponseData(result.apiResponse)\r\n  };\r\n\r\n  // Add the formatted summary to the result\r\n  formatted.userDataSummary = userDataSummary;\r\n  \r\n  // Create a pretty-printed version for console logging\r\n  formatted.prettyPrint = createPrettyPrintVersion(userDataSummary);\r\n  \r\n  return formatted;\r\n}\r\n\r\n/**\r\n * Formats connected accounts data\r\n * @param {Array} accounts - Array of connected account objects\r\n * @returns {Object} Formatted accounts summary\r\n */\r\nfunction formatConnectedAccounts(accounts) {\r\n  if (!Array.isArray(accounts) || accounts.length === 0) {\r\n    return {\r\n      count: 0,\r\n      platforms: [],\r\n      summary: 'No connected accounts'\r\n    };\r\n  }\r\n\r\n  // SDK stores connectedAccounts as an array of strings (e.g. [\"YouTube\",\"Reddit\"])\r\n  // in several flows. Support that format as well as object arrays.\r\n  if (typeof accounts[0] === 'string') {\r\n    const names = accounts.map(a => String(a || '').trim()).filter(Boolean);\r\n    return {\r\n      count: names.length,\r\n      platforms: names.map(name => ({\r\n        name,\r\n        status: 'Connected',\r\n        connectedAt: 'Unknown date',\r\n        hasData: false\r\n      })),\r\n      summary: `${names.length} platform(s) connected: ${names.join(', ')}`\r\n    };\r\n  }\r\n\r\n  return {\r\n    count: accounts.length,\r\n    platforms: accounts.map(account => ({\r\n      name: account.platform || account.name || 'Unknown Platform',\r\n      status: account.status || 'Unknown',\r\n      connectedAt: account.connectedAt || 'Unknown date',\r\n      hasData: account.hasData || false\r\n    })),\r\n    summary: `${accounts.length} platform(s) connected: ${accounts.map(a => a.platform || a.name).join(', ')}`\r\n  };\r\n}\r\n\r\n/**\r\n * Formats AI response data (personality scores, traits, etc.)\r\n * @param {Object} apiResponse - The API response containing AI data\r\n * @returns {Object} Formatted AI data summary\r\n */\r\nfunction formatAIResponseData(apiResponse) {\r\n  if (!apiResponse) {\r\n    return {\r\n      available: false,\r\n      dataTypes: [],\r\n      summary: 'No AI data available'\r\n    };\r\n  }\r\n\r\n  const aiData = {\r\n    available: true,\r\n    dataTypes: []\r\n  };\r\n\r\n  // Check for Onairos Wrapped Dashboard\r\n  if (apiResponse.data?.dashboard || apiResponse.dashboard || apiResponse.slides) {\r\n    aiData.dataTypes.push({\r\n      type: 'wrapped_dashboard',\r\n      available: true,\r\n      summary: 'Onairos Wrapped / Neural Recall Dashboard available'\r\n    });\r\n    \r\n    // Add apps if available\r\n    if (apiResponse.data?.apps || apiResponse.apps) {\r\n      const appsCount = (apiResponse.data?.apps || apiResponse.apps).length;\r\n      aiData.dataTypes.push({\r\n        type: 'connected_apps',\r\n        available: true,\r\n        summary: `Connected apps list available (${appsCount} apps)`\r\n      });\r\n    }\r\n  }\r\n\r\n  // Check for personality data - simplified to avoid confusion\r\n  if (apiResponse.InferenceResult?.traits || apiResponse.personalityDict || apiResponse.traits) {\r\n    const personalityData = {\r\n      type: 'personality',\r\n      available: true\r\n    };\r\n\r\n    // Determine summary without including full data (reduces log clutter)\r\n    if (apiResponse.personalityDict) {\r\n      personalityData.summary = `Personality analysis available (${Object.keys(apiResponse.personalityDict).length} traits)`;\r\n    } else if (apiResponse.InferenceResult?.traits) {\r\n      personalityData.summary = `Personality scores available (${Array.isArray(apiResponse.InferenceResult.traits) ? apiResponse.InferenceResult.traits.length : 'unknown count'} values)`;\r\n    } else if (apiResponse.traits) {\r\n      const count = Array.isArray(apiResponse.traits) ? apiResponse.traits.length : Object.keys(apiResponse.traits).length;\r\n      personalityData.summary = `Personality traits available (${count} items)`;\r\n    }\r\n\r\n    aiData.dataTypes.push(personalityData);\r\n  }\r\n\r\n  // Check for basic info/output\r\n  if (apiResponse.InferenceResult?.output || apiResponse.output) {\r\n    aiData.dataTypes.push({\r\n      type: 'basic_info',\r\n      available: true,\r\n      summary: 'Basic user information and insights available'\r\n    });\r\n  }\r\n\r\n  // Create overall summary\r\n  aiData.summary = aiData.dataTypes.length > 0 \r\n    ? `AI analysis complete with ${aiData.dataTypes.length} data type(s): ${aiData.dataTypes.map(d => d.type).join(', ')}`\r\n    : 'AI data structure present but no recognized data types found';\r\n\r\n  return aiData;\r\n}\r\n\r\n/**\r\n * Creates a pretty-printed version for console logging\r\n * @param {Object} userDataSummary - The formatted user data summary\r\n * @returns {string} Pretty-printed string for console output\r\n */\r\nfunction createPrettyPrintVersion(userDataSummary) {\r\n  const lines = [];\r\n  \r\n  lines.push(' ONAIROS USER DATA SUMMARY');\r\n  lines.push('=' .repeat(50));\r\n  \r\n  // Request Info\r\n  lines.push('\\n REQUEST INFORMATION:');\r\n  lines.push(`   App: ${userDataSummary.requestInfo.appName}`);\r\n  lines.push(`   User: ${userDataSummary.requestInfo.userHash}`);\r\n  lines.push(`   Mode: ${userDataSummary.requestInfo.testMode ? 'Test' : 'Production'}`);\r\n  lines.push(`   Data Types: ${Array.isArray(userDataSummary.requestInfo.dataTypesRequested) && userDataSummary.requestInfo.dataTypesRequested.length > 0 ? userDataSummary.requestInfo.dataTypesRequested.join(', ') : 'None'}`);\r\n  lines.push(`   Timestamp: ${new Date(userDataSummary.requestInfo.timestamp).toLocaleString()}`);\r\n  \r\n  // Connected Accounts\r\n  lines.push('\\n CONNECTED ACCOUNTS:');\r\n  lines.push(`   ${userDataSummary.connectedAccounts.summary}`);\r\n  if (userDataSummary.connectedAccounts.platforms.length > 0) {\r\n    userDataSummary.connectedAccounts.platforms.forEach(platform => {\r\n      lines.push(`    ${platform.name}: ${platform.status} ${platform.hasData ? '(has data)' : '(no data)'}`);\r\n    });\r\n  }\r\n  \r\n  // AI Data\r\n  lines.push('\\n AI ANALYSIS DATA:');\r\n  lines.push(`   ${userDataSummary.aiData.summary}`);\r\n  if (userDataSummary.aiData.dataTypes.length > 0) {\r\n    userDataSummary.aiData.dataTypes.forEach(dataType => {\r\n      lines.push(`    ${dataType.type.toUpperCase()}: ${dataType.summary}`);\r\n    });\r\n  }\r\n  \r\n  lines.push('\\n' + '=' .repeat(50));\r\n  \r\n  return lines.join('\\n');\r\n}\r\n\r\n/**\r\n * Console logging helper that prints formatted user data\r\n * @param {Object} result - The result object from onComplete\r\n */\r\nexport function logFormattedUserData(result) {\r\n  const formatted = formatUserDataForDisplay(result);\r\n  \r\n  console.log('\\n' + formatted.prettyPrint + '\\n');\r\n  \r\n  // Removed for distribution: detailed structured data logging\r\n  // This was causing confusing nested aiData/traits output in console\r\n  // Uncomment for debugging if needed:\r\n  // console.log(' Structured User Data Summary:', formatted.userDataSummary);\r\n  \r\n  return formatted;\r\n}\r\n\r\nexport default {\r\n  formatUserDataForDisplay,\r\n  logFormattedUserData\r\n};\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { COLORS } from '../../theme/colors.js';\r\n\r\n// Standardized page layout component with white background\r\nconst PageLayout = ({\r\n  children,\r\n  title,\r\n  subtitle,\r\n  icon,\r\n  showHeader = true,\r\n  showCloseButton = false,\r\n  onClose,\r\n  onBack,\r\n  showBackButton = false,\r\n  className = '',\r\n  contentClassName = '',\r\n  centerContent = true,\r\n  style = {},\r\n  ...props\r\n}) => {\r\n  const isSmallScreen = typeof window !== 'undefined' && window.innerWidth <= 768;\r\n  // If the caller passes a Tailwind override like \"!p-0\", we must respect it in inline styles.\r\n  // Inline styles override classes, so we mirror the intent here.\r\n  const disableContentPadding =\r\n    typeof contentClassName === 'string' &&\r\n    (contentClassName.includes('!p-0') || contentClassName.includes('p-0'));\r\n\r\n  const layoutStyle = {\r\n    backgroundColor: COLORS.background,\r\n    minHeight: '100%',\r\n    width: '100%',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    ...style\r\n  };\r\n\r\n  const headerStyle = {\r\n    position: 'sticky',\r\n    top: 0,\r\n    backgroundColor: COLORS.background,\r\n    zIndex: 10,\r\n    padding: isSmallScreen\r\n      ? '10px 16px 8px'\r\n      : 'clamp(8px, 2vw, 16px) clamp(16px, 4vw, 32px) clamp(6px, 1.5vw, 12px)'\r\n  };\r\n\r\n  const contentStyle = {\r\n    flex: 1,\r\n    padding: disableContentPadding ? '0' : (isSmallScreen ? '16px 16px 18px' : 'clamp(16px, 4vw, 32px)'),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    overflow: 'auto',\r\n    minHeight: 0, // Allow flex item to shrink below content size\r\n    ...(centerContent && {\r\n      alignItems: 'center',\r\n      justifyContent: 'flex-start'\r\n    })\r\n  };\r\n\r\n  const titleStyle = {\r\n    fontFamily: 'IBM Plex Sans, system-ui, sans-serif',\r\n    fontSize: 'clamp(20px, 5vw, 28px)',\r\n    fontWeight: '700',\r\n    color: COLORS.textPrimary,\r\n    margin: '0 0 clamp(6px, 1.5vw, 12px) 0',\r\n    textAlign: centerContent ? 'center' : 'left',\r\n    lineHeight: '1.2'\r\n  };\r\n\r\n  const subtitleStyle = {\r\n    fontFamily: 'Inter, system-ui, sans-serif',\r\n    fontSize: 'clamp(14px, 3.5vw, 18px)',\r\n    fontWeight: '400',\r\n    color: COLORS.textSecondary,\r\n    margin: isSmallScreen ? '0 0 18px 0' : '0 0 clamp(20px, 5vw, 40px) 0',\r\n    textAlign: centerContent ? 'center' : 'left',\r\n    lineHeight: '1.5'\r\n  };\r\n\r\n  const iconStyle = {\r\n    width: 'clamp(40px, 8vw, 56px)',\r\n    height: 'clamp(40px, 8vw, 56px)',\r\n    margin: '0 auto clamp(16px, 4vw, 32px)',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    fontSize: 'clamp(20px, 5vw, 28px)'\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className={`onairos-page-layout ${className}`}\r\n      style={layoutStyle}\r\n      {...props}\r\n    >\r\n      {/* Header with navigation */}\r\n      {showHeader && (\r\n        <div style={headerStyle}>\r\n          <div className=\"flex items-center justify-between\">\r\n            {/* Back button */}\r\n            {showBackButton && onBack && (\r\n              <button\r\n                onClick={onBack}\r\n                className=\"flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 transition-colors\"\r\n                aria-label=\"Go back\"\r\n              >\r\n                <span style={{ fontSize: '16px', color: COLORS.textPrimary }}></span>\r\n              </button>\r\n            )}\r\n\r\n\r\n            {/* Close button */}\r\n            {showCloseButton && onClose && (\r\n              <button\r\n                onClick={onClose}\r\n                className=\"flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 transition-colors\"\r\n                aria-label=\"Close\"\r\n              >\r\n                <span style={{ fontSize: '16px', color: COLORS.textPrimary }}></span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Main content area */}\r\n      <div \r\n        className={`onairos-page-content ${contentClassName}`}\r\n        style={contentStyle}\r\n      >\r\n        {/* Icon */}\r\n        {icon && (\r\n          <div style={iconStyle}>\r\n            {typeof icon === 'string' ? <span>{icon}</span> : icon}\r\n          </div>\r\n        )}\r\n\r\n        {/* Title */}\r\n        {title && (\r\n          <h1 style={titleStyle}>\r\n            {title}\r\n          </h1>\r\n        )}\r\n\r\n        {/* Subtitle */}\r\n        {subtitle && (\r\n          <p style={subtitleStyle}>\r\n            {subtitle}\r\n          </p>\r\n        )}\r\n\r\n        {/* Page content */}\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Modal wrapper component for overlay-style pages\r\nconst ModalPageLayout = ({\r\n  children,\r\n  visible = true,\r\n  onClose,\r\n  onBackdropClick,\r\n  backdropStyle = {},\r\n  modalStyle = {},\r\n  modalClassName = '',\r\n  ...pageLayoutProps\r\n}) => {\r\n  if (!visible) return null;\r\n\r\n  // Detect Capacitor native platform\r\n  // Must be defined BEFORE usage to avoid Temporal Dead Zone (TDZ) error\r\n  const isCapacitorNative = typeof window !== 'undefined' && \r\n    window.Capacitor && \r\n    typeof window.Capacitor.isNativePlatform === 'function' && \r\n    window.Capacitor.isNativePlatform();\r\n    \r\n  // Detect mobile browser (not Capacitor native)\r\n  const isMobileBrowser = typeof window !== 'undefined' && \r\n    window.innerWidth <= 768 && \r\n    !isCapacitorNative;\r\n\r\n  // Track viewport height using ResizeObserver on visualViewport if available\r\n  // This is the most reliable way to detect keyboard opening on iOS/Android\r\n  const [visualHeight, setVisualHeight] = useState(() => {\r\n    if (typeof window === 'undefined') return null;\r\n    return window.visualViewport?.height || window.innerHeight;\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    if (!isMobileBrowser) return;\r\n\r\n    const handleResize = () => {\r\n      const h = window.visualViewport?.height || window.innerHeight;\r\n      setVisualHeight(h);\r\n    };\r\n\r\n    // Listen to both visualViewport (keyboard) and window resize\r\n    if (window.visualViewport) {\r\n      window.visualViewport.addEventListener('resize', handleResize);\r\n      window.visualViewport.addEventListener('scroll', handleResize);\r\n    }\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    return () => {\r\n      if (window.visualViewport) {\r\n        window.visualViewport.removeEventListener('resize', handleResize);\r\n        window.visualViewport.removeEventListener('scroll', handleResize);\r\n      }\r\n      window.removeEventListener('resize', handleResize);\r\n    };\r\n  }, [isMobileBrowser]);\r\n\r\n  // Use visualViewport to avoid iOS \"vh\" causing phantom scroll and clipped content.\r\n  const [mobileModalHeightPx, setMobileModalHeightPx] = useState(() => {\r\n    if (typeof window === 'undefined') return null;\r\n    if (!isMobileBrowser) return null;\r\n    const h = window.innerHeight; // ALWAYS use full window innerHeight as base\r\n    return Math.round(h * 0.85);\r\n  });\r\n\r\n  // CRITICAL FIX: Only calculate height ONCE on mount (or significant orientation change).\r\n  // Do NOT update it when keyboard opens (which shrinks visualViewport height).\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    if (!isMobileBrowser) return;\r\n    \r\n    const compute = () => {\r\n      // Use window.innerHeight (layout viewport) which is stable on Android\r\n      // On iOS, it might change, so we might need screen.height check?\r\n      // Generally, window.innerHeight is safer for \"full screen\" modals than visualViewport\r\n      const h = window.innerHeight; \r\n      // Only update if difference is significant (orientation change), not just keyboard (20-40% diff)\r\n      // Keyboard usually takes 30-40% of screen.\r\n      setMobileModalHeightPx(Math.round(h * 0.85));\r\n    };\r\n    \r\n    compute();\r\n    \r\n    // Only re-compute on actual orientation change or massive resize,\r\n    // explicitly NOT on visualViewport resize (keyboard).\r\n    const onWindowResize = () => {\r\n       const newH = window.innerHeight;\r\n       // If height changed by more than 150px, it might be orientation or keyboard.\r\n       // But we want to IGNORE keyboard shrinking.\r\n       // Actually, on Android window.innerHeight often shrinks with keyboard.\r\n       // On iOS it does not.\r\n       // To be safe: use screen.height as reference? \r\n       // Better strategy: Fix the height to '85vh' in CSS (which ignores keyboard on most modern browsers)\r\n       // OR cache the initial height.\r\n       // Let's stick to initial height and only update if width changes (orientation).\r\n    };\r\n    \r\n    // Listen for orientation changes specifically\r\n    window.addEventListener('orientationchange', compute);\r\n    \r\n    return () => {\r\n      window.removeEventListener('orientationchange', compute);\r\n    };\r\n  }, [isMobileBrowser]);\r\n    \r\n  // ENHANCED DEBUG LOGGING for mobile browser height issues\r\n  if (typeof window !== 'undefined') {\r\n    console.log('[Onairos SDK][ModalPageLayout] Mobile Detection', {\r\n      width: window.innerWidth,\r\n      height: window.innerHeight,\r\n      isCapacitorNative,\r\n      isMobileBrowser,\r\n      modalHeight: isMobileBrowser ? '80vh' : (isCapacitorNative ? '100vh' : 'auto'),\r\n      modalMaxHeight: isMobileBrowser ? '80vh' : (isCapacitorNative ? '100vh' : '90vh'),\r\n      modalMaxWidth: isMobileBrowser ? '100%' : '500px',\r\n      backdropAlign: (isCapacitorNative || isMobileBrowser) ? 'flex-end' : 'center',\r\n      backdropPadding: isMobileBrowser ? '0' : '16px'\r\n    });\r\n  }\r\n\r\n  const backdropStyles = {\r\n    position: 'fixed',\r\n    top: 0,\r\n    left: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n    zIndex: 2147483647,\r\n    display: 'flex',\r\n    alignItems: (isCapacitorNative || isMobileBrowser) ? 'flex-end' : 'center',\r\n    justifyContent: 'center',\r\n    padding: isMobileBrowser ? '0' : '16px',\r\n    transition: 'opacity 200ms ease',\r\n    willChange: 'opacity',\r\n    ...backdropStyle\r\n  };\r\n  \r\n  console.log('[Onairos SDK][ModalPageLayout]  Backdrop Styles COMPUTED:', {\r\n    alignItems: backdropStyles.alignItems,\r\n    padding: backdropStyles.padding,\r\n    display: backdropStyles.display,\r\n    hasBackdropStyleOverride: Object.keys(backdropStyle).length > 0,\r\n    backdropStyleOverride: backdropStyle\r\n  });\r\n  \r\n  const modalStyles = {\r\n    backgroundColor: COLORS.background,\r\n    borderTopLeftRadius: '24px',\r\n    borderTopRightRadius: '24px',\r\n    borderBottomLeftRadius: (isCapacitorNative || isMobileBrowser) ? '0px' : '24px',\r\n    borderBottomRightRadius: (isCapacitorNative || isMobileBrowser) ? '0px' : '24px',\r\n    // Mobile browser: keep modal height STABLE while the keyboard opens.\r\n    // Some browsers shrink `vh` when the keyboard appears. Instead we capture a pixel height on mount\r\n    // (and only recompute on orientation changes) so the modal itself doesn't jump; content can scroll.\r\n    height: isMobileBrowser\r\n      ? (mobileModalHeightPx ? `${mobileModalHeightPx}px` : '85vh')\r\n      : (isCapacitorNative ? '100vh' : 'auto'),\r\n    maxHeight: isMobileBrowser\r\n      ? (mobileModalHeightPx ? `${mobileModalHeightPx}px` : '85vh')\r\n      : (isCapacitorNative ? '100vh' : '90vh'),\r\n    minHeight: (isCapacitorNative || isMobileBrowser) ? 'auto' : '600px',\r\n    width: '100%',\r\n    maxWidth: isMobileBrowser ? '100%' : '500px',\r\n    boxShadow: '0 -10px 40px rgba(0, 0, 0, 0.3)',\r\n    overflow: 'hidden',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    // iOS safe-area: extend the white modal background into the home-indicator inset\r\n    ...(isMobileBrowser ? { paddingBottom: 'env(safe-area-inset-bottom)' } : {}),\r\n    transform: 'translateY(0)',\r\n    transition: 'transform 220ms ease, opacity 220ms ease',\r\n    willChange: 'transform, opacity',\r\n    marginLeft: (isCapacitorNative || isMobileBrowser) ? '0' : 'auto',\r\n    marginRight: (isCapacitorNative || isMobileBrowser) ? '0' : 'auto',\r\n    marginBottom: isMobileBrowser ? '0' : 'auto',\r\n    marginTop: isMobileBrowser ? 'auto' : 'auto',\r\n    // Ensure full height on Capacitor native\r\n    ...(isCapacitorNative && {\r\n      position: 'absolute',\r\n      bottom: 0,\r\n      left: 0,\r\n      right: 0,\r\n      top: 0,\r\n      borderRadius: 0\r\n    }),\r\n    // Position mobile browser modal at bottom\r\n    ...(isMobileBrowser && {\r\n      flexShrink: 0\r\n    }),\r\n    // CRITICAL: Do NOT spread modalStyle on mobile browser - it breaks height\r\n    ...(isMobileBrowser ? {} : modalStyle)\r\n  };\r\n  \r\n  console.log('[Onairos SDK][ModalPageLayout]  Modal Styles COMPUTED:', {\r\n    height: modalStyles.height,\r\n    maxHeight: modalStyles.maxHeight,\r\n    minHeight: modalStyles.minHeight,\r\n    width: modalStyles.width,\r\n    maxWidth: modalStyles.maxWidth,\r\n    borderRadius: `${modalStyles.borderTopLeftRadius} / ${modalStyles.borderBottomLeftRadius}`,\r\n    hasModalStyleOverride: Object.keys(modalStyle).length > 0,\r\n    modalStyleWasApplied: isMobileBrowser ? 'NO (blocked for mobile)' : 'YES',\r\n    modalStyleOverride: modalStyle\r\n  });\r\n  \r\n  // Warn if modalStyle is trying to override on mobile browser\r\n  if (isMobileBrowser && modalStyle && Object.keys(modalStyle).length > 0) {\r\n    console.warn('[Onairos SDK][ModalPageLayout]  BLOCKED modalStyle override on mobile browser. Ignoring:', modalStyle);\r\n  }\r\n\r\n  //  Layout debug logging (desktop vs native)\r\n  try {\r\n    if (typeof window !== 'undefined') {\r\n      const width = window.innerWidth;\r\n      const isDesktop = width >= 1024 && !isCapacitorNative;\r\n      // Only spam logs in desktop where sizing issues occur\r\n      if (isDesktop) {\r\n        // Keep this fairly compact but detailed\r\n        console.log('[Onairos SDK][Layout][ModalPageLayout]', {\r\n          width,\r\n          isCapacitorNative,\r\n          modalClassName,\r\n          modalStyleKeys: Object.keys(modalStyle || {}),\r\n          backdropStyleKeys: Object.keys(backdropStyle || {}),\r\n          modalMaxWidth: modalStyles.maxWidth,\r\n          modalMinHeight: modalStyles.minHeight,\r\n          modalHeight: modalStyles.height,\r\n        });\r\n      }\r\n    }\r\n  } catch (e) {\r\n    // Never let logging break rendering\r\n  }\r\n\r\n  const handleBackdropClick = (e) => {\r\n    if (e.target === e.currentTarget) {\r\n      console.log(' Backdrop clicked outside modal');\r\n      if (onBackdropClick) {\r\n        console.log(' Calling onBackdropClick handler');\r\n        onBackdropClick();\r\n      } else if (onClose) {\r\n        console.log(' Calling onClose handler');\r\n        onClose();\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div \r\n      style={backdropStyles} \r\n      onClick={handleBackdropClick}\r\n      data-onairos-backdrop=\"true\"\r\n      data-mobile-browser={isMobileBrowser ? 'true' : 'false'}\r\n      data-capacitor-native={isCapacitorNative ? 'true' : 'false'}\r\n    >\r\n      <div \r\n        style={modalStyles} \r\n        className={modalClassName}\r\n        onClick={(e) => e.stopPropagation()}\r\n        data-onairos-modal=\"true\"\r\n        data-mobile-browser={isMobileBrowser ? 'true' : 'false'}\r\n        data-modal-height={modalStyles.height}\r\n      >\r\n        <PageLayout\r\n          {...pageLayoutProps}\r\n          showHeader={true}\r\n          showCloseButton={true}\r\n          onClose={onClose}\r\n          style={{\r\n            ...(pageLayoutProps.style || {}),\r\n            ...((!isMobileBrowser && !isCapacitorNative) ? { flex: 1, height: '100%' } : {}),\r\n          }}\r\n        >\r\n          {children}\r\n        </PageLayout>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport { ModalPageLayout };\r\nexport default PageLayout; ","/**\r\n * Session Management Utility\r\n * Handles persistent login sessions with token validation and expiration\r\n * Industry standard: 30-day session duration (configurable)\r\n * \r\n * Similar to \"Sign in with Google\" or \"Sign in with Apple\" behavior\r\n */\r\n\r\nimport { API_CONFIG } from '../config/api-config.js';\r\n\r\n// Session configuration (industry standard)\r\nconst SESSION_CONFIG = {\r\n  // 30 days in milliseconds (industry standard for \"Remember Me\")\r\n  DEFAULT_SESSION_DURATION: 30 * 24 * 60 * 60 * 1000,\r\n  \r\n  // 7 days for shorter sessions\r\n  SHORT_SESSION_DURATION: 7 * 24 * 60 * 60 * 1000,\r\n  \r\n  // Cookie name for fallback storage\r\n  COOKIE_NAME: 'onairos_session',\r\n  \r\n  // localStorage keys\r\n  STORAGE_KEYS: {\r\n    USER_DATA: 'onairosUser',\r\n    USER_TOKEN: 'onairos_user_token',\r\n    SESSION_EXPIRY: 'onairos_session_expiry'\r\n  }\r\n};\r\n\r\n/**\r\n * Check if a session is still valid (not expired)\r\n * @param {string|null} expiryTimestamp - ISO timestamp or null\r\n * @returns {boolean} True if session is still valid\r\n */\r\nexport function isSessionValid(expiryTimestamp = null) {\r\n  try {\r\n    // Get expiry from parameter or storage\r\n    const expiry = expiryTimestamp || localStorage.getItem(SESSION_CONFIG.STORAGE_KEYS.SESSION_EXPIRY);\r\n    \r\n    if (!expiry) {\r\n      console.log(' No session expiry found - session invalid');\r\n      return false;\r\n    }\r\n    \r\n    const expiryDate = new Date(expiry);\r\n    const now = new Date();\r\n    \r\n    const isValid = now < expiryDate;\r\n    \r\n    if (isValid) {\r\n      const daysRemaining = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));\r\n      console.log(` Session valid - expires in ${daysRemaining} days`);\r\n    } else {\r\n      console.log(` Session expired on ${expiryDate.toLocaleDateString()}`);\r\n    }\r\n    \r\n    return isValid;\r\n  } catch (error) {\r\n    console.error(' Error checking session validity:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get current session expiry timestamp\r\n * @returns {string|null} ISO timestamp or null\r\n */\r\nexport function getSessionExpiry() {\r\n  try {\r\n    return localStorage.getItem(SESSION_CONFIG.STORAGE_KEYS.SESSION_EXPIRY);\r\n  } catch (error) {\r\n    console.error(' Error getting session expiry:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set or extend session expiry\r\n * @param {number} duration - Duration in milliseconds (default: 30 days)\r\n * @returns {string} New expiry timestamp\r\n */\r\nexport function setSessionExpiry(duration = SESSION_CONFIG.DEFAULT_SESSION_DURATION) {\r\n  try {\r\n    const expiry = new Date(Date.now() + duration);\r\n    const expiryISO = expiry.toISOString();\r\n    \r\n    localStorage.setItem(SESSION_CONFIG.STORAGE_KEYS.SESSION_EXPIRY, expiryISO);\r\n    \r\n    // Also set cookie as fallback\r\n    setCookie(SESSION_CONFIG.COOKIE_NAME, expiryISO, duration);\r\n    \r\n    console.log(` Session expiry set to: ${expiry.toLocaleString()} (${Math.ceil(duration / (1000 * 60 * 60 * 24))} days)`);\r\n    \r\n    return expiryISO;\r\n  } catch (error) {\r\n    console.error(' Error setting session expiry:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Extend existing session (bump expiry forward)\r\n * Called on user activity to keep session alive\r\n * @param {number} duration - Duration in milliseconds (default: 30 days)\r\n */\r\nexport function extendSession(duration = SESSION_CONFIG.DEFAULT_SESSION_DURATION) {\r\n  if (isSessionValid()) {\r\n    setSessionExpiry(duration);\r\n    console.log(' Session extended');\r\n  }\r\n}\r\n\r\n/**\r\n * Validate JWT token by decoding and checking expiration\r\n * @param {string} token - JWT token\r\n * @returns {Object} { valid: boolean, payload: object|null, error: string|null }\r\n */\r\nexport function validateToken(token) {\r\n  try {\r\n    if (!token) {\r\n      return { valid: false, payload: null, error: 'No token provided' };\r\n    }\r\n    \r\n    // Decode JWT (don't verify signature - backend will do that)\r\n    const parts = token.split('.');\r\n    if (parts.length !== 3) {\r\n      return { valid: false, payload: null, error: 'Invalid token format' };\r\n    }\r\n    \r\n    const payload = JSON.parse(atob(parts[1]));\r\n    \r\n    // Check if token has required fields\r\n    if (!payload.email && !payload.id && !payload.userId && !payload.sub) {\r\n      return { valid: false, payload: null, error: 'Token missing user identifier' };\r\n    }\r\n    \r\n    // Check token expiration if present\r\n    if (payload.exp) {\r\n      const now = Math.floor(Date.now() / 1000);\r\n      if (now >= payload.exp) {\r\n        return { valid: false, payload, error: 'Token expired' };\r\n      }\r\n    }\r\n    \r\n    return { valid: true, payload, error: null };\r\n  } catch (error) {\r\n    console.error(' Error validating token:', error);\r\n    return { valid: false, payload: null, error: error.message };\r\n  }\r\n}\r\n\r\n/**\r\n * Get stored authentication token\r\n * @returns {string|null} JWT token or null\r\n */\r\nexport function getStoredToken() {\r\n  try {\r\n    // Try localStorage first\r\n    let token = localStorage.getItem(SESSION_CONFIG.STORAGE_KEYS.USER_TOKEN);\r\n    \r\n    // Fallback to userData.token\r\n    if (!token) {\r\n      const userData = localStorage.getItem(SESSION_CONFIG.STORAGE_KEYS.USER_DATA);\r\n      if (userData) {\r\n        const parsed = JSON.parse(userData);\r\n        token = parsed.token;\r\n      }\r\n    }\r\n    \r\n    // Fallback to cookie\r\n    if (!token) {\r\n      token = getCookie('onairos_token');\r\n    }\r\n    \r\n    return token;\r\n  } catch (error) {\r\n    console.error(' Error getting stored token:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has a valid session (can skip login)\r\n * @returns {Object} { hasSession: boolean, userData: object|null, shouldSkipLogin: boolean }\r\n */\r\nexport function checkValidSession() {\r\n  try {\r\n    // Check if session is expired\r\n    if (!isSessionValid()) {\r\n      console.log(' Session expired - user must re-authenticate');\r\n      return { hasSession: false, userData: null, shouldSkipLogin: false };\r\n    }\r\n    \r\n    // Get user data\r\n    const userDataStr = localStorage.getItem(SESSION_CONFIG.STORAGE_KEYS.USER_DATA);\r\n    if (!userDataStr) {\r\n      console.log(' No user data found');\r\n      return { hasSession: false, userData: null, shouldSkipLogin: false };\r\n    }\r\n    \r\n    const userData = JSON.parse(userDataStr);\r\n    \r\n    // Check if user completed onboarding and PIN\r\n    if (!userData.onboardingComplete || !userData.pinCreated) {\r\n      console.log(' User session exists but onboarding incomplete');\r\n      return { hasSession: true, userData, shouldSkipLogin: false };\r\n    }\r\n    \r\n    // Validate token if present\r\n    const token = getStoredToken();\r\n    if (token) {\r\n      const validation = validateToken(token);\r\n      if (!validation.valid) {\r\n        console.log(` Token invalid: ${validation.error}`);\r\n        return { hasSession: true, userData, shouldSkipLogin: false };\r\n      }\r\n    }\r\n    \r\n    console.log(' Valid session found - can skip login!');\r\n    console.log(`   User: ${userData.email || userData.username}`);\r\n    console.log(`   Expiry: ${getSessionExpiry()}`);\r\n    \r\n    return {\r\n      hasSession: true,\r\n      userData,\r\n      shouldSkipLogin: true\r\n    };\r\n  } catch (error) {\r\n    console.error(' Error checking valid session:', error);\r\n    return { hasSession: false, userData: null, shouldSkipLogin: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Create or update session after successful login\r\n * @param {Object} userData - User data object\r\n * @param {string} token - JWT token\r\n * @param {number} duration - Session duration in milliseconds (default: 30 days)\r\n */\r\nexport function createSession(userData, token = null, duration = SESSION_CONFIG.DEFAULT_SESSION_DURATION) {\r\n  try {\r\n    console.log(' Creating persistent session...');\r\n    \r\n    // Add session metadata\r\n    const sessionData = {\r\n      ...userData,\r\n      token: token || userData.token,\r\n      lastSessionTime: new Date().toISOString(),\r\n      sessionCreatedAt: new Date().toISOString()\r\n    };\r\n    \r\n    // Save to localStorage\r\n    localStorage.setItem(SESSION_CONFIG.STORAGE_KEYS.USER_DATA, JSON.stringify(sessionData));\r\n    \r\n    if (sessionData.token) {\r\n      localStorage.setItem(SESSION_CONFIG.STORAGE_KEYS.USER_TOKEN, sessionData.token);\r\n      // Also set token cookie\r\n      setCookie('onairos_token', sessionData.token, duration);\r\n    }\r\n    \r\n    // Set session expiry\r\n    setSessionExpiry(duration);\r\n    \r\n    console.log(' Session created successfully');\r\n    console.log(`   Duration: ${Math.ceil(duration / (1000 * 60 * 60 * 24))} days`);\r\n    console.log(`   User: ${sessionData.email || sessionData.username}`);\r\n    \r\n    return sessionData;\r\n  } catch (error) {\r\n    console.error(' Error creating session:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Destroy current session (logout)\r\n */\r\nexport function destroySession() {\r\n  try {\r\n    console.log(' Destroying session...');\r\n    \r\n    // Clear localStorage\r\n    localStorage.removeItem(SESSION_CONFIG.STORAGE_KEYS.USER_DATA);\r\n    localStorage.removeItem(SESSION_CONFIG.STORAGE_KEYS.USER_TOKEN);\r\n    localStorage.removeItem(SESSION_CONFIG.STORAGE_KEYS.SESSION_EXPIRY);\r\n    \r\n    // Clear cookies\r\n    deleteCookie(SESSION_CONFIG.COOKIE_NAME);\r\n    deleteCookie('onairos_token');\r\n    \r\n    // Clear sessionStorage\r\n    sessionStorage.clear();\r\n    \r\n    console.log(' Session destroyed');\r\n  } catch (error) {\r\n    console.error(' Error destroying session:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh session on user activity (bump expiry forward)\r\n */\r\nexport function refreshSessionOnActivity() {\r\n  if (isSessionValid()) {\r\n    extendSession();\r\n  }\r\n}\r\n\r\n// ============================================\r\n// Cookie Utilities (Fallback for localStorage)\r\n// ============================================\r\n\r\n/**\r\n * Set a cookie\r\n * @param {string} name - Cookie name\r\n * @param {string} value - Cookie value\r\n * @param {number} maxAge - Max age in milliseconds\r\n */\r\nfunction setCookie(name, value, maxAge = SESSION_CONFIG.DEFAULT_SESSION_DURATION) {\r\n  try {\r\n    const maxAgeSeconds = Math.floor(maxAge / 1000);\r\n    const secure = window.location.protocol === 'https:' ? '; Secure' : '';\r\n    const sameSite = '; SameSite=Lax';\r\n    \r\n    document.cookie = `${name}=${encodeURIComponent(value)}; max-age=${maxAgeSeconds}; path=/${secure}${sameSite}`;\r\n  } catch (error) {\r\n    console.warn(' Could not set cookie:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get a cookie value\r\n * @param {string} name - Cookie name\r\n * @returns {string|null} Cookie value or null\r\n */\r\nfunction getCookie(name) {\r\n  try {\r\n    const nameEQ = name + '=';\r\n    const ca = document.cookie.split(';');\r\n    \r\n    for (let i = 0; i < ca.length; i++) {\r\n      let c = ca[i];\r\n      while (c.charAt(0) === ' ') c = c.substring(1, c.length);\r\n      if (c.indexOf(nameEQ) === 0) {\r\n        return decodeURIComponent(c.substring(nameEQ.length, c.length));\r\n      }\r\n    }\r\n    \r\n    return null;\r\n  } catch (error) {\r\n    console.warn(' Could not get cookie:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a cookie\r\n * @param {string} name - Cookie name\r\n */\r\nfunction deleteCookie(name) {\r\n  try {\r\n    document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\r\n  } catch (error) {\r\n    console.warn(' Could not delete cookie:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get session duration options\r\n * @returns {Object} Duration options in milliseconds\r\n */\r\nexport function getSessionDurations() {\r\n  return {\r\n    SHORT: SESSION_CONFIG.SHORT_SESSION_DURATION,   // 7 days\r\n    DEFAULT: SESSION_CONFIG.DEFAULT_SESSION_DURATION, // 30 days\r\n    CUSTOM: (days) => days * 24 * 60 * 60 * 1000\r\n  };\r\n}\r\n\r\n/**\r\n * Get session info for debugging\r\n * @returns {Object} Session information\r\n */\r\nexport function getSessionInfo() {\r\n  const expiry = getSessionExpiry();\r\n  const isValid = isSessionValid(expiry);\r\n  const token = getStoredToken();\r\n  const tokenValidation = token ? validateToken(token) : { valid: false };\r\n  \r\n  return {\r\n    hasExpiry: !!expiry,\r\n    expiry: expiry,\r\n    isValid: isValid,\r\n    hasToken: !!token,\r\n    tokenValid: tokenValidation.valid,\r\n    tokenPayload: tokenValidation.payload,\r\n    daysRemaining: expiry ? Math.ceil((new Date(expiry) - new Date()) / (1000 * 60 * 60 * 24)) : 0\r\n  };\r\n}\r\n\r\nexport default {\r\n  isSessionValid,\r\n  getSessionExpiry,\r\n  setSessionExpiry,\r\n  extendSession,\r\n  validateToken,\r\n  getStoredToken,\r\n  checkValidSession,\r\n  createSession,\r\n  destroySession,\r\n  refreshSessionOnActivity,\r\n  getSessionDurations,\r\n  getSessionInfo,\r\n  SESSION_CONFIG\r\n};\r\n\r\n","import React, { useEffect, useState } from 'react';\r\nimport { App } from '@capacitor/app';\r\nimport { Browser } from '@capacitor/browser';\r\nimport WelcomeScreen from './components/WelcomeScreen.jsx';\r\nimport EmailAuth from './components/EmailAuth.js';\r\nimport UniversalOnboarding from './components/UniversalOnboarding.jsx';\r\nimport PinSetup from './components/PinSetup.js';\r\nimport DataRequest from './components/DataRequest.js';\r\nimport TrainingComponent from './components/TrainingComponent.jsx';\r\nimport TrainingScreen from './components/TrainingScreen.jsx';\r\nimport LoadingScreen from './components/LoadingScreen.jsx';\r\nimport WrappedLoadingPage from './components/WrappedLoadingPage.jsx';\r\nimport { formatOnairosResponse } from './utils/responseFormatter.js';\r\nimport { logOnairosResponse } from './utils/apiResponseLogger.js';\r\nimport { logFormattedUserData } from './utils/userDataFormatter.js';\r\nimport { ModalPageLayout } from './components/ui/PageLayout.jsx';\r\nimport { isMobileApp, isMobileBrowser } from './utils/capacitorDetection.js';\r\nimport { checkValidSession, createSession, isSessionValid, extendSession, destroySession } from './utils/sessionManager.js';\r\n\r\nexport function OnairosButton({\r\n  requestData, \r\n  webpageName, \r\n  inferenceData = null, \r\n  onComplete = null, \r\n  autoFetch = true, // Auto-enabled for seamless testing experience\r\n  testMode = false, // Production mode by default - set to true for testing\r\n  proofMode = false, \r\n  textLayout = 'below', \r\n  textColor = 'white',\r\n  login = false,\r\n  buttonType = 'pill',\r\n  loginReturn = null,\r\n  loginType = 'signIn',\r\n  visualType = 'full',\r\n  appIcon = null,\r\n  enableTraining = true,\r\n  formatResponse = true,\r\n  responseFormat = { includeDictionary: true, includeArray: true },\r\n  priorityPlatform = null, // Platform to prioritize (e.g., 'gmail', 'pinterest', 'linkedin')\r\n  rawMemoriesOnly = false, // Show only LLM connections when true\r\n  rawMemoriesConfig = null, // Configuration for RAW memories collection\r\n  time = false // Show time frequency slider (default: false)\r\n}) {\r\n\r\n  const [showOverlay, setShowOverlay] = useState(false);\r\n  const [currentFlow, setCurrentFlow] = useState('welcome'); // 'welcome' | 'email' | 'onboarding' | 'pin' | 'trainingScreen' | 'dataRequest' | 'wrappedLoading'\r\n  const [trainingHasStarted, setTrainingHasStarted] = useState(false);\r\n  const [userData, setUserData] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [oauthReturnDetected, setOauthReturnDetected] = useState(false);\r\n  const [returnToDataRequestAfterOnboarding, setReturnToDataRequestAfterOnboarding] = useState(false);\r\n  \r\n  // Detect mobile for conditional styling (MOBILE ONLY changes)\r\n  // Use a safer check that doesn't rely on window/navigator being immediately available\r\n  const [isMobileDevice, setIsMobileDevice] = useState(false);\r\n  \r\n  useEffect(() => {\r\n    // Determine mobile vs desktop based on viewport width + native runtime,\r\n    // and keep it updated on resize.\r\n    const computeMobile = () => {\r\n      try {\r\n        const hasWindow = typeof window !== 'undefined';\r\n        if (!hasWindow) {\r\n          setIsMobileDevice(false);\r\n          return;\r\n        }\r\n\r\n        // Base width from current window\r\n        let width = window.innerWidth || document.documentElement?.clientWidth || document.body?.clientWidth || 0;\r\n\r\n        // If running inside an iframe, try to use the parent window width as well\r\n        // so desktop pages embedding the SDK don't get misclassified as mobile.\r\n        try {\r\n          if (window.parent && window.parent !== window && window.parent.innerWidth) {\r\n            width = Math.max(width, window.parent.innerWidth);\r\n          }\r\n        } catch (_) {\r\n          // Cross-origin access can fail; ignore and fall back to local width.\r\n        }\r\n\r\n        const isCapNative = !!window.Capacitor?.isNativePlatform?.();\r\n\r\n        //  Final, explicit rule:\r\n        // - Capacitor native: ALWAYS mobile\r\n        // - Otherwise: viewport < 1024px (taking parent if available)  mobile; >= 1024px  desktop\r\n        const detectedMobile = isCapNative || width < 1024;\r\n\r\n        console.log('[Onairos SDK][Layout][MobileDetection simple]', {\r\n          width,\r\n          isCapNative,\r\n          detectedMobile,\r\n        });\r\n\r\n        setIsMobileDevice(detectedMobile);\r\n      } catch (e) {\r\n        setIsMobileDevice(false);\r\n      }\r\n    };\r\n\r\n    computeMobile();\r\n\r\n    // Desktop resize listener to keep classification accurate when user resizes window.\r\n    // This runs in all environments, but the rule above ensures iPhone/Capacitor\r\n    // keep their correct classification.\r\n    if (typeof window !== 'undefined') {\r\n      window.addEventListener('resize', computeMobile);\r\n      return () => window.removeEventListener('resize', computeMobile);\r\n    }\r\n  }, []);\r\n\r\n  // Lock background scroll on DESKTOP while modal is open (do not touch mobile/Capacitor)\r\n  useEffect(() => {\r\n    if (typeof document === 'undefined') return;\r\n\r\n    const body = document.body;\r\n    if (!body) return;\r\n\r\n    if (showOverlay && !isMobileDevice) {\r\n      // Remember previous overflow so we can restore it precisely\r\n      if (!body.dataset.onairosPrevOverflow) {\r\n        body.dataset.onairosPrevOverflow = body.style.overflow || '';\r\n      }\r\n      body.style.overflow = 'hidden';\r\n    } else {\r\n      // Restore previous overflow when modal closes or when switching back to mobile\r\n      if (body.dataset.onairosPrevOverflow !== undefined) {\r\n        body.style.overflow = body.dataset.onairosPrevOverflow;\r\n        delete body.dataset.onairosPrevOverflow;\r\n      }\r\n    }\r\n  }, [showOverlay, isMobileDevice]);\r\n\r\n  //  High-level layout debug for desktop vs mobile\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const width = window.innerWidth;\r\n    const isDesktop = width >= 1024 && !isMobileDevice;\r\n    console.log('[Onairos SDK][Layout][OnairosButton state]', {\r\n      width,\r\n      isDesktop,\r\n      isMobileDevice,\r\n      currentFlow,\r\n      showOverlay,\r\n    });\r\n  }, [isMobileDevice, currentFlow, showOverlay]);\r\n\r\n  //  DOM-level layout debug (only on desktop web)\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const width = window.innerWidth;\r\n    const isDesktopWeb = width >= 1024 && !isMobileDevice && !window.Capacitor?.isNativePlatform?.();\r\n    if (!isDesktopWeb || !showOverlay) return;\r\n\r\n    // Defer to allow React layout to flush\r\n    const id = window.setTimeout(() => {\r\n      try {\r\n        const modal = document.querySelector('.onairos-modal');\r\n        const pageContent = document.querySelector('.onairos-page-content');\r\n        const shell = document.querySelector('.onairos-modal-shell');\r\n\r\n        const getMetrics = (el) => {\r\n          if (!el) return null;\r\n          const rect = el.getBoundingClientRect();\r\n          const styles = window.getComputedStyle(el);\r\n          return {\r\n            width: rect.width,\r\n            height: rect.height,\r\n            maxWidth: styles.maxWidth,\r\n            paddingInline: styles.paddingLeft + ' / ' + styles.paddingRight,\r\n            classList: Array.from(el.classList || []),\r\n          };\r\n        };\r\n\r\n        console.log('[Onairos SDK][Layout][DOM snapshot]', {\r\n          currentFlow,\r\n          viewportWidth: width,\r\n          modal: getMetrics(modal),\r\n          pageContent: getMetrics(pageContent),\r\n          shell: getMetrics(shell),\r\n        });\r\n      } catch (e) {\r\n        console.log('[Onairos SDK][Layout][DOM snapshot] failed', e?.message);\r\n      }\r\n    }, 0);\r\n\r\n    return () => window.clearTimeout(id);\r\n  }, [currentFlow, showOverlay, isMobileDevice]);\r\n  \r\n  // Logic to process return URLs (Login & Connectors)\r\n  const handleDeepLink = (url) => {\r\n      try {\r\n        console.log(' Checking URL for OAuth return:', url);\r\n        \r\n        // Normalize URL to check for params\r\n        // For native apps, url might be 'mobiletest://oauth-callback?success=true...'\r\n        // Also check specifically for Reddit's return format or other providers\r\n        const hasSuccess = url.includes('success=true') || \r\n                          url.includes('onairos_oauth_success=true') ||\r\n                          (url.includes('state=') && url.includes('code='));\r\n        \r\n        const hasError = url.includes('error=') || url.includes('onairos_oauth_error=');\r\n        const isPopup = url.includes('is_popup=true'); // Check for our custom flag\r\n        \r\n        // Safety Check: If we are running inside a popup or iframe (desktop), we should close ourselves\r\n        // and notify the parent. This happens if the callback redirected instead of closing.\r\n        // We check for window.opener, parent!=window, OR our explicit is_popup flag\r\n        if ((hasSuccess || hasError) && typeof window !== 'undefined' && \r\n            (window.opener || window.parent !== window || isPopup)) {\r\n             console.log(' App loaded inside OAuth popup/iframe (detected via opener/parent/flag) - closing');\r\n             \r\n             // Extract params for storage/message\r\n             let params;\r\n             try {\r\n                const qIdx = url.indexOf('?');\r\n                if (qIdx !== -1) params = new URLSearchParams(url.substring(qIdx + 1));\r\n                else params = new URL(url).searchParams;\r\n             } catch(e) { params = new URLSearchParams(''); }\r\n             \r\n             const platform = params.get('platform') || params.get('onairos_oauth_platform');\r\n             const email = params.get('email') || params.get('onairos_oauth_email');\r\n             \r\n             // 1. Write to LocalStorage (Same Origin as Parent) - Primary mechanism for cross-origin flow fallback\r\n             if (hasSuccess && platform) {\r\n                 localStorage.setItem(`onairos_${platform}_success`, 'true');\r\n                 localStorage.setItem(`onairos_${platform}_timestamp`, Date.now().toString());\r\n                 if (email) localStorage.setItem(`onairos_${platform}_email`, email);\r\n             }\r\n             \r\n             // 2. Try postMessage (only works if opener exists)\r\n             try {\r\n                const target = window.opener || window.parent;\r\n                if (target) {\r\n                    target.postMessage({\r\n                        type: hasSuccess ? 'oauth-success' : 'oauth-error',\r\n                        platform: platform,\r\n                        email: email,\r\n                        error: params.get('error'),\r\n                        success: !!hasSuccess\r\n                    }, '*');\r\n                }\r\n             } catch (e) {}\r\n\r\n             // 3. Close window\r\n             window.close();\r\n             // If window.close() is blocked (scripts can't close windows they didn't open),\r\n             // show a message asking user to close.\r\n             setTimeout(() => {\r\n                 document.body.innerHTML = '<div style=\"display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;font-family:sans-serif;\"><h1>Success!</h1><p>You can close this window now.</p><button onclick=\"window.close()\" style=\"padding:10px 20px;margin-top:20px;cursor:pointer;\">Close Window</button></div>';\r\n             }, 500);\r\n             \r\n             return; // Stop execution here\r\n        }\r\n        \r\n        if (hasError) {\r\n           console.log(' Deep link/OAuth error detected:', url);\r\n\r\n           // Close browser if open (Capacitor)\r\n           Browser.close().catch(() => {});\r\n\r\n           // Extract params from URL\r\n           let params;\r\n           try {\r\n             const qIdx = url.indexOf('?');\r\n             if (qIdx !== -1) params = new URLSearchParams(url.substring(qIdx + 1));\r\n             else params = new URL(url).searchParams;\r\n           } catch (e) {\r\n             params = new URLSearchParams(url.split('?')[1] || '');\r\n           }\r\n\r\n           const platform = params.get('platform') || params.get('onairos_oauth_platform') || 'unknown';\r\n           const errMsg = params.get('error') || params.get('onairos_oauth_error') || 'Unknown error';\r\n\r\n           // Persist error signal for components that poll localStorage (desktop popup flows)\r\n           try {\r\n             localStorage.setItem(`onairos_${platform}_error`, errMsg);\r\n             localStorage.setItem(`onairos_${platform}_timestamp`, Date.now().toString());\r\n           } catch (_) {}\r\n\r\n           // Session signal so UniversalOnboarding can react after a mobile redirect\r\n           try {\r\n             sessionStorage.setItem('onairos_oauth_return_success', 'false');\r\n             sessionStorage.setItem('onairos_oauth_return_platform', platform);\r\n             sessionStorage.setItem('onairos_oauth_return_error', errMsg);\r\n           } catch (_) {}\r\n\r\n           // Re-open the SDK modal on Universal Onboarding immediately\r\n           setOauthReturnDetected(true);\r\n           setShowOverlay(true);\r\n           setCurrentFlow('onboarding');\r\n\r\n           // Clean up URL if possible (on web)\r\n           if (window.history && window.history.replaceState && url.startsWith('http')) {\r\n             const cleanUrl = window.location.pathname;\r\n             window.history.replaceState({}, '', cleanUrl);\r\n           }\r\n\r\n           return;\r\n        }\r\n\r\n        if (hasSuccess) {\r\n           console.log(' Deep link/OAuth return detected:', url);\r\n           \r\n           // Close browser if open (Capacitor) - Important for Native\r\n           Browser.close().catch(() => {});\r\n\r\n           // Extract params from URL\r\n           let params;\r\n           try {\r\n             // Handle custom schemes that URL() constructor might reject if not fully standard\r\n             const questionMarkIndex = url.indexOf('?');\r\n             if (questionMarkIndex !== -1) {\r\n                params = new URLSearchParams(url.substring(questionMarkIndex + 1));\r\n             } else {\r\n                params = new URL(url).searchParams;\r\n             }\r\n           } catch (e) {\r\n             console.warn('URL parsing failed, trying fallback split:', e);\r\n             params = new URLSearchParams(url.split('?')[1] || '');\r\n           }\r\n\r\n           let platform = params.get('platform') || params.get('onairos_oauth_platform') || 'google';\r\n           let email = params.get('email') || params.get('onairos_oauth_email');\r\n           \r\n           // Fallback for Reddit/others that might rely on state\r\n           if (!platform || platform === 'null') {\r\n              const state = params.get('state');\r\n              if (state) {\r\n                 try {\r\n                    // Try to decode state if it's base64\r\n                    const decoded = JSON.parse(atob(state));\r\n                    if (decoded.connectionType) platform = decoded.connectionType;\r\n                    if (decoded.username) email = decoded.username; // Sometimes username is email\r\n                 } catch (e) {\r\n                    console.log('State decoding failed (not base64 JSON or invalid)');\r\n                 }\r\n              }\r\n           }\r\n\r\n           if (email) email = decodeURIComponent(email);\r\n           \r\n           console.log(` Detected return from ${platform} for ${email || 'unknown user'}`);\r\n           \r\n           // Set state to restore flow\r\n           setOauthReturnDetected(true);\r\n           \r\n           // 1. SUPPORT UNIVERSAL ONBOARDING (YouTube, LinkedIn, Reddit, etc.)\r\n           sessionStorage.setItem('onairos_oauth_return_success', 'true');\r\n           sessionStorage.setItem('onairos_oauth_return_platform', platform);\r\n\r\n           // Dispatch event to update UI immediately if component is mounted\r\n           if (typeof window !== 'undefined') {\r\n             window.dispatchEvent(new CustomEvent('onairos-oauth-success', { \r\n               detail: { platform: platform, email: email } \r\n             }));\r\n           }\r\n           \r\n           if (platform) {\r\n             localStorage.setItem(`onairos_${platform}_success`, 'true');\r\n             localStorage.setItem(`onairos_${platform}_timestamp`, Date.now().toString());\r\n           }\r\n\r\n           // 2. SUPPORT EMAIL AUTH (Gmail)\r\n           if (platform === 'google' || platform === 'gmail') {\r\n             localStorage.setItem('onairos_gmail_success', 'true');\r\n             localStorage.setItem('onairos_gmail_timestamp', Date.now().toString());\r\n             if (email) localStorage.setItem('onairos_gmail_email', email);\r\n           }\r\n           \r\n           // Restore session\r\n           if (email) {\r\n             // MERGE with existing userData to preserve connectedAccounts\r\n             const existingUserData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n             const userData = {\r\n                ...existingUserData, // Preserve existing data (like connectedAccounts)\r\n                email: email,\r\n                verified: true,\r\n                onboardingComplete: false,\r\n                provider: platform\r\n             };\r\n             console.log(' Merging OAuth return with existing userData:', { existing: existingUserData.connectedAccounts, merged: userData.connectedAccounts });\r\n             localStorage.setItem('onairosUser', JSON.stringify(userData));\r\n             setUserData(userData);\r\n           } else {\r\n             // CRITICAL: If no email in URL, attempt to restore from existing session\r\n             // This prevents losing the user identity during OAuth flows that don't return email\r\n             try {\r\n                const existingUser = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n                if (existingUser && (existingUser.email || existingUser.username)) {\r\n                    console.log(' Restored existing user session during OAuth return (no email in URL)');\r\n                    setUserData(existingUser);\r\n                } else {\r\n                    console.warn(' OAuth return without email and no existing session found');\r\n                }\r\n             } catch (e) {\r\n                 console.error(' Failed to restore session during OAuth return:', e);\r\n             }\r\n           }\r\n           \r\n           // Open modal and go to onboarding immediately\r\n           setShowOverlay(true);\r\n           setCurrentFlow('onboarding');\r\n           \r\n           // Clean up URL if possible (on web)\r\n           if (window.history && window.history.replaceState && url.startsWith('http')) {\r\n             const cleanUrl = window.location.pathname;\r\n             window.history.replaceState({}, '', cleanUrl);\r\n           }\r\n        }\r\n      } catch (e) {\r\n        console.error('Error handling deep link:', e);\r\n      }\r\n  };\r\n\r\n  // Native Deep Link Listener (Runs once, stays active)\r\n  useEffect(() => {\r\n    let appListener = null;\r\n    const setupListener = async () => {\r\n      // Only run on native platforms (iOS/Android)\r\n      const isNative = typeof window !== 'undefined' && window.Capacitor?.isNativePlatform?.();\r\n      if (!isNative) return;\r\n\r\n      let AppPlugin = App;\r\n      if (!AppPlugin || !AppPlugin.addListener) {\r\n        if (typeof window !== 'undefined' && window.Capacitor?.Plugins?.App) {\r\n          AppPlugin = window.Capacitor.Plugins.App;\r\n        }\r\n      }\r\n\r\n      if (!AppPlugin || !AppPlugin.addListener) {\r\n         console.warn(' App plugin not found for deep linking listener');\r\n         return;\r\n      }\r\n\r\n      try {\r\n        appListener = await AppPlugin.addListener('appUrlOpen', (data) => {\r\n          console.log(' Native deep link received:', data.url);\r\n          handleDeepLink(data.url);\r\n        });\r\n        console.log(' App deep link listener registered successfully');\r\n      } catch (e) {\r\n        console.warn(' Failed to setup App listener:', e);\r\n      }\r\n    };\r\n    setupListener();\r\n    \r\n    return () => {\r\n      if (appListener) appListener.remove();\r\n    };\r\n  }, []);\r\n\r\n  // Web/Initial Check (Respects oauthReturnDetected)\r\n  useEffect(() => {\r\n    if (oauthReturnDetected) return;\r\n    \r\n    handleDeepLink(window.location.href);\r\n    \r\n    const checkWindowUrl = () => handleDeepLink(window.location.href);\r\n    window.addEventListener('popstate', checkWindowUrl);\r\n    \r\n    return () => window.removeEventListener('popstate', checkWindowUrl);\r\n  }, [oauthReturnDetected]);\r\n\r\n  // Check for existing user session with token validation\r\n  useEffect(() => {\r\n    const checkExistingSession = () => {\r\n      // If we are in an OAuth return flow (URL params present), DO NOT restore session yet.\r\n      // Let checkOAuthReturn handle the state setup and flow direction (to 'onboarding').\r\n      // This prevents a race condition where checkExistingSession forces 'dataRequest' (due to onboardingComplete=true)\r\n      // before we've had a chance to show the \"Connected!\" state in UniversalOnboarding.\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      if (urlParams.get('onairos_oauth_success') === 'true') {\r\n        console.log(' checkExistingSession aborted - OAuth return detected in URL');\r\n        return;\r\n      }\r\n\r\n      // Also check for localStorage OAuth markers (for same-domain redirects that cleared URL)\r\n      // BUT exclude gmail auth flow (which should proceed normally)\r\n      if (localStorage.getItem('onairos_oauth_context') === 'platform-connector') {\r\n         // Check if we have a recent success signal\r\n         const platform = localStorage.getItem('onairos_oauth_platform');\r\n         if (platform) {\r\n            const success = localStorage.getItem(`onairos_${platform}_success`);\r\n            if (success === 'true') {\r\n               console.log(' checkExistingSession aborted - Platform OAuth success marker found');\r\n               return;\r\n            }\r\n         }\r\n      }\r\n\r\n      // In test mode, always start fresh to see the full flow\r\n      if (testMode) {\r\n        console.log(' Test mode: Starting fresh flow, clearing any cached user data');\r\n        localStorage.removeItem('onairosUser');\r\n        setCurrentFlow('welcome');\r\n        return;\r\n      }\r\n      \r\n      // If we just kicked off an OAuth connector flow, force return into onboarding\r\n      // so users can connect multiple apps without getting bounced to DataRequest.\r\n      const postOAuthFlow = (() => {\r\n        try { return localStorage.getItem('onairos_post_oauth_flow'); } catch { return null; }\r\n      })();\r\n      if (postOAuthFlow === 'onboarding') {\r\n        try { localStorage.removeItem('onairos_post_oauth_flow'); } catch {}\r\n        const savedUser = localStorage.getItem('onairosUser');\r\n        if (savedUser) {\r\n          try { setUserData(JSON.parse(savedUser)); } catch {}\r\n        }\r\n        setShowOverlay(true);\r\n        setCurrentFlow('onboarding');\r\n        return;\r\n      }\r\n      \r\n      // ============================================\r\n      // NEW: Enhanced session validation with token checking\r\n      // ============================================\r\n      console.log(' Checking for valid session (with token validation)...');\r\n      const sessionCheck = checkValidSession();\r\n      \r\n      if (sessionCheck.shouldSkipLogin) {\r\n        // Valid session found - skip login and go straight to data request!\r\n        console.log(' Valid session found - skipping login!');\r\n        console.log(`   User: ${sessionCheck.userData.email || sessionCheck.userData.username}`);\r\n        \r\n        // Clean wrapped data if needed\r\n        const user = sessionCheck.userData;\r\n        if (webpageName && webpageName.toLowerCase().includes('wrapped')) {\r\n          if (user.apiResponse || user.lastDataRequest) {\r\n            console.log(' Cleaning old wrapped data from session to force fresh state');\r\n            delete user.apiResponse;\r\n          }\r\n        }\r\n        \r\n        // Extend session on activity (bump expiry forward)\r\n        extendSession();\r\n        \r\n        setUserData(user);\r\n        setCurrentFlow('dataRequest');\r\n        return;\r\n      }\r\n      \r\n      // Session exists but incomplete or expired\r\n      if (sessionCheck.hasSession && !sessionCheck.shouldSkipLogin) {\r\n        console.log(' Session exists but incomplete or expired');\r\n        const user = sessionCheck.userData;\r\n        \r\n        // Check if session is expired\r\n        if (!isSessionValid()) {\r\n          console.log(' Session expired - user must re-authenticate');\r\n          localStorage.removeItem('onairosUser');\r\n          localStorage.removeItem('onairos_user_token');\r\n          localStorage.removeItem('onairos_session_expiry');\r\n          setCurrentFlow('welcome');\r\n          return;\r\n        }\r\n        \r\n        // Session valid but onboarding incomplete\r\n        setUserData(user);\r\n        if (user.verified && !user.onboardingComplete) {\r\n          setCurrentFlow('onboarding');\r\n        } else if (user.onboardingComplete && !user.pinCreated) {\r\n          setCurrentFlow('pin');\r\n        } else {\r\n          setCurrentFlow('welcome');\r\n        }\r\n      }\r\n    };\r\n\r\n    checkExistingSession();\r\n  }, [testMode, webpageName]);\r\n\r\n  // Check for OAuth return (Google login redirect back)\r\n  useEffect(() => {\r\n    if (oauthReturnDetected) return; // Prevent double-processing\r\n    \r\n    const checkOAuthReturn = () => {\r\n      // Check URL params for OAuth completion\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const oauthSuccess = urlParams.get('onairos_oauth_success');\r\n      const oauthPlatform = urlParams.get('onairos_oauth_platform');\r\n      const oauthEmail = urlParams.get('onairos_oauth_email');\r\n\r\n      // Check for generic OAuth return (any platform)\r\n      if (oauthSuccess === 'true' && oauthPlatform) {\r\n        setOauthReturnDetected(true);\r\n        \r\n        // Clean up URL\r\n        const newUrl = window.location.pathname;\r\n        window.history.replaceState({}, '', newUrl);\r\n        \r\n        if (oauthPlatform === 'gmail' && oauthEmail) {\r\n          console.log(' Gmail OAuth return detected in URL params');\r\n          \r\n          // Create user data from OAuth\r\n          const authData = {\r\n            email: oauthEmail,\r\n            verified: true,\r\n            isNewUser: true, // Assume new user for now, backend will correct this\r\n            provider: 'google'\r\n          };\r\n          \r\n          // Save to localStorage - MERGE with existing to preserve connectedAccounts\r\n          const existingUserData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n          const userData = {\r\n            ...existingUserData, // Preserve existing data (like connectedAccounts)\r\n            email: oauthEmail,\r\n            verified: true,\r\n            onboardingComplete: false,\r\n            provider: 'google'\r\n          };\r\n          console.log(' Merging Google OAuth with existing userData:', { existing: existingUserData.connectedAccounts, merged: userData.connectedAccounts });\r\n          localStorage.setItem('onairosUser', JSON.stringify(userData));\r\n          setUserData(userData);\r\n          \r\n          // Open modal and go to onboarding\r\n          setShowOverlay(true);\r\n          setCurrentFlow('onboarding');\r\n          \r\n          // Clean up OAuth localStorage\r\n          localStorage.removeItem('onairos_gmail_success');\r\n          localStorage.removeItem('onairos_gmail_timestamp');\r\n          localStorage.removeItem('onairos_oauth_email');\r\n          localStorage.removeItem('onairos_return_url');\r\n          localStorage.removeItem('onairos_oauth_context');\r\n          \r\n        } else {\r\n          // Other platforms (Universal Onboarding connectors)\r\n          console.log(` ${oauthPlatform} OAuth return detected - restoring onboarding flow`);\r\n          \r\n          // Ensure we have user session to show the modal correctly\r\n          // (User should already be logged in if they were connecting apps)\r\n          const savedUser = localStorage.getItem('onairosUser');\r\n          if (savedUser) {\r\n            setUserData(JSON.parse(savedUser));\r\n          }\r\n          \r\n          // Open modal and restore flow\r\n          setShowOverlay(true);\r\n          setCurrentFlow('onboarding');\r\n          \r\n          // Pass the success signal to UniversalOnboarding via a temporary storage flag\r\n          // that works even if cross-domain cleared the original context\r\n          sessionStorage.setItem('onairos_oauth_return_success', 'true');\r\n          sessionStorage.setItem('onairos_oauth_return_platform', oauthPlatform);\r\n        }\r\n        \r\n        return;\r\n      }\r\n\r\n      // Also check localStorage for OAuth completion (fallback)\r\n      const gmailSuccess = localStorage.getItem('onairos_gmail_success');\r\n      const gmailTimestamp = localStorage.getItem('onairos_gmail_timestamp');\r\n      const gmailEmail = localStorage.getItem('onairos_gmail_email') || localStorage.getItem('onairos_oauth_email');\r\n\r\n      if (gmailSuccess === 'true' && gmailTimestamp && gmailEmail) {\r\n        const now = Date.now();\r\n        const timestamp = parseInt(gmailTimestamp, 10);\r\n        \r\n        // Only process if timestamp is recent (within last 60 seconds)\r\n        if (now - timestamp < 60000) {\r\n          console.log(' Gmail OAuth return detected in localStorage');\r\n          setOauthReturnDetected(true);\r\n          \r\n          // Create user data from OAuth - MERGE with existing to preserve connectedAccounts\r\n          const existingUserData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n          const userData = {\r\n            ...existingUserData, // Preserve existing data (like connectedAccounts)\r\n            email: gmailEmail,\r\n            verified: true,\r\n            onboardingComplete: false,\r\n            provider: 'google'\r\n          };\r\n          console.log(' Merging Gmail OAuth with existing userData:', { existing: existingUserData.connectedAccounts, merged: userData.connectedAccounts });\r\n          localStorage.setItem('onairosUser', JSON.stringify(userData));\r\n          setUserData(userData);\r\n          \r\n          // Open modal and go to onboarding\r\n          setShowOverlay(true);\r\n          setCurrentFlow('onboarding');\r\n          \r\n          // Clean up OAuth localStorage\r\n          localStorage.removeItem('onairos_gmail_success');\r\n          localStorage.removeItem('onairos_gmail_timestamp');\r\n          localStorage.removeItem('onairos_gmail_email');\r\n          localStorage.removeItem('onairos_oauth_email');\r\n          localStorage.removeItem('onairos_return_url');\r\n          localStorage.removeItem('onairos_oauth_context');\r\n        }\r\n      }\r\n    };\r\n\r\n    checkOAuthReturn();\r\n  }, [oauthReturnDetected]);\r\n\r\n  const openTerminal = async () => {\r\n    try {\r\n      console.log(' openTerminal called - resetting flow');\r\n      console.log(' testMode prop:', testMode);\r\n      console.log(' window.onairosApiKey:', window.onairosApiKey);\r\n      // ALWAYS reset flow on open to start fresh every time\r\n      setCurrentFlow('welcome');\r\n      setUserData(null);\r\n      try { localStorage.removeItem('onairosUser'); } catch {}\r\n        setShowOverlay(true);\r\n    } catch (error) {\r\n      console.error('Error in openTerminal:', error);\r\n    }\r\n  };\r\n\r\n  const handleCloseOverlay = () => {\r\n    setShowOverlay(false);\r\n    setError(null);\r\n    // Reset flow and session so next open starts fresh\r\n    setCurrentFlow('welcome');\r\n    try { localStorage.removeItem('onairosUser'); } catch {}\r\n    setUserData(null);\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    console.log(' User logout initiated');\r\n    \r\n    // ============================================\r\n    // NEW: Use session manager to destroy session\r\n    // ============================================\r\n    destroySession();\r\n    \r\n    // Clear additional OAuth-specific storage\r\n    try {\r\n      localStorage.removeItem('onairos_gmail_success');\r\n      localStorage.removeItem('onairos_gmail_timestamp');\r\n      localStorage.removeItem('onairos_gmail_email');\r\n      localStorage.removeItem('onairos_oauth_email');\r\n      localStorage.removeItem('onairos_return_url');\r\n      localStorage.removeItem('onairos_oauth_context');\r\n      localStorage.removeItem('onairos_post_oauth_flow');\r\n    } catch (e) {\r\n      console.warn(' Error clearing additional storage during logout:', e);\r\n    }\r\n    \r\n    // Reset component state\r\n    setUserData(null);\r\n    setError(null);\r\n    setCurrentFlow('welcome');\r\n    setOauthReturnDetected(false);\r\n    setReturnToDataRequestAfterOnboarding(false);\r\n    setTrainingHasStarted(false);\r\n    \r\n    // Close the overlay\r\n    setShowOverlay(false);\r\n    \r\n    console.log(' Logout complete - user session cleared');\r\n  };\r\n\r\n  // Handle clicks on the backdrop to close modal\r\n  const handleBackdropClick = (e) => {\r\n    if (e.target === e.currentTarget) {\r\n      handleCloseOverlay();\r\n    }\r\n  };\r\n\r\n  const handleWelcomeContinue = () => {\r\n    console.log(' Welcome screen continue clicked');\r\n    setCurrentFlow('email');\r\n  };\r\n\r\n  const handleEmailAuthSuccess = (authData) => {\r\n    console.log(' Email auth successful:', authData);\r\n    console.log(' User State:', {\r\n      isNewUser: authData.isNewUser,\r\n      userState: authData.userState,\r\n      flowType: authData.flowType,\r\n      existingUser: authData.existingUser,\r\n      hasAccountInfo: !!authData.accountInfo,\r\n      accountStatus: authData.accountStatus // NEW: Log accountStatus\r\n    });\r\n\r\n    // Save identity-bearing JWT immediately (email/id/userId/sub)\r\n    try {\r\n      const candidate = authData.jwtToken || authData.token || authData.accessToken;\r\n      if (candidate) {\r\n        const base64 = candidate.split('.')[1];\r\n        if (base64) {\r\n          const payload = JSON.parse(decodeURIComponent(atob(base64).split('').map(c => '%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join('')));\r\n          if (payload && (payload.email || payload.id || payload.userId || payload.sub)) {\r\n            try { localStorage.setItem('onairos_user_token', candidate); } catch {}\r\n            console.log(' [OnairosButton] Identity JWT saved from email auth');\r\n          } else {\r\n            console.warn(' [OnairosButton] Email auth returned minimal token (no id/email)');\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.warn(' [OnairosButton] Failed to parse/save email auth token');\r\n    }\r\n    \r\n    // SDK-ONLY USER DETECTION: Determine new vs existing based purely on SDK-side logic\r\n    const accountStatus = authData.accountStatus;\r\n    let isNewUser;\r\n    \r\n    // Primary indicator: Backend explicit flags\r\n    const backendSaysNewUser =\r\n      authData.isNewUser === true ||\r\n      authData.userCreated === true ||\r\n      authData.existingUser === false ||\r\n      authData.flowType === 'onboarding' ||\r\n      authData.userState === 'new';\r\n    \r\n    // Secondary indicator: Connected platforms (most reliable for \"returning user\")\r\n    const connectedPlatforms = accountStatus?.connectedPlatforms || [];\r\n    const hasConnectedPlatforms = Array.isArray(connectedPlatforms) && connectedPlatforms.length > 0;\r\n    \r\n    // Tertiary indicator: Has trained model or personality data\r\n    const hasTrainedModel = accountStatus?.hasTrainedModel === true;\r\n    const hasPersonalityTraits = accountStatus?.hasPersonalityTraits === true;\r\n    const hasExistingData = hasTrainedModel || hasPersonalityTraits;\r\n    \r\n    // SDK-side decision logic:\r\n    // 1. If backend explicitly says new user  new user (go to onboarding)\r\n    // 2. If user has connected platforms  existing user (skip to dataRequest)\r\n    // 3. If user has trained model/traits  existing user (skip to dataRequest)\r\n    // 4. DEFAULT: No platforms + no trained data  new user (go to onboarding first)\r\n    //    This ensures brand new signups always connect platforms before requesting permissions\r\n    if (backendSaysNewUser) {\r\n      isNewUser = true;\r\n      console.log(' SDK: New user (backend explicit flag)');\r\n    } else if (hasConnectedPlatforms) {\r\n      isNewUser = false;\r\n      console.log(' SDK: Existing user (has connected platforms):', connectedPlatforms);\r\n    } else if (hasExistingData) {\r\n      isNewUser = false;\r\n      console.log(' SDK: Existing user (has trained model/traits)');\r\n    } else {\r\n      // Default: no platforms + no trained data  new user needs onboarding\r\n      isNewUser = true;\r\n      console.log(' SDK: New user (no platforms, no trained data  onboarding first)');\r\n    }\r\n    \r\n    console.log(' SDK Flow determination:', {\r\n      decision: isNewUser ? 'NEW USER  onboarding (connect platforms)' : 'EXISTING USER  dataRequest (permissions)',\r\n      backendSaysNewUser,\r\n      hasConnectedPlatforms,\r\n      connectedPlatforms,\r\n      hasExistingData,\r\n      hasTrainedModel,\r\n      hasPersonalityTraits,\r\n      accountStatusExists: accountStatus?.exists,\r\n      authDataExistingUser: authData.existingUser\r\n    });\r\n    \r\n    const newUserData = {\r\n      ...authData,\r\n      verified: true,\r\n      onboardingComplete: !isNewUser, // New users need onboarding, returning users have completed it\r\n      pinCreated: !isNewUser // Assume returning users have PIN, new users need to create it\r\n    };\r\n\r\n    // If backend provides connected platforms for existing users, carry them into connectedAccounts\r\n    // so DataRequest/Onboarding can reflect what is already connected.\r\n    const normalizePlatformName = (p) => {\r\n      const key = String(p || '').trim().toLowerCase();\r\n      const map = {\r\n        instagram: 'Instagram',\r\n        youtube: 'YouTube',\r\n        linkedin: 'LinkedIn',\r\n        reddit: 'Reddit',\r\n        pinterest: 'Pinterest',\r\n        github: 'GitHub',\r\n        gmail: 'Gmail',\r\n        twitter: 'Twitter',\r\n        x: 'Twitter',\r\n        chatgpt: 'ChatGPT',\r\n        claude: 'Claude',\r\n        gemini: 'Gemini',\r\n        grok: 'Grok',\r\n      };\r\n      return map[key] || (key ? key.charAt(0).toUpperCase() + key.slice(1) : '');\r\n    };\r\n    if (!isNewUser) {\r\n      const fromAccountStatus = Array.isArray(accountStatus?.connectedPlatforms)\r\n        ? accountStatus.connectedPlatforms\r\n        : [];\r\n      const normalized = fromAccountStatus.map(normalizePlatformName).filter(Boolean);\r\n      if (normalized.length > 0) {\r\n        newUserData.connectedAccounts = normalized;\r\n      }\r\n    } else {\r\n      // New user: never pre-populate connected apps.\r\n      // This prevents stale local state from previous sessions from auto-toggling connectors.\r\n      newUserData.connectedAccounts = [];\r\n    }\r\n    \r\n    // Ensure token is stored in userData and localStorage\r\n    const emailToken = authData.token || authData.jwtToken || authData.accessToken;\r\n    if (emailToken) {\r\n      newUserData.token = emailToken;\r\n      try {\r\n        localStorage.setItem('onairos_user_token', emailToken);\r\n        console.log(' Token from email verification saved to localStorage');\r\n      } catch (e) {\r\n        console.warn(' Could not save token to localStorage:', e);\r\n      }\r\n    }\r\n    \r\n    // ============================================\r\n    // NEW: Create persistent session (30-day default)\r\n    // ============================================\r\n    const sessionData = createSession(newUserData, emailToken);\r\n    setUserData(sessionData || newUserData);\r\n    \r\n    // Fallback if createSession fails\r\n    if (!sessionData) {\r\n      localStorage.setItem('onairosUser', JSON.stringify(newUserData));\r\n    }\r\n    \r\n    console.log(' Persistent session created - user can skip login for 30 days');\r\n    \r\n    // Flow decision logic:\r\n    // - New users: go to UniversalOnboarding (connectors)\r\n    // - Existing users: go straight to DataRequest (data permissions)\r\n    if (isNewUser) {\r\n      console.log(' Auth successful (new user)  Starting onboarding flow (data connectors page)');\r\n    setCurrentFlow('onboarding');\r\n    } else {\r\n      console.log(' Auth successful (existing user)  Going straight to DataRequest (data permissions)');\r\n      setCurrentFlow('dataRequest');\r\n    }\r\n  };\r\n\r\n  const handleOnboardingComplete = (onboardingData) => {\r\n    console.log(' Onboarding completed:', onboardingData);\r\n    console.log(' Connected accounts from onboarding:', onboardingData.connectedAccounts);\r\n    \r\n    // DEFENSIVE: Ensure we don't overwrite session with null if state was lost\r\n    const currentData = userData || JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n    \r\n    const updatedUserData = {\r\n      ...currentData,\r\n      onboardingComplete: true,\r\n      connectedAccounts: onboardingData.connectedAccounts || []\r\n    };\r\n    \r\n    // Recover email if missing from currentData but present in onboardingData (unlikely but safe)\r\n    if (!updatedUserData.email && onboardingData.email) {\r\n        updatedUserData.email = onboardingData.email;\r\n    }\r\n    \r\n    console.log(' Saving userData with connectedAccounts:', updatedUserData.connectedAccounts);\r\n    setUserData(updatedUserData);\r\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\r\n    if (returnToDataRequestAfterOnboarding) {\r\n      setReturnToDataRequestAfterOnboarding(false);\r\n      // Determine flow: if user added NEW connections and wants to re-train (implicit in wrapped/non-wrapped flow?),\r\n      // or just wants to go back to data request.\r\n      // User requested: \"so i cna redo training\" -> send to trainingScreen.\r\n      // But if wrapped, training is skipped.\r\n      const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n      if (isWrappedApp) {\r\n        // Wrapped: back to DataRequest (training skipped anyway)\r\n        setCurrentFlow('dataRequest');\r\n      } else {\r\n        // Non-wrapped: User likely wants to re-train with new data\r\n        setCurrentFlow('trainingScreen');\r\n        // Reset training state so it runs again\r\n        setTrainingHasStarted(false);\r\n      }\r\n    } else {\r\n      // Check if user already has a PIN. If so, skip PIN setup.\r\n      if (updatedUserData.pinCreated) {\r\n        console.log(' User already has a PIN, skipping setup.');\r\n        \r\n        // Decide next step based on wrapped/non-wrapped logic\r\n        const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n        if (isWrappedApp) {\r\n          console.log(' Wrapped app - skipping training screen, going to data request');\r\n          setCurrentFlow('dataRequest');\r\n        } else {\r\n          console.log(' Non-wrapped app - showing training screen');\r\n          setTrainingHasStarted(false);\r\n          setCurrentFlow('trainingScreen');\r\n        }\r\n      } else {\r\n        setCurrentFlow('pin');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handlePinSetupComplete = async (pinData) => {\r\n    console.log('PIN setup completed:', pinData);\r\n    \r\n    // DEFENSIVE: Ensure we don't overwrite session with null if state was lost\r\n    const currentData = userData || JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n    \r\n    const updatedUserData = {\r\n      ...currentData,\r\n      ...pinData,\r\n      pinCreated: true\r\n    };\r\n    setUserData(updatedUserData);\r\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\r\n    \r\n    // Check if this is a wrapped app\r\n    const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n    \r\n    if (isWrappedApp) {\r\n      // Wrapped apps skip training screen - go directly to data request\r\n      console.log(' Wrapped app - skipping training screen, going to data request');\r\n      setCurrentFlow('dataRequest');\r\n    } else {\r\n      // Non-wrapped apps show training screen BEFORE data request\r\n      console.log(' Non-wrapped app - showing training screen');\r\n      // Reset training start watchdog state\r\n      setTrainingHasStarted(false);\r\n      setCurrentFlow('trainingScreen');\r\n    }\r\n  };\r\n\r\n  // Non-wrapped ONLY: if training does not START within 30s, move forward to DataRequest anyway.\r\n  // Wrapped apps must NOT do this.\r\n  useEffect(() => {\r\n    const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n    if (isWrappedApp) return;\r\n\r\n    if (currentFlow !== 'trainingScreen') return;\r\n    if (trainingHasStarted) return;\r\n\r\n    const timeoutId = setTimeout(() => {\r\n      // Re-check conditions at fire time (effect cleanup should handle most cases).\r\n      const stillWrapped = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n      if (stillWrapped) return;\r\n      if (currentFlow === 'trainingScreen' && !trainingHasStarted) {\r\n        console.warn(' Training did not start within 30s (non-wrapped). Continuing to DataRequest.');\r\n        setCurrentFlow('dataRequest');\r\n      }\r\n    }, 30000);\r\n\r\n    return () => clearTimeout(timeoutId);\r\n  }, [currentFlow, trainingHasStarted, webpageName]);\r\n\r\n  const handleLoadingComplete = () => {\r\n    setCurrentFlow('dataRequest');\r\n  };\r\n\r\n  const handleTrainingComplete = (trainingResult) => {\r\n    console.log(' Training completed:', trainingResult);\r\n    \r\n    // DEFENSIVE: Ensure we don't overwrite session with null if state was lost\r\n    const currentData = userData || JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n    \r\n    const updatedUserData = {\r\n      ...currentData,\r\n      // Persist a stable flag name used across SDK helpers/formatters\r\n      trainingComplete: !(trainingResult?.fallback || trainingResult?.error),\r\n      trainingCompleted: true,\r\n      ...trainingResult\r\n    };\r\n    setUserData(updatedUserData);\r\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\r\n    \r\n    // Move to data request after training\r\n    setCurrentFlow('dataRequest');\r\n  };\r\n\r\n  const handleTrainingScreenComplete = (trainingResult) => {\r\n    console.log(' Training screen completed:', trainingResult);\r\n    \r\n    // DEFENSIVE: Ensure we don't overwrite session with null if state was lost\r\n    const currentData = userData || JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n    \r\n    const updatedUserData = {\r\n      ...currentData,\r\n      trainingComplete: !(trainingResult?.fallback || trainingResult?.error),\r\n      trainingCompleted: true,\r\n      ...trainingResult\r\n    };\r\n    setUserData(updatedUserData);\r\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\r\n    \r\n    // Move to data request after training screen\r\n    setCurrentFlow('dataRequest');\r\n  };\r\n\r\n  const handleDataRequestComplete = async (requestResult) => {\r\n    console.log(' OnairosButton: Data request completed:', requestResult);\r\n    \r\n    // Check if this is a wrapped app\r\n    const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n    \r\n    // For non-wrapped apps, training and inference already happened in TrainingScreen\r\n    // No need to run it again here\r\n    if (!isWrappedApp && requestResult.approved?.length > 0) {\r\n      console.log(' Non-wrapped app: Training and inference already completed in TrainingScreen');\r\n      console.log(' Data approval recorded:', requestResult.approved);\r\n    }\r\n    \r\n    // Resolve user identifier robustly\r\n    let accountIdentifier = userData?.email || userData?.username;\r\n    \r\n    // Fallback: check localStorage if state is missing email\r\n    if (!accountIdentifier) {\r\n        try {\r\n            const savedUser = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n            accountIdentifier = savedUser.email || savedUser.username;\r\n            if (accountIdentifier) {\r\n                 console.log(' Recovered user identifier from localStorage:', accountIdentifier);\r\n            }\r\n        } catch (e) {\r\n            console.warn(' Failed to recover user identifier from localStorage:', e);\r\n        }\r\n    }\r\n\r\n    // DEFENSIVE: Ensure we don't overwrite session with null if state was lost\r\n    const currentData = userData || JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n    \r\n    // Update user data with request result\r\n    const updatedUserData = {\r\n      ...currentData,\r\n      lastDataRequest: requestResult\r\n    };\r\n    \r\n    // Ensure email is set in updatedUserData if we recovered it\r\n    if (accountIdentifier && !updatedUserData.email) {\r\n        updatedUserData.email = accountIdentifier;\r\n        console.log(' Backfilled email into updatedUserData');\r\n    }\r\n\r\n    setUserData(updatedUserData);\r\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\r\n\r\n    // For wrapped apps: Don't immediately show loading - wait to see if data is cached\r\n    // The loading screen will be shown only if fetch takes >1s (indicating fresh generation)\r\n\r\n    // Handle data fetching if autoFetch is enabled\r\n    // Non-wrapped apps still need this call to produce InferenceResult (output + traits) for host apps.\r\n    let finalResult = requestResult;\r\n    \r\n    if (autoFetch && requestResult.approved?.length > 0) {\r\n      console.log(` Auto-fetching data from Onairos API (${isWrappedApp ? 'wrapped' : 'non-wrapped'})...`);\r\n      \r\n      try {\r\n        if (!accountIdentifier) {\r\n            throw new Error('User identifier (email) is missing - cannot fetch data');\r\n        }\r\n\r\n        // 1. Get the API URL from the backend\r\n        const urlResponse = await fetch('https://api2.onairos.uk/getAPIurlMobile', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            Info: {\r\n              appId: webpageName,\r\n              account: accountIdentifier,\r\n              confirmations: requestResult.approved.map(id => ({ data: id === 'personality' ? 'Large' : id === 'basic' ? 'Basic' : id })),\r\n              EncryptedUserPin: userData?.EncryptedUserPin || 'pending_pin_integration',\r\n              storage: 's3',\r\n              proofMode: proofMode\r\n            }\r\n          })\r\n        });\r\n\r\n        const urlData = await urlResponse.json();\r\n        console.log(' API URL received:', urlData.apiUrl);\r\n        console.log(' webpageName sent as appId:', webpageName);\r\n\r\n        if (urlData.apiUrl && urlData.token) {\r\n          // Treat as \"wrapped\" when either:\r\n          // - appId/name indicates wrapped, OR\r\n          // - backend returns the special wrapped dashboard endpoint (traits-only)\r\n          // This prevents host apps (e.g. remind.*) from being misclassified as non-wrapped and\r\n          // receiving only traits-only fallback data instead of a full wrapped dashboard.\r\n          const apiUrlLooksWrapped =\r\n            typeof urlData.apiUrl === 'string' &&\r\n            (urlData.apiUrl.includes('/traits-only') || urlData.apiUrl.includes('traits-only'));\r\n          const nameLooksWrapped =\r\n            typeof webpageName === 'string' &&\r\n            webpageName.toLowerCase().includes('wrapped');\r\n          const isWrappedApp = !!(nameLooksWrapped || apiUrlLooksWrapped);\r\n          console.log(' Is wrapped app?', isWrappedApp, '(checking:', webpageName, ')', {\r\n            nameLooksWrapped,\r\n            apiUrlLooksWrapped,\r\n            apiUrl: urlData.apiUrl\r\n          });\r\n          \r\n          // Track fetch start time to detect cached responses\r\n          const fetchStartTime = Date.now();\r\n          let shouldShowWrappedLoading = isWrappedApp;\r\n          \r\n          if (isWrappedApp) {\r\n            // Don't show loading screen yet - we'll check if response is fast (cached)\r\n            console.log(' Wrapped app detected - checking if data is cached...');\r\n          } else {\r\n            // Non-wrapped app: DO NOT show loading screen here. \r\n            // The user already accepted permissions, and for non-wrapped apps, \r\n            // we should just fetch in background and close the modal when done.\r\n            // setCurrentFlow('loading'); // <-- REMOVED\r\n            console.log(' Non-wrapped app: fetching data in background, keeping current view until complete');\r\n          }\r\n          \r\n          // Emit custom event for host app\r\n          if (typeof window !== 'undefined') {\r\n            const eventDetail = { apiUrl: urlData.apiUrl, approved: requestResult.approved };\r\n            window.dispatchEvent(new CustomEvent('onairos-api-call-start', { detail: eventDetail }));\r\n            console.log(' Emitted onairos-api-call-start event');\r\n          }\r\n          \r\n          // 2. Fetch the actual data\r\n          // IMPORTANT: This endpoint can take 1-3 minutes as it runs Python LLM scripts\r\n          // We MUST wait for the actual response before proceeding\r\n          // Always use POST for consistency and to support body data\r\n          // traits-only endpoint requires POST\r\n          const method = 'POST';\r\n          \r\n          let fetchUrl = urlData.apiUrl;\r\n          let fetchBody = {\r\n             email: accountIdentifier,\r\n             includeLlmData: requestResult.approved.includes('rawMemories')\r\n          };\r\n\r\n          // Wrapped: use backend policy (cached vs fresh)  DO NOT forceFresh by default.\r\n          // Backend will return:\r\n          // - cached dashboard instantly when available and connections unchanged\r\n          // - processing + poll until a freshly-generated dashboard is ready otherwise\r\n          if (isWrappedApp) {\r\n             console.log(' WRAPPED APP DETECTED - Using traits-only endpoint from backend:', fetchUrl);\r\n             console.log(' Wrapped policy: backend decides cached vs fresh (no fallback dashboards)');\r\n             fetchBody = {\r\n               ...fetchBody,\r\n               // Keep cacheBust only as a cache-buster hint for proxies; backend should not treat this as \"force fresh\"\r\n               cacheBust: Date.now(),\r\n             };\r\n             \r\n             // Append cachebuster to URL to prevent any edge/proxy caching\r\n             if (fetchUrl.includes('?')) {\r\n               fetchUrl += `&cb=${Date.now()}`;\r\n             } else {\r\n               fetchUrl += `?cb=${Date.now()}`;\r\n             }\r\n\r\n             try {\r\n               if (accountIdentifier) localStorage.setItem('onairos_last_wrapped_email', accountIdentifier);\r\n             } catch {}\r\n             console.log(' Wrapped request (backend decides cached vs fresh):', { \r\n               email: accountIdentifier,\r\n               url: fetchUrl,\r\n               body: fetchBody,\r\n               isRetry: fetchBody.retry,\r\n               note: 'Backend will compare connection signatures to decide'\r\n             });\r\n          } else {\r\n            // Non-wrapped: do NOT re-run training here. Use apiUrl from getAPIurlMobile for traits/inference.\r\n            fetchBody = {\r\n              email: accountIdentifier,\r\n              includeLlmData: requestResult.approved.includes('rawMemories')\r\n            };\r\n            console.log(' Non-wrapped: Using apiUrl from getAPIurlMobile for traits/inference:', fetchUrl);\r\n          }\r\n          \r\n          console.log(` Fetching/Training data from ${fetchUrl} (${method})...`);\r\n          console.log(` Using token: ${urlData.token ? urlData.token.substring(0, 20) + '...' : 'NO TOKEN'}`);\r\n          try {\r\n            console.log(' Wrapped fetch request body:', fetchBody);\r\n          } catch {}\r\n          console.log(` Waiting for backend response - this may take 1-3 minutes for LLM processing...`);\r\n          \r\n          let dataResponse;\r\n          let apiResponse;\r\n          let fetchCompleted = false;\r\n          let fetchError = null;\r\n          \r\n          try {\r\n            // CRITICAL: Wait for the actual fetch response - don't proceed until we get data or a real error\r\n            // The backend Python script needs time to generate the wrapped dashboard\r\n            console.log(` Starting fetch request - will wait for complete response...`);\r\n            \r\n            // Create abort controller with 10-minute timeout for LLM-heavy endpoints\r\n            // This prevents the BROWSER from timing out, even if the server might\r\n            // Note: Gateway/load balancer may timeout earlier (typically 60s), which is expected\r\n            const controller = new AbortController();\r\n            const timeoutId = setTimeout(() => controller.abort(), 600000); // 10 minutes\r\n\r\n            try {\r\n              dataResponse = await fetch(fetchUrl, {\r\n                method: method,\r\n                headers: {\r\n                  'Authorization': `Bearer ${urlData.token}`,\r\n                  'Content-Type': 'application/json'\r\n                },\r\n                // Prevent browser/proxy caching for wrapped dashboards\r\n                cache: 'no-store',\r\n                // Only send body for POST\r\n                body: method === 'POST' ? JSON.stringify(fetchBody) : undefined,\r\n                signal: controller.signal\r\n              });\r\n            } finally {\r\n              clearTimeout(timeoutId);\r\n            }\r\n\r\n            console.log(` Response status: ${dataResponse.status} ${dataResponse.statusText}`);\r\n            console.log(` Response headers:`, Object.fromEntries(dataResponse.headers.entries()));\r\n\r\n            // Check for 504 Gateway Timeout - implies backend is still working\r\n            if (dataResponse.status === 504) {\r\n               console.warn(' 504 Gateway Timeout received - Backend is likely still processing');\r\n               throw new Error('Gateway Timeout (504) - Backend processing continued');\r\n            }\r\n\r\n            // CRITICAL: Check if response is ok before parsing JSON\r\n            if (!dataResponse.ok) {\r\n              throw new Error(`HTTP ${dataResponse.status}: ${dataResponse.statusText}`);\r\n            }\r\n\r\n            // CRITICAL: Wait for JSON parsing to complete\r\n            apiResponse = await dataResponse.json();\r\n            \r\n            // Check if this was a fast response (cached data)\r\n            const fetchDuration = Date.now() - fetchStartTime;\r\n            const isCachedResponse = fetchDuration < 1000; // Less than 1 second = likely cached\r\n            const hasActualDashboard = !!(apiResponse?.slides || apiResponse?.dashboard || apiResponse?.data?.dashboard);\r\n            \r\n            console.log(' Parsed API response:', {\r\n              isWrappedApp,\r\n              hasStatus: !!apiResponse.status,\r\n              status: apiResponse.status,\r\n              hasSlides: !!apiResponse.slides,\r\n              hasDashboard: hasActualDashboard,\r\n              fetchDuration: `${fetchDuration}ms`,\r\n              isCachedResponse,\r\n              responseKeys: Object.keys(apiResponse)\r\n            });\r\n            \r\n            // For wrapped apps: Only show loading screen if response is NOT cached\r\n            if (isWrappedApp && !isCachedResponse) {\r\n              setCurrentFlow('wrappedLoading');\r\n              console.log(' Showing wrapped loading screen (fresh generation in progress)');\r\n            } else if (isWrappedApp && isCachedResponse && hasActualDashboard) {\r\n              console.log(' Cached wrapped data detected - skipping loading screen');\r\n            }\r\n\r\n            // \r\n            // Normalize + log API response in the exact SDK format expected\r\n            // (see SDK_API_USAGE_EXAMPLES.md) using apiResponseLogger.\r\n            // \r\n            try {\r\n              const normalizedForLogging = (() => {\r\n                // Wrapped dashboard responses are logged elsewhere; skip here.\r\n                if (apiResponse?.slides || apiResponse?.dashboard || apiResponse?.data?.dashboard) return null;\r\n\r\n                // Standard inference shape already\r\n                if (apiResponse?.InferenceResult) return apiResponse;\r\n\r\n                // traits-only: { success, traits, userTraits, llmData? }\r\n                if (apiResponse?.traits && typeof apiResponse.traits === 'object') {\r\n                  return {\r\n                    InferenceResult: {\r\n                      // Output may be absent for traits-only; logger will still print traits nicely.\r\n                      output: apiResponse.output || apiResponse.InferenceResult?.output || [],\r\n                      traits: { personality_traits: apiResponse.traits }\r\n                    },\r\n                    llmData: apiResponse.llmData,\r\n                    inference_metadata: {\r\n                      source: 'traits-only',\r\n                      retrievedAt: apiResponse?.metadata?.retrievedAt,\r\n                      note: 'Normalized traits-only response into InferenceResult for logging'\r\n                    }\r\n                  };\r\n                }\r\n\r\n                // Generic fallback normalization for unknown shapes that might contain personality data\r\n                if (apiResponse?.personalityDict || apiResponse?.personality_traits) {\r\n                    return {\r\n                        InferenceResult: {\r\n                            output: apiResponse.output || [],\r\n                            traits: { \r\n                                personality_traits: apiResponse.personality_traits || apiResponse.personalityDict\r\n                            }\r\n                        },\r\n                        llmData: apiResponse.llmData\r\n                    };\r\n                }\r\n\r\n                return apiResponse;\r\n              })();\r\n\r\n              if (normalizedForLogging) {\r\n                logOnairosResponse(normalizedForLogging, fetchUrl, { detailed: true, showRawData: false });\r\n              }\r\n            } catch (logErr) {\r\n              console.warn(' Failed to log Onairos response:', logErr);\r\n            }\r\n            \r\n            // Check if dashboard is still being generated (wrapped app only)\r\n            if (isWrappedApp && apiResponse.status === 'processing') {\r\n              console.log(' Dashboard is being generated - starting polling...');\r\n              const basePollInterval = (apiResponse.poll_interval_seconds || 3) * 1000;\r\n              // Wrapped generation can take longer (LLM + queue). Be patient.\r\n              const maxPolls = 300; // ~15 minutes at 3s interval\r\n              let pollCount = 0;\r\n              \r\n              while (pollCount < maxPolls) {\r\n                pollCount++;\r\n                console.log(` Polling attempt ${pollCount}/${maxPolls}...`);\r\n                \r\n                // Wait before next poll\r\n                // mild backoff to reduce load on long-running generations\r\n                const pollInterval = Math.min(15000, Math.round(basePollInterval * (pollCount < 30 ? 1 : pollCount < 120 ? 1.5 : 2)));\r\n                await new Promise(resolve => setTimeout(resolve, pollInterval));\r\n                \r\n                try {\r\n                  // Ensure polling request is unique to bypass proxy caches\r\n                  const pollUrl = new URL(fetchUrl);\r\n                  pollUrl.searchParams.set('poll_cb', Date.now());\r\n\r\n                  // CRITICAL: Do NOT send forceFresh during polling (backend uses cached-vs-fresh policy).\r\n                  const pollBody = { ...fetchBody };\r\n                  delete pollBody.retry; // Don't signal retry on polls\r\n                  delete pollBody.force_refresh;\r\n                  delete pollBody.refresh;\r\n                  \r\n                  // CRITICAL FIX: Pass the nonce back so backend checks THIS specific job\r\n                  // Otherwise it might return old cached data while the new job runs\r\n                  if (apiResponse.nonce) {\r\n                    pollBody.nonce = apiResponse.nonce;\r\n                    pollUrl.searchParams.set('nonce', apiResponse.nonce);\r\n                  }\r\n\r\n                  const pollResponse = await fetch(pollUrl.toString(), {\r\n                    method: method,\r\n                    headers: {\r\n                      'Authorization': `Bearer ${urlData.token}`,\r\n                      'Content-Type': 'application/json'\r\n                    },\r\n                    cache: 'no-store',\r\n                    body: method === 'POST' ? JSON.stringify(pollBody) : undefined\r\n                  });\r\n                  \r\n                  if (pollResponse.ok) {\r\n                    const pollData = await pollResponse.json();\r\n                    \r\n                    // Check if we have the actual dashboard now\r\n                    if (pollData.slides) {\r\n                      console.log(' Dashboard ready! Received slides.');\r\n                      \r\n                      // DETAILED DASHBOARD INSPECTION\r\n                      console.log(' Dashboard metadata:', {\r\n                        version: pollData.version,\r\n                        user_id: pollData.user_id,\r\n                        generated_at: pollData.generated_at,\r\n                        has_meta: !!pollData.meta,\r\n                        is_fallback: pollData.meta?.is_fallback,\r\n                        fallback_reason: pollData.meta?.fallback_reason,\r\n                        cache: pollData.meta?.cache,\r\n                        signature: pollData.meta?.signature\r\n                      });\r\n                      \r\n                      // Check red_pill_forensic roasts to detect generic content (for logging only)\r\n                      const roasts = pollData.slides?.red_pill_forensic?.roasts || [];\r\n                      const knownGenericRoasts = [\r\n                        \"You have 47 tabs open and you're emotionally attached to all of them.\",\r\n                        \"Your 'quick 5-minute task' has never taken 5 minutes. Ever.\",\r\n                        \"You've started more projects than you've finished.\"\r\n                      ];\r\n                      const hasGenericRoasts = roasts.some(roast => knownGenericRoasts.includes(roast));\r\n                      \r\n                      if (hasGenericRoasts) {\r\n                        console.log(' Note: Some generic roasts detected - may indicate limited data available');\r\n                        console.log('   Roasts:', roasts);\r\n                      }\r\n                      \r\n                      // Check if this is a fallback dashboard (backend explicitly marks these)\r\n                      if (pollData.meta?.is_fallback) {\r\n                        console.log(''.repeat(80));\r\n                        console.log(' FALLBACK DASHBOARD DETECTED (SDK)');\r\n                        console.log(''.repeat(80));\r\n                        console.log(' REASON:', pollData.meta.fallback_reason || 'Unknown reason');\r\n                        console.log(' WARNING:', pollData.meta.warning || 'This dashboard contains generic content');\r\n                        console.log(' This is NOT personalized data based on your connected accounts');\r\n                        console.log(''.repeat(80));\r\n                      }\r\n                      \r\n                      apiResponse = pollData;\r\n                      break;\r\n                    } else if (pollData.status !== 'processing') {\r\n                      console.warn(' Unexpected response during polling:', pollData);\r\n                      apiResponse = pollData;\r\n                      break;\r\n                    }\r\n                    \r\n                    console.log(' Still processing...');\r\n                  } else {\r\n                    console.warn(` Poll failed with status ${pollResponse.status}`);\r\n                  }\r\n                } catch (pollErr) {\r\n                  console.warn(' Poll request failed:', pollErr.message);\r\n                }\r\n              }\r\n              \r\n              if (!apiResponse?.slides && pollCount >= maxPolls) {\r\n                console.warn(' Wrapped polling reached max attempts; treating as still-processing (do not fail the flow)');\r\n                requestResult.isTimeout = true;\r\n                // Preserve processing state so UI continues loading and we avoid firing onComplete prematurely.\r\n                apiResponse = apiResponse || { status: 'processing' };\r\n              }\r\n            }\r\n            \r\n            // Mark fetch as completed successfully\r\n            fetchCompleted = true;\r\n            \r\n            console.log(' API Response received and parsed successfully');\r\n            console.log(' Has slides?', !!apiResponse.slides);\r\n            if (apiResponse.slides) {\r\n              console.log(' Slides keys:', Object.keys(apiResponse.slides));\r\n            }\r\n            \r\n          } catch (fetchErr) {\r\n            // Mark that we encountered an error during fetch\r\n            fetchError = fetchErr;\r\n            fetchCompleted = false;\r\n            \r\n            console.error(' FETCH ERROR:', fetchErr);\r\n            console.error(' Error name:', fetchErr.name);\r\n            console.error(' Error message:', fetchErr.message);\r\n            \r\n            // Check if it's a timeout error (504 Gateway Timeout)\r\n            if (fetchErr.message?.includes('504') || fetchErr.message?.includes('Gateway Timeout')) {\r\n              console.error(' GATEWAY TIMEOUT (504) - Backend is still processing');\r\n              console.error(' This means the backend Python LLM script is still running');\r\n              console.error(' DO NOT fall back to mocks yet - backend is generating data');\r\n              // Don't set apiResponse to null yet - we want to retry or wait\r\n              apiResponse = null;\r\n              \r\n              // Flag this as a timeout specifically so the app knows to wait/retry\r\n              requestResult.isTimeout = true;\r\n            }\r\n            // If it's a CORS error, the backend is returning data but browser blocks it\r\n            else if (fetchErr.message?.includes('CORS') || fetchErr.message?.includes('Failed to fetch')) {\r\n              console.error(' CORS BLOCKING RESPONSE - Backend generated data but browser cannot read it');\r\n              console.error(' This usually means a 504/502 timeout from load balancer stripping headers');\r\n              console.error(' Backend successfully generated dashboard (see server logs)');\r\n              \r\n              // Even though fetch failed, we still have the token and URL\r\n              // Set apiResponse to null but keep token and apiUrl for retry\r\n              apiResponse = null;\r\n              \r\n              // Treat CORS errors on this endpoint as timeouts/processing\r\n              // The backend likely finished but the LB cut the connection\r\n              requestResult.isTimeout = true;\r\n            } else {\r\n              // For other errors, still set to null but log the error\r\n              console.error(' Fetch failed with error:', fetchErr);\r\n              apiResponse = null;\r\n            }\r\n          }\r\n          \r\n          // CRITICAL: Log fetch completion status\r\n          if (fetchCompleted) {\r\n            console.log(' Fetch completed - data ready');\r\n          } else if (requestResult.isTimeout) {\r\n             console.log(' Request timed out - passing timeout flag to app');\r\n          } else if (fetchError) {\r\n            console.error(' Fetch failed:', fetchError.message);\r\n          }\r\n\r\n          // Merge into result - include token and apiUrl even if fetch failed\r\n          finalResult = {\r\n            ...requestResult,\r\n            apiResponse: apiResponse, // Raw response (null if CORS blocked)\r\n            token: urlData.token,     // Token used - ALWAYS include this\r\n            apiUrl: urlData.apiUrl    // URL used - ALWAYS include this\r\n          };\r\n          \r\n          console.log(' Final result ready:', {\r\n            hasApiResponse: !!finalResult.apiResponse,\r\n            hasSlides: !!finalResult.apiResponse?.slides,\r\n            hasToken: !!finalResult.token\r\n          });\r\n          \r\n          // Add to updated user data - include token even if apiResponse is null\r\n          updatedUserData.apiResponse = apiResponse;\r\n          if (urlData.token) {\r\n            updatedUserData.token = urlData.token;\r\n            // Also store in localStorage for persistence\r\n            try {\r\n              localStorage.setItem('onairos_user_token', urlData.token);\r\n            } catch (e) {\r\n              console.warn(' Could not store token in localStorage:', e);\r\n            }\r\n          }\r\n          setUserData(updatedUserData);\r\n        } else {\r\n          console.warn(' Failed to get API URL:', urlData);\r\n        }\r\n      } catch (fetchError) {\r\n        console.error(' Error auto-fetching data:', fetchError);\r\n        \r\n        // Check if it's a timeout/abort error\r\n        if (fetchError.name === 'AbortError' || fetchError.message?.includes('timeout')) {\r\n          console.error(' Request timed out - backend took longer than 2 minutes');\r\n        }\r\n        // Check if it's a CORS error\r\n        else if (fetchError.message?.includes('CORS') || \r\n                 fetchError.message?.includes('Failed to fetch') ||\r\n                 fetchError.name === 'TypeError') {\r\n          console.error(' CORS ERROR DETECTED');\r\n          console.error(' Backend needs to allow CORS for:', window.location.origin);\r\n        }\r\n        \r\n        // Continue with what we have - don't block the flow\r\n        // The app can still proceed without apiResponse\r\n      }\r\n    }\r\n\r\n    // Format response if requested and API response is present.\r\n    // IMPORTANT: Do NOT format wrapped dashboard payloads (slides/dashboard),\r\n    // because the formatter is designed for traits/personality shapes and can\r\n    // strip/reshape the response, causing host apps to incorrectly fall back to mocks.\r\n    let formattedResult = finalResult;\r\n    const hasWrappedDashboardPayload =\r\n      !!finalResult?.apiResponse?.slides ||\r\n      !!finalResult?.apiResponse?.dashboard ||\r\n      !!finalResult?.apiResponse?.data?.dashboard;\r\n\r\n    if (formatResponse && finalResult?.apiResponse && !hasWrappedDashboardPayload) {\r\n      try {\r\n        formattedResult = {\r\n          ...finalResult,\r\n          apiResponse: formatOnairosResponse(finalResult.apiResponse, responseFormat)\r\n        };\r\n        console.log(' Response formatted with dictionary:', formattedResult.apiResponse?.personalityDict || 'No personality data');\r\n      } catch (error) {\r\n        console.warn(' Error formatting response:', error);\r\n        // Continue with original result if formatting fails\r\n      }\r\n    } else if (formatResponse && hasWrappedDashboardPayload) {\r\n      console.log(' Wrapped dashboard detected - skipping response formatting to preserve slides');\r\n    }\r\n\r\n    // Ensure token is included from userData if not already in finalResult\r\n    if (!finalResult.token && updatedUserData.token) {\r\n      finalResult.token = updatedUserData.token;\r\n      console.log(' Added token from userData to finalResult');\r\n    }\r\n    \r\n    // Also check localStorage as fallback\r\n    if (!finalResult.token) {\r\n      try {\r\n        const storedToken = localStorage.getItem('onairos_user_token');\r\n        if (storedToken) {\r\n          finalResult.token = storedToken;\r\n          console.log(' Added token from localStorage to finalResult');\r\n        }\r\n      } catch (e) {\r\n        console.warn(' Could not read token from localStorage:', e);\r\n      }\r\n    }\r\n    \r\n    // Add user data to the result for comprehensive formatting\r\n    const completeResult = {\r\n      ...formattedResult,\r\n      token: finalResult.token || formattedResult.token || updatedUserData.token, // Ensure token is at root level\r\n      userData: updatedUserData,\r\n      // Add appName and userHash for proper logging/formatting\r\n      appName: webpageName || formattedResult.appName || 'Unknown App',\r\n      userHash: updatedUserData?.email || updatedUserData?.username || accountIdentifier || formattedResult.userHash || 'Unknown User'\r\n    };\r\n\r\n    // Enhanced user data formatting for better display\r\n    let enhancedResult = completeResult;\r\n    try {\r\n    // Log formatted user data for better readability\r\n        enhancedResult = logFormattedUserData(completeResult);\r\n    } catch (formatError) {\r\n        console.warn(' Error formatting user data for display:', formatError);\r\n        // Continue with unformatted result to ensure app doesn't break\r\n    }\r\n    \r\n    // Ensure token is still present after formatting\r\n    if (!enhancedResult.token && completeResult.token) {\r\n      enhancedResult.token = completeResult.token;\r\n    }\r\n    if (!enhancedResult.token && updatedUserData.token) {\r\n      enhancedResult.token = updatedUserData.token;\r\n    }\r\n\r\n    // Call onComplete callback if provided\r\n    // For non-wrapped apps, onComplete was already called from TrainingScreen\r\n    // So we only call it here for wrapped apps OR if training screen was skipped\r\n    // webpageName is already in scope from the component props\r\n    const isWrappedAppForCallback = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n    \r\n    if (onComplete && isWrappedAppForCallback) {\r\n      try {\r\n        const hasWrappedDashboard =\r\n          !!enhancedResult?.apiResponse?.slides ||\r\n          !!enhancedResult?.apiResponse?.dashboard ||\r\n          !!enhancedResult?.apiResponse?.data?.dashboard;\r\n        const stillProcessing =\r\n          enhancedResult?.isTimeout === true ||\r\n          enhancedResult?.apiResponse?.status === 'processing' ||\r\n          !hasWrappedDashboard;\r\n\r\n        if (stillProcessing) {\r\n          // IMPORTANT: Do not call onComplete yet; many consuming apps will navigate away/unmount\r\n          // the SDK, which looks like the loading modal \"closed prematurely\".\r\n          console.log(' Wrapped dashboard still processing - keeping loading screen open and NOT calling onComplete yet');\r\n        } else {\r\n          console.log(' Calling onComplete for wrapped app with final dashboard data');\r\n        onComplete(enhancedResult);\r\n        }\r\n      } catch (error) {\r\n        console.error(' Error in onComplete callback:', error);\r\n      }\r\n    } else if (onComplete && !isWrappedAppForCallback) {\r\n      console.log(' Skipping onComplete for non-wrapped app (already called from TrainingScreen)');\r\n    } else {\r\n      console.log(' No onComplete callback provided');\r\n    }\r\n\r\n    // WRAPPED APPS:\r\n    // If the dashboard data is READY (slides/dashboard present), close the overlay automatically.\r\n    // Only wait for an explicit ready signal when the backend is still processing.\r\n    if (isWrappedApp) {\r\n      const hasWrappedDashboardNow =\r\n        !!enhancedResult?.apiResponse?.slides ||\r\n        !!enhancedResult?.apiResponse?.dashboard ||\r\n        !!enhancedResult?.apiResponse?.data?.dashboard;\r\n      const stillProcessingNow =\r\n        enhancedResult?.isTimeout === true ||\r\n        enhancedResult?.apiResponse?.status === 'processing' ||\r\n        !hasWrappedDashboardNow;\r\n\r\n      if (!stillProcessingNow) {\r\n        console.log(' Wrapped dashboard ready (slides present) - auto-closing SDK overlay');\r\n        handleCloseOverlay();\r\n        return;\r\n      }\r\n\r\n      console.log(' Wrapped app - still processing, waiting for dashboard ready signal');\r\n      console.log(' Setting up onairos-dashboard-ready event listener');\r\n\r\n      // Listen for custom event from the wrapped app indicating dashboard is ready\r\n      const handleDashboardReady = (event) => {\r\n        console.log(' Dashboard ready signal received - closing SDK overlay');\r\n        console.log(' Event details:', event);\r\n        handleCloseOverlay();\r\n        window.removeEventListener('onairos-dashboard-ready', handleDashboardReady);\r\n      };\r\n\r\n      window.addEventListener('onairos-dashboard-ready', handleDashboardReady);\r\n      console.log(' Event listener attached, waiting for signal...');\r\n    } else {\r\n      // For non-wrapped apps, just close the modal - training already happened in TrainingScreen\r\n      console.log(' Non-wrapped app: Training complete, closing overlay');\r\n      handleCloseOverlay();\r\n    }\r\n  };\r\n\r\n  const getFlowTitle = () => {\r\n    switch (currentFlow) {\r\n      case 'welcome':\r\n        return ''; // WelcomeScreen handles its own titles\r\n      case 'email':\r\n        return ''; // EmailAuth handles its own titles\r\n      case 'onboarding':\r\n        return 'Connect Your Data';\r\n      case 'pin':\r\n        return 'Secure Your Account';\r\n      case 'training':\r\n        return 'Training Your Model';\r\n      case 'trainingScreen':\r\n        return 'Training Your Model';\r\n      case 'dataRequest':\r\n        return 'Data Request';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getFlowSubtitle = () => {\r\n    switch (currentFlow) {\r\n      case 'welcome':\r\n        return ''; // WelcomeScreen handles its own subtitles\r\n      case 'email':\r\n        return ''; // EmailAuth handles its own subtitles\r\n      case 'onboarding':\r\n        return 'Choose which accounts to connect for a personalized experience';\r\n      case 'pin':\r\n        return 'Create a secure PIN to protect your data';\r\n      case 'training':\r\n        return 'Building your personalized insights';\r\n      case 'trainingScreen':\r\n        return 'Building your personalized insights';\r\n      case 'dataRequest':\r\n        return `Select the data you want to share with ${webpageName}`;\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getFlowIcon = () => {\r\n    switch (currentFlow) {\r\n      case 'welcome':\r\n        return ''; // WelcomeScreen handles its own layout\r\n      case 'email':\r\n        return ''; // EmailAuth handles its own layout\r\n      case 'onboarding':\r\n        return '';\r\n      case 'pin':\r\n        return '';\r\n      case 'training':\r\n        return '';\r\n      case 'trainingScreen':\r\n        return '';\r\n      case 'dataRequest':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const renderContent = () => {\r\n    const commonProps = {\r\n      isMobile: isMobileDevice,\r\n      testMode: testMode\r\n    };\r\n\r\n    switch (currentFlow) {\r\n      case 'welcome':\r\n        return (\r\n          <WelcomeScreen \r\n            {...commonProps}\r\n            onContinue={handleWelcomeContinue}\r\n            onClose={handleCloseOverlay}\r\n            webpageName={webpageName}\r\n            appIcon={appIcon}\r\n          />\r\n        );\r\n      case 'email':\r\n        return (\r\n          <div className={isMobileDevice ? \"flex-1 min-h-0 flex flex-col\" : \"flex-1 min-h-0 flex flex-col\"}>\r\n            <EmailAuth \r\n              {...commonProps}\r\n              onSuccess={handleEmailAuthSuccess}\r\n            />\r\n          </div>\r\n        );\r\n      case 'onboarding':\r\n        return (\r\n          <UniversalOnboarding \r\n            {...commonProps}\r\n            initialConnectedAccounts={userData?.connectedAccounts}\r\n            onComplete={handleOnboardingComplete}\r\n            onBack={() => {\r\n              if (returnToDataRequestAfterOnboarding) {\r\n                setReturnToDataRequestAfterOnboarding(false);\r\n                // Sync connected apps from storage so DataRequest reflects newly connected platforms\r\n                try {\r\n                  const saved = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n                  if (saved && Array.isArray(saved.connectedAccounts)) {\r\n                    setUserData((prev) => {\r\n                      const merged = { ...(prev || {}), ...saved, connectedAccounts: saved.connectedAccounts };\r\n                      try { localStorage.setItem('onairosUser', JSON.stringify(merged)); } catch {}\r\n                      return merged;\r\n                    });\r\n                  }\r\n                } catch {}\r\n                setCurrentFlow('dataRequest');\r\n              } else {\r\n                setCurrentFlow('email');\r\n              }\r\n            }}\r\n            appIcon={appIcon || \"https://onairos.sirv.com/Images/OnairosBlack.png\"}\r\n            appName={webpageName}\r\n            username={userData?.email || userData?.username}\r\n            priorityPlatform={priorityPlatform}\r\n            rawMemoriesOnly={rawMemoriesOnly}\r\n            rawMemoriesConfig={rawMemoriesConfig}\r\n          />\r\n        );\r\n      case 'pin':\r\n        return (\r\n          <div className={isMobileDevice ? \"flex-1 min-h-0\" : \"\"}>\r\n            <PinSetup \r\n              onComplete={handlePinSetupComplete}\r\n              onBack={() => setCurrentFlow('onboarding')}\r\n              userEmail={userData?.email}\r\n            />\r\n          </div>\r\n        );\r\n      case 'training':\r\n        return (\r\n          <TrainingComponent \r\n            onComplete={handleTrainingComplete}\r\n            userEmail={userData?.email}\r\n            appName={webpageName}\r\n            connectedAccounts={userData?.connectedAccounts || []}\r\n            testMode={testMode}\r\n          />\r\n        );\r\n      case 'trainingScreen':\r\n        console.log(' Rendering TrainingScreen with userData:', {\r\n          hasUserData: !!userData,\r\n          hasToken: !!userData?.token,\r\n          tokenPreview: userData?.token ? userData.token.substring(0, 20) + '...' : 'NO TOKEN',\r\n          email: userData?.email,\r\n          connectedAccounts: userData?.connectedAccounts\r\n        });\r\n        return (\r\n          <TrainingScreen \r\n            onComplete={handleTrainingScreenComplete}\r\n            onTrainingStart={() => setTrainingHasStarted(true)}\r\n            userEmail={userData?.email}\r\n            connectedAccounts={userData?.connectedAccounts || []}\r\n            userToken={userData?.token}\r\n          />\r\n        );\r\n      case 'dataRequest':\r\n        console.log(' Rendering DataRequest:', {\r\n          connectedAccounts: userData?.connectedAccounts,\r\n          isArray: Array.isArray(userData?.connectedAccounts),\r\n          userData: userData\r\n        });\r\n        return (\r\n          <DataRequest \r\n            onComplete={handleDataRequestComplete}\r\n            onConnectMoreApps={() => {\r\n              // Go back to UniversalOnboarding but return here afterwards.\r\n              // Connected apps are persisted in localStorage by UniversalOnboarding.\r\n              // IMPORTANT: Refresh userData from localStorage to ensure connected accounts are current\r\n              try {\r\n                const savedUser = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n                if (savedUser && savedUser.connectedAccounts) {\r\n                  setUserData((prev) => ({\r\n                    ...(prev || {}),\r\n                    ...savedUser,\r\n                    connectedAccounts: savedUser.connectedAccounts\r\n                  }));\r\n                  console.log(' Refreshed userData with connected accounts from localStorage:', savedUser.connectedAccounts);\r\n                }\r\n              } catch (e) {\r\n                console.warn(' Failed to refresh userData from localStorage:', e);\r\n              }\r\n              setReturnToDataRequestAfterOnboarding(true);\r\n              setCurrentFlow('onboarding');\r\n            }}\r\n            userEmail={userData?.email || userData?.username}\r\n            requestData={requestData}\r\n            appName={webpageName}\r\n            autoFetch={autoFetch}\r\n            testMode={testMode}\r\n            appIcon={appIcon}\r\n            connectedPlatforms={userData?.connectedAccounts || []}\r\n            rawMemoriesOnly={rawMemoriesOnly}\r\n            rawMemoriesConfig={rawMemoriesConfig}\r\n            showTime={time}\r\n            onLogout={handleLogout}\r\n          />\r\n        );\r\n      case 'wrappedLoading':\r\n        // CRITICAL: Only render WrappedLoadingPage for wrapped apps\r\n        const isWrappedAppCheck = webpageName && webpageName.toLowerCase().includes('wrapped');\r\n        if (!isWrappedAppCheck) {\r\n          console.warn(' wrappedLoading case should not be reached for non-wrapped app');\r\n          return null;\r\n        }\r\n        return (\r\n          <div className=\"flex-1 min-h-0\">\r\n            <WrappedLoadingPage appName={webpageName} />\r\n          </div>\r\n        );\r\n      case 'loading':\r\n        return <LoadingScreen onComplete={handleLoadingComplete} appName={webpageName} />;\r\n      default:\r\n        return (\r\n          <div className=\"flex flex-col items-center space-y-4 p-6\">\r\n            <div className=\"animate-spin h-8 w-8 border-2 border-blue-600 rounded-full border-t-transparent\"></div>\r\n            <p className=\"text-gray-600\">Loading...</p>\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  // Styling and button class based on visual type\r\n  const buttonClass = \r\n    `flex items-center justify-center font-bold rounded cursor-pointer ${\r\n    buttonType === 'pill' ? 'px-4 py-2' : 'w-12 h-12'\r\n    } bg-transparent OnairosConnect`;\r\n\r\n  const buttonStyle = {\r\n    flexDirection: textLayout === 'below' ? 'column' : 'row',\r\n    backgroundColor: 'transparent',\r\n    color: textColor,\r\n    border: '1px solid transparent',\r\n  };\r\n\r\n  // Icon and text style based on the visualType\r\n  const logoStyle = {\r\n    width: '20px',\r\n    height: '20px',\r\n    marginRight: visualType === 'full' ? '12px' : '0',\r\n  };\r\n\r\n  const getText = () => {\r\n    switch (loginType) {\r\n      case 'signUp':\r\n        return 'Sign Up with Onairos';\r\n      case 'signOut':\r\n        return 'Sign Out of Onairos';\r\n      default:\r\n        return 'Sign In with Onairos';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        className={buttonClass}\r\n        onClick={openTerminal}\r\n        style={buttonStyle}\r\n      >\r\n        {(visualType === 'full' || visualType === 'icon') && (\r\n          <img\r\n            src={login ? \"https://onairos.sirv.com/Images/OnairosWhite.png\" : \"https://onairos.sirv.com/Images/OnairosBlack.png\"}\r\n            alt=\"Onairos Logo\"\r\n            style={logoStyle}\r\n          />\r\n        )}\r\n        {visualType !== 'icon' && (\r\n          <span className={`${textColor === 'black' ? 'text-black' : 'text-white'} ${visualType === 'icon' ? 'sr-only' : ''} ${textLayout === 'right' ? 'ml-2' : textLayout === 'left' ? 'mr-2' : ''}`}>\r\n            {getText()}\r\n          </span>\r\n        )}\r\n      </button>\r\n\r\n      {/* Modal with New Design */}\r\n      {showOverlay && (\r\n        <>\r\n          {/** Wrapped-only typography hook */}\r\n          {/** Adds CSS variables --fontHeading/--fontBody via .onairos-wrapped-fonts */}\r\n          {isMobileDevice ? (\r\n            // Mobile Browser: Use ModalPageLayout with mobile-optimized props\r\n            <ModalPageLayout\r\n              visible={showOverlay}\r\n              onClose={handleCloseOverlay}\r\n              showBackButton={currentFlow !== 'welcome' && currentFlow !== 'email' && currentFlow !== 'loading' && currentFlow !== 'wrappedLoading'}\r\n              onBack={() => {\r\n                        if (currentFlow === 'onboarding') {\r\n                          if (returnToDataRequestAfterOnboarding) {\r\n                            setReturnToDataRequestAfterOnboarding(false);\r\n                            // Sync connected apps from storage so DataRequest reflects newly connected platforms\r\n                            try {\r\n                              const saved = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n                              if (saved && Array.isArray(saved.connectedAccounts)) {\r\n                                setUserData((prev) => {\r\n                                  const merged = { ...(prev || {}), ...saved, connectedAccounts: saved.connectedAccounts };\r\n                                  try { localStorage.setItem('onairosUser', JSON.stringify(merged)); } catch {}\r\n                                  return merged;\r\n                                });\r\n                              }\r\n                            } catch {}\r\n                            setCurrentFlow('dataRequest');\r\n                          } else {\r\n                            setCurrentFlow('email');\r\n                          }\r\n                        }\r\n                        else if (currentFlow === 'pin') setCurrentFlow('onboarding');\r\n                        else if (currentFlow === 'dataRequest') setCurrentFlow('onboarding');\r\n                        else if (currentFlow === 'training') setCurrentFlow('pin');\r\n                      }}\r\n              showCloseButton={currentFlow === 'welcome' || currentFlow === 'email'}\r\n              title=\"\"\r\n              subtitle=\"\"\r\n              icon={null}\r\n              centerContent={true}\r\n              contentClassName=\"!p-0\"\r\n              modalClassName={`onairos-modal onairos-modal-mobile ${(webpageName || '').toLowerCase().includes('wrapped') ? 'onairos-wrapped-fonts' : ''}`}\r\n            >\r\n              <div className=\"onairos-modal-shell flex-1 min-h-0 flex flex-col\">\r\n                  {renderContent()}\r\n                </div>\r\n            </ModalPageLayout>\r\n          ) : (\r\n            // Desktop Layout\r\n            <ModalPageLayout\r\n              visible={showOverlay}\r\n              onClose={handleCloseOverlay}\r\n              showBackButton={currentFlow === 'training' || currentFlow === 'onboarding' || currentFlow === 'pin' || currentFlow === 'dataRequest'}\r\n              modalStyle={currentFlow === 'onboarding' ? { height: '90vh', maxHeight: '90vh' } : {}}\r\n              onBack={() => {\r\n                if (currentFlow === 'email') setCurrentFlow('welcome');\r\n                if (currentFlow === 'onboarding') {\r\n                  if (returnToDataRequestAfterOnboarding) {\r\n                    setReturnToDataRequestAfterOnboarding(false);\r\n                    // Sync connected apps from storage so DataRequest reflects newly connected platforms\r\n                    try {\r\n                      const saved = JSON.parse(localStorage.getItem('onairosUser') || '{}');\r\n                      if (saved && Array.isArray(saved.connectedAccounts)) {\r\n                        setUserData((prev) => {\r\n                          const merged = { ...(prev || {}), ...saved, connectedAccounts: saved.connectedAccounts };\r\n                          try { localStorage.setItem('onairosUser', JSON.stringify(merged)); } catch {}\r\n                          return merged;\r\n                        });\r\n                      }\r\n                    } catch {}\r\n                    setCurrentFlow('dataRequest');\r\n                  } else {\r\n                    setCurrentFlow('email');\r\n                  }\r\n                }\r\n                if (currentFlow === 'pin') setCurrentFlow('onboarding'); \r\n                if (currentFlow === 'training') setCurrentFlow('pin');\r\n                if (currentFlow === 'dataRequest') setCurrentFlow('onboarding');\r\n              }}\r\n              title=\"\"\r\n              subtitle=\"\"\r\n              icon={null}\r\n              centerContent={true}\r\n              contentClassName={currentFlow !== 'welcome' ? \"!p-0\" : \"\"}\r\n              modalClassName={`onairos-modal ${(webpageName || '').toLowerCase().includes('wrapped') ? 'onairos-wrapped-fonts' : ''}`}\r\n            >\r\n              {/* \r\n                Desktop: Make the shell a flex column (onboarding only) so UniversalOnboarding can flex to fill\r\n                the modal height. Without this, the CTA can't be pinned to the bottom and appears to \"float\"\r\n                with empty space below (since flex: 1 doesn't apply unless the parent is a flex container).\r\n              */}\r\n              <div className={currentFlow === 'onboarding' ? \"onairos-modal-shell flex-1 min-h-0 flex flex-col\" : \"onairos-modal-shell\"}>\r\n                {renderContent()}\r\n              </div>\r\n            </ModalPageLayout>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default OnairosButton;","/**\r\n * Onairos API Response Logger\r\n * \r\n * Provides detailed, formatted logging for Onairos API responses\r\n * with visual indicators, explanatory labels, and formatted tables.\r\n * \r\n * Usage:\r\n *   import { logOnairosResponse } from '../utils/apiResponseLogger';\r\n *   logOnairosResponse(apiData, endpointUrl, { detailed: true, showRawData: false });\r\n */\r\n\r\n// Content category names for the 16 output scores\r\nconst CONTENT_CATEGORIES = [\r\n  'Technology & Innovation',\r\n  'Entertainment & Media',\r\n  'Health & Wellness',\r\n  'Education & Learning',\r\n  'Finance & Business',\r\n  'Travel & Adventure',\r\n  'Food & Cooking',\r\n  'Sports & Fitness',\r\n  'Arts & Culture',\r\n  'Science & Nature',\r\n  'Fashion & Style',\r\n  'Gaming & Esports',\r\n  'Social & Relationships',\r\n  'Politics & News',\r\n  'DIY & Crafts',\r\n  'Music & Audio'\r\n];\r\n\r\n/**\r\n * Get emoji and level label based on score\r\n * @param {number} score - Score value (0-1 for content prefs, 0-100 for traits)\r\n * @param {boolean} isPercentage - Whether score is 0-100 scale\r\n * @returns {{emoji: string, level: string}}\r\n */\r\nfunction getScoreIndicator(score, isPercentage = false) {\r\n  const normalizedScore = isPercentage ? score / 100 : score;\r\n  \r\n  if (normalizedScore >= 0.8) return { emoji: '', level: isPercentage ? 'Exceptional' : 'Very High' };\r\n  if (normalizedScore >= 0.6) return { emoji: '', level: isPercentage ? 'Strong' : 'High' };\r\n  if (normalizedScore >= 0.4) return { emoji: '', level: isPercentage ? 'Moderate' : 'Moderate' };\r\n  if (normalizedScore >= 0.2) return { emoji: '', level: isPercentage ? 'Developing' : 'Low' };\r\n  return { emoji: '', level: isPercentage ? 'Low Priority' : 'Very Low' };\r\n}\r\n\r\n/**\r\n * Create visual progress bar\r\n * @param {number} score - Score value (0-1 for content prefs, 0-100 for traits)\r\n * @param {boolean} isPercentage - Whether score is 0-100 scale\r\n * @returns {string} Visual bar representation\r\n */\r\nfunction createProgressBar(score, isPercentage = false) {\r\n  const normalizedScore = isPercentage ? score / 100 : score;\r\n  // Clamp score between 0 and 1 safely\r\n  const clampedScore = Math.max(0, Math.min(1, normalizedScore));\r\n  const filledBlocks = Math.round(clampedScore * 10);\r\n  const emptyBlocks = 10 - filledBlocks;\r\n  return ''.repeat(filledBlocks) + ''.repeat(emptyBlocks);\r\n}\r\n\r\n/**\r\n * Log content preference scores with visual formatting\r\n * @param {Array<Array<number>>} output - 2D array of scores [[0.95], [0.89], ...]\r\n */\r\nfunction logContentPreferences(output) {\r\n  if (!output || !Array.isArray(output) || output.length === 0) {\r\n    console.log('    No content preferences found');\r\n    return;\r\n  }\r\n\r\n  console.log('    Content Preferences');\r\n  console.log('       Content Preference Scores (0.0 = Not Interested, 1.0 = Highly Interested)');\r\n  console.log('      ');\r\n  console.log('');\r\n  console.log('      Category                    Score    Visual              Interest Level');\r\n  console.log('      ');\r\n\r\n  const scores = output.map((item, index) => {\r\n    const score = Array.isArray(item) ? item[0] : item;\r\n    const category = CONTENT_CATEGORIES[index] || `Category ${index + 1}`;\r\n    const indicator = getScoreIndicator(score);\r\n    const bar = createProgressBar(score);\r\n\r\n    console.log(`      ${category.padEnd(28)} ${score.toFixed(3)}    ${bar} ${indicator.emoji}       ${indicator.level}`);\r\n\r\n    return { category, score };\r\n  });\r\n\r\n  // Summary statistics\r\n  const avg = scores.reduce((sum, s) => sum + s.score, 0) / scores.length;\r\n  const max = Math.max(...scores.map(s => s.score));\r\n  const min = Math.min(...scores.map(s => s.score));\r\n  const maxCategory = scores.find(s => s.score === max)?.category;\r\n\r\n  console.log('');\r\n  console.log(`       Summary: Avg ${avg.toFixed(3)} | Max ${max.toFixed(3)} (${maxCategory}) | Min ${min.toFixed(3)}`);\r\n}\r\n\r\n/**\r\n * Log personality traits with visual formatting\r\n * @param {Object} personalityTraits - Personality traits object with positive_traits and traits_to_improve\r\n */\r\nfunction logPersonalityTraits(personalityTraits) {\r\n  if (!personalityTraits || typeof personalityTraits !== 'object') {\r\n    console.log('    No personality traits found');\r\n    return;\r\n  }\r\n\r\n  console.log('    Personality Analysis');\r\n\r\n  // Positive traits (strengths)\r\n  if (personalityTraits.positive_traits) {\r\n    console.log('       Positive Traits (Strengths) - Scale: 0-100');\r\n    console.log('      ');\r\n    console.log('');\r\n    console.log('      Trait                  Score    Visual              Level');\r\n    console.log('      ');\r\n\r\n    Object.entries(personalityTraits.positive_traits).forEach(([trait, score]) => {\r\n      const indicator = getScoreIndicator(score, true);\r\n      const bar = createProgressBar(score, true);\r\n      const traitName = trait.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\r\n\r\n      console.log(`      ${traitName.padEnd(22)} ${score.toFixed(1).padStart(5)}    ${bar} ${indicator.emoji}       ${indicator.level}`);\r\n    });\r\n\r\n    console.log('');\r\n  }\r\n\r\n  // Traits to improve (growth areas)\r\n  if (personalityTraits.traits_to_improve) {\r\n    console.log('       Traits to Improve (Growth Areas) - Scale: 0-100');\r\n    console.log('      ');\r\n    console.log('');\r\n    console.log('      Trait                  Score    Visual              Priority');\r\n    console.log('      ');\r\n\r\n    Object.entries(personalityTraits.traits_to_improve).forEach(([trait, score]) => {\r\n      const indicator = getScoreIndicator(score, true);\r\n      const bar = createProgressBar(score, true);\r\n      const traitName = trait.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\r\n      const priority = score < 40 ? 'Low Priority' : score < 60 ? 'Medium Priority' : 'High Priority';\r\n\r\n      console.log(`      ${traitName.padEnd(22)} ${score.toFixed(1).padStart(5)}    ${bar} ${indicator.emoji}       ${priority}`);\r\n    });\r\n\r\n    console.log('');\r\n  }\r\n}\r\n\r\n/**\r\n * Log Onairos API response with detailed formatting\r\n * @param {Object} response - API response object\r\n * @param {string} endpoint - API endpoint URL\r\n * @param {Object} options - Logging options { detailed: boolean, showRawData: boolean }\r\n */\r\nexport function logOnairosResponse(response, endpoint = 'Unknown', options = {}) {\r\n  const { detailed = true, showRawData = false } = options;\r\n\r\n  console.log('\\n Onairos API Response');\r\n  console.log(`   Endpoint: ${endpoint}`);\r\n  console.log(`   Timestamp: ${new Date().toISOString()}`);\r\n  console.log('  ');\r\n  console.log('');\r\n\r\n  if (!response) {\r\n    console.log('   Empty response');\r\n    return;\r\n  }\r\n\r\n  // Log inference results in a proper table format using console.table for better readability\r\n  if (response.InferenceResult) {\r\n    console.group('   Inference Result');\r\n\r\n    // Content preferences\r\n    if (response.InferenceResult.output && Array.isArray(response.InferenceResult.output) && response.InferenceResult.output.length > 0) {\r\n      console.log('     Content Preferences (Scale: 0.0 - 1.0)');\r\n      \r\n      const contentTableData = response.InferenceResult.output.map((item, index) => {\r\n        const score = Array.isArray(item) ? item[0] : item;\r\n        const indicator = getScoreIndicator(score);\r\n        return {\r\n          Category: CONTENT_CATEGORIES[index] || `Category ${index + 1}`,\r\n          Score: score.toFixed(3),\r\n          Level: `${indicator.emoji} ${indicator.level}`\r\n        };\r\n      });\r\n      \r\n      console.table(contentTableData);\r\n      \r\n      // Summary statistics\r\n      const scores = response.InferenceResult.output.map(item => Array.isArray(item) ? item[0] : item);\r\n      const avg = scores.reduce((sum, s) => sum + s, 0) / scores.length;\r\n      const max = Math.max(...scores);\r\n      const min = Math.min(...scores);\r\n      const maxIndex = scores.indexOf(max);\r\n      const maxCategory = CONTENT_CATEGORIES[maxIndex] || `Category ${maxIndex + 1}`;\r\n      \r\n      console.log(`     Summary: Avg ${avg.toFixed(3)} | Max ${max.toFixed(3)} (${maxCategory}) | Min ${min.toFixed(3)}`);\r\n      console.log('');\r\n    } else {\r\n        console.log('     No content preferences output found');\r\n    }\r\n\r\n    // Personality traits\r\n    if (response.InferenceResult.traits?.personality_traits) {\r\n      console.log('     Personality Analysis (Scale: 0 - 100)');\r\n      \r\n      const traits = response.InferenceResult.traits.personality_traits;\r\n      const traitsTableData = [];\r\n\r\n      // Add Positive Traits\r\n      if (traits.positive_traits) {\r\n        Object.entries(traits.positive_traits).forEach(([trait, score]) => {\r\n          const indicator = getScoreIndicator(score, true);\r\n          const traitName = trait.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\r\n          traitsTableData.push({\r\n            Type: 'Strength ',\r\n            Trait: traitName,\r\n            Score: score.toFixed(1),\r\n            Level: `${indicator.emoji} ${indicator.level}`\r\n          });\r\n        });\r\n      }\r\n\r\n      // Add Traits to Improve\r\n      if (traits.traits_to_improve) {\r\n        Object.entries(traits.traits_to_improve).forEach(([trait, score]) => {\r\n          const indicator = getScoreIndicator(score, true);\r\n          const traitName = trait.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\r\n          // For improvement areas, lower score often means higher priority to fix, but here we just show level\r\n          // Adjust logic if \"Level\" column needs to say \"Priority\"\r\n          const priority = score < 40 ? 'High Priority' : score < 60 ? 'Medium Priority' : 'Low Priority';\r\n          \r\n          traitsTableData.push({\r\n            Type: 'Growth Area ',\r\n            Trait: traitName,\r\n            Score: score.toFixed(1),\r\n            Level: `${indicator.emoji} ${priority}`\r\n          });\r\n        });\r\n      }\r\n\r\n      if (traitsTableData.length > 0) {\r\n        console.table(traitsTableData);\r\n      } else {\r\n        console.log('     No personality traits data found');\r\n      }\r\n      console.log('');\r\n    }\r\n    \r\n    console.groupEnd();\r\n    console.log('');\r\n  }\r\n\r\n  // Log persona information (if present)\r\n  if (response.persona) {\r\n    console.log('   Persona Information');\r\n    console.log(`     ID: ${response.persona.id}`);\r\n    console.log(`     Name: ${response.persona.name}`);\r\n    if (response.persona.description) {\r\n      console.log(`     Description: ${response.persona.description}`);\r\n    }\r\n    console.log('');\r\n  }\r\n\r\n  // Log inference metadata (if present)\r\n  if (response.inference_metadata) {\r\n    console.log('   Inference Metadata');\r\n    console.log(`     Model Size: ${response.inference_metadata.size_used || 'N/A'}`);\r\n    console.log(`     Total Outputs: ${response.inference_metadata.total_outputs || 'N/A'}`);\r\n    if (response.inference_metadata.persona_applied) {\r\n      console.log(`     Persona Applied: ${response.inference_metadata.persona_applied}`);\r\n    }\r\n    console.log('');\r\n  }\r\n\r\n  // Log LLM data summary (if present)\r\n  if (response.llmData) {\r\n    console.log('   LLM Data');\r\n    console.log(`     Has LLM Data: ${response.llmData.hasLlmData || false}`);\r\n    console.log(`     Total Interactions: ${response.llmData.totalInteractions || 0}`);\r\n    if (response.llmData.platforms) {\r\n      const platforms = Object.keys(response.llmData.platforms).filter(k => response.llmData.platforms[k]);\r\n      console.log(`     Platforms: ${platforms.join(', ') || 'None'}`);\r\n    }\r\n    console.log('');\r\n  }\r\n\r\n  // Show raw data if requested\r\n  if (showRawData) {\r\n    console.log('   Raw Response Data:');\r\n    console.log(JSON.stringify(response, null, 2));\r\n    console.log('');\r\n  }\r\n\r\n  console.log('   Response logging complete');\r\n  console.log('  \\n');\r\n}\r\n\r\n/**\r\n * Simple one-line logging for API responses\r\n * @param {Object} response - API response object\r\n * @param {string} endpoint - API endpoint URL\r\n */\r\nexport function logOnairosResponseSimple(response, endpoint = 'Unknown') {\r\n  const contentCount = response?.InferenceResult?.output?.length || 0;\r\n  const hasTraits = !!(response?.InferenceResult?.traits?.personality_traits);\r\n  const hasLlm = !!(response?.llmData?.hasLlmData);\r\n\r\n  console.log(` Onairos Response [${endpoint}]: ${contentCount} content scores, Traits: ${hasTraits}, LLM: ${hasLlm}`);\r\n}\r\n\r\nexport default { logOnairosResponse, logOnairosResponseSimple };\r\n"],"names":["WelcomeScreen","onContinue","onClose","useEffect","script","document","createElement","src","async","head","appendChild","existingScript","querySelector","removeChild","React","className","style","height","alt","fontFamily","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","COLORS","btnGradStart","btnGradEnd","btnLabel","btnBorder","iconCircleGradientStart","iconCircleGradientEnd","background","backgroundSecondary","textPrimary","textSecondary","textMuted","border","borderLight","success","error","warning","info","hover","pressed","focus","IconCircle","size","children","width","borderRadius","fontSize","color","backgroundColor","PrimaryButton","label","iconRight","loading","disabled","testId","textStyle","centered","props","setPressed","useState","buttonStyle","position","overflow","minWidth","maxWidth","margin","cursor","opacity","boxShadow","transition","pressedOverlayStyle","top","left","right","bottom","labelStyle","fontWeight","textAlign","_extends","onMouseDown","handleMouseDown","onMouseUp","handleMouseUp","onMouseLeave","handleMouseLeave","display","justifyContent","alignItems","isCapacitor","window","Capacitor","Plugins","webkit","messageHandlers","bridge","isReactNative","navigator","product","global","undefined","nativeModuleProxy","isMobileApp","isMobileBrowser","test","userAgent","innerWidth","GoogleButton","onPress","isPressed","setIsPressed","onTouchStart","onTouchEnd","outline","type","EmailAuth","onSuccess","testMode","email","setEmail","codeDigits","setCodeDigits","Array","step","setStep","isLoading","setIsLoading","setError","emailSent","setEmailSent","emailServiceMessage","setEmailServiceMessage","isCodeComplete","every","length","resetCodeDigits","isMobileWeb","sleep","ms","Promise","resolve","setTimeout","postJson","url","apiKey","body","fetch","method","headers","JSON","stringify","googleLogin","useGoogleLogin","console","log","userInfoResponse","Authorization","tokenResponse","access_token","ok","Error","userInfo","json","name","gmailEmail","credential","normalizedEmail","trim","toLowerCase","baseUrl","onairosBaseUrl","onairosApiKey","authResponse","errorData","message","authData","username","isNewUser","jwtToken","token","accountInfo","accountStatus","accountCheckResponse","Info","identifier","accountData","AccountInfo","exists","connectedPlatforms","accountCheckError","warn","verified","userName","existingUser","flowType","adminMode","userCreated","provider","accountDetails","createdAt","Date","toISOString","ssoProvider","authError","handleOAuthSuccess","onError","scope","flow","handleGoogleSignIn","e","firstInput","handleEmailSubmit","preventDefault","validateEmail","data","rawEmail","res","action","legacyRes","msg","err","requestEmailVerification","handleCodeSubmit","join","split","testAccount","codeToSubmit","code","rawCode","normalizedCode","String","includes","attempt","errMsg","attemptsRemaining","verifyEmailCode","user","value","onChange","target","placeholder","paddingLeft","paddingRight","WebkitTextFillColor","onKeyDown","key","autoFocus","from","_","index","inputMode","maxLength","val","replace","next","parentElement","borderColor","caretColor","Check","BOOKMARKLET_HREF","ConnectChatGPTModal","open","onConnected","userToken","getUserToken","directToken","localStorage","getItem","userData","parse","substring","bookmarkletHref","createPortal","inset","zIndex","pointerEvents","fillRule","clipRule","animation","href","title","draggable","onDragStart","dataTransfer","setData","effectAllowed","alert","suppressHydrationWarning","handleGotIt","chatgptIcon","claudeIcon","geminiIcon","grokIcon","pinterestIcon","sdkConfig","process","env","REACT_APP_ONAIROS_API_KEY","REACT_APP_ONAIROS_BASE_URL","sdkType","enableHealthMonitoring","enableAutoRefresh","enableConnectionValidation","fadeSlideInKeyframes","UniversalOnboarding","onComplete","onBack","appIcon","appName","priorityPlatform","rawMemoriesOnly","rawMemoriesConfig","isMobile","isMobileProp","initialConnectedAccounts","lottieRef","useRef","lastFrameRef","rafRef","initialLoadDone","connectedAccounts","setConnectedAccounts","getInitialState","isArray","reduce","acc","p","isConnecting","setIsConnecting","connectingPlatform","setConnectingPlatform","selected","setSelected","currentPage","setCurrentPage","showChatGPTModal","setShowChatGPTModal","touchStartX","touchDeltaX","isActualMobileDevice","isNativePlatform","vh","setVh","innerHeight","onResize","addEventListener","removeEventListener","INFO_SHEET_MAX_H","Math","min","round","isSmallMobile","personaSide","PERSONA_TOP","SLOT","max","floor","CIRCLE","GAP_PAGE1","GAP_PAGE2","ACTIVE_SCALE","ICONS_H","igGradId","useId","Brand","ChatGPT","objectFit","Claude","Gemini","Grok","Instagram","id","cx","cy","r","offset","stopColor","YouTube","Reddit","LinkedIn","Pinterest","Twitter","aiLinks","descriptions","allPlatformsDefault","connector","icon","directLink","wrappedPlatforms","isWrappedApp","allPlatforms","canonicalizePlatformName","raw","lower","byConnector","find","byName","charAt","toUpperCase","slice","prev","propState","canonical","Object","keys","connectedArray","entries","filter","v","map","k","Boolean","setItem","dispatchEvent","CustomEvent","platforms","page","Set","has","handleAuthSuccess","platform","detail","plat","sessionStorage","now","toString","currentState","updated","justConnectedTime","parseInt","accountsObj","current","checkOAuthSuccess","sessionSuccess","sessionPlatform","removeItem","legacySuccess","legacyTs","legacyTsNum","NaN","Number","isFinite","handleSwitch","savedUser","userIdentifier","connection","revokeError","s","resolvedUsername","u","isCapacitorNative","effectiveMobile","returnUrl","location","origin","pathname","sessionPayload","bodyPayload","session","candidates","youtube","linkedin","reddit","pinterest","instagram","github","facebook","gmail","oauthUrl","candidateLower","c","withMobileReturnUrl","rawUrl","URL","cleanReturnUrl","searchParams","get","set","statePayload","ts","encoded","btoa","encodeURIComponent","localStorageKey","Browser","addListener","listenerError","windowName","presentationStyle","screenX","outerWidth","screenY","outerHeight","popup","closed","messageHandler","event","clearInterval","pollInterval","timestampKey","close","pollCount","maxPolls","setInterval","timestamp","timestampNum","connectToPlatform","connectedCount","values","totalFrames","personaAnim","progress","start","startTs","performance","t","eased","frame","goToAndStop","requestAnimationFrame","cancelAnimationFrame","flex","minHeight","scrollbarWidth","msOverflowStyle","transform","Lottie","animationData","autoplay","loop","paddingTop","paddingBottom","touches","clientX","onTouchMove","dx","gridAutoFlow","gridTemplateColumns","columnGap","justifyItems","paddingInline","idx","on","showConnectedStyling","isSel","shift","hasCapacitor","transformOrigin","marginTop","marginBottom","n","maxHeight","overflowY","overflowX","role","stopPropagation","WebkitTapHighlightColor","userSelect","touchAction","xmlns","hasConnections","connectedList","totalConnections","PinSetup","userEmail","pin","setPin","pinRequirements","setPinRequirements","uppercase","number","keyboardOffset","setKeyboardOffset","scrollAreaRef","inputRef","isMobileViewport","useMemo","visualViewport","vv","update","allRequirementsMet","ref","onFocus","scrollIntoView","block","behavior","willChange","handleSubmit","pinCreated","Icon","base","DataTypeToggle","dataType","enabled","onToggle","isNative","handle","required","options","DataRequest","onConnectMoreApps","showTime","onLogout","basic","rawMemories","preferences","personality","freq","setFreq","platformIconFailed","setPlatformIconFailed","setPlatforms","normalizePlatformName","twitter","x","chatgpt","claude","gemini","grok","toggle","option","opt","selectedCount","refreshPlatforms","newPlatforms","getConnected","normalized","mappedRaw","mapped","handleConnectedAccountsUpdate","handleStorageChange","availableOptions","hasLLMConnections","llmPlatforms","some","freqToPercent","f","textDecoration","currentTarget","innerHTML","rect","getBoundingClientRect","ratio","WebkitOverflowScrolling","GitHub","Facebook","Gmail","failed","fallbackText","approved","TrainingComponent","currentStep","setCurrentStep","setProgress","isComplete","setIsComplete","steps","description","duration","interval","stepTimeout","stepDuration","stepProgress","newProgress","completionDelay","trainingComplete","simulatedTraining","clearTimeout","trainingPhrases","TrainingScreen","onTrainingStart","currentPhrase","setCurrentPhrase","socket","progressTimer","didSignalStart","watchdogTimer","phraseTimer","phraseIndex","signalTrainingStarted","startVaguePhraseRotation","resetWatchdog","disconnect","fallback","autoCompleted","storedToken","io","auth","transports","reconnection","timeout","socketId","emit","percentage","upvoted","details","upvotedCount","downvoted","downvotedCount","total","totalCount","suggestions","errorCode","errorDetails","result","traits","userTraits","then","logger","responseData","InferenceResult","personality_traits","output","inferenceResults","inference_metadata","source","completionType","logOnairosResponse","detailed","catch","reason","runTrainingAndInference","gap","lineHeight","rainAnim","LoadingScreen","progressInterval","completeTimer","WrappedLoadingPage","setAnimationData","messageIndex","setMessageIndex","messages","err2","timer","messageTimer","PERSONALITY_TYPES","TRAIT_CATEGORIES","formatOnairosResponse","apiResponse","includeDictionary","includeArray","formatted","scores","personalityDict","forEach","traitResult","traitDict","category","formatUserDataForDisplay","userDataSummary","requestInfo","userHash","dataTypesRequested","approvedData","formatConnectedAccounts","aiData","formatAIResponseData","prettyPrint","lines","push","repeat","toLocaleString","summary","status","hasData","dataTypes","createPrettyPrintVersion","accounts","count","names","a","connectedAt","account","available","dashboard","slides","apps","appsCount","personalityData","logFormattedUserData","PageLayout","subtitle","showHeader","showCloseButton","showBackButton","contentClassName","centerContent","isSmallScreen","disableContentPadding","layoutStyle","flexDirection","headerStyle","padding","contentStyle","titleStyle","subtitleStyle","ModalPageLayout","visible","onBackdropClick","backdropStyle","modalStyle","modalClassName","pageLayoutProps","visualHeight","setVisualHeight","handleResize","h","mobileModalHeightPx","setMobileModalHeightPx","compute","modalHeight","modalMaxHeight","modalMaxWidth","backdropAlign","backdropPadding","backdropStyles","hasBackdropStyleOverride","backdropStyleOverride","modalStyles","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","marginLeft","marginRight","flexShrink","hasModalStyleOverride","modalStyleWasApplied","modalStyleOverride","modalStyleKeys","backdropStyleKeys","modalMinHeight","SESSION_CONFIG","DEFAULT_SESSION_DURATION","SHORT_SESSION_DURATION","COOKIE_NAME","STORAGE_KEYS","USER_DATA","USER_TOKEN","SESSION_EXPIRY","isSessionValid","expiryTimestamp","expiry","expiryDate","isValid","daysRemaining","ceil","toLocaleDateString","getSessionExpiry","setSessionExpiry","expiryISO","setCookie","extendSession","validateToken","valid","payload","parts","atob","userId","sub","exp","getStoredToken","nameEQ","ca","cookie","i","indexOf","decodeURIComponent","getCookie","checkValidSession","hasSession","shouldSkipLogin","userDataStr","onboardingComplete","validation","createSession","sessionData","lastSessionTime","sessionCreatedAt","destroySession","deleteCookie","clear","maxAge","maxAgeSeconds","secure","protocol","sameSite","OnairosButton","requestData","webpageName","inferenceData","autoFetch","proofMode","textLayout","textColor","login","buttonType","loginReturn","loginType","visualType","enableTraining","formatResponse","responseFormat","time","showOverlay","setShowOverlay","currentFlow","setCurrentFlow","trainingHasStarted","setTrainingHasStarted","setUserData","oauthReturnDetected","setOauthReturnDetected","returnToDataRequestAfterOnboarding","setReturnToDataRequestAfterOnboarding","isMobileDevice","setIsMobileDevice","computeMobile","documentElement","clientWidth","parent","isCapNative","detectedMobile","dataset","onairosPrevOverflow","isDesktop","modal","pageContent","shell","getMetrics","el","styles","getComputedStyle","classList","viewportWidth","handleDeepLink","hasSuccess","hasError","isPopup","opener","params","qIdx","URLSearchParams","postMessage","history","replaceState","startsWith","cleanUrl","questionMarkIndex","state","decoded","connectionType","existingUserData","existing","merged","appListener","AppPlugin","App","setupListener","remove","checkWindowUrl","checkExistingSession","search","sessionCheck","lastDataRequest","checkOAuthReturn","urlParams","oauthSuccess","oauthPlatform","oauthEmail","newUrl","gmailSuccess","gmailTimestamp","handleCloseOverlay","handleLogout","handleWelcomeContinue","handleEmailAuthSuccess","userState","hasAccountInfo","candidate","accessToken","base64","charCodeAt","backendSaysNewUser","hasConnectedPlatforms","hasTrainedModel","hasPersonalityTraits","hasExistingData","decision","accountStatusExists","authDataExistingUser","newUserData","emailToken","handleOnboardingComplete","onboardingData","updatedUserData","handlePinSetupComplete","pinData","timeoutId","handleLoadingComplete","handleTrainingComplete","trainingResult","trainingCompleted","handleTrainingScreenComplete","handleDataRequestComplete","requestResult","accountIdentifier","finalResult","urlResponse","appId","confirmations","EncryptedUserPin","storage","urlData","apiUrl","apiUrlLooksWrapped","nameLooksWrapped","fetchStartTime","eventDetail","dataResponse","fetchUrl","fetchBody","includeLlmData","cacheBust","isRetry","retry","note","fetchCompleted","fetchError","controller","AbortController","abort","cache","signal","statusText","fromEntries","fetchDuration","isCachedResponse","hasActualDashboard","hasStatus","hasSlides","hasDashboard","responseKeys","normalizedForLogging","llmData","retrievedAt","metadata","showRawData","logErr","basePollInterval","poll_interval_seconds","pollUrl","pollBody","force_refresh","refresh","nonce","pollResponse","pollData","version","user_id","generated_at","has_meta","meta","is_fallback","fallback_reason","signature","roasts","red_pill_forensic","knownGenericRoasts","roast","pollErr","isTimeout","fetchErr","hasApiResponse","hasToken","formattedResult","hasWrappedDashboardPayload","completeResult","enhancedResult","formatError","isWrappedAppForCallback","hasWrappedDashboard","hasWrappedDashboardNow","handleDashboardReady","renderContent","commonProps","saved","hasUserData","tokenPreview","buttonClass","logoStyle","getText","CONTENT_CATEGORIES","getScoreIndicator","score","isPercentage","normalizedScore","emoji","level","response","endpoint","group","contentTableData","item","indicator","Category","Score","toFixed","Level","table","avg","sum","maxIndex","maxCategory","traitsTableData","positive_traits","trait","traitName","w","Type","Trait","traits_to_improve","priority","groupEnd","persona","size_used","total_outputs","persona_applied","hasLlmData","totalInteractions","logOnairosResponseSimple","contentCount","hasTraits","hasLlm"],"sourceRoot":""}