{"version":3,"file":"198.js","mappings":"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","sources":["webpack://OnairosLaravel/./src/components/WelcomeScreen.jsx","webpack://OnairosLaravel/./src/theme/colors.js","webpack://OnairosLaravel/./src/components/ui/PrimaryButton.jsx","webpack://OnairosLaravel/./src/components/EmailAuth.js","webpack://OnairosLaravel/./src/utils/capacitorDetection.js","webpack://OnairosLaravel/./src/components/ConnectChatGPTModal.jsx","webpack://OnairosLaravel/./src/components/UniversalOnboarding.jsx","webpack://OnairosLaravel/./src/components/PinSetup.js","webpack://OnairosLaravel/./src/components/DataRequest.js","webpack://OnairosLaravel/./src/components/TrainingComponent.jsx","webpack://OnairosLaravel/./src/components/TrainingScreen.jsx","webpack://OnairosLaravel/./src/components/LoadingScreen.jsx","webpack://OnairosLaravel/./src/components/WrappedLoadingPage.jsx","webpack://OnairosLaravel/./src/utils/responseFormatter.js","webpack://OnairosLaravel/./src/utils/userDataFormatter.js","webpack://OnairosLaravel/./src/components/ui/PageLayout.jsx","webpack://OnairosLaravel/./src/onairosButton.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { COLORS } from '../theme/colors.js';\n\nexport default function WelcomeScreen({ onContinue, onClose }) {\n  // Load Sirv script for responsive images\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = 'https://scripts.sirv.com/sirvjs/v3/sirv.js';\n    script.async = true;\n    document.head.appendChild(script);\n    \n    return () => {\n      const existingScript = document.querySelector('script[src=\"https://scripts.sirv.com/sirvjs/v3/sirv.js\"]');\n      if (existingScript) {\n        document.head.removeChild(existingScript);\n      }\n    };\n  }, []);\n\n  return (\n    <div className=\"w-full flex flex-col\" style={{ height: '100%' }}>\n      {/* Content - Flexible center area */}\n      <div className=\"px-6 pt-16 text-center flex-1 flex flex-col\">\n        {/* Logo */}\n        <div className=\"mb-8 flex justify-center\">\n          <div className=\"w-20 h-20 flex items-center justify-center\">\n            <img \n              className=\"Sirv w-full h-full object-contain\" \n              data-src=\"https://anushkasirv.sirv.com/OnairosBlack.png\" \n              alt=\"Onairos Logo\"\n            />\n          </div>\n        </div>\n\n        {/* Welcome Text */}\n        <p className=\"text-gray-500 text-sm mb-2\">Welcome to</p>\n\n        {/* Main Title */}\n        <h1 className=\"text-4xl font-bold text-gray-900 mb-6 text-balance\">Onairos</h1>\n\n        {/* Description */}\n        <p className=\"text-gray-600 text-base leading-relaxed mb-12 text-pretty px-2\">\n          OnairOS personalizes your digital experience on every app so you can just enjoy being you!\n        </p>\n      </div>\n\n      {/* Get Started Button - Fixed at bottom */}\n      <div className=\"px-6 pb-8 flex-shrink-0\">\n        <button\n          className=\"w-full bg-gray-900 hover:bg-gray-800 text-white rounded-full py-4 text-base font-medium flex items-center justify-center gap-2 transition-colors\"\n          onClick={onContinue}\n        >\n          Get Started\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n          </svg>\n        </button>\n      </div>\n    </div>\n  );\n}\n","// Theme colors for Onairos SDK - derived from mobile design\nexport const COLORS = {\n  // Button gradient colors\n  btnGradStart: '#1A1A1A',\n  btnGradEnd: '#000000',\n  \n  // Button text and icon colors\n  btnLabel: '#FFFFFF',\n  btnBorder: 'rgba(0, 0, 0, 0.2)',\n  \n  // Icon circle gradient colors\n  iconCircleGradientStart: '#333333',\n  iconCircleGradientEnd: '#1A1A1A',\n  \n  // Background colors\n  background: '#FFFFFF',\n  backgroundSecondary: '#F8F9FA',\n  \n  // Text colors\n  textPrimary: '#1A1A1A',\n  textSecondary: '#6B7280',\n  textMuted: '#9CA3AF',\n  \n  // Border colors\n  border: '#E5E7EB',\n  borderLight: '#F3F4F6',\n  \n  // Status colors\n  success: '#10B981',\n  error: '#EF4444',\n  warning: '#F59E0B',\n  info: '#3B82F6',\n  \n  // Interactive states\n  hover: 'rgba(0, 0, 0, 0.05)',\n  pressed: 'rgba(0, 0, 0, 0.1)',\n  focus: 'rgba(59, 130, 246, 0.1)',\n};\n\nexport default COLORS; ","import React, { useState } from 'react';\nimport { COLORS } from '../../theme/colors.js';\n\n// Icon Circle component matching the React Native version\nconst IconCircle = ({ \n  size = 40, \n  children,\n  className = ''\n}) => {\n  return (\n    <div \n      className={`relative flex items-center justify-center border border-black border-opacity-25 ${className}`}\n      style={{\n        width: size,\n        height: size,\n        borderRadius: size / 2,\n        background: `linear-gradient(to bottom, ${COLORS.iconCircleGradientStart}, ${COLORS.iconCircleGradientEnd})`\n      }}\n    >\n      {children || (\n        <span \n          className=\"font-semibold opacity-95\"\n          style={{\n            fontSize: '20px',\n            color: COLORS.btnLabel,\n            backgroundColor: 'transparent'\n          }}\n        >\n          \n        </span>\n      )}\n    </div>\n  );\n};\n\n// Primary Button component matching the React Native design\nconst PrimaryButton = ({\n  label = \"Get Started\",\n  onClick,\n  iconRight,\n  loading = false,\n  disabled = false,\n  testId,\n  className = '',\n  style = {},\n  textStyle = {},\n  centered = false,\n  ...props\n}) => {\n  const [pressed, setPressed] = useState(false);\n\n  const handleMouseDown = () => setPressed(true);\n  const handleMouseUp = () => setPressed(false);\n  const handleMouseLeave = () => setPressed(false);\n\n  const buttonStyle = {\n    height: '48px',\n    borderRadius: '100px',\n    border: `1px solid ${COLORS.btnBorder}`,\n    background: `linear-gradient(to bottom, ${COLORS.btnGradStart}, ${COLORS.btnGradEnd})`,\n    position: 'relative',\n    overflow: 'hidden',\n    width: centered ? 'auto' : '100%',\n    minWidth: centered ? '250px' : 'auto',\n    maxWidth: centered ? '350px' : 'none',\n    margin: centered ? '0 auto' : '0',\n    cursor: disabled ? 'not-allowed' : 'pointer',\n    opacity: disabled ? 0.65 : 1,\n    boxShadow: disabled ? 'none' : '20px 30px 40px rgba(0,0,0,0.10)',\n    transition: 'all 0.2s ease',\n    ...style\n  };\n\n  const pressedOverlayStyle = {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: 'rgba(0,0,0,0.1)',\n    borderRadius: '100px',\n    opacity: pressed ? 1 : 0,\n    transition: 'opacity 0.1s ease'\n  };\n\n  const textContainerStyle = {\n    position: 'absolute',\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'transparent'\n  };\n\n  const iconPositionStyle = {\n    position: 'absolute',\n    right: '4px',\n    top: '4px',\n    bottom: '4px',\n    width: '40px',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'transparent'\n  };\n\n  const labelStyle = {\n    fontFamily: 'Inter, system-ui, sans-serif',\n    fontWeight: '600',\n    fontSize: '16px',\n    color: COLORS.btnLabel,\n    textAlign: 'center',\n    backgroundColor: 'transparent',\n    ...textStyle\n  };\n\n  return (\n    <button\n      className={`relative ${className}`}\n      style={buttonStyle}\n      onClick={onClick}\n      onMouseDown={handleMouseDown}\n      onMouseUp={handleMouseUp}\n      onMouseLeave={handleMouseLeave}\n      disabled={disabled || loading}\n      data-testid={testId}\n      aria-label={label}\n      {...props}\n    >\n      {/* Pressed state overlay */}\n      <div style={pressedOverlayStyle} />\n\n      {/* Centered text container */}\n      <div style={textContainerStyle}>\n        {loading ? (\n          <div \n            className=\"animate-spin rounded-full border-2 border-white border-t-transparent\"\n            style={{ width: '20px', height: '20px' }}\n          />\n        ) : (\n          <span style={labelStyle}>{label}</span>\n        )}\n      </div>\n\n      {/* Icon in fixed position on right */}\n      <div style={iconPositionStyle}>\n        {!loading && (iconRight || <IconCircle />)}\n      </div>\n    </button>\n  );\n};\n\nexport { IconCircle };\nexport default PrimaryButton; ","import React, { useState, useEffect } from 'react';\nimport { Mail, ArrowRight, Check } from 'lucide-react';\nimport { GoogleLogin } from '@react-oauth/google';\nimport PrimaryButton from './ui/PrimaryButton.jsx';\nimport { COLORS } from '../theme/colors.js';\n\nexport default function EmailAuth({ onSuccess, testMode = true }) {\n  const [email, setEmail] = useState('');\n  // Store verification code as per-digit state to avoid losing position when users click/paste/autofill.\n  const [codeDigits, setCodeDigits] = useState(() => Array(6).fill(''));\n  const [step, setStep] = useState('email'); // 'email' | 'code' | 'success'\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [emailSent, setEmailSent] = useState(true); // Track if email was actually sent\n  const [emailServiceMessage, setEmailServiceMessage] = useState(''); // Store service message\n  const code = codeDigits.join('');\n  const isCodeComplete = codeDigits.every((d) => typeof d === 'string' && d.length === 1);\n  const resetCodeDigits = () => setCodeDigits(Array(6).fill(''));\n\n  const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\n  const postJson = async (url, apiKey, body) => {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-api-key': apiKey,\n        'Authorization': `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify(body),\n    });\n    return response;\n  };\n\n  // Prefer the newer single-endpoint API: POST /email/verification { action: 'request'|'verify' }\n  // Fall back to legacy /email/verify and /email/verify/confirm if needed.\n  const requestEmailVerification = async ({ baseUrl, apiKey, email: rawEmail }) => {\n    const normalizedEmail = (rawEmail || '').trim().toLowerCase();\n\n    // New endpoint\n    try {\n      const res = await postJson(`${baseUrl}/email/verification`, apiKey, {\n        email: normalizedEmail,\n        action: 'request',\n      });\n      if (res.ok) return await res.json();\n    } catch {\n      // ignore and fall back\n    }\n\n    // Legacy endpoint\n    const legacyRes = await postJson(`${baseUrl}/email/verify`, apiKey, { email: normalizedEmail });\n    if (!legacyRes.ok) {\n      let msg = 'Failed to send verification code';\n      try {\n        const err = await legacyRes.json();\n        if (err?.error) msg = err.error;\n      } catch {}\n      throw new Error(msg);\n    }\n    return await legacyRes.json();\n  };\n\n  const verifyEmailCode = async ({ baseUrl, apiKey, email: rawEmail, code: rawCode }) => {\n    const normalizedEmail = (rawEmail || '').trim().toLowerCase();\n    const normalizedCode = String(rawCode || '').trim();\n\n    // New endpoint\n    try {\n      const res = await postJson(`${baseUrl}/email/verification`, apiKey, {\n        email: normalizedEmail,\n        action: 'verify',\n        code: normalizedCode,\n      });\n      if (res.ok) return await res.json();\n      // If it's a hard failure, surface its message\n      try {\n        const err = await res.json();\n        throw new Error(err?.error || err?.message || 'Verification failed');\n      } catch (e) {\n        // If parsing fails, fall through to legacy retry below\n        if (e instanceof Error) throw e;\n      }\n    } catch (e) {\n      // If server doesn't support /email/verification or network hiccup, try legacy below.\n      // If it's a real \"invalid code\" error, we rethrow and don't spam retries.\n      const msg = e?.message || '';\n      if (msg && !msg.toLowerCase().includes('not found') && !msg.toLowerCase().includes('cannot')) {\n        // Keep going to legacy; it might be the only supported path.\n      }\n    }\n\n    // Legacy endpoint with light retry for multi-instance deployments:\n    // \"No verification code found\" often means request+confirm hit different servers.\n    const maxAttempts = 5;\n    for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n      const res = await postJson(`${baseUrl}/email/verify/confirm`, apiKey, {\n        email: normalizedEmail,\n        code: normalizedCode,\n      });\n\n      if (res.ok) return await res.json();\n\n      let errMsg = 'Invalid verification code';\n      try {\n        const err = await res.json();\n        if (err?.error) errMsg = err.error;\n        if (typeof err?.attemptsRemaining === 'number') {\n          errMsg = `${errMsg} (attempts remaining: ${err.attemptsRemaining})`;\n        }\n      } catch {}\n\n      // Retry only for the \"code missing\" case\n      if (errMsg.toLowerCase().includes('no verification code found') && attempt < maxAttempts) {\n        await sleep(150 * attempt);\n        continue;\n      }\n\n      throw new Error(errMsg);\n    }\n\n    throw new Error('Verification failed');\n  };\n\n  // Helper function to handle OAuth success (Gmail) - defined early for useEffect\n  const handleOAuthSuccess = async (gmailEmail) => {\n    try {\n      setIsLoading(true);\n      console.log(' Google OAuth completed successfully, email:', gmailEmail);\n\n      const normalizedEmail = (gmailEmail || '').trim().toLowerCase();\n      setEmail(normalizedEmail);\n\n      // Check if this email already has an account in the backend\n      const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\n      const apiKey = (typeof window !== 'undefined' && window.onairosApiKey) || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey';\n\n      let accountInfo = null;\n      let accountStatus = null;\n      let existingUser = false;\n\n      try {\n        console.log(' Checking if account exists for:', normalizedEmail);\n        const accountCheckResponse = await fetch(`${baseUrl}/getAccountInfo/email`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'x-api-key': apiKey,\n          },\n          body: JSON.stringify({\n            Info: {\n              identifier: normalizedEmail\n            }\n          })\n        });\n\n        if (accountCheckResponse.ok) {\n          const accountData = await accountCheckResponse.json();\n          \n          if (accountData.AccountInfo) {\n            accountInfo = accountData.AccountInfo;\n            accountStatus = accountData.accountStatus;\n            existingUser = accountStatus?.exists || false;\n            \n            console.log(' Existing account found:', {\n              exists: existingUser,\n              hasTrainedModel: accountStatus?.hasTrainedModel,\n              hasPersonalityTraits: accountStatus?.hasPersonalityTraits,\n              connectedPlatforms: accountStatus?.connectedPlatforms,\n              needsDataConnection: accountStatus?.needsDataConnection,\n              needsTraining: accountStatus?.needsTraining,\n              canUseInference: accountStatus?.canUseInference\n            });\n          } else {\n            console.log(' No existing account found - new user');\n          }\n        } else {\n          console.log(' Account check returned non-OK status - treating as new user');\n        }\n      } catch (accountCheckError) {\n        console.warn(' Could not check account status, treating as new user:', accountCheckError);\n      }\n\n      setStep('success');\n      setIsLoading(false);\n\n      setTimeout(() => {\n        onSuccess({\n          email: normalizedEmail,\n          verified: true,\n          token: null,\n          userName: normalizedEmail.split('@')[0],\n          existingUser: existingUser,\n          accountInfo: accountInfo,\n          accountStatus: accountStatus, // NEW: Pass the accountStatus object\n          isNewUser: !existingUser,\n          flowType: existingUser ? 'dataRequest' : 'onboarding',\n          adminMode: false,\n          userCreated: !existingUser,\n          accountDetails: existingUser ? accountInfo : {\n            email: normalizedEmail,\n            createdAt: new Date().toISOString(),\n            ssoProvider: 'gmail'\n          }\n        });\n      }, 400);\n    \n    } catch (error) {\n      console.error(' Error handling OAuth success:', error);\n      setError('Failed to continue with Google authentication. Please try again.');\n      setIsLoading(false);\n    }\n  };\n\n  // Check for Gmail OAuth success on mount (after redirect back)\n  useEffect(() => {\n    const checkGmailOAuthSuccess = () => {\n      const gmailSuccess = localStorage.getItem('onairos_gmail_success');\n      const gmailTimestamp = localStorage.getItem('onairos_gmail_timestamp');\n      const oauthContext = localStorage.getItem('onairos_oauth_context');\n      \n      // Only process if we're coming back from Gmail auth flow\n      if (gmailSuccess === 'true' && gmailTimestamp && oauthContext === 'gmail-auth') {\n        const timestampNum = parseInt(gmailTimestamp, 10);\n        const now = Date.now();\n        \n        // Only process if timestamp is recent (within last 30 seconds)\n        if (now - timestampNum < 30000) {\n          console.log(' Gmail OAuth completed - processing redirect back');\n          \n          // Get email from localStorage\n          const gmailEmail = localStorage.getItem('onairos_gmail_email') || \n                           localStorage.getItem('onairos_oauth_email');\n          \n          // Clean up localStorage\n          localStorage.removeItem('onairos_gmail_success');\n          localStorage.removeItem('onairos_gmail_timestamp');\n          localStorage.removeItem('onairos_oauth_context');\n          localStorage.removeItem('onairos_return_url');\n          \n          if (gmailEmail) {\n            // Process OAuth success\n            handleOAuthSuccess(gmailEmail);\n          }\n        }\n      }\n    };\n\n    checkGmailOAuthSuccess();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // Only run once on mount\n\n  // Check for OAuth completion on mount (for same-page redirect flow)\n  useEffect(() => {\n    const checkOAuthCompletion = () => {\n      // Check URL params for OAuth completion\n      const urlParams = new URLSearchParams(window.location.search);\n      const oauthSuccess = urlParams.get('onairos_oauth_success');\n      const oauthPlatform = urlParams.get('onairos_oauth_platform');\n      const oauthEmail = urlParams.get('onairos_oauth_email');\n\n      if (oauthSuccess === 'true' && oauthPlatform === 'gmail' && oauthEmail) {\n        console.log(' Gmail OAuth completion detected on page load');\n        // Clean up URL\n        const newUrl = window.location.pathname;\n        window.history.replaceState({}, '', newUrl);\n        // Handle OAuth success\n        handleOAuthSuccess(oauthEmail);\n      } else {\n        // Check localStorage for OAuth completion (fallback)\n        const success = localStorage.getItem('onairos_gmail_success');\n        const timestamp = localStorage.getItem('onairos_gmail_timestamp');\n        const gmailEmail = localStorage.getItem('onairos_gmail_email');\n\n        if (success === 'true' && timestamp && gmailEmail) {\n          const timestampNum = parseInt(timestamp, 10);\n          const now = Date.now();\n          \n          // Only process if timestamp is recent (within last 60 seconds)\n          if (now - timestampNum < 60000) {\n            console.log(' Gmail OAuth completion detected via localStorage');\n            // Clean up localStorage\n            localStorage.removeItem('onairos_gmail_success');\n            localStorage.removeItem('onairos_gmail_timestamp');\n            // Handle OAuth success\n            handleOAuthSuccess(gmailEmail);\n          }\n        }\n      }\n    };\n\n    checkOAuthCompletion();\n  }, []); // Run once on mount\n\n  // Auto-focus first PIN input when code step loads\n  useEffect(() => {\n    if (step === 'code') {\n      // Small delay to ensure DOM is ready\n      setTimeout(() => {\n        const firstInput = document.querySelector('input.onairos-verification-digit');\n        if (firstInput) {\n          firstInput.focus();\n        }\n      }, 100);\n    }\n  }, [step]);\n\n  const validateEmail = (email) => {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  };\n\n  const handleEmailSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setEmailSent(true); // Reset email status\n    setEmailServiceMessage(''); // Reset service message\n    resetCodeDigits();\n\n    if (!validateEmail(email)) {\n      setError('Please enter a valid email address');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      if (testMode) {\n        // Test mode: Skip API call completely, simulate instant success\n        console.log(' Test mode: Simulating email verification request for:', email);\n        setTimeout(() => {\n          setStep('code');\n          setIsLoading(false);\n          console.log(' Test mode: Email verification simulated successfully');\n        }, 800); // Shorter delay for faster testing\n      } else {\n        // Production mode: Use proper email verification API from schema\n        const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\n        const apiKey = (typeof window !== 'undefined' && window.onairosApiKey) || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey';\n        const data = await requestEmailVerification({ baseUrl, apiKey, email });\n\n        console.log(' Email request response:', data);\n\n        // Store email service status\n        // /email/verify returns emailSent, /email/verification typically does not.\n        setEmailSent(data.emailSent !== false);\n        setEmailServiceMessage(data.message || '');\n\n        setStep('code');\n        setIsLoading(false);\n      }\n    } catch (error) {\n      console.error('Email request error:', error);\n      setError(error.message);\n      setIsLoading(false);\n    }\n  };\n\n  // Handle Google Sign-In success (using official GoogleLogin component)\n  const handleGoogleSuccess = async (credentialResponse) => {\n    try {\n      setIsLoading(true);\n      setError('');\n      console.log(' Google Sign-In successful, received credential');\n\n      // Decode the JWT credential to get user info\n      const credential = credentialResponse.credential;\n      const base64Url = credential.split('.')[1];\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n      const jsonPayload = decodeURIComponent(\n        atob(base64)\n          .split('')\n          .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n          .join('')\n      );\n\n      const userInfo = JSON.parse(jsonPayload);\n      const gmailEmail = userInfo.email;\n      \n      console.log(' Decoded user email from Google:', gmailEmail);\n      console.log(' User info:', { \n        email: userInfo.email, \n        name: userInfo.name,\n        picture: userInfo.picture,\n        email_verified: userInfo.email_verified\n      });\n\n      // Send to backend for authentication - backend creates account if new\n      try {\n        const sdkConfig = {\n          baseUrl: 'https://api2.onairos.uk',\n          apiKey: window.onairosApiKey || 'test-key',\n        };\n\n        const response = await fetch(`${sdkConfig.baseUrl}/auth/google`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'x-api-key': sdkConfig.apiKey,\n          },\n          body: JSON.stringify({\n            credential: credential,\n            email: gmailEmail,\n            userInfo: userInfo,\n          }),\n        });\n\n        if (response.ok) {\n          const authData = await response.json();\n          console.log(' Google auth response:', authData);\n\n          // TRUST the backend's isNewUser field - it knows if account was just created!\n          const isNewUser = authData.body?.isNewUser !== undefined ? authData.body.isNewUser : authData.isNewUser;\n          const existingUser = !isNewUser;\n\n          console.log(' Using backend isNewUser determination:', {\n            isNewUser: isNewUser,\n            existingUser: existingUser,\n            httpStatus: authData.status,\n            message: authData.body?.message || authData.message\n          });\n\n          setStep('success');\n          setIsLoading(false);\n\n          setTimeout(() => {\n            onSuccess({\n              email: gmailEmail,\n              verified: true,\n              token: authData.body?.token || authData.token || null,\n              userName: authData.body?.username || authData.username || gmailEmail.split('@')[0],\n              existingUser: existingUser,\n              isNewUser: isNewUser,\n              flowType: isNewUser ? 'onboarding' : 'dataRequest',\n              accountInfo: {\n                email: gmailEmail,\n                name: userInfo.name,\n                picture: userInfo.picture,\n                verified: true,\n                ssoProvider: 'google'\n              },\n              adminMode: false,\n              userCreated: isNewUser,\n              accountDetails: {\n                email: gmailEmail,\n                name: userInfo.name,\n                picture: userInfo.picture,\n                createdAt: new Date().toISOString(),\n                ssoProvider: 'google'\n              }\n            });\n          }, 400);\n          return;\n        } else {\n          console.warn(' Backend /auth/google failed, falling back to account check');\n        }\n      } catch (backendError) {\n        console.warn(' Backend /auth/google error, falling back to account check:', backendError);\n      }\n\n      // Fallback: Continue with the OAuth success flow (account check)\n      handleOAuthSuccess(gmailEmail);\n\n    } catch (error) {\n      console.error(' Google Sign-In processing failed:', error);\n      setError('Google authentication failed. Please try again.');\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleError = () => {\n    console.error(' Google Sign-In failed');\n    setError('Google authentication failed. Please try again.');\n    setIsLoading(false);\n  };\n\n  // handleOAuthSuccess is defined at the top of the component for use in useEffect\n\n  const handleCodeSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    try {\n      if (testMode) {\n        // Test mode: Skip API call completely, simulate verification\n        console.log(' Test mode: Simulating code verification for:', email, 'with code:', code);\n        \n        if (code === '123456' || isCodeComplete) {\n          setStep('success');\n          setTimeout(() => {\n            // Simulate new user for design testing\n            const simulatedResponse = { \n              email, \n              verified: true, \n              token: 'test-token-' + Date.now(),\n              userName: email.split('@')[0],\n              existingUser: false, // Always simulate new user for full flow testing\n              accountInfo: null,\n              isNewUser: true,\n              flowType: 'onboarding',\n              adminMode: false,\n              userCreated: true,\n              accountDetails: {\n                email: email,\n                createdAt: new Date().toISOString(),\n                testAccount: true\n              }\n            };\n            console.log(' Test mode: Simulated verification successful, user data:', simulatedResponse);\n            onSuccess(simulatedResponse);\n          }, 600); // Faster for design testing\n        } else {\n          setError('Invalid code. Use any 6-digit code (e.g., 123456) for testing.');\n          setIsLoading(false);\n        }\n      } else {\n        // Production mode: Use real email verification API from schema\n        const baseUrl = (typeof window !== 'undefined' && window.onairosBaseUrl) || 'https://api2.onairos.uk';\n        const apiKey = (typeof window !== 'undefined' && window.onairosApiKey) || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey';\n        const codeToSubmit = codeDigits.join('');\n\n        if (!isCodeComplete) {\n          throw new Error('Please enter the full 6-digit code.');\n        }\n        \n        const data = await verifyEmailCode({ baseUrl, apiKey, email, code: codeToSubmit.trim() });\n        \n        if (!data.success) {\n          throw new Error(data.error || 'Verification failed');\n        }\n\n        console.log(' Email verification response:', data);\n\n        // TRUST the backend's isNewUser field - it knows if account was just created!\n        // Backend creates account during verification, so it's authoritative\n        const isNewUser = data.isNewUser !== undefined ? data.isNewUser : true;\n        const existingUser = !isNewUser;\n\n        console.log(' Using backend isNewUser determination:', {\n          isNewUser: isNewUser,\n          existingUser: existingUser,\n          userState: data.userState,\n          flowType: data.flowType,\n          hasExistingData: data.existingUserData?.hasExistingData\n        });\n\n        // Use data from verification response\n        const accountInfo = data.user || data.accountInfo || null;\n        const accountStatus = data.accountStatus || null;\n        \n        // Optional: For existing users, we could fetch detailed account info if needed\n        // But the verification response already includes existingUserData for returning users\n\n        setStep('success');\n        setTimeout(() => {\n          // Pass complete API response - trust backend's flow determination\n          onSuccess({ \n            email, \n            verified: true, \n            token: data.token || data.jwtToken,\n            userName: data.userName || accountInfo?.userName,\n            existingUser: existingUser,\n            isNewUser: isNewUser,\n            userState: data.userState,\n            flowType: isNewUser ? 'onboarding' : 'dataRequest',\n            accountInfo: accountInfo,\n            accountStatus: accountStatus,\n            existingUserData: data.existingUserData || null,\n            enochInstructions: data.enochInstructions || null,\n            displayMessages: data.displayMessages || null,\n            adminMode: data.adminMode,\n            userCreated: data.userCreated,\n            accountDetails: accountInfo || {\n              email: email,\n              createdAt: data.createdAt || accountInfo?.creationDate || new Date().toISOString(),\n              provider: 'email'\n            }\n          });\n        }, 1000);\n      }\n    } catch (error) {\n      console.error('Email verification error:', error);\n      setError(error.message || 'Invalid code. Please try again.');\n      setIsLoading(false);\n    }\n  };\n\n  const renderEmailStep = () => (\n    <div className=\"w-full flex flex-col\" style={{ height: '100%' }}>\n      {/* Content - Flexible center area */}\n      <div className=\"px-12 pt-16 pb-8 text-center flex-1 flex flex-col\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2 text-balance leading-tight\">\n            Use pre-existing Persona or create a new one in seconds\n          </h1>\n          <p className=\"text-gray-600 text-base\">Sign in or create an account</p>\n        </div>\n\n        <div className=\"mb-6\">\n          <input\n            type=\"email\"\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n            placeholder=\"Enter your email\"\n            className=\"w-full max-w-sm mx-auto px-4 py-4 text-base bg-gray-50 border-0 rounded-xl !text-black placeholder:text-gray-400 focus:bg-white focus:ring-2 focus:ring-gray-200 outline-none transition-all duration-200\"\n            style={{ \n              fontFamily: 'Inter, system-ui, sans-serif',\n              WebkitTextFillColor: '#000000'\n            }}\n            required\n          />\n        </div>\n\n        <div className=\"mb-6 text-center\">\n          <span className=\"text-gray-500 text-sm\">Or</span>\n        </div>\n\n        <div className=\"mb-8 flex justify-center\">\n          <GoogleLogin\n            onSuccess={handleGoogleSuccess}\n            onError={handleGoogleError}\n            text=\"continue_with\"\n            size=\"large\"\n            shape=\"rectangular\"\n            width=\"384\"\n            logo_alignment=\"left\"\n          />\n        </div>\n\n        {/* Error Display */}\n        {error && (\n          <div className=\"mb-6\">\n            <p className=\"text-sm text-center\" style={{ color: COLORS.error }}>{error}</p>\n          </div>\n        )}\n      </div>\n\n      {/* Continue Button - Fixed at bottom */}\n      <div className=\"px-12 pb-8 flex-shrink-0\">\n        <button\n          className=\"w-full max-w-sm mx-auto bg-gray-900 hover:bg-gray-800 text-white rounded-full py-4 text-base font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\n          onClick={handleEmailSubmit}\n          disabled={isLoading || !email.trim()}\n          style={{ \n            fontFamily: 'Inter, system-ui, sans-serif'\n          }}\n        >\n          {isLoading ? 'Loading...' : 'Continue'}\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n          </svg>\n        </button>\n      </div>\n    </div>\n  );\n\n  const renderCodeStep = () => (\n    <div className=\"w-full flex flex-col\" style={{ height: '100%' }}>\n      {/* Ensure verification code inputs always render black text (host apps may inject global input styles) */}\n      <style>{`\n        /* High-specificity + !important so consuming apps can't easily override text color */\n        input.onairos-verification-digit {\n          color: #000000 !important;\n          caret-color: #000000 !important;\n          -webkit-text-fill-color: #000000 !important; /* Safari/iOS */\n        }\n      `}</style>\n      {/* Heading - matching VerificationStep.tsx */}\n      <div className=\"w-full pt-16 px-12 mb-10 text-center\">\n        <h1 \n          className=\"font-bold mb-2\"\n          style={{ \n            fontFamily: 'IBM Plex Sans, system-ui, sans-serif',\n            fontWeight: '700',\n            fontSize: '24px',\n            lineHeight: '32px',\n            color: COLORS.textPrimary\n          }}\n        >\n          Enter verification code\n        </h1>\n        <p \n          className=\"mb-2\"\n          style={{ \n            fontFamily: 'Inter, system-ui, sans-serif',\n            fontWeight: '400',\n            fontSize: '16px',\n            lineHeight: '24px',\n            color: COLORS.textSecondary\n          }}\n        >\n          {emailSent ? `We've sent a 6-digit code to ${email}` : `A verification code has been generated for ${email}`}\n        </p>\n        {!emailSent && (\n          <div \n            className=\"mb-4 mx-auto max-w-sm px-4 py-3 rounded-lg border\"\n            style={{ \n              backgroundColor: '#FEF3C7',\n              borderColor: '#FCD34D',\n              fontFamily: 'Inter, system-ui, sans-serif',\n              fontSize: '14px',\n              lineHeight: '20px',\n              color: '#92400E'\n            }}\n          >\n            <p className=\"font-medium mb-1\"> Email service unavailable</p>\n            <p className=\"text-sm\">\n              {emailServiceMessage.includes('testing mode') || emailServiceMessage.includes('server logs') \n                ? 'Any 6-digit code will be accepted. Check server logs for the actual code.'\n                : 'The verification code was generated but could not be sent. Please check server logs or contact support.'}\n            </p>\n          </div>\n        )}\n      </div>\n\n\n      {/* Code Input - matching VerificationStep design with individual digit boxes */}\n      <div className=\"px-12 mb-6\">\n        <div className=\"flex justify-center space-x-3\">\n          {Array.from({ length: 6 }, (_, index) => (\n            <input\n              key={index}\n              type=\"text\"\n              inputMode=\"numeric\"\n              pattern=\"[0-9]*\"\n              maxLength=\"1\"\n              autoComplete={index === 0 ? \"one-time-code\" : \"off\"}\n              value={codeDigits[index] || ''}\n              onPaste={(e) => {\n                const pasted = (e.clipboardData?.getData('text') || '').replace(/\\D/g, '');\n                if (!pasted) return;\n                e.preventDefault();\n\n                const nextDigits = [...codeDigits];\n                for (let i = 0; i < pasted.length && index + i < 6; i++) {\n                  nextDigits[index + i] = pasted[i];\n                }\n                setCodeDigits(nextDigits);\n\n                const focusIndex = Math.min(index + pasted.length, 5);\n                const nextInput = e.currentTarget.parentElement?.children?.[focusIndex];\n                if (nextInput && typeof nextInput.focus === 'function') nextInput.focus();\n              }}\n              onChange={(e) => {\n                const raw = e.target.value || '';\n                const digitsOnly = raw.replace(/\\D/g, '');\n\n                // Clear\n                if (!digitsOnly) {\n                  const nextDigits = [...codeDigits];\n                  nextDigits[index] = '';\n                  setCodeDigits(nextDigits);\n                  return;\n                }\n\n                // Some browsers/OTP autofill can inject multiple digits at once\n                const nextDigits = [...codeDigits];\n                for (let i = 0; i < digitsOnly.length && index + i < 6; i++) {\n                  nextDigits[index + i] = digitsOnly[i];\n                }\n                setCodeDigits(nextDigits);\n\n                const focusIndex = Math.min(index + digitsOnly.length, 5);\n                if (focusIndex !== index) {\n                  const nextInput = e.target.parentElement?.children?.[focusIndex];\n                  if (nextInput && typeof nextInput.focus === 'function') nextInput.focus();\n                } else if (index < 5) {\n                  const nextInput = e.target.parentElement?.children?.[index + 1];\n                  if (nextInput && typeof nextInput.focus === 'function') nextInput.focus();\n                }\n              }}\n              onKeyDown={(e) => {\n                // Handle backspace to focus previous input\n                if (e.key === 'Backspace') {\n                  // If current has a digit, clear it first (common OTP UX)\n                  if (codeDigits[index]) {\n                    const nextDigits = [...codeDigits];\n                    nextDigits[index] = '';\n                    setCodeDigits(nextDigits);\n                    e.preventDefault();\n                    return;\n                  }\n                  // Otherwise move focus left\n                  if (index > 0) {\n                    const prevInput = e.currentTarget.parentElement?.children?.[index - 1];\n                    if (prevInput && typeof prevInput.focus === 'function') prevInput.focus();\n                  }\n                }\n              }}\n              className=\"onairos-verification-digit w-12 h-12 border rounded-lg text-center text-lg font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none !text-black\"\n              style={{ \n                borderColor: COLORS.border,\n                backgroundColor: COLORS.background,\n                fontFamily: 'Inter, system-ui, sans-serif',\n                color: '#000000',\n                caretColor: '#000000',\n                WebkitTextFillColor: '#000000',\n              }}\n            />\n          ))}\n        </div>\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <div className=\"px-12 mb-6\">\n          <p className=\"text-sm text-center\" style={{ color: COLORS.error }}>{error}</p>\n        </div>\n      )}\n\n      {/* Continue Button - positioned right below code inputs */}\n      <div className=\"px-12 mb-6\">\n        <div className=\"max-w-sm mx-auto\">\n          <PrimaryButton\n            label=\"Continue\"\n            onClick={handleCodeSubmit}\n            loading={isLoading}\n            disabled={isLoading || !isCodeComplete}\n            testId=\"verify-code-button\"\n            className=\"!text-white\"\n            textStyle={{ color: '#FFFFFF' }}\n          />\n        </div>\n      </div>\n\n      {/* Spacer */}\n      <div style={{ flex: 1, minHeight: '20px' }} />\n\n      {/* Back to email option */}\n      <div className=\"px-12 w-full\">\n        <div className=\"max-w-sm mx-auto\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              resetCodeDigits();\n              setStep('email');\n            }}\n            className=\"w-full py-2 px-4 font-medium transition-colors text-sm\"\n            style={{ color: COLORS.textSecondary }}\n          >\n            Use a different email\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n\n  const renderSuccessStep = () => (\n    <div className=\"w-full flex flex-col items-center space-y-6 pt-16 px-12\">\n      <div \n        className=\"flex items-center justify-center w-16 h-16 rounded-full\"\n        style={{ backgroundColor: '#D1FAE5' }}\n      >\n        <Check className=\"w-8 h-8\" style={{ color: COLORS.success }} />\n      </div>\n      \n      <div className=\"text-center space-y-2\">\n        <h2 \n          className=\"text-xl font-semibold\"\n          style={{ color: COLORS.textPrimary }}\n        >\n          Email verified!\n        </h2>\n        <p style={{ color: COLORS.textSecondary }}>Setting up your account...</p>\n      </div>\n\n      <div className=\"w-8 h-8\">\n        <div className=\"animate-spin h-8 w-8 border-2 border-blue-600 rounded-full border-t-transparent\"></div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"w-full\">\n      {step === 'email' && renderEmailStep()}\n      {step === 'code' && renderCodeStep()}\n      {step === 'success' && renderSuccessStep()}\n    </div>\n  );\n} \n","/**\n * Capacitor/Mobile Environment Detection Utility\n * \n * Detects if the app is running in a Capacitor environment\n * and provides mobile-specific functionality\n */\n\n/**\n * Detect if running in Capacitor environment\n * @returns {boolean} True if running in Capacitor\n */\nexport const isCapacitor = () => {\n  // Check for Capacitor global object\n  if (typeof window !== 'undefined' && window.Capacitor) {\n    return true;\n  }\n  \n  // Check for Capacitor plugins\n  if (typeof window !== 'undefined' && window.Capacitor?.Plugins) {\n    return true;\n  }\n  \n  // Check for Capacitor native bridge\n  if (typeof window !== 'undefined' && window.webkit?.messageHandlers?.bridge) {\n    return true;\n  }\n  \n  return false;\n};\n\n/**\n * Detect if running in React Native environment\n * @returns {boolean} True if running in React Native\n */\nexport const isReactNative = () => {\n  return typeof navigator !== 'undefined' && navigator.product === 'ReactNative' ||\n         typeof global !== 'undefined' && global.nativeModuleProxy !== undefined;\n};\n\n/**\n * Detect if running in any mobile app environment (Capacitor or React Native)\n * @returns {boolean} True if running in a mobile app\n */\nexport const isMobileApp = () => {\n  return isCapacitor() || isReactNative();\n};\n\n/**\n * Detect if running on iOS\n * @returns {boolean} True if running on iOS\n */\nexport const isIOS = () => {\n  if (typeof window !== 'undefined' && window.Capacitor) {\n    return window.Capacitor.getPlatform() === 'ios';\n  }\n  \n  // Fallback to user agent detection\n  return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n};\n\n/**\n * Detect if running on Android\n * @returns {boolean} True if running on Android\n */\nexport const isAndroid = () => {\n  if (typeof window !== 'undefined' && window.Capacitor) {\n    return window.Capacitor.getPlatform() === 'android';\n  }\n  \n  // Fallback to user agent detection\n  return /Android/.test(navigator.userAgent);\n};\n\n/**\n * Get platform information\n * @returns {Object} Platform details\n */\nexport const getPlatformInfo = () => {\n  return {\n    isCapacitor: isCapacitor(),\n    isReactNative: isReactNative(),\n    isMobileApp: isMobileApp(),\n    isIOS: isIOS(),\n    isAndroid: isAndroid(),\n    platform: window.Capacitor ? window.Capacitor.getPlatform() : 'web',\n    userAgent: navigator.userAgent\n  };\n};\n\n/**\n * Detect if mobile browser (not Capacitor, just mobile web browser)\n * @returns {boolean} True if mobile browser\n */\nexport const isMobileBrowser = () => {\n  if (isMobileApp()) {\n    return false; // Capacitor/RN apps are not browsers\n  }\n  \n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\n         (window.innerWidth <= 768);\n};\n\n/**\n * Get environment type\n * @returns {string} Environment type: 'capacitor', 'react-native', 'mobile-browser', 'desktop-browser'\n */\nexport const getEnvironmentType = () => {\n  if (isCapacitor()) return 'capacitor';\n  if (isReactNative()) return 'react-native';\n  if (isMobileBrowser()) return 'mobile-browser';\n  return 'desktop-browser';\n};\n\n/**\n * Check if browser extension support is available\n * Browser extensions don't work in Capacitor/React Native\n * @returns {boolean} True if browser extensions are supported\n */\nexport const supportsBrowserExtensions = () => {\n  return !isMobileApp();\n};\n\n/**\n * Log platform information for debugging\n */\nexport const logPlatformInfo = () => {\n  const info = getPlatformInfo();\n  console.log(' Platform Detection:', info);\n  console.log(' Environment Type:', getEnvironmentType());\n  console.log(' Browser Extensions Supported:', supportsBrowserExtensions());\n  return info;\n};\n\n","import React from 'react';\nimport { createPortal } from 'react-dom';\n\nconst BOOKMARKLET_HREF =\n  \"javascript:(async()=>{let loader=null;function showLoader(msg){if(!loader){loader=document.createElement('div');loader.style.cssText='position:fixed;top:20px;right:20px;width:280px;background:rgba(15,23,42,0.95);color:white;padding:14px 20px;border-radius:12px;font-family:-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,sans-serif;font-size:13px;font-weight:500;z-index:999999;box-shadow:0 8px 24px rgba(0,0,0,0.4),0 2px 8px rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.1);backdrop-filter:blur(12px);line-height:1.4;text-align:center';document.body.appendChild(loader)}loader.textContent=msg}function hideLoader(){if(loader){loader.remove();loader=null}}function h(){try{const e=window.location.hostname||'';return e==='chat.openai.com'||e==='chatgpt.com'||e.endsWith('.chatgpt.com')}catch{return false}}function getDeviceId(){try{const c=document.cookie.match(/oai-did=([^;]+)/);return c?c[1]:null}catch{return null}}async function getAccessToken(){const url=`${window.location.origin}/api/auth/session`;const r=await fetch(url,{method:'GET',credentials:'include',headers:{'Accept':'application/json','Referer':window.location.origin}});if(!r.ok)return null;const data=await r.json();return data?.accessToken||null}async function fetchList(token,deviceId){const url=`${window.location.origin}/backend-api/conversations?offset=0&limit=10`;const headers={'Accept':'*/*','oai-language':'en-US'};if(token)headers['Authorization']=`Bearer ${token}`;if(deviceId)headers['oai-device-id']=deviceId;const r=await fetch(url,{method:'GET',credentials:'include',headers});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}async function fetchConvo(id,token,deviceId){const url=`${window.location.origin}/backend-api/conversation/${id}`;const headers={'Accept':'*/*','oai-language':'en-US','Referer':window.location.origin};if(token)headers['Authorization']=`Bearer ${token}`;if(deviceId)headers['oai-device-id']=deviceId;const r=await fetch(url,{method:'GET',credentials:'include',headers});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}async function fetchMemories(token,deviceId){const url=`${window.location.origin}/backend-api/memories?include_memory_entries=true&memory_entries_filter=all`;const headers={'Accept':'application/json','Referer':window.location.origin};if(token)headers['Authorization']=`Bearer ${token}`;if(deviceId)headers['oai-device-id']=deviceId;try{const r=await fetch(url,{method:'GET',credentials:'include',headers});if(!r.ok)return null;return r.json()}catch{return null}}function extractUserMessages(data){const mapping=data?.mapping||{};const msgs=[];for(const node of Object.values(mapping)){const msg=node?.message;if(!msg||!msg.author)continue;if(msg.author.role!=='user')continue;const time=msg.create_time?new Date(msg.create_time*1000).toISOString():null;let text='';const content=msg.content||{};if(Array.isArray(content.parts)){text=content.parts.join('\\\\n').trim()}else if(content.text){text=content.text.trim()}if(text){msgs.push({content:text,timestamp:time})}}return msgs}if(!h()){alert(' Please open ChatGPT and try again.');return}const popup=window.open('about:blank','OnairosSync','width=500,height=600');if(!popup){alert(' Please allow popups for ChatGPT to sync with Onairos!\\\\n\\\\nEnable popups and try again.');return}popup.document.write('<html><head><title>Onairos Sync</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:\\\"Shne\\\",-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Helvetica,Arial,sans-serif;background:#0D0D0D;color:#ECECEC;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}.container{max-width:450px;width:100%;background:#212121;border-radius:16px;padding:32px;box-shadow:0 4px 24px rgba(0,0,0,0.4)}h1{font-size:24px;font-weight:600;text-align:center;margin-bottom:8px}.subtitle{font-size:14px;color:#8E8EA0;text-align:center;margin-bottom:32px}.status-text{text-align:center;font-size:16px;margin-bottom:16px}.spinner{width:40px;height:40px;border:3px solid #2F2F2F;border-top-color:#10A37F;border-radius:50%;animation:spin 0.6s linear infinite;margin:0 auto 16px}@keyframes spin{to{transform:rotate(360deg)}}</style></head><body><div class=\\\"container\\\"><h1> Onairos Sync</h1><p class=\\\"subtitle\\\">Collecting your ChatGPT data</p><div class=\\\"spinner\\\"></div><div class=\\\"status-text\\\" id=\\\"status\\\">Starting...</div></div></body></html>');popup.document.close();function updatePopup(msg){try{if(popup&&!popup.closed){popup.document.getElementById('status').textContent=msg}}catch(e){}}showLoader(' Starting export...');console.log('[Onairos]  Starting export...');(async()=>{try{updatePopup(' Getting access token...');showLoader(' Getting access token...');const token=await getAccessToken();const deviceId=getDeviceId();if(!token){hideLoader();updatePopup(' Could not get access token. Make sure you\\\\'re logged into ChatGPT.');setTimeout(()=>popup.close(),5000);return}updatePopup(' Fetching conversations...');showLoader(' Fetching conversations...');let list;try{list=await fetchList(token,deviceId)}catch(err){hideLoader();updatePopup(' Failed: '+err.message);setTimeout(()=>popup.close(),5000);return}const items=(list?.items||[]).slice(0,10);if(items.length===0){hideLoader();updatePopup(' No conversations found');setTimeout(()=>popup.close(),3000);return}const convos=[];for(let i=0;i<items.length;i++){const c=items[i];updatePopup(` ${i+1}/${items.length}: ${c.title||'Untitled'}...`);showLoader(` ${i+1}/${items.length}: ${c.title||'Untitled'}...`);try{const data=await fetchConvo(c.id,token,deviceId);const userMsgs=extractUserMessages(data);convos.push({id:c.id,title:c.title||'Untitled',url:`${window.location.origin}/c/${c.id}`,messageCount:userMsgs.length,messages:userMsgs})}catch(err){convos.push({id:c.id,title:c.title||'Untitled',error:err.message})}}updatePopup(' Fetching memories...');showLoader(' Fetching memories...');const memories=await fetchMemories(token,deviceId);updatePopup(' Syncing to Onairos...');showLoader(' Syncing to Onairos...');const userData=JSON.parse(localStorage.getItem('onairosUser')||'{}');let jwtToken=userData.token||localStorage.getItem('onairos_user_token');if(!jwtToken){hideLoader();updatePopup(' Please log into Onairos first');setTimeout(()=>popup.close(),5000);return}const syncData={convos,memories,token:jwtToken};updatePopup(' Opening sync page...');const form=popup.document.createElement('form');form.method='POST';form.action='https://api2.onairos.uk/chatgpt-sync';form.style.display='none';const input=popup.document.createElement('input');input.type='hidden';input.name='data';input.value=JSON.stringify(syncData);form.appendChild(input);popup.document.body.appendChild(form);form.submit();hideLoader();console.log(' [Onairos] Submitting sync form')}catch(e){hideLoader();updatePopup(' Error: '+e.message);console.error(e);setTimeout(()=>popup.close(),5000)}})()})();\";\n\nexport const getOnairosChatGPTBookmarklet = () => BOOKMARKLET_HREF;\n\nexport default function ConnectChatGPTModal({ open, onClose, onConnected }) {\n  // Debug log to confirm render attempt\n  if (open) {\n    console.log(' ConnectChatGPTModal rendering! Open:', open);\n  }\n\n  if (!open) return null;\n\n  // Get user token from localStorage to embed in bookmarklet\n  const getUserToken = () => {\n    try {\n      // Try onairos_user_token first\n      const directToken = localStorage.getItem('onairos_user_token');\n      if (directToken) return directToken;\n      \n      // Try onairosUser.token\n      const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n      if (userData.token) return userData.token;\n      \n      return null;\n    } catch (e) {\n      console.error('Error getting token:', e);\n      return null;\n    }\n  };\n\n  const userToken = getUserToken();\n  console.log(' User token for bookmarklet:', userToken ? userToken.substring(0, 20) + '...' : 'NOT FOUND');\n\n  // Create bookmarklet with embedded token\n  const createBookmarkletWithToken = (token) => {\n    if (!token) {\n      // Fallback to original bookmarklet that checks localStorage\n      return BOOKMARKLET_HREF;\n    }\n    \n    // Embed the token directly in the bookmarklet\n    return BOOKMARKLET_HREF.replace(\n      'const userData=JSON.parse(localStorage.getItem(\\'onairosUser\\')||\\'{}\\')',\n      `const userData={token:'${token}'}`\n    );\n  };\n\n  const bookmarkletHref = createBookmarkletWithToken(userToken);\n\n  const handleGotIt = () => {\n    if (typeof onConnected === 'function') {\n      onConnected();\n    }\n    if (typeof onClose === 'function') {\n      onClose();\n    }\n  };\n\n  // Use a portal to break out of any parent transforms/overflows\n  return createPortal(\n    <div style={{ position: 'fixed', inset: 0, zIndex: 2147483647, pointerEvents: 'auto' }}>\n      <style>{`\n        @keyframes gentlePulse {\n          0%, 100% {\n            box-shadow: 0 0 0 0 rgba(148, 163, 184, 0.35);\n          }\n          50% {\n            box-shadow: 0 0 0 10px rgba(148, 163, 184, 0);\n          }\n        }\n        .bookmarklet-button {\n          background: rgba(15, 23, 42, 0.85);\n          border-radius: 9999px;\n          border: 1px solid rgba(255,255,255,0.16);\n          backdrop-filter: blur(18px);\n        }\n        .bookmarklet-button:hover {\n          background: rgba(15, 23, 42, 0.92);\n        }\n        @keyframes fadeInScale {\n          0% { opacity: 0; transform: translateY(8px) scale(0.96); }\n          100% { opacity: 1; transform: translateY(0) scale(1); }\n        }\n        .chatgpt-modal-card {\n          animation: fadeInScale 200ms cubic-bezier(0.16, 1, 0.3, 1);\n        }\n        .step-circle {\n          background: rgba(15, 23, 42, 0.9);\n          min-width: 28px;\n          width: 28px;\n          height: 28px;\n        }\n        .chatgpt-got-it-button {\n          color: #FFFFFF !important;\n          background-color: rgba(15, 23, 42, 0.8) !important;\n        }\n        .chatgpt-got-it-button:hover {\n          background-color: rgba(15, 23, 42, 0.9) !important;\n        }\n        .chatgpt-got-it-button * {\n          color: #FFFFFF !important;\n        }\n        .chatgpt-got-it-button span {\n          color: #FFFFFF !important;\n        }\n        /* Mobile browser specific styling */\n        @media (max-width: 768px) {\n          .chatgpt-modal-backdrop {\n            align-items: flex-end !important;\n            padding: 0 !important;\n          }\n          .chatgpt-modal-card {\n            max-width: 100% !important;\n            height: 100% !important;\n            max-height: 100% !important;\n            border-radius: 24px 24px 0 0 !important;\n            animation: slideUpFromBottom 300ms cubic-bezier(0.16, 1, 0.3, 1) !important;\n          }\n        }\n        @keyframes slideUpFromBottom {\n          0% { transform: translateY(100%); }\n          100% { transform: translateY(0); }\n        }\n      `}</style>\n\n      <div \n        className=\"chatgpt-modal-backdrop fixed inset-0 flex items-center justify-center p-4 bg-black/60\" \n        style={{ zIndex: 2147483647 }}\n      >\n        <div \n          className=\"chatgpt-modal-card w-full max-w-md rounded-3xl shadow-2xl border border-white/10 overflow-hidden text-white relative\"\n          style={{\n            background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.92) 50%, rgba(15, 23, 42, 0.95) 100%)',\n            boxShadow: 'inset 0 1px 0 0 rgba(255, 255, 255, 0.1), 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(148, 163, 184, 0.15)'\n          }}\n        >\n            <div className=\"relative px-5 py-4 border-b border-white/10 bg-white/5\">\n              <button\n                onClick={onClose}\n                className=\"absolute right-4 top-4 p-2 hover:bg-white/10 rounded-full transition-colors z-50 cursor-pointer\"\n                aria-label=\"Close\"\n              >\n                <svg\n                  className=\"w-5 h-5 text-slate-300\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M6 18L18 6M6 6l12 12\"\n                  />\n                </svg>\n              </button>\n\n              <h2 className=\"text-xl font-semibold pr-8 text-white\">\n                Connect ChatGPT\n              </h2>\n              <p className=\"text-sm mt-0.5 text-white\">\n                Three quick steps to import your conversations\n              </p>\n\n              <div className=\"mt-3 flex items-start gap-2 bg-white/12 rounded-2xl px-3 py-2\">\n                <svg\n                  className=\"w-4 h-4 text-emerald-300 mt-0.5 flex-shrink-0\"\n                  fill=\"currentColor\"\n                  viewBox=\"0 0 20 20\"\n                >\n                  <path\n                    fillRule=\"evenodd\"\n                    d=\"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\"\n                    clipRule=\"evenodd\"\n                  />\n                </svg>\n                <p className=\"text-xs leading-relaxed text-white\">\n                  <strong className=\"font-semibold\">Private &amp; secure.</strong>{' '}\n                  We only access your chat history. No one else sees this data.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"px-5 py-4 space-y-4\">\n              <div className=\"flex gap-3\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"step-circle rounded-full flex items-center justify-center\">\n                    <span className=\"text-white font-bold text-sm\">1</span>\n                  </div>\n                </div>\n                <div className=\"flex-1 pt-0.5\">\n                  <h3 className=\"text-sm font-semibold mb-1 text-white\">\n                    Drag this button to your bookmarks bar\n                  </h3>\n                  <div className=\"relative inline-block mt-2\">\n                    <div\n                      className=\"absolute inset-0 rounded-full\"\n                      style={{ animation: 'gentlePulse 2s ease-in-out infinite' }}\n                    />\n                    <a\n                      href={bookmarkletHref}\n                      title=\" Onairos ChatGPT Sync\"\n                      draggable=\"true\"\n                      onDragStart={(e) => {\n                        try {\n                          // Set the bookmark URL\n                          e.dataTransfer.setData('text/uri-list', bookmarkletHref);\n                          e.dataTransfer.setData('text/plain', bookmarkletHref);\n                          \n                          // IMPORTANT: Set bookmark title for different browsers\n                          // Firefox uses text/x-moz-url format: URL\\nTitle\n                          e.dataTransfer.setData('text/x-moz-url', `${bookmarkletHref}\\n Onairos ChatGPT`);\n                          \n                          // Chrome/Safari: Set via DownloadURL\n                          e.dataTransfer.setData('DownloadURL', `application/javascript: Onairos ChatGPT:${bookmarkletHref}`);\n                          \n                          e.dataTransfer.effectAllowed = 'copy';\n                          console.log(' Bookmarklet drag started with title:  Onairos ChatGPT');\n                        } catch (err) {\n                          console.warn('Drag start error:', err);\n                        }\n                      }}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        alert(' Please drag this button to your bookmarks bar!\\n\\nTip: Press Ctrl+Shift+B (or Cmd+Shift+B on Mac) to show your bookmarks bar.');\n                      }}\n                      className=\"bookmarklet-button relative inline-flex items-center gap-1.5 px-4 py-2 font-medium cursor-move select-none transition-all hover:scale-[1.03]\"\n                      suppressHydrationWarning\n                    >\n                      <span className=\"text-base\"></span>\n                      <span className=\"text-sm\">Onairos ChatGPT</span>\n                    </a>\n                  </div>\n                  <p className=\"text-xs mt-2 text-slate-200\">\n                    <kbd className=\"px-1.5 py-0.5 bg-white/10 rounded-full text-[10px] font-mono border border-white/10 text-slate-50\">\n                      Ctrl+Shift+B\n                    </kbd>{' '}\n                    (or{' '}\n                    <kbd className=\"px-1.5 py-0.5 bg-white/10 rounded-full text-[10px] font-mono border border-white/10 text-slate-50\">\n                      Cmd+Shift+B\n                    </kbd>{' '}\n                    on Mac) to show bookmarks bar\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"border-t border-white/10 ml-10\" />\n\n              <div className=\"flex gap-3\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"step-circle rounded-full flex items-center justify-center\">\n                    <span className=\"text-white font-bold text-sm\">2</span>\n                  </div>\n                </div>\n                <div className=\"flex-1 pt-0.5\">\n                  <h3 className=\"text-sm font-semibold mb-1 text-white\">\n                    Open ChatGPT and log in\n                  </h3>\n                  <p className=\"text-xs mb-2 text-slate-200\">\n                    Make sure you're logged into your ChatGPT account\n                  </p>\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      window.open('https://chat.openai.com', '_blank', 'noopener,noreferrer');\n                    }}\n                    className=\"inline-flex items-center gap-1.5 px-4 py-2 rounded-full text-xs font-medium transition-all hover:scale-[1.02] active:scale-[0.98]\"\n                    style={{\n                      background: 'linear-gradient(135deg, #10a37f 0%, #0d9270 100%)',\n                      color: '#ffffff',\n                      boxShadow: '0 0 25px rgba(16, 163, 127, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2)'\n                    }}\n                  >\n                    <svg\n                      className=\"w-3.5 h-3.5\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"\n                      />\n                    </svg>\n                    Open ChatGPT\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"border-t border-white/10 ml-10\" />\n\n              <div className=\"flex gap-3\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"step-circle rounded-full flex items-center justify-center\">\n                    <span className=\"text-white font-bold text-sm\">3</span>\n                  </div>\n                </div>\n                <div className=\"flex-1 pt-0.5\">\n                  <h3 className=\"text-sm font-semibold mb-1 text-white\">\n                    Click the bookmark on ChatGPT\n                  </h3>\n                  <p className=\"text-xs text-slate-200\">\n                    Click the <strong className=\"text-white\">&quot;Onairos ChatGPT&quot;</strong>{' '}\n                    bookmark you added. We&apos;ll securely import your last 10 conversations.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"px-5 py-4 bg-white/5 border-t border-white/10\">\n              <button\n                type=\"button\"\n                onClick={handleGotIt}\n                className=\"w-full px-4 py-2.5 rounded-full font-medium text-sm transition-all hover:scale-[1.01] active:scale-[0.99] shadow-[0_10px_30px_rgba(15,23,42,0.45)] border border-white/40 chatgpt-got-it-button\"\n              >\n                <span>Got it! </span>\n              </button>\n            </div>\n          </div>\n        </div>\n    </div>,\n    document.body\n  );\n}\n\n\n","import React, { useEffect, useId, useState, useRef } from 'react';\nimport { Browser } from '@capacitor/browser';\nimport Lottie from 'lottie-react';\nimport personaAnim from '../../public/persona-anim.json';\nimport { isMobileApp, isMobileBrowser } from '../utils/capacitorDetection';\nimport ConnectChatGPTModal from './ConnectChatGPTModal.jsx';\n\n// Mobile detection\nconst isMobile = () => {\n  if (typeof window === 'undefined') return false;\n  return isMobileApp() || isMobileBrowser() || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n};\nconst chatgptIcon = 'https://anushkasirv.sirv.com/openai.png';\nconst claudeIcon = 'https://anushkasirv.sirv.com/claude-color.png';\nconst geminiIcon = 'https://anushkasirv.sirv.com/gemini-color.png';\nconst grokIcon = 'https://anushkasirv.sirv.com/grok.png';\n\nconst sdkConfig = {\n  apiKey: process.env.REACT_APP_ONAIROS_API_KEY || 'ona_VvoHNg1fdCCUa9eBy4Iz3IfvXdgLfMFI7TNcyHLDKEadPogkbjAeE2iDOs6M7Aey',\n  baseUrl: process.env.REACT_APP_ONAIROS_BASE_URL || 'https://api2.onairos.uk',\n  sdkType: 'web',\n  enableHealthMonitoring: true,\n  enableAutoRefresh: true,\n  enableConnectionValidation: true,\n};\n\nconst fadeSlideInKeyframes = `\n@keyframes fadeSlideIn {\n  from { opacity: 0; transform: translateX(var(--slide-x)); }\n  to { opacity: 1; transform: translateX(0); }\n}\n`;\n\nexport default function UniversalOnboarding({ onComplete, onBack, appIcon, appName, username, testMode, priorityPlatform, rawMemoriesOnly, rawMemoriesConfig, isMobile: isMobileProp = false }) {\n  const lottieRef = useRef(null);\n  const lastFrameRef = useRef(0);\n  const rafRef = useRef(null);\n  const initialLoadDone = useRef(false);\n\n  const [connectedAccounts, setConnectedAccounts] = useState({});\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [connectingPlatform, setConnectingPlatform] = useState(null);\n  const [selected, setSelected] = useState('Instagram');\n  const [currentPage, setCurrentPage] = useState(1);\n  const [showChatGPTModal, setShowChatGPTModal] = useState(false);\n\n  // swipe state\n  const touchStartX = useRef(0);\n  const touchDeltaX = useRef(0);\n\n  // Mobile detection - use prop if provided (from layout), else detect\n  // Only use actual mobile device detection, not window width (to avoid false positives from dev tools)\n  const isActualMobileDevice = typeof navigator !== 'undefined' && \n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n  const isNativePlatform = typeof window !== 'undefined' && \n    window.Capacitor?.isNativePlatform?.() === true;\n  const isMobile = isMobileProp || isNativePlatform || isActualMobileDevice;\n\n  const [vh, setVh] = useState(() => (typeof window !== 'undefined' ? window.innerHeight : 800));\n  useEffect(() => {\n    const onResize = () => setVh(window.innerHeight);\n    window.addEventListener('resize', onResize);\n    return () => window.removeEventListener('resize', onResize);\n  }, []);\n\n  const INFO_SHEET_MAX_H = isMobile ? (vh * 0.18) : (vh * 0.2);\n\n  const FOOTER_H = 88;\n\n  // MOBILE ONLY: persona placement / sizing - GIVE MORE SPACE TO PERSONA\n  const isSmallMobile = isMobile && vh < 700;\n  // Desktop adjustments: Reduce persona size and top position to fit modal without scroll\n  // We allow overlap on desktop if needed\n  const personaSide = isMobile \n    ? (isSmallMobile ? Math.min(vh * 0.46, 420) : Math.min(vh * 0.52, 480))\n    : Math.min(vh * 0.45, 420); // Desktop: allow larger size, will position absolutely\n  \n  const PERSONA_TOP = isMobile \n    ? (isSmallMobile ? 28 : 44) \n    : 40; // Desktop: Higher up\n\n  // MOBILE ONLY: icon layout - PUSH ICONS DOWN significantly\n  // Desktop: Adjust spacing to fit\n  const SLOT = isMobile \n    ? Math.max(50, Math.min(60, Math.floor(vh * 0.07)))\n    : 60; // Desktop: fixed reasonable size\n  const CIRCLE = isMobile \n    ? (isSmallMobile ? 36 : 40)\n    : 40; // Desktop: fixed reasonable size\n  const GAP_PAGE1 = isMobile ? 10 : 12; // Desktop: original\n  const GAP_PAGE2 = isMobile ? 18 : 20; // Desktop: original\n  const ACTIVE_SCALE = isMobile \n    ? (vh < 760 ? 1.15 : 1.25)\n    : 1.2; // Desktop: standard scale\n\n  const ICONS_H = isMobile \n    ? (isSmallMobile ? 70 : 80)\n    : 76; // Desktop: tighter height\n  const ICONS_TOP_OFFSET = isMobile \n    ? Math.max(200, Math.min(280, Math.round(vh * 0.32)))\n    : 200; // Desktop: unused but kept for ref\n\n  const igGradId = useId();\n\n  // ---- official brand SVGs (compact, consistent viewboxes) ----\n  const Brand = {\n    ChatGPT: <img src={chatgptIcon} alt=\"ChatGPT\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\n    Claude: <img src={claudeIcon} alt=\"Claude\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\n    Gemini: <img src={geminiIcon} alt=\"Gemini\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\n    Grok: <img src={grokIcon} alt=\"Grok\" style={{ width: 20, height: 20, objectFit: 'contain' }} />,\n    Instagram: (\n      <svg viewBox=\"0 0 24 24\" aria-hidden width=\"100%\" height=\"100%\">\n        <defs>\n          <radialGradient id={igGradId} cx=\"0.5\" cy=\"1\" r=\"1\">\n            <stop offset=\"0%\" stopColor=\"#FDBB4B\"/>\n            <stop offset=\"40%\" stopColor=\"#E95950\"/>\n            <stop offset=\"70%\" stopColor=\"#BC2A8D\"/>\n            <stop offset=\"100%\" stopColor=\"#4C68D7\"/>\n          </radialGradient>\n        </defs>\n        <path fill={`url(#${igGradId})`} d=\"M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5.5A4.5 4.5 0 1 0 16.5 12 4.5 4.5 0 0 0 12 7.5zm0 7.4A2.9 2.9 0 1 1 14.9 12 2.9 2.9 0 0 1 12 14.9Zm5.35-8.25a1.15 1.15 0 1 0 1.15 1.15 1.15 1.15 0 0 0-1.15-1.15Z\"/>\n      </svg>\n    ),\n    YouTube: (\n      <svg viewBox=\"0 0 24 24\" aria-hidden width=\"100%\" height=\"100%\">\n        <path fill=\"#FF0000\" d=\"M22.54 6.42a3 3 0 0 0-2.11-2.12C18.49 3.75 12 3.75 12 3.75s-6.49 0-8.43.55A3 3 0 0 0 1.46 6.42 31.63 31.63 0 0 0 1 12a31.63 31.63 0 0 0 .46 5.58 3 3 0 0 0 2.11 2.12C5.51 20.25 12 20.25 12 20.25s6.49 0 8.43-.55a3 3 0 0 0 2.11-2.12A31.63 31.63 0 0 0 23 12a31.63 31.63 0 0 0-.46-5.58z\"/>\n        <path fill=\"#FFF\" d=\"M10 8.75v6.5l6-3.25-6-3.25z\"/>\n        </svg>\n      ),\n    Reddit: (\n      <img src=\"https://upload.wikimedia.org/wikipedia/en/b/bd/Reddit_Logo_Icon.svg\" alt=\"Reddit\" width=\"100%\" height=\"100%\" />\n      ),\n    LinkedIn: (\n      <img src=\"https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png\" alt=\"LinkedIn\" width=\"100%\" height=\"100%\" />\n      ),\n    Twitter: (\n      <svg viewBox=\"0 0 24 24\" aria-hidden width=\"100%\" height=\"100%\">\n        <path fill=\"#1DA1F2\" d=\"M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z\"/>\n        </svg>\n      ),\n  };\n\n  const aiLinks = {\n    ChatGPT: 'https://chat.openai.com',\n    Claude: 'https://claude.ai',\n    Gemini: 'https://gemini.google.com',\n    Grok: 'https://grok.x.ai',\n  };\n\n  const descriptions = {\n    ChatGPT: <>We analyze your <strong className=\"font-semibold\">prompt style</strong> and <strong className=\"font-semibold\">chat history</strong> to match your writing and thinking patterns.</>,\n    Claude: <>We learn your <strong className=\"font-semibold\">document workflow</strong> and <strong className=\"font-semibold\">reasoning preferences</strong> to tune output format and detail.</>,\n    Gemini: <>We study your <strong className=\"font-semibold\">search patterns</strong> and <strong className=\"font-semibold\">multimodal usage</strong> to improve response accuracy.</>,\n    Grok: <>We adapt to your <strong className=\"font-semibold\">X posting style</strong> and <strong className=\"font-semibold\">meme literacy</strong> to match your tone.</>,\n    Twitter: <>We analyze your <strong className=\"font-semibold\">tweets</strong> and <strong className=\"font-semibold\">interests</strong> to understand your preferences.</>,\n    YouTube: <>We study your <strong className=\"font-semibold\">watch history</strong> and <strong className=\"font-semibold\">interactions</strong> to learn your interests.</>,\n    Reddit: <>We examine your <strong className=\"font-semibold\">search history</strong> and <strong className=\"font-semibold\">discussions</strong> to understand your interests.</>,\n    Instagram: <>We analyze your <strong className=\"font-semibold\">photos</strong> and <strong className=\"font-semibold\">interactions</strong> to learn visual preferences.</>,\n    LinkedIn: <>We study your <strong className=\"font-semibold\">professional graph</strong> and <strong className=\"font-semibold\">content</strong> to understand career interests.</>,\n  };\n\n  // Full platform list for all apps\n  const allPlatformsDefault = [\n    // Page 1\n    { name: 'Instagram', connector: 'instagram', icon: Brand.Instagram },\n    { name: 'YouTube', connector: 'youtube', icon: Brand.YouTube },\n    { name: 'ChatGPT', connector: 'chatgpt', icon: Brand.ChatGPT, directLink: aiLinks.ChatGPT },\n    // Page 2\n    { name: 'Claude', connector: 'claude', icon: Brand.Claude, directLink: aiLinks.Claude },\n    { name: 'Gemini', connector: 'gemini', icon: Brand.Gemini, directLink: aiLinks.Gemini },\n    { name: 'Twitter', connector: 'twitter', icon: Brand.Twitter },\n    // Page 3\n    { name: 'LinkedIn', connector: 'linkedin', icon: Brand.LinkedIn },\n    { name: 'Reddit', connector: 'reddit', icon: Brand.Reddit },\n    { name: 'Grok', connector: 'grok', icon: Brand.Grok, directLink: aiLinks.Grok },\n  ];\n\n  // Restricted platform list for onairos-wrapped only\n  const wrappedPlatforms = [\n    { name: 'YouTube', connector: 'youtube', icon: Brand.YouTube },\n    { name: 'LinkedIn', connector: 'linkedin', icon: Brand.LinkedIn },\n    { name: 'Reddit', connector: 'reddit', icon: Brand.Reddit },\n  ];\n\n  // Check if this is onairos-wrapped\n  const isWrappedApp = typeof appName === 'string' && appName.toLowerCase().includes('onairos-wrapped');\n  \n  const allPlatforms = isWrappedApp ? wrappedPlatforms : allPlatformsDefault;\n\n  // Normalize platform strings coming from various sources (connector ids like \"linkedin\"\n  // vs display names like \"LinkedIn\") so connected rings render reliably.\n  const canonicalizePlatformName = (value) => {\n    const raw = String(value || '').trim();\n    if (!raw) return '';\n    const lower = raw.toLowerCase();\n    const byConnector = allPlatforms.find((p) => String(p.connector).toLowerCase() === lower);\n    if (byConnector) return byConnector.name;\n    const byName = allPlatforms.find((p) => String(p.name).toLowerCase() === lower);\n    if (byName) return byName.name;\n    return raw.charAt(0).toUpperCase() + raw.slice(1);\n  };\n\n  // Helper to notify DataRequest when connected accounts change\n  const notifyConnectedAccountsUpdate = () => {\n    if (typeof window !== 'undefined') {\n      window.dispatchEvent(new CustomEvent('onairos-connected-accounts-update'));\n    }\n  };\n\n  // Debug: Log connectedAccounts state changes\n  useEffect(() => {\n    console.log(' connectedAccounts state changed:', connectedAccounts);\n  }, [connectedAccounts]);\n\n  // Auto-persist connected accounts to localStorage whenever they change\n  useEffect(() => {\n    console.log(' Persistence useEffect triggered. connectedAccounts:', connectedAccounts, 'length:', Object.keys(connectedAccounts).length);\n    \n    // Skip initial mount if connectedAccounts is empty\n    if (Object.keys(connectedAccounts).length === 0) {\n      console.log(' Skipping persistence (empty state)');\n      return;\n    }\n    \n    try {\n      const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n      const connectedArray = Object.entries(connectedAccounts)\n        .filter(([, v]) => !!v)\n        .map(([k]) => canonicalizePlatformName(k))\n        .filter(Boolean);\n      userData.connectedAccounts = connectedArray;\n      localStorage.setItem('onairosUser', JSON.stringify(userData));\n      console.log(' Auto-persisted connected accounts:', connectedArray);\n      notifyConnectedAccountsUpdate();\n    } catch (e) {\n      console.error(' Error auto-persisting connected accounts:', e);\n    }\n  }, [connectedAccounts]);\n\n  const getPlatformsForPage = (page) => {\n    // If wrapped app, show all platforms on one page (no pagination)\n    if (isWrappedApp) return allPlatforms;\n    \n    // For other apps, use pagination\n    if (page === 1) return allPlatforms.slice(0, 3);\n    if (page === 2) return allPlatforms.slice(3, 6);\n    return allPlatforms.slice(6);\n  };\n\n  const platforms = getPlatformsForPage(currentPage);\n\n  // Wrapped-only: ensure we never show a default selection that isn't available (e.g. Instagram),\n  // and keep paging locked to a single page.\n  useEffect(() => {\n    if (!isWrappedApp) return;\n    if (currentPage !== 1) setCurrentPage(1);\n    const allowed = new Set(wrappedPlatforms.map((p) => p.name));\n    if (!allowed.has(selected)) {\n      setSelected('YouTube');\n    }\n  }, [isWrappedApp, currentPage, selected]);\n\n  useEffect(() => {\n    // Listener for immediate UI update from deep link (when component is already mounted)\n    const handleAuthSuccess = (e) => {\n       const { platform } = e.detail;\n       console.log(` Event received: OAuth success for ${platform}`);\n       const plat = allPlatforms.find((p) => p.connector === platform);\n       if (plat) {\n          // Mark that we just processed OAuth (for 5 seconds)\n          sessionStorage.setItem('onairos_just_connected', Date.now().toString());\n          // Update state (persistence happens automatically via useEffect)\n          setConnectedAccounts((currentState) => {\n            const updated = { ...currentState, [plat.name]: true };\n            console.log(` Connected ${plat.name} (event) - adding to:`, currentState, ' result:', updated);\n            return updated;\n          });\n       }\n    };\n    if (typeof window !== 'undefined') {\n      window.addEventListener('onairos-oauth-success', handleAuthSuccess);\n    }\n\n    // Check for OAuth success on mount (after redirect back from mobile)\n    const checkOAuthSuccess = () => {\n      // 1. Check URL-based return signal (from OnairosButton or direct URL params)\n      // Note: OnairosButton cleans up URL params, so we might check sessionStorage set by it\n      const sessionSuccess = sessionStorage.getItem('onairos_oauth_return_success');\n      const sessionPlatform = sessionStorage.getItem('onairos_oauth_return_platform');\n      \n      if (sessionSuccess === 'true' && sessionPlatform) {\n        console.log(` ${sessionPlatform} OAuth detected via session signal`);\n        const plat = allPlatforms.find((p) => p.connector === sessionPlatform);\n        if (plat) {\n          // Mark that we just processed OAuth (for 5 seconds)\n          sessionStorage.setItem('onairos_just_connected', Date.now().toString());\n          // Update state (persistence happens automatically via useEffect)\n          setConnectedAccounts((currentState) => {\n            const updated = { ...currentState, [plat.name]: true };\n            console.log(` Connected ${plat.name} (session) - adding to:`, currentState, ' result:', updated);\n            return updated;\n          });\n        }\n        // Clean up\n        sessionStorage.removeItem('onairos_oauth_return_success');\n        sessionStorage.removeItem('onairos_oauth_return_platform');\n        return true; // Signal that OAuth was processed\n      }\n      return false;\n\n      // 2. Fallback to existing localStorage logic (same-domain or preserved state)\n      const oauthContext = localStorage.getItem('onairos_oauth_context');\n      const platformConnector = localStorage.getItem('onairos_oauth_platform');\n      \n      // Only process if we're coming back from platform connector flow\n      if (oauthContext === 'platform-connector' && platformConnector) {\n        const localStorageKey = `onairos_${platformConnector}_success`;\n        const timestampKey = `onairos_${platformConnector}_timestamp`;\n        const success = localStorage.getItem(localStorageKey);\n        const timestamp = localStorage.getItem(timestampKey);\n        \n        if (success === 'true' && timestamp) {\n          const timestampNum = parseInt(timestamp, 10);\n          const now = Date.now();\n          \n          // Only process if timestamp is recent (within last 30 seconds)\n          if (now - timestampNum < 30000) {\n            console.log(` ${platformConnector} OAuth completed - processing redirect back`);\n            \n            // Find platform by connector\n            const plat = allPlatforms.find((p) => p.connector === platformConnector);\n            if (plat) {\n              // Mark that we just processed OAuth (for 5 seconds)\n              sessionStorage.setItem('onairos_just_connected', Date.now().toString());\n              // Update state (persistence happens automatically via useEffect)\n              setConnectedAccounts((currentState) => {\n                const updated = { ...currentState, [plat.name]: true };\n                console.log(` Connected ${plat.name} (context) - adding to:`, currentState, ' result:', updated);\n                return updated;\n              });\n            }\n            \n            // Clean up localStorage\n            localStorage.removeItem(localStorageKey);\n            localStorage.removeItem(timestampKey);\n            localStorage.removeItem('onairos_oauth_context');\n            localStorage.removeItem('onairos_oauth_platform');\n            localStorage.removeItem('onairos_return_url');\n            return true; // Signal that OAuth was processed\n          }\n        }\n      }\n      return false;\n    };\n\n    // Check if we're in the middle of an OAuth flow (within last 2 seconds)\n    const justConnectedTime = sessionStorage.getItem('onairos_just_connected');\n    const inOAuthFlow = justConnectedTime && (Date.now() - parseInt(justConnectedTime, 10) < 2000);\n    \n    // ALWAYS load from localStorage on mount UNLESS we're actively processing OAuth right now\n    // (to avoid overwriting the OAuth update that just happened)\n    if (!inOAuthFlow) {\n      try {\n        const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n        console.log(' UniversalOnboarding mount: Loading persisted accounts from localStorage:', userData.connectedAccounts);\n        if (userData.connectedAccounts && Array.isArray(userData.connectedAccounts)) {\n          // Convert array to object format\n          const accountsObj = userData.connectedAccounts.reduce((acc, platform) => {\n            acc[canonicalizePlatformName(platform)] = true;\n            return acc;\n          }, {});\n          console.log(' Loaded connected accounts:', accountsObj);\n          setConnectedAccounts(accountsObj);\n        } else {\n          console.log(' No valid connectedAccounts in localStorage');\n        }\n      } catch (error) {\n        console.error(' Failed to load persisted connected accounts:', error);\n      }\n    } else {\n      console.log(' Skipping localStorage load (OAuth just completed)');\n    }\n    \n    initialLoadDone.current = true;\n    \n    // THEN: Check for OAuth success (which will ADD to existing connections)\n    checkOAuthSuccess();\n    \n    // Legacy: Load OAuth platform returns (for backward compatibility)\n    const p = localStorage.getItem('onairos_oauth_platform');\n    if (p && !localStorage.getItem('onairos_oauth_context')) {\n      // Only accept legacy signals if there is a *real* recent success marker.\n      // Otherwise this can auto-toggle a platform for \"new users\" from stale leftovers.\n      const legacySuccess = localStorage.getItem(`onairos_${String(p).toLowerCase()}_success`) || localStorage.getItem(`onairos_${p}_success`);\n      const legacyTs = localStorage.getItem(`onairos_${String(p).toLowerCase()}_timestamp`) || localStorage.getItem(`onairos_${p}_timestamp`);\n      const legacyTsNum = legacyTs ? parseInt(legacyTs, 10) : NaN;\n      const legacyOk = legacySuccess === 'true' && Number.isFinite(legacyTsNum) && (Date.now() - legacyTsNum < 30000);\n\n      if (!legacyOk) {\n        // Clean up stale keys and do nothing.\n        localStorage.removeItem('onairos_oauth_platform');\n        localStorage.removeItem('onairos_oauth_return');\n      } else {\n        localStorage.removeItem('onairos_oauth_platform');\n        localStorage.removeItem('onairos_oauth_return');\n        \n        // Mark that we just processed OAuth (for 5 seconds)\n        sessionStorage.setItem('onairos_just_connected', Date.now().toString());\n        // Update state (persistence happens automatically via useEffect)\n        const canonical = canonicalizePlatformName(p);\n        setConnectedAccounts((currentState) => {\n          const updated = { ...currentState, [canonical]: true };\n          console.log(` Connected ${canonical} (legacy) - adding to:`, currentState);\n          return updated;\n        });\n      }\n    }\n    \n    return () => {\n      if (typeof window !== 'undefined') {\n        window.removeEventListener('onairos-oauth-success', handleAuthSuccess);\n      }\n    };\n  }, []);\n\n  async function connectToPlatform(name) {\n    const plat = allPlatforms.find((p) => p.name === name);\n    if (!plat) return false;\n    try {\n      // For direct-link platforms (no OAuth), mark connected immediately and return\n      if (plat.directLink) {\n        setConnectedAccounts((s) => ({ ...s, [name]: true }));\n        setIsConnecting(false);\n        setConnectingPlatform(null);\n        return true;\n      }\n\n      // IMPORTANT: do NOT optimistically mark as connected before OAuth completes.\n      // Otherwise users can hit \"Update\" and persist a fake connection.\n      console.log(` Connecting to ${name} - starting OAuth (no optimistic connected state)`);\n      setIsConnecting(true);\n      setConnectingPlatform(name);\n      \n      // BYPASS: Twitter endpoint is 404, so just keep toggle ON without API call\n      if (name === 'Twitter') {\n        console.log(' Twitter: Bypassing API call (endpoint not available), keeping toggle ON');\n        setIsConnecting(false);\n        setConnectingPlatform(null);\n        return true;\n      }\n      \n      const username = localStorage.getItem('username') || (JSON.parse(localStorage.getItem('onairosUser') || '{}')?.email) || 'user@example.com';\n\n      // Determine return URL based on platform\n      // For Desktop/Web: Send empty string/null to prevent backend from generating a redirect URL\n      // This forces oauth-callback.html to NOT redirect, allowing the popup/iframe to close naturally via postMessage or window.close()\n      const isCapacitorNative = typeof window !== 'undefined' && \n        window.Capacitor && \n        typeof window.Capacitor.isNativePlatform === 'function' && \n        window.Capacitor.isNativePlatform();\n      \n      const isMobileBrowser = typeof navigator !== 'undefined' &&\n        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n\n      // Effective mobile check for flow control (use prop or detection)\n      const effectiveMobile = isMobileProp || isMobileBrowser;\n\n      let returnUrl = ''; // Default to empty for Desktop Web\n      \n      if (isCapacitorNative) {\n        returnUrl = `mobiletest://oauth-callback?success=true&platform=${plat.connector}`;\n      } else if (effectiveMobile) {\n        // Mobile Web needs redirect back to self\n        // Sanitize URL to prevent recursive params if user is already on a return URL\n        const cleanUrl = window.location.origin + window.location.pathname;\n        returnUrl = cleanUrl;\n      }\n\n      console.log(` Authorizing ${plat.connector} with returnUrl:`, returnUrl || '(none/desktop)');\n\n      // Build session payload for backend (SDK-aware)\n      const sessionPayload = {\n        username,\n      };\n\n      // For mobile web flows, let backend know this is coming from the web SDK\n      // and pass returnUrl inside session for connectors that use parseEnhancedSession (e.g. Reddit)\n      if (effectiveMobile) {\n        sessionPayload.sdkType = 'web';\n        sessionPayload.returnUrl = returnUrl;\n      }\n\n      const bodyPayload = {\n        session: sessionPayload,\n      };\n\n      // Backward compatibility for YouTube route which currently reads req.body.returnUrl\n      // Desktop flows don't need a returnUrl; only send it for mobile web\n      if (!isCapacitorNative && effectiveMobile) {\n        bodyPayload.returnUrl = returnUrl;\n      }\n\n      const res = await fetch(`${sdkConfig.baseUrl}/${plat.connector}/authorize`, {\n        method: 'POST',\n        headers: { 'x-api-key': sdkConfig.apiKey, 'Content-Type': 'application/json' },\n        body: JSON.stringify(bodyPayload),\n      });\n      if (!res.ok) throw new Error('auth failed');\n      const data = await res.json();\n\n      const candidates = (\n        {\n          youtube: ['youtubeURL','youtubeUrl','youtube_url'],\n          linkedin: ['linkedinURL','linkedinUrl','linkedin_url'],\n          reddit: ['redditURL','redditUrl','reddit_url'],\n          pinterest: ['pinterestURL','pinterestUrl','pinterest_url'],\n          instagram: ['instagramURL','instagramUrl','instagram_url'],\n          github: ['githubURL','githubUrl','github_url'],\n          facebook: ['facebookURL','facebookUrl','facebook_url'],\n          gmail: ['gmailURL','gmailUrl','gmail_url'],\n        }[plat.connector]\n      ) || [`${plat.connector}URL`, `${plat.connector}Url`, `${plat.connector}_url`, 'platformURL', 'authUrl', 'url'];\n\n      let oauthUrl = null;\n      console.log(` [DEBUG] ${plat.connector} candidates:`, candidates, 'Response keys:', Object.keys(data));\n      \n      // Fallback: Check for URL in data object (case-insensitive)\n      if (!oauthUrl) {\n         const keys = Object.keys(data);\n         const candidateLower = candidates.map(c => c.toLowerCase());\n         for (const key of keys) {\n            if (candidateLower.includes(key.toLowerCase()) && data[key]) {\n               console.log(` [DEBUG] Found fuzzy match for ${plat.connector}: ${key}`);\n               oauthUrl = data[key];\n               break;\n            }\n         }\n      }\n\n      for (const k of candidates) {\n        if (data[k]) {\n          oauthUrl = data[k];\n          break;\n        }\n      }\n      \n      if (!oauthUrl) {\n        console.error(` No URL found for ${plat.connector} in response:`, data);\n        throw new Error('no url');\n      }\n\n      // Always store a return URL/context before launching OAuth.\n      // On iOS Safari, \"popup\" often becomes a new tab with no window.opener,\n      // so oauth-callback must rely on localStorage to navigate back.\n      try {\n        // Hint to the SDK: after OAuth completes, reopen the modal on UniversalOnboarding\n        // (otherwise existing users can get auto-routed to DataRequest on reload).\n        localStorage.setItem('onairos_post_oauth_flow', 'onboarding');\n        const returnUrl = window.location.href;\n        localStorage.setItem('onairos_return_url', returnUrl);\n        localStorage.setItem('onairos_oauth_context', 'platform-connector');\n        localStorage.setItem('onairos_oauth_platform', plat.connector);\n        console.log(` Stored return URL for ${plat.connector}:`, returnUrl);\n      } catch (e) {\n        // ignore storage failures\n      }\n\n      // PRIORITY 1: Use Capacitor Browser for native apps\n\n      if (isCapacitorNative) {\n        console.log(` Capacitor Native: opening ${plat.connector} OAuth with Browser plugin`);\n        try {\n          // Store context for when user returns\n          const localStorageKey = `onairos_${plat.connector}_success`;\n          \n          // Try to set up listener, but don't let it block\n          // Note: 'browserFinished' is fired when the browser is closed by the user or programmatically\n          try {\n            await Browser.addListener('browserFinished', () => {\n              console.log(` Browser closed for ${plat.connector}`);\n              // Only reset if we haven't already detected success\n              if (!localStorage.getItem(localStorageKey)) {\n                 setIsConnecting(false);\n                 setConnectingPlatform(null);\n              }\n            });\n          } catch (listenerError) {\n             console.warn('Browser listener setup failed:', listenerError);\n          }\n          \n          // Ensure Browser.open is awaited and errors caught\n          await Browser.open({ \n            url: oauthUrl,\n            windowName: '_blank',\n            presentationStyle: 'fullscreen'\n          });\n          console.log(` Opened ${plat.connector} OAuth URL in Capacitor Browser`);\n          \n          return true;\n        } catch (err) {\n          console.error(` Capacitor Browser failed for ${plat.connector}:`, err);\n          // Fall through to mobile browser redirect if plugin fails\n        }\n      }\n\n      // PRIORITY 2: Mobile browser - use same-page redirect\n      if (effectiveMobile) {\n        console.log(` Mobile browser/view: redirecting to ${plat.connector} OAuth in same page`);\n        \n        // Store return URL and context for redirect back\n        const returnUrl = window.location.href;\n        localStorage.setItem('onairos_post_oauth_flow', 'onboarding');\n        localStorage.setItem('onairos_return_url', returnUrl);\n        localStorage.setItem('onairos_oauth_context', 'platform-connector');\n        localStorage.setItem('onairos_oauth_platform', plat.connector);\n        console.log(` Stored return URL for ${plat.connector}:`, returnUrl);\n        \n        // Use same-page redirect on mobile\n        setIsConnecting(false);\n        setConnectingPlatform(null);\n        window.location.href = oauthUrl;\n        return true;\n      }\n\n      // Desktop: open popup\n      const popup = window.open(\n        oauthUrl,\n        'onairos_oauth_popup', \n        'width=500,height=600,scrollbars=yes,resizable=yes'\n      );\n\n      if (!popup || popup.closed || typeof popup.closed === 'undefined') {\n        console.warn(` ${plat.connector} popup blocked, falling back to full-page redirect`);\n        setIsConnecting(false);\n        setConnectingPlatform(null);\n        window.location.href = oauthUrl;\n        return true;\n      }\n\n      // Set up postMessage listener for cross-origin communication\n      const messageHandler = (event) => {\n        // Only accept messages from onairos.uk origin\n        if (event.origin !== 'https://api2.onairos.uk' && \n            event.origin !== 'https://onairos.uk' &&\n            !event.origin.includes('onairos.uk')) {\n          return;\n        }\n\n        if (event.data && event.data.type === 'oauth-success' && event.data.platform === plat.connector) {\n          console.log(` ${plat.connector} OAuth success received via postMessage:`, event.data);\n          window.removeEventListener('message', messageHandler);\n          clearInterval(pollInterval);\n          setIsConnecting(false);\n          setConnectingPlatform(null);\n          \n          // Mark connected ONLY after actual OAuth success (persistence happens automatically via useEffect)\n          setConnectedAccounts((currentState) => {\n            const updated = { ...currentState, [plat.name]: true };\n            console.log(` Connected ${plat.name} (postMessage) - Current:`, currentState, ' Updated:', updated);\n            return updated;\n          });\n\n          // Clean up any OAuth markers so they can't incorrectly affect future sessions.\n          try {\n            localStorage.removeItem(localStorageKey);\n            localStorage.removeItem(timestampKey);\n            localStorage.removeItem('onairos_oauth_context');\n            localStorage.removeItem('onairos_oauth_platform');\n            localStorage.removeItem('onairos_return_url');\n          } catch (e) {}\n          \n          // Close popup immediately\n          try {\n            if (popup && !popup.closed) {\n              popup.close();\n            }\n          } catch (e) {\n            // Ignore errors closing popup\n          }\n        }\n      };\n\n      window.addEventListener('message', messageHandler);\n\n      // Poll localStorage for OAuth completion (oauth-callback.html sets this)\n      const localStorageKey = `onairos_${plat.connector}_success`;\n      const timestampKey = `onairos_${plat.connector}_timestamp`;\n      let pollCount = 0;\n      const maxPolls = 300; // 5 minutes max\n\n      const pollInterval = setInterval(() => {\n        pollCount++;\n        \n        try {\n          // Check if popup is closed (works for popups, not tabs)\n          if (popup.closed && pollCount > 10) {\n            clearInterval(pollInterval);\n            window.removeEventListener('message', messageHandler);\n            setIsConnecting(false);\n            setConnectingPlatform(null);\n            console.log(` ${plat.connector} popup was closed`);\n            return;\n          }\n\n          // Check localStorage for success signal\n          const success = localStorage.getItem(localStorageKey);\n          const timestamp = localStorage.getItem(timestampKey);\n          \n          if (success === 'true' && timestamp) {\n            const timestampNum = parseInt(timestamp, 10);\n            const now = Date.now();\n            \n            // Only process if timestamp is recent (within last 30 seconds)\n            if (now - timestampNum < 30000) {\n              console.log(` ${plat.connector} OAuth completed successfully`);\n              clearInterval(pollInterval);\n              window.removeEventListener('message', messageHandler);\n              setIsConnecting(false);\n              setConnectingPlatform(null);\n              \n              // Mark connected ONLY after actual OAuth success (persistence happens automatically via useEffect)\n              setConnectedAccounts((currentState) => {\n                const updated = { ...currentState, [plat.name]: true };\n                console.log(` Connected ${plat.name} (localStorage poll) - adding to:`, currentState, ' result:', updated);\n                return updated;\n              });\n\n              // Clean up success markers + oauth context so they don't cause auto-toggles later.\n              try {\n                localStorage.removeItem(localStorageKey);\n                localStorage.removeItem(timestampKey);\n                localStorage.removeItem('onairos_oauth_context');\n                localStorage.removeItem('onairos_oauth_platform');\n                localStorage.removeItem('onairos_return_url');\n              } catch (e) {}\n              \n              // Close popup immediately\n              try {\n                if (!popup.closed) {\n                  popup.close();\n                }\n              } catch (e) {\n                // Ignore errors closing popup\n              }\n              return;\n            }\n          }\n\n          // Timeout after max polls\n          if (pollCount >= maxPolls) {\n            clearInterval(pollInterval);\n            window.removeEventListener('message', messageHandler);\n            setIsConnecting(false);\n            setConnectingPlatform(null);\n            console.log(` [TIMEOUT] ${plat.connector} OAuth polling timed out after 5 minutes`);\n            \n            // Try to close popup if still open\n            try {\n              if (!popup.closed) {\n                popup.close();\n              }\n            } catch (e) {\n              // Ignore errors closing popup\n            }\n          }\n        } catch (error) {\n          console.error(`Error in ${plat.connector} OAuth polling:`, error);\n        }\n      }, 1000);\n\n      return true;\n    } catch (e) {\n      console.error(` Error connecting to ${name}:`, e);\n      // On failure, revert the optimistic toggle\n      setConnectedAccounts((s) => ({ ...s, [name]: false }));\n      setIsConnecting(false); setConnectingPlatform(null); return false;\n    }\n  }\n\n  const handleSwitch = async (name) => {\n    // Mobile: AI direct-link platforms are display-only (no-op on tap)\n    const aiNoopOnMobile = ['ChatGPT', 'Claude', 'Gemini', 'Grok'];\n    if (isMobile && aiNoopOnMobile.includes(name)) {\n      console.log(` ${name} disabled on mobile - no action`);\n      return;\n    }\n    if (isConnecting && connectingPlatform !== name) return;\n    const on = !!connectedAccounts[name];\n    if (on) {\n      // Toggle OFF (persistence happens automatically via useEffect)\n      setConnectedAccounts((currentState) => {\n        const updated = { ...currentState, [name]: false };\n        console.log(` Disconnected ${name}`);\n        return updated;\n      });\n      return;\n    }\n    else await connectToPlatform(name);\n  };\n\n  const connectedCount = Object.values(connectedAccounts).filter(Boolean).length;\n\n  useEffect(() => {\n    if (!lottieRef.current) return;\n    const totalFrames = (personaAnim.op || 0) - (personaAnim.ip || 0);\n    const TOTAL_PLATFORMS = isWrappedApp ? 3 : 9; // 3 for wrapped app, 9 for other apps\n    const progress = connectedCount / TOTAL_PLATFORMS;\n    const target = Math.max(0, Math.floor(progress * totalFrames));\n    const start = lastFrameRef.current || 0;\n    const duration = 420; const startTs = performance.now();\n    const step = (now) => {\n      const t = Math.min(1, (now - startTs) / duration);\n      const eased = t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;\n      const frame = Math.floor(start + (target - start) * eased);\n      lottieRef.current.goToAndStop(frame, true);\n      if (t < 1) rafRef.current = requestAnimationFrame(step); else lastFrameRef.current = target;\n    };\n    if (rafRef.current) cancelAnimationFrame(rafRef.current);\n    rafRef.current = requestAnimationFrame(step);\n    return () => { if (rafRef.current) cancelAnimationFrame(rafRef.current); };\n  }, [connectedCount]);\n\n  // swipe handlers for smooth paging\n  const onTouchStart = (e) => { touchStartX.current = e.touches[0].clientX; touchDeltaX.current = 0; };\n  const onTouchMove  = (e) => { touchDeltaX.current = e.touches[0].clientX - touchStartX.current; };\n  const onTouchEnd   = () => {\n    const dx = touchDeltaX.current; const THRESH = 40;\n    // Disable pagination swipe for wrapped app\n    if (!isWrappedApp) {\n      if (dx < -THRESH && currentPage < 3) setCurrentPage(currentPage + 1);\n      else if (dx > THRESH && currentPage > 1) setCurrentPage(currentPage - 1);\n    }\n  };\n\n  return (\n    <div className=\"w-full h-full relative\" style={{ \n      height: '100%',\n      // Hide scrollbars for mobile browser only\n      ...(isMobile && {\n        scrollbarWidth: 'none', /* Firefox */\n        msOverflowStyle: 'none', /* IE/Edge */\n      })\n    }}>\n      <style>\n        {fadeSlideInKeyframes}\n        {/* Hide scrollbar for webkit browsers on mobile */}\n        {isMobile && `\n          .w-full::-webkit-scrollbar,\n          *::-webkit-scrollbar {\n            display: none;\n            width: 0;\n            height: 0;\n          }\n        `}\n      </style>\n\n      {/* persona as background (unchanged) */}\n      <div aria-hidden style={{ \n        position: 'absolute', \n        left: '50%', \n        top: PERSONA_TOP, \n        transform: 'translateX(-50%)', \n        width: personaSide, \n        height: personaSide, \n        zIndex: 0, \n        pointerEvents: 'none', \n        opacity: 0.95 \n      }}>\n        <div className=\"overflow-hidden rounded-[28px] w-full h-full\">\n          <Lottie lottieRef={lottieRef} animationData={personaAnim} autoplay={false} loop={false} style={{ width: '100%', height: '100%' }} />\n        </div>\n      </div>\n\n      {/* content above persona */}\n      <div className=\"relative z-10 h-full flex flex-col\" style={{\n        // Hide scrollbars for mobile browser only\n        ...(isMobile && {\n          scrollbarWidth: 'none', /* Firefox */\n          msOverflowStyle: 'none', /* IE/Edge */\n        })\n      }}>\n        {/* header - MOBILE ONLY: smaller top padding to give persona space */}\n        {/* Desktop: Reduced padding to fit everything */}\n        <div className=\"px-6 text-center flex-shrink-0\" style={{ paddingTop: isMobile ? (isSmallMobile ? '2.0rem' : '2.25rem') : '1.5rem', paddingBottom: isMobile ? '0.5rem' : '0.25rem' }}>\n          {/* Nudge header/subheader up slightly on mobile without affecting layout below (transform doesn't affect flow). */}\n          <div style={{ transform: isMobile ? 'translateY(-6px)' : 'translateY(-10px)' }}>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2 leading-tight\">Connect App Data</h1>\n            <p className=\"text-gray-600 text-base\">More Connections, Better Personalization.</p>\n          </div>\n        </div>\n\n        {/* Spacer - MOBILE ONLY: push icons/card WAY down so PERSONA SHINES */}\n        {/* Desktop: Increased spacer to push content lower on page */}\n        {isMobile && <div className=\"flex-1\" style={{ minHeight: isSmallMobile ? 120 : 150 }} />}\n        {!isMobile && <div className=\"flex-1\" style={{ minHeight: 80 }} />}\n\n        {/* icons band */}\n        <div className=\"px-6 flex-shrink-0\" style={{ height: ICONS_H }}>\n          {/* Web-only: nudge icon band down slightly without affecting layout below */}\n          <div className=\"h-full flex items-center justify-center\" style={{ transform: isMobile ? 'none' : 'translateY(8px)' }}>\n            <div\n              className=\"grid w-full box-border relative\"\n              onTouchStart={onTouchStart}\n              onTouchMove={onTouchMove}\n              onTouchEnd={onTouchEnd}\n                    style={{\n                gridAutoFlow: 'column',\n                gridTemplateColumns: `repeat(${platforms.length}, minmax(0,1fr))`,\n                columnGap: currentPage === 1 ? GAP_PAGE1 : GAP_PAGE2,\n                alignItems: 'center',\n                justifyItems: 'center',\n                paddingInline: 8,\n                overflow: 'hidden',\n              }}\n            >\n              {platforms.map((p, idx) => {\n                const on = !!connectedAccounts[p.name];\n                const showConnectedStyling = on;\n                const busy = false; // keep icon static visually per request\n                const isSel = selected === p.name;\n                \n                // Debug: Log connection state for each platform\n                if (on) {\n                  console.log(` ${p.name} is connected:`, { on, showConnectedStyling, connectedAccounts });\n                }\n                const shift = (currentPage === 1 ? idx : idx - 2) * 14;\n                return (\n                  <div key={p.name} className=\"transition-all duration-300\" style={{ opacity: 0, transform: `translateX(${shift}px)`, animation: 'fadeSlideIn 0.28s forwards', ['--slide-x']: `${shift}px` }}>\n                    <button\n                      type=\"button\"\n                      onClick={() => { \n                        // Mobile: AI direct-link platforms are display-only (no-op on tap)\n                        const aiNoopOnMobile = ['chatgpt', 'claude', 'gemini', 'grok'];\n                        if (isMobile && aiNoopOnMobile.includes(p.connector)) {\n                          console.log(` ${p.name} disabled on mobile - no action`);\n                          return;\n                        }\n\n                        setSelected(p.name);\n                        \n                        // Properly detect native platform (not just Capacitor presence)\n                        const isNativePlatform = typeof window !== 'undefined' && \n                          window.Capacitor?.isNativePlatform?.() === true;\n                        \n                        // Detect mobile browser (not Capacitor native)\n                        const isMobileBrowser = typeof window !== 'undefined' && \n                          window.innerWidth <= 768 && \n                          !isNativePlatform;\n                        \n                        // Debug logging\n                        console.log('UniversalOnboarding Click:', { \n                          platform: p.name, \n                          isMobile, \n                          isMobileProp, \n                          isNativePlatform,\n                          isMobileBrowser,\n                          hasCapacitor: typeof window !== 'undefined' && !!window.Capacitor,\n                          userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown'\n                        });\n\n                        // MOBILE BROWSER ONLY: Disable Instagram clicks (show visual selection but don't connect)\n                        if (p.name === 'Instagram' && isMobileBrowser) {\n                          console.log(' Instagram disabled on mobile browser - visual selection only');\n                          return;\n                        }\n\n                        // For ChatGPT, show modal ONLY on DESKTOP (not mobile browser or native app)\n                        if (p.connector === 'chatgpt' && !isNativePlatform && !isMobileBrowser) {\n                          console.log(' Opening ChatGPT Connect Modal (Desktop Only)');\n                          setShowChatGPTModal(true);\n                          return;\n                        }\n                        \n                        // On mobile browser, ChatGPT card is visible but clicking does nothing (like Instagram)\n                        if (p.connector === 'chatgpt' && isMobileBrowser) {\n                          console.log(' ChatGPT disabled on mobile browser - visual selection only');\n                          return;\n                        }\n\n                        if (p.directLink) {\n                          // For direct-link AI tools, just select (don't open)\n                          console.log(`Selecting ${p.name} (direct link platform)`);\n                          setSelected(p.name);\n                        } else {\n                          // For all platforms, icon click should ONLY select, not toggle\n                          console.log(`Selecting ${p.name}`);\n                          setSelected(p.name);\n                        }\n                      }}\n                      className=\"relative grid place-items-center outline-none\"\n                      style={{ width: SLOT, height: SLOT }}\n                      title={p.name}\n                    >\n                      <div \n                        className={`rounded-full transition-all duration-200 ease-out flex items-center justify-center shadow-lg ${showConnectedStyling ? 'ring-4 ring-blue-600 border-2 border-white bg-white text-black' : 'border-2 border-gray-300 hover:border-gray-400 bg-white text-black'}`}\n                        style={{ \n                          width: CIRCLE, \n                          height: CIRCLE, \n                          transform: `scale(${isSel ? ACTIVE_SCALE : 1})`, \n                          transformOrigin: 'center',\n                          boxShadow: showConnectedStyling ? '0 0 0 4px rgb(37 99 235), 0 4px 6px -1px rgba(0, 0, 0, 0.1)' : undefined\n                        }}\n                      >\n                        <div className=\"flex items-center justify-center\" style={{ width: 20, height: 20 }}>\n                          {p.icon}\n                        </div>\n                      </div>\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n\n        {/* Pagination dots - hidden for wrapped app */}\n        {!isWrappedApp && (\n          <div className=\"relative flex items-center justify-center gap-3 select-none flex-shrink-0\" style={{ marginTop: isMobile ? 12 : 24, marginBottom: isMobile ? 20 : 20, zIndex: 25 }}>\n            {[1,2,3].map(n => (\n              <button key={n} onClick={() => setCurrentPage(n)} aria-label={`page ${n}`} className=\"relative\" style={{ width: isMobile ? 6 : 8, height: isMobile ? 6 : 8 }}>\n                <span className={`block rounded-full ${currentPage === n ? 'bg-blue-600 scale-125' : 'bg-gray-300'} transition-transform`} style={{ width: isMobile ? 6 : 8, height: isMobile ? 6 : 8 }} />\n              </button>\n            ))}\n          </div>\n        )}\n\n        {/* info sheet  positioned using flex, MOBILE ONLY: LOWER */}\n        <div className=\"px-6 flex-shrink-0\" style={{ marginBottom: isMobile ? 24 : 28, zIndex: 20 }}>\n          <div\n            className=\"mx-auto rounded-2xl bg-white shadow-sm border border-gray-200 px-4 py-2.5\"\n            style={{ \n              width: 'min(680px,92%)', \n              maxHeight: isMobile ? INFO_SHEET_MAX_H : 'none',\n              overflow: isMobile ? 'hidden' : 'visible'\n            }}\n          >\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-gray-900 font-medium\">{selected}</div>\n              <button\n                type=\"button\"\n                role=\"switch\"\n                aria-checked={!!connectedAccounts[selected]}\n                aria-label={`toggle ${selected}`}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  handleSwitch(selected);\n                }}\n                onTouchEnd={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  handleSwitch(selected);\n                }}\n                disabled={isConnecting && connectingPlatform !== selected}\n                className={`relative inline-flex items-center transition-colors disabled:opacity-50 ${connectedAccounts[selected] ? 'bg-black' : 'bg-gray-200'} rounded-full touch-manipulation`}\n                style={{ width: 56, height: 32, WebkitTapHighlightColor: 'transparent', userSelect: 'none', touchAction: 'manipulation' }}\n              >\n                <span\n                  className=\"absolute bg-white rounded-full shadow pointer-events-none\"\n                  style={{\n                    width: 24,\n                    height: 24,\n                    transform: connectedAccounts[selected] ? 'translateX(26px)' : 'translateX(6px)',\n                    transition: 'transform 160ms ease',\n                  }}\n                />\n              </button>\n            </div>\n            <div className=\"mt-3\">\n              <div\n                className={`rounded-2xl bg-gray-50 text-gray-700 ${isMobile ? 'text-sm leading-6' : 'text-xs leading-5'} px-4 py-3 shadow-[inset_0_0_0_1px_rgba(0,0,0,0.04)]`}\n                style={{ \n                  maxHeight: isMobile ? Math.max(72, INFO_SHEET_MAX_H - 56) : 'none',\n                  overflowY: isMobile ? 'auto' : 'visible'\n                }}\n              >\n                {descriptions[selected] || null}\n              </div>\n              {!isMobileBrowser && !isNativePlatform && selected === 'ChatGPT' && (\n                <div className=\"mt-3 flex justify-end\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowChatGPTModal(true)}\n                    className=\"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-900\"\n                  >\n                    <span>Connect ChatGPT</span>\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      width=\"16\"\n                      height=\"16\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M10 6h8m0 0v8m0-8L6 18\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* footer  anchored at bottom using flex */}\n        <div className=\"px-6 flex-shrink-0\" style={{ paddingBottom: isMobile ? 12 : 16, background: isMobile ? 'transparent' : 'linear-gradient(to top, white 60%, rgba(255,255,255,0.9) 85%, rgba(255,255,255,0))', zIndex: 30 }}>\n          <div className=\"w-full bg-gray-900 hover:bg-gray-800 rounded-full text-base font-medium flex items-center justify-center gap-2 cursor-pointer transition-colors\"\n            style={{ paddingTop: isSmallMobile ? 12 : 16, paddingBottom: isSmallMobile ? 12 : 16, color: '#ffffff' }}\n            onClick={() => {\n            console.log(' UniversalOnboarding: Update clicked');\n            console.log(' Current connectedAccounts state:', connectedAccounts);\n            const connected = Object.entries(connectedAccounts).filter(([, v]) => v).map(([k]) => k);\n            console.log(' Sending to onComplete:', { connectedAccounts: connected, totalConnections: connected.length });\n            onComplete?.({ connectedAccounts: connected, totalConnections: connected.length });\n          }}>\n            Update\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"#ffffff\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" /></svg>\n          </div>\n          <div onClick={() => onComplete?.({ connectedAccounts: [], totalConnections: 0 })} className=\"w-full text-gray-600 text-base font-medium py-2 text-center cursor-pointer hover:text-gray-800 transition-colors\" style={{ paddingTop: isSmallMobile ? 6 : 8, paddingBottom: isSmallMobile ? 6 : 8 }}>Skip</div>\n        </div>\n      </div>\n      {/* Modal - Always render if state is true, regardless of isMobile prop */}\n      <ConnectChatGPTModal\n        open={showChatGPTModal}\n        onClose={() => setShowChatGPTModal(false)}\n        onConnected={() => {\n          setConnectedAccounts((s) => ({ ...s, ChatGPT: true }));\n        }}\n      />\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\n\nexport default function PinSetup({ onComplete, onBack, userEmail }) {\n  const [pin, setPin] = useState('');\n  const [pinRequirements, setPinRequirements] = useState({\n    length: false,\n    uppercase: false,\n    number: false,\n  });\n\n  // Check PIN requirements\n  useEffect(() => {\n    setPinRequirements({\n      length: pin.length >= 6,\n      uppercase: /[A-Z]/.test(pin),\n      number: /\\d/.test(pin),\n    });\n  }, [pin]);\n\n  const allRequirementsMet = pinRequirements.length && pinRequirements.uppercase && pinRequirements.number;\n\n  const handleSubmit = () => {\n    if (allRequirementsMet) {\n      onComplete({\n        pin: pin, // This should be hashed in production\n        pinCreated: true,\n        timestamp: new Date().toISOString()\n      });\n    }\n  };\n\n  return (\n    <div className=\"w-full h-full flex flex-col\" style={{ height: '100%', minHeight: 0 }}>\n      {/* Content - Flexible center area */}\n      <div className=\"px-6 pt-16 flex-1 flex flex-col\" style={{ minHeight: 0, overflow: 'hidden' }}>\n        <div className=\"mb-6 flex-shrink-0\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Create a PIN</h1>\n          <p className=\"text-gray-600 text-base\">A PIN so only you have the access to your data</p>\n        </div>\n\n        <div className=\"mb-6 flex-shrink-0\">\n          <input\n            type=\"password\"\n            value={pin}\n            onChange={(e) => setPin(e.target.value)}\n            className=\"w-full px-4 py-4 border-2 border-gray-300 rounded-xl text-center text-lg font-medium focus:border-gray-900 focus:outline-none bg-white !text-black\"\n            placeholder=\"Enter your PIN\"\n            maxLength={20}\n            style={{\n              WebkitTextFillColor: '#000000',\n              backgroundColor: '#FFFFFF',\n              color: '#000000'\n            }}\n          />\n        </div>\n\n        {/* Scrollable requirements list */}\n        <div className=\"flex-1 overflow-y-auto\" style={{ minHeight: 0 }}>\n          <div className=\"space-y-3 pb-4\">\n            <p className=\"text-gray-900 font-medium mb-4\">Your PIN must:</p>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-3\">\n                <div\n                  className={`w-5 h-5 rounded-full border-2 ${pinRequirements.length ? \"border-green-500 bg-green-500\" : \"border-gray-300 bg-white\"}`}\n                >\n                  {pinRequirements.length && (\n                    <svg className=\"w-3 h-3 text-white m-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                  )}\n                </div>\n                <span className=\"text-gray-700\">Be at least 6 characters in length.</span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <div\n                  className={`w-5 h-5 rounded-full border-2 ${pinRequirements.uppercase ? \"border-green-500 bg-green-500\" : \"border-gray-300 bg-white\"}`}\n                >\n                  {pinRequirements.uppercase && (\n                    <svg className=\"w-3 h-3 text-white m-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                  )}\n                </div>\n                <span className=\"text-gray-700\">Contain an uppercase letter.</span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <div\n                  className={`w-5 h-5 rounded-full border-2 ${pinRequirements.number ? \"border-green-500 bg-green-500\" : \"border-gray-300 bg-white\"}`}\n                >\n                  {pinRequirements.number && (\n                    <svg className=\"w-3 h-3 text-white m-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                  )}\n                </div>\n                <span className=\"text-gray-700\">Contain a number.</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Buttons - Fixed at bottom */}\n      <div className=\"px-6 pb-6 pt-4 flex-shrink-0 space-y-3\" style={{ minHeight: 'auto' }}>\n        <div\n          className={`w-full rounded-full py-4 text-base font-medium flex items-center justify-center gap-2 transition-colors ${\n            allRequirementsMet \n              ? \"bg-gray-900 hover:bg-gray-800 cursor-pointer\" \n              : \"bg-gray-300 text-gray-500 cursor-not-allowed\"\n          }`}\n          style={allRequirementsMet ? { color: '#ffffff' } : {}}\n          onClick={allRequirementsMet ? handleSubmit : undefined}\n        >\n          Continue\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n          </svg>\n        </div>\n      </div>\n    </div>\n  );\n} ","import React, { useState, useEffect } from \"react\";\nimport personaImg from \"../assets/persona.png\";\n\n/* -------------------------\n   ICON COMPONENTS\n-------------------------- */\nconst Icon = ({ type }) => {\n  const base = \"w-4 h-4 text-gray-700\";\n\n  switch (type) {\n    case \"User\":\n      return (\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4\n           1.79-4 4 1.79 4 4 4zm0 2c-2.67\n           0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/>\n        </svg>\n      );\n    case \"Memory\":\n      return (\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M12 2C6.48 2 2 6.48 2\n           12s4.48 10 10 10 10-4.48 10-10S17.52\n           2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z\"/>\n        </svg>\n      );\n    case \"Grid3X3\":\n      return (\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10\n           0h8V11h-8v10zm0-18v6h8V3h-8z\"/>\n        </svg>\n      );\n    case \"Brain\":\n      return (\n        <svg className={base} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M11.99 2C6.47 2 2 6.48 2\n           12s4.47 10 9.99 10C17.52\n           22 22 17.52 22 12S17.52\n           2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8\n           8-8 8 3.58 8 8-3.58 8-8\n           8zm3.5-9c.83 0 1.5-.67\n           1.5-1.5S16.33 8 15.5\n           8 14 8.67 14 9.5s.67 1.5\n           1.5 1.5zm-7 0c.83 0 1.5-.67\n           1.5-1.5S9.33 8 8.5\n           8 7 8.67 7 9.5s.67 1.5\n           1.5 1.5zm3.5 6.5c2.33\n           0 4.31-1.46 5.11-3.5H6.89c.8\n           2.04 2.78 3.5 5.11 3.5z\"/>\n        </svg>\n      );\n    default:\n      return null;\n  }\n};\n\n/* -------------------------\n   TOGGLE (soft apple style)\n-------------------------- */\nconst DataTypeToggle = ({ dataType, enabled, onToggle, isNative }) => {\n  const handle = () => {\n    if (dataType.required) return;\n    onToggle(dataType.id, !enabled);\n  };\n\n  return (\n    <button\n      onClick={handle}\n      className=\"\n        w-full flex items-center justify-between\n        py-2.5 px-2\n        bg-white/40 backdrop-blur-sm\n        hover:bg-white/70\n        transition rounded-xl shadow-sm\n      \"\n    >\n      <div className=\"flex items-center gap-3\">\n        <div className=\"w-7 h-7 flex items-center justify-center rounded-full bg-gray-100\">\n          <Icon type={dataType.icon} />\n        </div>\n        <span className={`${isNative ? 'text-[15px]' : 'text-[14px]'} text-gray-900 font-medium`}>\n          {dataType.name}\n        </span>\n      </div>\n\n      <div\n        className={`w-5 h-5 rounded-md border flex items-center justify-center shadow-sm\n          transition\n          ${enabled\n            ? \"bg-gray-900 border-gray-900\"\n            : \"bg-white border-gray-300\"\n          }`}\n      >\n        {enabled && (\n          <svg className=\"w-3 h-3 text-white\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n            <path d=\"M16.707 5.293a1 1 0 010\n            1.414l-8 8a1 1 0 01-1.414\n            0l-4-4a1 1 0 011.414-1.414L8\n            12.586l7.293-7.293a1 1 0\n            011.414 0z\"/>\n          </svg>\n        )}\n      </div>\n    </button>\n  );\n};\n\n/* -------------------------\n   MAIN COMPONENT\n-------------------------- */\n\nconst options = [\n  { id: \"basic\", name: \"Basic Profile\", icon: \"User\", required: true },\n  { id: \"rawMemories\", name: \"Raw Memory Data\", icon: \"Memory\" },\n  { id: \"preferences\", name: \"User Preferences\", icon: \"Grid3X3\" },\n  { id: \"personality\", name: \"Personality Traits\", icon: \"Brain\" },\n];\n\nconst DataRequest = ({ appName = \"My App\", onComplete, onConnectMoreApps, connectedPlatforms = [], showTime = false }) => {\n  const [selected, setSelected] = useState({\n    basic: true,\n    rawMemories: false,\n    preferences: false,\n    personality: false,\n  });\n\n  const [freq, setFreq] = useState(\"weekly\");\n  const [platformIconFailed, setPlatformIconFailed] = useState({});\n  const [platforms, setPlatforms] = useState([]);\n\n  const isWrappedApp = typeof appName === 'string' && appName.toLowerCase().includes('wrapped');\n\n  // Normalize platform ids/names coming from different sources (SDK, backend, localStorage)\n  // so logos always render (e.g. \"linkedin\" -> \"LinkedIn\").\n  const normalizePlatformName = (p) => {\n    const key = String(p || '').trim();\n    const lower = key.toLowerCase();\n    const map = {\n      instagram: 'Instagram',\n      youtube: 'YouTube',\n      linkedin: 'LinkedIn',\n      reddit: 'Reddit',\n      pinterest: 'Pinterest',\n      github: 'GitHub',\n      facebook: 'Facebook',\n      gmail: 'Gmail',\n      twitter: 'Twitter',\n      x: 'Twitter',\n      chatgpt: 'ChatGPT',\n      claude: 'Claude',\n      gemini: 'Gemini',\n      grok: 'Grok',\n    };\n    return map[lower] || (key ? key.charAt(0).toUpperCase() + key.slice(1) : '');\n  };\n\n  const toggle = (id, val) =>\n    setSelected((p) => ({ ...p, [id]: val }));\n\n  const selectedCount = Object.values(selected).filter(Boolean).length;\n\n  // Ensure we actually show connected platforms even if prop isn't passed\n  const getConnected = () => {\n    console.log(' DataRequest getConnected:', { \n      connectedPlatforms, \n      isArray: Array.isArray(connectedPlatforms),\n      type: typeof connectedPlatforms \n    });\n\n    // Prefer localStorage as the source of truth (it is updated by UniversalOnboarding on OAuth return).\n    // This avoids stale props causing \"added platforms\" to not show up until a full refresh.\n    try {\n      const u = JSON.parse(localStorage.getItem(\"onairosUser\") || \"{}\");\n      if (u && u.connectedAccounts) {\n        // Check if it's an array\n        if (Array.isArray(u.connectedAccounts)) {\n          const normalized = u.connectedAccounts.map(normalizePlatformName).filter(Boolean);\n          console.log(' Using localStorage connectedAccounts (array):', u.connectedAccounts, '', normalized);\n          return normalized;\n        }\n        // Check if it's an object\n        if (typeof u.connectedAccounts === \"object\") {\n          const mappedRaw = Object.entries(u.connectedAccounts).filter(([_, v]) => Boolean(v)).map(([k]) => k);\n          const mapped = mappedRaw.map(normalizePlatformName).filter(Boolean);\n          console.log(' Using localStorage connectedAccounts (object):', mappedRaw, '', mapped);\n          return mapped;\n        }\n      }\n    } catch (e) {\n      console.error(' Failed to read localStorage:', e);\n    }\n\n    // Fall back to prop if localStorage isn't available / doesn't have the field.\n    // If array provided, use it\n    if (Array.isArray(connectedPlatforms) && connectedPlatforms.length > 0) {\n      const normalized = connectedPlatforms.map(normalizePlatformName).filter(Boolean);\n      console.log(' Using connectedPlatforms prop (array):', connectedPlatforms, '', normalized);\n      return normalized;\n    }\n    \n    // If object provided, map truthy keys\n    if (connectedPlatforms && typeof connectedPlatforms === \"object\" && !Array.isArray(connectedPlatforms)) {\n      const mappedRaw = Object.entries(connectedPlatforms).filter(([_, v]) => Boolean(v)).map(([k]) => k);\n      const mapped = mappedRaw.map(normalizePlatformName).filter(Boolean);\n      console.log(' Using connectedPlatforms prop (object):', mappedRaw, '', mapped);\n      return mapped;\n    }\n    \n    console.log(' No connected platforms found');\n    return [];\n  };\n\n  // Refresh platforms list on mount and when connectedAccounts changes\n  useEffect(() => {\n    const refreshPlatforms = () => {\n      const newPlatforms = getConnected();\n      console.log(' DataRequest refreshing platforms:', newPlatforms);\n      setPlatforms(newPlatforms);\n    };\n\n    // Initial load\n    refreshPlatforms();\n\n    // Listen for custom event from UniversalOnboarding\n    const handleConnectedAccountsUpdate = () => {\n      console.log(' DataRequest received connectedAccountsUpdate event');\n      refreshPlatforms();\n    };\n    window.addEventListener('onairos-connected-accounts-update', handleConnectedAccountsUpdate);\n\n    return () => {\n      window.removeEventListener('onairos-connected-accounts-update', handleConnectedAccountsUpdate);\n    };\n  }, [connectedPlatforms]); // Re-run if connectedPlatforms prop changes\n\n  console.log(' Final platforms to display:', platforms);\n\n  const isCapacitorNative = typeof window !== 'undefined' && \n    window.Capacitor && \n    typeof window.Capacitor.isNativePlatform === 'function' && \n    window.Capacitor.isNativePlatform();\n\n  // Check if user has any LLM connections\n  const hasLLMConnections = () => {\n    const llmPlatforms = ['chatgpt', 'claude', 'gemini', 'grok', 'ChatGPT', 'Claude', 'Gemini', 'Grok'];\n    return platforms.some(p => llmPlatforms.includes(p));\n  };\n\n  // Filter options based on LLM connections\n  const availableOptions = options.filter(opt => {\n    if (opt.id === 'rawMemories') {\n      return hasLLMConnections();\n    }\n    return true;\n  });\n\n  const freqToPercent = (f) => (f === \"once\" ? 0 : f === \"weekly\" ? 50 : 100);\n  const handleRailClick = (e) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));\n    const ratio = x / rect.width;\n    if (ratio < 1 / 3) setFreq(\"once\");\n    else if (ratio < 2 / 3) setFreq(\"weekly\");\n    else setFreq(\"daily\");\n  };\n\n  return (\n    <div className=\"flex flex-col h-full max-h-full md:max-h-[90vh] bg-white/70 backdrop-blur-2xl rounded-3xl overflow-hidden\">\n\n      {/* CONTENT */}\n      <div className=\"flex-1 overflow-y-auto px-6 pt-6 md:pt-10 pb-4\">\n\n        {/* ICONS */}\n        <div className=\"flex justify-center items-center gap-4 mb-5 md:mb-6\">\n          {/* Wrapped: Onairos -> Persona. Non-wrapped: Onairos -> app placeholder */}\n          <div className={`${isCapacitorNative ? 'w-14 h-14' : 'w-12 h-12'} rounded-2xl bg-white shadow flex items-center justify-center`}>\n            {isWrappedApp ? (\n              <img \n                src=\"https://onairos.sirv.com/Images/OnairosBlack.png\" \n                alt=\"Onairos\"\n                className={`${isCapacitorNative ? 'w-10 h-10' : 'w-8 h-8'} object-contain`}\n              />\n            ) : (\n              <img \n                src=\"https://onairos.sirv.com/Images/OnairosBlack.png\" \n                alt=\"Onairos\"\n                className={`${isCapacitorNative ? 'w-10 h-10' : 'w-8 h-8'} object-contain`}\n              />\n            )}\n          </div>\n          <svg className={`${isCapacitorNative ? 'w-8 h-8' : 'w-6 h-6'} text-gray-400`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M14 5l7 7m0 0l-7 7m7-7H3\" />\n          </svg>\n          <div className={`${isCapacitorNative ? 'w-14 h-14' : 'w-12 h-12'} rounded-2xl bg-white shadow flex items-center justify-center`}>\n            {isWrappedApp ? (\n              <img \n                src={personaImg}\n                alt=\"Persona\"\n                className={`${isCapacitorNative ? 'w-10 h-10' : 'w-8 h-8'} object-contain rounded-xl`}\n                onError={(e) => { e.currentTarget.style.display = 'none'; }}\n              />\n            ) : (\n              <span className={`${isCapacitorNative ? 'text-2xl' : 'text-xl'} font-serif font-bold`}>J</span>\n            )}\n          </div>\n        </div>\n\n        {/* TITLE */}\n        <div className=\"text-center mb-6 md:mb-8\">\n          <h1 className={`${isCapacitorNative ? 'text-[26px] md:text-[28px]' : 'text-[24px] md:text-[26px]'} font-semibold text-gray-900 leading-tight tracking-tight`}>\n            {appName} wants to personalize your experience\n          </h1>\n          <p className={`${isCapacitorNative ? 'text-[14px]' : 'text-[13px]'} text-gray-500 mt-1`}>choose what to share</p>\n        </div>\n\n        {/* TOGGLES */}\n        <div className={`${isCapacitorNative ? 'flex flex-col gap-3' : 'flex flex-col sm:grid sm:grid-cols-2 gap-3 sm:gap-4'} mb-6 md:mb-10`}>\n          {availableOptions.map((opt) => (\n            <DataTypeToggle\n              key={opt.id}\n              dataType={opt}\n              enabled={selected[opt.id]}\n              onToggle={toggle}\n              isNative={isCapacitorNative}\n            />\n          ))}\n        </div>\n\n        {/* FREQUENCY PANEL - Only shown if showTime is true */}\n        {showTime && (\n          <div className=\"p-5 rounded-3xl bg-white/50 backdrop-blur-md border border-black/5 shadow-sm\">\n            <div className=\"flex justify-between items-center mb-3\">\n              <span className=\"text-sm font-medium text-gray-900\">\n                How often can {appName} receive updates?\n              </span>\n              <span className=\"text-[11px] text-gray-500\">\n                {freq === \"once\"\n                  ? \"one-time only\"\n                  : freq === \"weekly\"\n                  ? \"once per week\"\n                  : \"once per day\"}\n              </span>\n            </div>\n\n            {/* SLIDER: subtle rail, monochrome progress, click-to-set */}\n            <div\n              className=\"relative h-2.5 rounded-full bg-gray-200/90 overflow-hidden mb-4 border border-black/5 shadow-inner cursor-pointer\"\n              onClick={handleRailClick}\n            >\n              <div\n                className=\"absolute h-full transition-all rounded-full\"\n                style={{\n                  width: `${freqToPercent(freq)}%`,\n                  background: \"linear-gradient(90deg, rgba(31,41,55,0.95) 0%, rgba(107,114,128,0.9) 60%, rgba(209,213,219,0.85) 100%)\",\n                }}\n              />\n              {/* Tick marks for 3 stops */}\n              <span className=\"absolute left-0 top-1/2 -translate-y-1/2 w-[2px] h-3 bg-black/10\" />\n              <span className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[2px] h-3 bg-black/10\" />\n              <span className=\"absolute right-0 top-1/2 -translate-y-1/2 w-[2px] h-3 bg-black/10\" />\n              {/* Thumb indicator (sleek) */}\n              <span\n                className=\"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-4.5 h-4.5 rounded-full bg-white border border-black/20 shadow-md\"\n                style={{\n                  left: `${freqToPercent(freq)}%`,\n                }}\n              />\n            </div>\n\n            <div className=\"grid grid-cols-3 text-center text-[12px] font-medium\">\n              <button onClick={() => setFreq(\"once\")} className=\"text-gray-700\">1 only</button>\n              <button onClick={() => setFreq(\"weekly\")} className=\"text-gray-900 font-semibold\">1 weekly</button>\n              <button onClick={() => setFreq(\"daily\")} className=\"text-gray-700\">1 daily</button>\n            </div>\n\n            <p className=\"text-[11px] text-gray-500 mt-3 leading-snug\">\n              This only controls update frequency; It does not grant more access.\n            </p>\n          </div>\n        )}\n\n      </div>\n\n      {/* FOOTER */}\n      <div className=\"px-6 py-4 md:py-5 bg-white/80 backdrop-blur border-t border-black/5\">\n        {/* Connected platforms pinned above CTAs so it never gets cropped on mobile */}\n        {platforms && platforms.length > 0 && (\n          <div className=\"mb-3 rounded-2xl bg-white/60 backdrop-blur border border-black/5 px-3 py-2\">\n            <div className=\"text-center text-[11px] text-gray-500 mb-1\">Connected Platforms</div>\n            <div className=\"flex items-center justify-center gap-2 overflow-x-auto whitespace-nowrap pb-1\" style={{ WebkitOverflowScrolling: 'touch' }}>\n              {platforms.map((platform, index) => {\n                const logoMap = {\n                  Instagram: 'https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png',\n                  YouTube: 'https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg',\n                  LinkedIn: 'https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png',\n                  Reddit: 'https://upload.wikimedia.org/wikipedia/en/b/bd/Reddit_Logo_Icon.svg',\n                  Pinterest: 'https://upload.wikimedia.org/wikipedia/commons/0/08/Pinterest-logo.png',\n                  GitHub: 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png',\n                  Facebook: 'https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg',\n                  Gmail: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg',\n                  Twitter: 'https://upload.wikimedia.org/wikipedia/commons/6/6f/Logo_of_Twitter.svg',\n                  ChatGPT: 'https://anushkasirv.sirv.com/openai.png',\n                  Claude: 'https://anushkasirv.sirv.com/claude-color.png',\n                  Gemini: 'https://anushkasirv.sirv.com/gemini-color.png',\n                  Grok: 'https://anushkasirv.sirv.com/grok.png'\n                };\n                const src = logoMap[platform] || '';\n                const key = `${platform}-${index}`;\n                const failed = !!platformIconFailed[key];\n                const fallbackText = (() => {\n                  if (platform === 'LinkedIn') return 'in';\n                  if (platform === 'YouTube') return 'YT';\n                  if (platform === 'ChatGPT') return 'AI';\n                  return String(platform || '?').slice(0, 2).toUpperCase();\n                })();\n                return (\n                  failed || !src ? (\n                    <div\n                      key={key}\n                      title={platform}\n                      className=\"w-6 h-6 rounded-md shadow-sm flex-shrink-0 bg-gray-100 text-gray-700 flex items-center justify-center text-[10px] font-semibold\"\n                    >\n                      {fallbackText}\n                    </div>\n                  ) : (\n                    <img\n                      key={key}\n                      src={src}\n                      alt={platform}\n                      title={platform}\n                      className=\"w-6 h-6 rounded-md shadow-sm flex-shrink-0\"\n                      onError={() => setPlatformIconFailed((p) => ({ ...p, [key]: true }))}\n                    />\n                  )\n                );\n              })}\n            </div>\n            {typeof onConnectMoreApps === 'function' && (\n              <div className=\"mt-1 flex justify-center\">\n                <button\n                  type=\"button\"\n                  onClick={onConnectMoreApps}\n                  className=\"text-[11px] font-medium text-gray-700 hover:text-gray-900 inline-flex items-center gap-1.5\"\n                  style={{ WebkitTextFillColor: '#111827' }}\n                >\n                  <span>Connect more</span>\n                  <span\n                    aria-hidden=\"true\"\n                    className=\"inline-flex items-center justify-center w-4 h-4 rounded-full border border-gray-400 text-gray-800 leading-none\"\n                    style={{ WebkitTextFillColor: '#111827' }}\n                  >\n                    +\n                  </span>\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* If no platforms are connected yet, still allow user to go connect apps */}\n        {(!platforms || platforms.length === 0) && typeof onConnectMoreApps === 'function' && (\n          <div className=\"mb-3 rounded-2xl bg-white/60 backdrop-blur border border-black/5 px-3 py-2 text-center\">\n            <div className=\"text-[11px] text-gray-500 mb-1\">No apps connected yet</div>\n            <button\n              type=\"button\"\n              onClick={onConnectMoreApps}\n              className=\"text-[12px] font-medium underline underline-offset-2 text-gray-700 hover:text-gray-900\"\n              style={{ WebkitTextFillColor: '#111827' }}\n            >\n              Connect apps?\n            </button>\n          </div>\n        )}\n        <button\n          className=\"w-full rounded-full py-3 bg-gray-900 text-sm font-medium shadow-sm flex items-center justify-center mb-3\"\n          style={{ color: '#ffffff' }}\n          disabled={selectedCount === 0}\n          onClick={() => {\n            if (selectedCount === 0) return;\n            onComplete?.({\n              approved: Object.keys(selected).filter(id => selected[id]),\n              freq,\n            });\n          }}\n        >\n          Accept & Continue\n        </button>\n\n        <style>{`\n          .decline-button {\n            color: #000000 !important;\n          }\n          .decline-button * {\n            color: #000000 !important;\n          }\n          .decline-button span {\n            color: #000000 !important;\n          }\n          button.decline-button {\n            color: #000000 !important;\n          }\n          .decline-button-text {\n            color: #000000 !important;\n            -webkit-text-fill-color: #000000 !important;\n          }\n        `}</style>\n        <button\n          className=\"w-full rounded-full py-3 bg-gray-100 text-sm font-medium shadow-sm decline-button\"\n          style={{ color: '#000000' }}\n          onClick={() => {\n            onComplete?.({\n              approved: [],\n              freq,\n              declined: true,\n            });\n          }}\n        >\n          <span className=\"decline-button-text\" style={{ color: '#000000' }}>Decline</span>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default DataRequest;\n","import React, { useState, useEffect } from 'react';\nimport { COLORS } from '../theme/colors.js';\n\nexport default function TrainingComponent({ onComplete, userEmail, appName = 'App', testMode = false }) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [isComplete, setIsComplete] = useState(false);\n\n  const steps = [\n    {\n      title: 'Setting up your personal AI',\n      description: 'Initializing your secure data model',\n      icon: '',\n      duration: testMode ? 800 : 2000 // Much faster in test mode\n    },\n    {\n      title: 'Processing your connections',\n      description: 'Analyzing your social media patterns',\n      icon: '',\n      duration: testMode ? 600 : 2500\n    },\n    {\n      title: 'Training your model',\n      description: 'Building your personalized insights',\n      icon: '',\n      duration: testMode ? 700 : 3000\n    },\n    {\n      title: 'Finalizing setup',\n      description: 'Preparing your Onairos experience',\n      icon: '',\n      duration: testMode ? 500 : 2000\n    }\n  ];\n\n  useEffect(() => {\n    let interval;\n    let stepTimeout;\n\n    if (currentStep < steps.length) {\n      const stepDuration = steps[currentStep].duration;\n      const stepProgress = 100 / steps.length;\n\n      // Update progress gradually\n      interval = setInterval(() => {\n        setProgress(prev => {\n          const newProgress = prev + (stepProgress / (stepDuration / 100));\n          return Math.min(newProgress, (currentStep + 1) * stepProgress);\n        });\n      }, 100);\n\n      // Move to next step after duration\n      stepTimeout = setTimeout(() => {\n        if (currentStep < steps.length - 1) {\n          setCurrentStep(prev => prev + 1);\n        } else {\n          setIsComplete(true);\n          const completionDelay = testMode ? 400 : 1000; // Faster completion in test mode\n          \n          if (testMode) {\n            console.log(' Test mode: Training simulation completed');\n          }\n          \n          setTimeout(() => {\n            onComplete({\n              trainingComplete: true,\n              timestamp: new Date().toISOString(),\n              userEmail: userEmail,\n              appName: appName,\n              testMode: testMode,\n              simulatedTraining: testMode\n            });\n          }, completionDelay);\n        }\n      }, stepDuration);\n    }\n\n    return () => {\n      if (interval) clearInterval(interval);\n      if (stepTimeout) clearTimeout(stepTimeout);\n    };\n  }, [currentStep, onComplete, userEmail, appName]);\n\n  return (\n    <div className=\"w-full flex flex-col items-center space-y-8\">\n      <div className=\"text-center\">\n        <div \n          className=\"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4\"\n          style={{\n            background: `linear-gradient(135deg, ${COLORS.info}, #8B5CF6)`\n          }}\n        >\n          <div className=\"text-3xl\">\n            {isComplete ? '' : steps[currentStep]?.icon}\n          </div>\n        </div>\n        <h2 \n          className=\"text-2xl font-bold mb-2\"\n          style={{ color: COLORS.textPrimary }}\n        >\n          {isComplete ? 'All set!' : steps[currentStep]?.title}\n        </h2>\n        <p style={{ color: COLORS.textSecondary }}>\n          {isComplete \n            ? 'Your personal AI is ready to use' \n            : steps[currentStep]?.description\n          }\n        </p>\n      </div>\n\n      {/* Progress Bar */}\n      <div className=\"w-full\">\n        <div \n          className=\"flex justify-between text-sm mb-2\"\n          style={{ color: COLORS.textSecondary }}\n        >\n          <span>Progress</span>\n          <span>{Math.round(progress)}%</span>\n        </div>\n        <div \n          className=\"w-full rounded-full h-2\"\n          style={{ backgroundColor: COLORS.borderLight }}\n        >\n          <div \n            className=\"h-2 rounded-full transition-all duration-300 ease-out\"\n            style={{ \n              width: `${progress}%`,\n              background: `linear-gradient(90deg, ${COLORS.info}, #8B5CF6)`\n            }}\n          />\n        </div>\n      </div>\n\n      {/* Steps Indicator */}\n      <div className=\"flex justify-center space-x-2\">\n        {steps.map((_, index) => (\n          <div\n            key={index}\n            className=\"w-3 h-3 rounded-full transition-all duration-300\"\n            style={{\n              backgroundColor: index <= currentStep ? COLORS.info : COLORS.border\n            }}\n          />\n        ))}\n      </div>\n\n      {/* Current Step Details */}\n      <div \n        className=\"p-4 rounded-lg w-full\"\n        style={{ backgroundColor: COLORS.backgroundSecondary }}\n      >\n        <div className=\"flex items-center space-x-3\">\n          <div \n            className=\"w-8 h-8 rounded-full flex items-center justify-center\"\n            style={{ backgroundColor: '#DBEAFE' }}\n          >\n            <div className=\"text-sm\">\n              {isComplete ? '' : steps[currentStep]?.icon}\n            </div>\n          </div>\n          <div>\n            <h3 \n              className=\"font-medium\"\n              style={{ color: COLORS.textPrimary }}\n            >\n              {isComplete ? 'Training Complete' : `Step ${currentStep + 1} of ${steps.length}`}\n            </h3>\n            <p \n              className=\"text-sm\"\n              style={{ color: COLORS.textSecondary }}\n            >\n              {isComplete \n                ? 'Your Onairos experience is ready' \n                : steps[currentStep]?.description\n              }\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* App Info */}\n      <div className=\"text-center\">\n        <p \n          className=\"text-sm\"\n          style={{ color: COLORS.textSecondary }}\n        >\n          Setting up for <span className=\"font-medium\">{appName}</span>\n        </p>\n        {userEmail && (\n          <p \n            className=\"text-xs mt-1\"\n            style={{ color: COLORS.textMuted }}\n          >\n            {userEmail}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n} ","import React, { useEffect, useState, useRef } from 'react';\nimport Lottie from 'lottie-react';\nimport rainAnim from '../../public/rain-anim.json';\nimport io from 'socket.io-client';\n\nconst trainingPhrases = [\n  \"Analyzing your data patterns...\",\n  \"Building your personality model...\",\n  \"Training neural networks...\",\n  \"Running inference algorithms...\",\n  \"Generating personalized insights...\",\n  \"Finalizing your profile...\",\n  \"Almost done...\"\n];\n\nexport default function TrainingScreen({ onComplete, onTrainingStart, userEmail, connectedAccounts = [], userToken }) {\n  const [progress, setProgress] = useState(0);\n  const [currentPhrase, setCurrentPhrase] = useState(trainingPhrases[0]);\n  const [currentStage, setCurrentStage] = useState('training'); // 'training' | 'inference' | 'complete'\n  const lottieRef = useRef(null);\n\n  useEffect(() => {\n    let socket = null;\n    let progressTimer = null;\n    let didSignalStart = false;\n\n    const signalTrainingStarted = () => {\n      if (didSignalStart) return;\n      didSignalStart = true;\n      try {\n        onTrainingStart?.();\n      } catch (e) {\n        // never block training due to callback issues\n      }\n    };\n    \n    // ACTUALLY run training + inference using Socket.IO\n    const runTrainingAndInference = async () => {\n      console.log(' Starting REAL training for:', userEmail);\n      console.log(' Connected accounts:', connectedAccounts);\n      console.log(' userToken prop received:', userToken ? `${userToken.substring(0, 20)}...` : 'UNDEFINED');\n\n      try {\n        // Use token passed from parent component, fallback to localStorage\n        let token = userToken;\n        \n        if (!token) {\n          console.warn(' Token not passed as prop, checking localStorage...');\n          try {\n            const storedToken = localStorage.getItem('onairos_user_token');\n            if (storedToken) {\n              token = storedToken;\n              console.log(' Found token in localStorage');\n            } else {\n              const userData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n              token = userData.token;\n              if (token) {\n                console.log(' Found token in onairosUser localStorage');\n              }\n            }\n          } catch (e) {\n            console.error(' Error reading from localStorage:', e);\n          }\n        }\n\n        if (!token) {\n          console.error(' No token found anywhere - cannot run training');\n          console.error(' Token should be passed from parent component OR stored in localStorage');\n          throw new Error('No authentication token');\n        }\n        \n        console.log(' Token found, starting Socket.IO training...', token.substring(0, 20) + '...');\n\n        // Phase 1: Connect to Socket.IO\n        setCurrentStage('training');\n        setCurrentPhrase('Connecting to server...');\n        console.log(' Connecting to Socket.IO server...');\n\n        socket = io('https://api2.onairos.uk', {\n          auth: { token },\n          transports: ['websocket', 'polling'],\n          reconnection: false, // Don't reconnect automatically for this one-time operation\n          timeout: 60000 // 60 second timeout\n        });\n\n        // Handle connection\n        socket.on('connect', () => {\n          console.log(' Socket connected:', socket.id);\n          // At this point, training can actually start (server reachable).\n          signalTrainingStarted();\n          setCurrentPhrase('Starting training...');\n          \n          // Start progress animation\n          progressTimer = setInterval(() => {\n            setProgress(prev => {\n              if (prev < 95) return prev + 0.5; // Slow smooth progress\n              return prev;\n            });\n          }, 200);\n\n          // Trigger training\n          console.log(' Emitting start-training event with:', {\n            socketId: socket.id,\n            email: userEmail,\n            platforms: connectedAccounts\n          });\n\n          socket.emit('start-training', {\n            socketId: socket.id,\n            email: userEmail,\n            username: userEmail,\n            platforms: connectedAccounts,\n            connectedAccounts: connectedAccounts\n          });\n        });\n\n        // Handle training progress updates\n        socket.on('training-progress', (data) => {\n          console.log(' Training progress:', data);\n          // Progress events mean training has definitely started.\n          signalTrainingStarted();\n          if (data.percentage) {\n            setProgress(Math.min(data.percentage, 95)); // Cap at 95% until complete\n          }\n          if (data.message) {\n            setCurrentPhrase(data.message);\n          }\n          if (data.stage) {\n            setCurrentStage(data.stage);\n          }\n        });\n\n        // Handle training completion\n        socket.on('training-complete', (result) => {\n          console.log(' Training complete via Socket.IO:', result);\n          \n          if (progressTimer) clearInterval(progressTimer);\n          setProgress(100);\n          setCurrentStage('complete');\n          setCurrentPhrase('Training complete!');\n\n          // Log complete results to console\n          console.log('\\n ===== TRAINING + INFERENCE COMPLETE =====\\n');\n          console.log(' Training Results:', {\n            status: 'completed',\n            userEmail,\n            connectedPlatforms: connectedAccounts,\n            traits: result.traits || result.trainingResults?.traits || {},\n            timestamp: new Date().toISOString()\n          });\n          \n          console.log('\\n Traits Retrieved:', {\n            traits: result.traits || result.trainingResults?.traits || {},\n            userTraits: result.userTraits || result.trainingResults?.userTraits || {},\n            hasLlmData: !!result.llmData,\n            inferenceResults: result.inferenceResults || null\n          });\n          \n          console.log('\\n Model ready for predictions!\\n');\n\n          // Disconnect socket\n          socket.disconnect();\n\n          // Complete after short delay\n          setTimeout(() => {\n            onComplete?.(result);\n          }, 500);\n        });\n\n        // Handle errors\n        socket.on('training-error', (error) => {\n          console.error(' Training error from Socket.IO:', error);\n          \n          if (progressTimer) clearInterval(progressTimer);\n          \n          setProgress(100);\n          setCurrentPhrase('Error occurred, continuing...');\n          \n          socket.disconnect();\n          \n          setTimeout(() => {\n            onComplete?.({ \n              error: error.message || 'Training failed',\n              fallback: true \n            });\n          }, 500);\n        });\n\n        // Handle connection errors\n        socket.on('connect_error', (error) => {\n          console.error(' Socket.IO connection error:', error);\n          \n          if (progressTimer) clearInterval(progressTimer);\n          \n          setProgress(100);\n          setCurrentPhrase('Connection error, continuing...');\n          \n          socket.disconnect();\n          \n          setTimeout(() => {\n            onComplete?.({ \n              error: 'Failed to connect to training server',\n              fallback: true \n            });\n          }, 500);\n        });\n\n        // Handle disconnect\n        socket.on('disconnect', (reason) => {\n          console.log(' Socket disconnected:', reason);\n        });\n\n      } catch (error) {\n        console.error(' Training/Inference Error:', error);\n        \n        if (progressTimer) clearInterval(progressTimer);\n        if (socket) socket.disconnect();\n        \n        // Fallback: still complete but show error\n        console.warn(' Falling back to cached data or skipping training');\n        setProgress(100);\n        setTimeout(() => {\n          onComplete?.({ \n            error: error.message,\n            fallback: true \n          });\n        }, 500);\n      }\n    };\n\n    runTrainingAndInference();\n\n    // Cleanup on unmount\n    return () => {\n      if (progressTimer) clearInterval(progressTimer);\n      if (socket) {\n        console.log(' Cleaning up socket connection');\n        socket.disconnect();\n      }\n    };\n  }, [userEmail, connectedAccounts, userToken, onComplete]);\n\n  return (\n    <div className=\"w-full h-full flex flex-col items-center justify-center p-8 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900\">\n      <style>{`\n        @keyframes float {\n          0%, 100% { transform: translateY(0px); }\n          50% { transform: translateY(-20px); }\n        }\n        .float-animation {\n          animation: float 6s ease-in-out infinite;\n        }\n        .glow-bar {\n          box-shadow: 0 0 20px rgba(59, 130, 246, 0.5),\n                      0 0 40px rgba(139, 92, 246, 0.3),\n                      inset 0 0 20px rgba(255, 255, 255, 0.1);\n        }\n      `}</style>\n\n      {/* Rain Animation - Sleek and centered */}\n      <div className=\"w-full max-w-sm mb-6 float-animation\">\n        <Lottie \n          lottieRef={lottieRef}\n          animationData={rainAnim}\n          loop={true}\n          autoplay={true}\n          style={{ width: '100%', height: '240px', filter: 'brightness(1.1)' }}\n        />\n      </div>\n\n      {/* Training Status - Sleeker design */}\n      <div className=\"w-full max-w-lg\">\n        {/* Title with stage indicator */}\n        <div className=\"text-center mb-6\">\n          <div className=\"inline-flex items-center gap-2 mb-3 px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-sm border border-white/20\">\n            <div className=\"w-2 h-2 rounded-full bg-blue-400 animate-pulse\"></div>\n            <span className=\"text-xs font-medium text-blue-100 uppercase tracking-wider\">\n              {currentStage === 'training' ? 'Training Model' : \n               currentStage === 'inference' ? 'Running Inference' : 'Complete'}\n            </span>\n          </div>\n          \n          <h2 className=\"text-3xl font-bold text-white mb-2 tracking-tight\">\n            {currentStage === 'complete' ? 'Ready!' : 'Building Your Profile'}\n          </h2>\n          \n          <p className=\"text-blue-200 text-sm font-medium\">\n            {currentPhrase}\n          </p>\n        </div>\n\n        {/* Progress Bar - Sleek glassmorphism design */}\n        <div className=\"relative mb-4\">\n          <div className=\"w-full bg-white/5 backdrop-blur-sm rounded-full h-3 overflow-hidden border border-white/10\">\n            <div \n              className=\"h-full rounded-full transition-all duration-300 ease-out glow-bar\"\n              style={{ \n                width: `${progress}%`,\n                background: 'linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%)'\n              }}\n            />\n          </div>\n          \n          {/* Progress percentage overlay */}\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <span className=\"text-xs font-bold text-white drop-shadow-lg\">\n              {progress}%\n            </span>\n          </div>\n        </div>\n\n        {/* Stage indicators */}\n        <div className=\"flex justify-between items-center px-2 mb-6\">\n          <div className={`text-xs font-medium transition-colors ${progress >= 0 ? 'text-blue-400' : 'text-gray-500'}`}>\n            Training\n          </div>\n          <div className={`text-xs font-medium transition-colors ${progress >= 50 ? 'text-purple-400' : 'text-gray-500'}`}>\n            Inference\n          </div>\n          <div className={`text-xs font-medium transition-colors ${progress >= 100 ? 'text-pink-400' : 'text-gray-500'}`}>\n            Complete\n          </div>\n        </div>\n\n        {/* Info box - Sleek and minimal */}\n        <div className=\"mt-6 p-4 rounded-2xl bg-white/5 backdrop-blur-md border border-white/10\">\n          <div className=\"flex items-center justify-center gap-2 text-blue-100\">\n            <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n            </svg>\n            <p className=\"text-xs\">\n              Processing your data securely  {connectedAccounts.length} {connectedAccounts.length === 1 ? 'platform' : 'platforms'} connected\n            </p>\n          </div>\n        </div>        \n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport Lottie from 'lottie-react';\nimport rainAnim from '../../public/rain-anim.json';\n\nexport default function LoadingScreen({ onComplete }) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [dotCount, setDotCount] = useState(0);\n\n  const loadingStates = [\n    { message: \"Validating PIN and continuing training\", progress: 20 },\n    { message: \"Uploading model to secure storage\", progress: 40 },\n    { message: \"Running test inference\", progress: 60 },\n    { message: \"Storing results in databases\", progress: 80 },\n    { message: \"Complete!\", progress: 100 },\n  ];\n\n  useEffect(() => {\n    const stateInterval = setInterval(() => {\n      setCurrentStep((prev) => {\n        const nextStep = prev + 1;\n        if (nextStep >= loadingStates.length) {\n          // Loading complete, call onComplete after a short delay\n          setTimeout(() => {\n            onComplete();\n          }, 1000);\n          return prev; // Keep at last step\n        }\n        return nextStep;\n      });\n    }, 3000); // Change state every 3 seconds\n\n    return () => clearInterval(stateInterval);\n  }, [loadingStates.length, onComplete]);\n\n  useEffect(() => {\n    const dotInterval = setInterval(() => {\n      setDotCount((prev) => (prev + 1) % 4); // 0, 1, 2, 3 dots\n    }, 500); // Change dots every 500ms\n\n    return () => clearInterval(dotInterval);\n  }, []);\n\n  const currentState = loadingStates[currentStep];\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-500 bg-opacity-50 flex items-center justify-center p-6\" style={{ zIndex: 2147483647, pointerEvents: 'auto' }}>\n      {/* Modal - Full height from bottom */}\n      <div className=\"bg-white rounded-3xl w-full max-w-lg mx-auto shadow-2xl overflow-hidden flex flex-col\" style={{ maxWidth: '500px', height: '100%', maxHeight: '90vh' }}>\n        {/* Header */}\n        <div className=\"px-6 pt-6 pb-4 flex-shrink-0\">\n        </div>\n\n        {/* Content - Rain animation and loading state */}\n        <div className=\"flex-1 flex flex-col px-6\">\n          {/* Rain Animation */}\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div style={{ width: '100%', maxWidth: '400px', aspectRatio: '1' }}>\n              <Lottie\n                animationData={rainAnim}\n                loop={true}\n                autoplay={true}\n                style={{ width: '100%', height: '100%' }}\n              />\n            </div>\n          </div>\n\n          {/* Loading State - Positioned at bottom */}\n          <div className=\"flex-shrink-0 pb-12\">\n            <div className=\"text-center\">\n              <h1 className=\"font-bold text-gray-900 leading-tight mb-6\" style={{ fontSize: 'clamp(16px, 4vw, 20px)' }}>\n                {currentState.message}\n                {currentState.message !== \"Complete!\" && (\n                  <span className=\"inline-block w-8 text-left\">{\".\".repeat(dotCount)}</span>\n                )}\n              </h1>\n\n              <div className=\"mx-auto\" style={{ width: 'clamp(200px, 50vw, 300px)' }}>\n                <div className=\"w-full h-2 bg-gray-200 rounded-full\">\n                  <div\n                    className=\"h-2 bg-gray-900 rounded-full transition-all duration-1000 ease-out\"\n                    style={{ width: `${currentState.progress}%` }}\n                  ></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Bottom spacing */}\n        <div className=\"h-20 flex-shrink-0\"></div>\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport Lottie from 'lottie-react';\n\nexport default function WrappedLoadingPage({ appName }) {\n  const [animationData, setAnimationData] = useState(null);\n  const [progress, setProgress] = useState(0);\n  const [messageIndex, setMessageIndex] = useState(0);\n  \n  // Only show \"Updating your digital brain for 2025...\" if app name contains \"wrapped\"\n  const isWrappedApp = appName && appName.toLowerCase().includes('wrapped');\n\n  // Whimsical rotating messages\n  const messages = [\n    \"Reading your mind...\",\n    \"Connecting the dots...\",\n    \"Brewing insights...\",\n    \"Decoding your vibe...\",\n    \"Piecing together your story...\",\n    \"Finding patterns in the chaos...\",\n    \"Translating data to wisdom...\",\n    \"Your digital fingerprint is unique...\",\n    \"Almost done thinking...\",\n    \"Polishing the final details...\"\n  ];\n\n  useEffect(() => {\n    // Fetch the animation JSON from public folder\n    fetch('/rain-anim.json')\n      .then(res => res.json())\n      .then(data => setAnimationData(data))\n      .catch(err => {\n        console.error('Failed to load rain animation:', err);\n        // Fallback: try from the npm package public folder\n        fetch('https://onairos.sirv.com/rain-anim.json')\n          .then(res => res.json())\n          .then(data => setAnimationData(data))\n          .catch(err2 => console.error('Failed to load rain animation from fallback:', err2));\n      });\n  }, []);\n\n  // Animate progress bar over ~2 minutes (API can take 1-3 minutes)\n  useEffect(() => {\n    const duration = 120000; // 2 minutes in ms\n    const interval = 100; // Update every 100ms\n    const increment = (interval / duration) * 100;\n    \n    const timer = setInterval(() => {\n      setProgress(prev => {\n        const next = prev + increment;\n        // Cap at 95% to avoid reaching 100% before API completes\n        return next >= 95 ? 95 : next;\n      });\n    }, interval);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  // Rotate messages every 4 seconds\n  useEffect(() => {\n    const messageTimer = setInterval(() => {\n      setMessageIndex(prev => (prev + 1) % messages.length);\n    }, 4000);\n\n    return () => clearInterval(messageTimer);\n  }, []);\n\n  return (\n    <div className=\"flex flex-col items-center justify-center h-full px-6 py-4\">\n      {/* Content is centered vertically inside the modal card */}\n      <div className=\"flex flex-col items-center justify-center w-full max-w-2xl space-y-6\">\n        {/* Title */}\n        <div className=\"text-center\">\n          <h2 className=\"text-xl md:text-2xl font-semibold text-gray-900 mb-1\">\n            {isWrappedApp ? 'Updating your digital brain for 2025...' : 'Processing your data...'}\n          </h2>\n          <p className=\"text-xs md:text-sm text-gray-600\">\n            {isWrappedApp ? 'Crafting your personalized insights from your digital footprint' : 'This will just take a moment'}\n          </p>\n        </div>\n\n        {/* Lottie Animation */}\n        {animationData ? (\n          <div className=\"w-full max-w-sm mx-auto\">\n            {/* Fixed aspect ratio so the figure sits nicely in the center and never clips */}\n            <div className=\"relative w-full\" style={{ paddingBottom: '100%' }}>\n              <Lottie \n                animationData={animationData}\n                loop={true}\n                autoplay={true}\n                className=\"absolute inset-0 w-full h-full\"\n              />\n            </div>\n          </div>\n        ) : (\n          <div className=\"w-full max-w-sm h-64 flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900\"></div>\n          </div>\n        )}\n\n        {/* Black and White Loading Bar - Below Lottie */}\n        <div className=\"w-full max-w-md\">\n          <div className=\"relative w-full h-1.5 bg-gray-200 rounded-full overflow-hidden\">\n            <div \n              className=\"absolute top-0 left-0 h-full bg-gray-900 rounded-full transition-all duration-300 ease-out\"\n              style={{ \n                width: `${progress}%`\n              }}\n            />\n          </div>\n          \n          {/* Rotating message with fade transition */}\n          <p \n            key={messageIndex}\n            className=\"text-center text-xs text-gray-600 mt-3 animate-fadeIn\"\n            style={{ \n              animation: 'fadeIn 0.5s ease-in-out'\n            }}\n          >\n            {messages[messageIndex]}\n          </p>\n        </div>\n\n        <style>{`\n          @keyframes fadeIn {\n            0% { opacity: 0; transform: translateY(-4px); }\n            100% { opacity: 1; transform: translateY(0); }\n          }\n        `}</style>\n      </div>\n    </div>\n  );\n}\n\n","/**\n * Response formatter utility for Onairos SDK\n * Converts array-based responses to dictionary format for better developer experience\n */\n\n// Standard 16 personality types in order that the API returns them\nexport const PERSONALITY_TYPES = [\n  'Analyst',\n  'Diplomat', \n  'Sentinel',\n  'Explorer',\n  'Architect',\n  'Logician',\n  'Commander',\n  'Debater',\n  'Advocate',\n  'Mediator',\n  'Protagonist',\n  'Campaigner',\n  'Logistician',\n  'Defender',\n  'Executive',\n  'Consul'\n];\n\n// Standard trait categories that might be returned\nexport const TRAIT_CATEGORIES = [\n  'Openness',\n  'Conscientiousness',\n  'Extraversion',\n  'Agreeableness',\n  'Neuroticism'\n];\n\n/**\n * Formats API response to include both array and dictionary formats\n * @param {Object} apiResponse - Raw API response from Onairos\n * @param {Object} options - Formatting options\n * @param {boolean} options.includeDictionary - Whether to include dictionary format (default: true)\n * @param {boolean} options.includeArray - Whether to include original array format (default: true)\n * @returns {Object} Formatted response with both formats\n */\nexport function formatOnairosResponse(apiResponse, options = {}) {\n  const { includeDictionary = true, includeArray = true } = options;\n  \n  if (!apiResponse) {\n    return apiResponse;\n  }\n\n  const formatted = { ...apiResponse };\n\n  // Handle personality scores if present\n  if (apiResponse.InferenceResult?.traits || apiResponse.traits || apiResponse.scores) {\n    const scores = apiResponse.InferenceResult?.traits || apiResponse.traits || apiResponse.scores;\n    \n    if (Array.isArray(scores) && scores.length >= 16) {\n      if (includeDictionary) {\n        // Create personality dictionary\n        const personalityDict = {};\n        PERSONALITY_TYPES.forEach((type, index) => {\n          personalityDict[type] = scores[index];\n        });\n        \n        // Add to formatted response\n        if (formatted.InferenceResult) {\n          formatted.InferenceResult.personalityDict = personalityDict;\n        } else {\n          formatted.personalityDict = personalityDict;\n        }\n      }\n      \n      if (!includeArray) {\n        // Remove array format if not requested\n        if (formatted.InferenceResult?.traits) {\n          delete formatted.InferenceResult.traits;\n        }\n        if (formatted.traits) {\n          delete formatted.traits;\n        }\n        if (formatted.scores) {\n          delete formatted.scores;\n        }\n      }\n    }\n  }\n\n  // Handle trait data if present (for preferences/traits)\n  if (apiResponse.traitResult || apiResponse.traits) {\n    const traits = apiResponse.traitResult || apiResponse.traits;\n    \n    if (Array.isArray(traits) && includeDictionary) {\n      const traitDict = {};\n      TRAIT_CATEGORIES.forEach((category, index) => {\n        if (traits[index] !== undefined) {\n          traitDict[category] = traits[index];\n        }\n      });\n      \n      formatted.traitDict = traitDict;\n    }\n  }\n\n  return formatted;\n}\n\n/**\n * Legacy formatter for backward compatibility\n * Converts scores array to personality dictionary only\n * @param {Array} scores - Array of personality scores\n * @returns {Object} Dictionary with personality type names as keys\n */\nexport function formatPersonalityScores(scores) {\n  if (!Array.isArray(scores) || scores.length < 16) {\n    console.warn('Invalid scores array provided to formatPersonalityScores');\n    return {};\n  }\n\n  const personalityDict = {};\n  PERSONALITY_TYPES.forEach((type, index) => {\n    personalityDict[type] = scores[index];\n  });\n  \n  return personalityDict;\n}\n\n/**\n * Get personality type names in order\n * @returns {Array} Array of personality type names\n */\nexport function getPersonalityTypes() {\n  return [...PERSONALITY_TYPES];\n}\n\n/**\n * Get trait category names in order  \n * @returns {Array} Array of trait category names\n */\nexport function getTraitCategories() {\n  return [...TRAIT_CATEGORIES];\n} ","/**\n * Enhanced User Data Formatter for onComplete Callback\n * Provides structured, readable formatting of Onairos user data\n */\n\n/**\n * Formats user data for better readability in onComplete callback\n * @param {Object} result - The complete result object from data request\n * @returns {Object} Enhanced result with formatted user data display\n */\nexport function formatUserDataForDisplay(result) {\n  if (!result) return result;\n\n  const formatted = { ...result };\n  \n  // Create a structured summary of the user data\n  const userDataSummary = {\n    // Basic request information\n    requestInfo: {\n      timestamp: result.timestamp || new Date().toISOString(),\n      appName: result.appName || 'Unknown App',\n      userHash: result.userHash || 'Unknown User',\n      testMode: result.testMode || false,\n      dataTypesRequested: Array.isArray(result.approvedData) ? result.approvedData : (result.approved || [])\n    },\n    \n    // User authentication and profile data\n    userProfile: {\n      email: result.userData?.email || 'Not provided',\n      userType: result.userData?.userType || 'Unknown',\n      onboardingComplete: result.userData?.onboardingComplete || false,\n      pinCreated: result.userData?.pinCreated || false,\n      trainingComplete: result.userData?.trainingComplete || false,\n      modelReady: result.userData?.modelReady || false\n    },\n    \n    // Connected platforms/accounts\n    connectedAccounts: formatConnectedAccounts(result.userData?.connectedAccounts || []),\n    \n    // API response data (personality, preferences, etc.)\n    aiData: formatAIResponseData(result.apiResponse),\n    \n    // Success status and any errors\n    status: {\n      success: result.success || false,\n      hasApiResponse: !!result.apiResponse,\n      hasErrors: !!result.error || !!result.apiError\n    }\n  };\n\n  // Add the formatted summary to the result\n  formatted.userDataSummary = userDataSummary;\n  \n  // Create a pretty-printed version for console logging\n  formatted.prettyPrint = createPrettyPrintVersion(userDataSummary);\n  \n  return formatted;\n}\n\n/**\n * Formats connected accounts data\n * @param {Array} accounts - Array of connected account objects\n * @returns {Object} Formatted accounts summary\n */\nfunction formatConnectedAccounts(accounts) {\n  if (!Array.isArray(accounts) || accounts.length === 0) {\n    return {\n      count: 0,\n      platforms: [],\n      summary: 'No connected accounts'\n    };\n  }\n\n  // SDK stores connectedAccounts as an array of strings (e.g. [\"YouTube\",\"Reddit\"])\n  // in several flows. Support that format as well as object arrays.\n  if (typeof accounts[0] === 'string') {\n    const names = accounts.map(a => String(a || '').trim()).filter(Boolean);\n    return {\n      count: names.length,\n      platforms: names.map(name => ({\n        name,\n        status: 'Connected',\n        connectedAt: 'Unknown date',\n        hasData: false\n      })),\n      summary: `${names.length} platform(s) connected: ${names.join(', ')}`\n    };\n  }\n\n  return {\n    count: accounts.length,\n    platforms: accounts.map(account => ({\n      name: account.platform || account.name || 'Unknown Platform',\n      status: account.status || 'Unknown',\n      connectedAt: account.connectedAt || 'Unknown date',\n      hasData: account.hasData || false\n    })),\n    summary: `${accounts.length} platform(s) connected: ${accounts.map(a => a.platform || a.name).join(', ')}`\n  };\n}\n\n/**\n * Formats AI response data (personality scores, traits, etc.)\n * @param {Object} apiResponse - The API response containing AI data\n * @returns {Object} Formatted AI data summary\n */\nfunction formatAIResponseData(apiResponse) {\n  if (!apiResponse) {\n    return {\n      available: false,\n      dataTypes: [],\n      summary: 'No AI data available'\n    };\n  }\n\n  const aiData = {\n    available: true,\n    dataTypes: []\n  };\n\n  // Check for Onairos Wrapped Dashboard\n  if (apiResponse.data?.dashboard || apiResponse.dashboard || apiResponse.slides) {\n    aiData.dataTypes.push({\n      type: 'wrapped_dashboard',\n      available: true,\n      data: apiResponse.data?.dashboard || apiResponse.dashboard || apiResponse,\n      summary: 'Onairos Wrapped / Neural Recall Dashboard'\n    });\n    \n    // Add apps if available\n    if (apiResponse.data?.apps || apiResponse.apps) {\n      aiData.dataTypes.push({\n        type: 'connected_apps',\n        available: true,\n        data: apiResponse.data?.apps || apiResponse.apps,\n        summary: `Connected apps list (${(apiResponse.data?.apps || apiResponse.apps).length})`\n      });\n    }\n  }\n\n  // Check for personality data\n  if (apiResponse.InferenceResult?.traits || apiResponse.personalityDict || apiResponse.traits) {\n    const personalityData = {\n      type: 'personality',\n      available: true\n    };\n\n    // If we have dictionary format, use it for better readability\n    if (apiResponse.personalityDict) {\n      personalityData.data = apiResponse.personalityDict;\n      personalityData.summary = `Personality analysis with ${Object.keys(apiResponse.personalityDict).length} traits`;\n    } else if (apiResponse.InferenceResult?.traits) {\n      personalityData.data = apiResponse.InferenceResult.traits;\n      personalityData.summary = `Personality scores array with ${apiResponse.InferenceResult.traits.length} values`;\n    } else if (apiResponse.traits) {\n      personalityData.data = apiResponse.traits;\n      personalityData.summary = `Personality traits with ${Array.isArray(apiResponse.traits) ? apiResponse.traits.length : Object.keys(apiResponse.traits).length} items`;\n    }\n\n    aiData.dataTypes.push(personalityData);\n  }\n\n  // Check for preferences/traits data\n  if (apiResponse.traitResult || apiResponse.traitDict) {\n    const preferencesData = {\n      type: 'preferences',\n      available: true\n    };\n\n    if (apiResponse.traitDict) {\n      preferencesData.data = apiResponse.traitDict;\n      preferencesData.summary = `Preferences analysis with ${Object.keys(apiResponse.traitDict).length} categories`;\n    } else if (apiResponse.traitResult) {\n      preferencesData.data = apiResponse.traitResult;\n      preferencesData.summary = `Trait results with ${Array.isArray(apiResponse.traitResult) ? apiResponse.traitResult.length : Object.keys(apiResponse.traitResult).length} items`;\n    }\n\n    aiData.dataTypes.push(preferencesData);\n  }\n\n  // Check for basic info/output\n  if (apiResponse.InferenceResult?.output || apiResponse.output) {\n    aiData.dataTypes.push({\n      type: 'basic_info',\n      available: true,\n      data: apiResponse.InferenceResult?.output || apiResponse.output,\n      summary: 'Basic user information and insights'\n    });\n  }\n\n  // Create overall summary\n  aiData.summary = aiData.dataTypes.length > 0 \n    ? `AI analysis complete with ${aiData.dataTypes.length} data type(s): ${aiData.dataTypes.map(d => d.type).join(', ')}`\n    : 'AI data structure present but no recognized data types found';\n\n  return aiData;\n}\n\n/**\n * Creates a pretty-printed version for console logging\n * @param {Object} userDataSummary - The formatted user data summary\n * @returns {string} Pretty-printed string for console output\n */\nfunction createPrettyPrintVersion(userDataSummary) {\n  const lines = [];\n  \n  lines.push(' ONAIROS USER DATA SUMMARY');\n  lines.push('=' .repeat(50));\n  \n  // Request Info\n  lines.push('\\n REQUEST INFORMATION:');\n  lines.push(`   App: ${userDataSummary.requestInfo.appName}`);\n  lines.push(`   User: ${userDataSummary.requestInfo.userHash}`);\n  lines.push(`   Mode: ${userDataSummary.requestInfo.testMode ? 'Test' : 'Production'}`);\n  lines.push(`   Data Types: ${Array.isArray(userDataSummary.requestInfo.dataTypesRequested) && userDataSummary.requestInfo.dataTypesRequested.length > 0 ? userDataSummary.requestInfo.dataTypesRequested.join(', ') : 'None'}`);\n  lines.push(`   Timestamp: ${new Date(userDataSummary.requestInfo.timestamp).toLocaleString()}`);\n  \n  // User Profile\n  lines.push('\\n USER PROFILE:');\n  lines.push(`   Email: ${userDataSummary.userProfile.email}`);\n  lines.push(`   Type: ${userDataSummary.userProfile.userType}`);\n  lines.push(`   Onboarding: ${userDataSummary.userProfile.onboardingComplete ? '' : ''}`);\n  lines.push(`   PIN Setup: ${userDataSummary.userProfile.pinCreated ? '' : ''}`);\n  lines.push(`   Training: ${userDataSummary.userProfile.trainingComplete ? '' : ''}`);\n  lines.push(`   Model Ready: ${userDataSummary.userProfile.modelReady ? '' : ''}`);\n  \n  // Connected Accounts\n  lines.push('\\n CONNECTED ACCOUNTS:');\n  lines.push(`   ${userDataSummary.connectedAccounts.summary}`);\n  if (userDataSummary.connectedAccounts.platforms.length > 0) {\n    userDataSummary.connectedAccounts.platforms.forEach(platform => {\n      lines.push(`    ${platform.name}: ${platform.status} ${platform.hasData ? '(has data)' : '(no data)'}`);\n    });\n  }\n  \n  // AI Data\n  lines.push('\\n AI ANALYSIS DATA:');\n  lines.push(`   ${userDataSummary.aiData.summary}`);\n  if (userDataSummary.aiData.dataTypes.length > 0) {\n    userDataSummary.aiData.dataTypes.forEach(dataType => {\n      lines.push(`    ${dataType.type.toUpperCase()}: ${dataType.summary}`);\n    });\n  }\n  \n  // Status\n  lines.push('\\n STATUS:');\n  lines.push(`   Success: ${userDataSummary.status.success ? '' : ''}`);\n  lines.push(`   API Response: ${userDataSummary.status.hasApiResponse ? '' : ''}`);\n  lines.push(`   Errors: ${userDataSummary.status.hasErrors ? ' Yes' : ' None'}`);\n  \n  lines.push('\\n' + '=' .repeat(50));\n  \n  return lines.join('\\n');\n}\n\n/**\n * Console logging helper that prints formatted user data\n * @param {Object} result - The result object from onComplete\n */\nexport function logFormattedUserData(result) {\n  const formatted = formatUserDataForDisplay(result);\n  \n  console.log('\\n' + formatted.prettyPrint + '\\n');\n  \n  // Also log the structured data for programmatic access\n  console.log(' Structured User Data Summary:', formatted.userDataSummary);\n  \n  return formatted;\n}\n\nexport default {\n  formatUserDataForDisplay,\n  logFormattedUserData\n};\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { COLORS } from '../../theme/colors.js';\n\n// Standardized page layout component with white background\nconst PageLayout = ({\n  children,\n  title,\n  subtitle,\n  icon,\n  showHeader = true,\n  showCloseButton = false,\n  onClose,\n  onBack,\n  showBackButton = false,\n  className = '',\n  contentClassName = '',\n  centerContent = true,\n  style = {},\n  ...props\n}) => {\n  const isSmallScreen = typeof window !== 'undefined' && window.innerWidth <= 768;\n\n  const layoutStyle = {\n    backgroundColor: COLORS.background,\n    minHeight: '100%',\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    ...style\n  };\n\n  const headerStyle = {\n    position: 'sticky',\n    top: 0,\n    backgroundColor: COLORS.background,\n    zIndex: 10,\n    padding: isSmallScreen\n      ? '10px 16px 8px'\n      : 'clamp(8px, 2vw, 16px) clamp(16px, 4vw, 32px) clamp(6px, 1.5vw, 12px)'\n  };\n\n  const contentStyle = {\n    flex: 1,\n    padding: isSmallScreen ? '16px 16px 18px' : 'clamp(16px, 4vw, 32px)',\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'auto',\n    minHeight: 0, // Allow flex item to shrink below content size\n    ...(centerContent && {\n      alignItems: 'center',\n      justifyContent: 'flex-start'\n    })\n  };\n\n  const titleStyle = {\n    fontFamily: 'Inter, system-ui, sans-serif',\n    fontSize: 'clamp(20px, 5vw, 28px)',\n    fontWeight: '700',\n    color: COLORS.textPrimary,\n    margin: '0 0 clamp(6px, 1.5vw, 12px) 0',\n    textAlign: centerContent ? 'center' : 'left',\n    lineHeight: '1.2'\n  };\n\n  const subtitleStyle = {\n    fontFamily: 'Inter, system-ui, sans-serif',\n    fontSize: 'clamp(14px, 3.5vw, 18px)',\n    fontWeight: '400',\n    color: COLORS.textSecondary,\n    margin: isSmallScreen ? '0 0 18px 0' : '0 0 clamp(20px, 5vw, 40px) 0',\n    textAlign: centerContent ? 'center' : 'left',\n    lineHeight: '1.5'\n  };\n\n  const iconStyle = {\n    width: 'clamp(40px, 8vw, 56px)',\n    height: 'clamp(40px, 8vw, 56px)',\n    margin: '0 auto clamp(16px, 4vw, 32px)',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    fontSize: 'clamp(20px, 5vw, 28px)'\n  };\n\n  return (\n    <div \n      className={`onairos-page-layout ${className}`}\n      style={layoutStyle}\n      {...props}\n    >\n      {/* Header with navigation */}\n      {showHeader && (\n        <div style={headerStyle}>\n          <div className=\"flex items-center justify-between\">\n            {/* Back button */}\n            {showBackButton && onBack && (\n              <button\n                onClick={onBack}\n                className=\"flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 transition-colors\"\n                aria-label=\"Go back\"\n              >\n                <span style={{ fontSize: '16px', color: COLORS.textPrimary }}></span>\n              </button>\n            )}\n\n\n            {/* Close button */}\n            {showCloseButton && onClose && (\n              <button\n                onClick={onClose}\n                className=\"flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 transition-colors\"\n                aria-label=\"Close\"\n              >\n                <span style={{ fontSize: '16px', color: COLORS.textPrimary }}></span>\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Main content area */}\n      <div \n        className={`onairos-page-content ${contentClassName}`}\n        style={contentStyle}\n      >\n        {/* Icon */}\n        {icon && (\n          <div style={iconStyle}>\n            {typeof icon === 'string' ? <span>{icon}</span> : icon}\n          </div>\n        )}\n\n        {/* Title */}\n        {title && (\n          <h1 style={titleStyle}>\n            {title}\n          </h1>\n        )}\n\n        {/* Subtitle */}\n        {subtitle && (\n          <p style={subtitleStyle}>\n            {subtitle}\n          </p>\n        )}\n\n        {/* Page content */}\n        {children}\n      </div>\n    </div>\n  );\n};\n\n// Modal wrapper component for overlay-style pages\nconst ModalPageLayout = ({\n  children,\n  visible = true,\n  onClose,\n  onBackdropClick,\n  backdropStyle = {},\n  modalStyle = {},\n  modalClassName = '',\n  ...pageLayoutProps\n}) => {\n  if (!visible) return null;\n\n  // Detect Capacitor native platform\n  // Must be defined BEFORE usage to avoid Temporal Dead Zone (TDZ) error\n  const isCapacitorNative = typeof window !== 'undefined' && \n    window.Capacitor && \n    typeof window.Capacitor.isNativePlatform === 'function' && \n    window.Capacitor.isNativePlatform();\n    \n  // Detect mobile browser (not Capacitor native)\n  const isMobileBrowser = typeof window !== 'undefined' && \n    window.innerWidth <= 768 && \n    !isCapacitorNative;\n\n  // Use visualViewport to avoid iOS \"vh\" causing phantom scroll and clipped content.\n  const [mobileModalHeightPx, setMobileModalHeightPx] = useState(() => {\n    if (typeof window === 'undefined') return null;\n    if (!isMobileBrowser) return null;\n    const h = window.visualViewport?.height || window.innerHeight;\n    return Math.round(h * 0.85);\n  });\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    if (!isMobileBrowser) return;\n    const compute = () => {\n      const h = window.visualViewport?.height || window.innerHeight;\n      setMobileModalHeightPx(Math.round(h * 0.85));\n    };\n    compute();\n    window.addEventListener('resize', compute);\n    window.visualViewport?.addEventListener?.('resize', compute);\n    window.visualViewport?.addEventListener?.('scroll', compute);\n    return () => {\n      window.removeEventListener('resize', compute);\n      window.visualViewport?.removeEventListener?.('resize', compute);\n      window.visualViewport?.removeEventListener?.('scroll', compute);\n    };\n  }, [isMobileBrowser]);\n    \n  // ENHANCED DEBUG LOGGING for mobile browser height issues\n  if (typeof window !== 'undefined') {\n    console.log('[Onairos SDK][ModalPageLayout] Mobile Detection', {\n      width: window.innerWidth,\n      height: window.innerHeight,\n      isCapacitorNative,\n      isMobileBrowser,\n      modalHeight: isMobileBrowser ? '80vh' : (isCapacitorNative ? '100vh' : 'auto'),\n      modalMaxHeight: isMobileBrowser ? '80vh' : (isCapacitorNative ? '100vh' : '90vh'),\n      modalMaxWidth: isMobileBrowser ? '100%' : '500px',\n      backdropAlign: (isCapacitorNative || isMobileBrowser) ? 'flex-end' : 'center',\n      backdropPadding: isMobileBrowser ? '0' : '16px'\n    });\n  }\n\n  const backdropStyles = {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n    zIndex: 2147483647,\n    display: 'flex',\n    alignItems: (isCapacitorNative || isMobileBrowser) ? 'flex-end' : 'center',\n    justifyContent: 'center',\n    padding: isMobileBrowser ? '0' : '16px',\n    transition: 'opacity 200ms ease',\n    willChange: 'opacity',\n    ...backdropStyle\n  };\n  \n  console.log('[Onairos SDK][ModalPageLayout]  Backdrop Styles COMPUTED:', {\n    alignItems: backdropStyles.alignItems,\n    padding: backdropStyles.padding,\n    display: backdropStyles.display,\n    hasBackdropStyleOverride: Object.keys(backdropStyle).length > 0,\n    backdropStyleOverride: backdropStyle\n  });\n  \n  const modalStyles = {\n    backgroundColor: COLORS.background,\n    borderTopLeftRadius: '24px',\n    borderTopRightRadius: '24px',\n    borderBottomLeftRadius: (isCapacitorNative || isMobileBrowser) ? '0px' : '24px',\n    borderBottomRightRadius: (isCapacitorNative || isMobileBrowser) ? '0px' : '24px',\n    // Force height on mobile browser with !important via inline style\n    height: isMobileBrowser ? (mobileModalHeightPx ? `${mobileModalHeightPx}px` : '85vh') : (isCapacitorNative ? '100vh' : 'auto'),\n    maxHeight: isMobileBrowser ? (mobileModalHeightPx ? `${mobileModalHeightPx}px` : '85vh') : (isCapacitorNative ? '100vh' : '90vh'),\n    minHeight: (isCapacitorNative || isMobileBrowser) ? 'auto' : '600px',\n    width: '100%',\n    maxWidth: isMobileBrowser ? '100%' : '500px',\n    boxShadow: '0 -10px 40px rgba(0, 0, 0, 0.3)',\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column',\n    // iOS safe-area: extend the white modal background into the home-indicator inset\n    ...(isMobileBrowser ? { paddingBottom: 'env(safe-area-inset-bottom)' } : {}),\n    transform: 'translateY(0)',\n    transition: 'transform 220ms ease, opacity 220ms ease',\n    willChange: 'transform, opacity',\n    marginLeft: (isCapacitorNative || isMobileBrowser) ? '0' : 'auto',\n    marginRight: (isCapacitorNative || isMobileBrowser) ? '0' : 'auto',\n    marginBottom: isMobileBrowser ? '0' : 'auto',\n    marginTop: isMobileBrowser ? 'auto' : 'auto',\n    // Ensure full height on Capacitor native\n    ...(isCapacitorNative && {\n      position: 'absolute',\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      borderRadius: 0\n    }),\n    // Position mobile browser modal at bottom\n    ...(isMobileBrowser && {\n      flexShrink: 0\n    }),\n    // CRITICAL: Do NOT spread modalStyle on mobile browser - it breaks height\n    ...(isMobileBrowser ? {} : modalStyle)\n  };\n  \n  console.log('[Onairos SDK][ModalPageLayout]  Modal Styles COMPUTED:', {\n    height: modalStyles.height,\n    maxHeight: modalStyles.maxHeight,\n    minHeight: modalStyles.minHeight,\n    width: modalStyles.width,\n    maxWidth: modalStyles.maxWidth,\n    borderRadius: `${modalStyles.borderTopLeftRadius} / ${modalStyles.borderBottomLeftRadius}`,\n    hasModalStyleOverride: Object.keys(modalStyle).length > 0,\n    modalStyleWasApplied: isMobileBrowser ? 'NO (blocked for mobile)' : 'YES',\n    modalStyleOverride: modalStyle\n  });\n  \n  // Warn if modalStyle is trying to override on mobile browser\n  if (isMobileBrowser && modalStyle && Object.keys(modalStyle).length > 0) {\n    console.warn('[Onairos SDK][ModalPageLayout]  BLOCKED modalStyle override on mobile browser. Ignoring:', modalStyle);\n  }\n\n  //  Layout debug logging (desktop vs native)\n  try {\n    if (typeof window !== 'undefined') {\n      const width = window.innerWidth;\n      const isDesktop = width >= 1024 && !isCapacitorNative;\n      // Only spam logs in desktop where sizing issues occur\n      if (isDesktop) {\n        // Keep this fairly compact but detailed\n        console.log('[Onairos SDK][Layout][ModalPageLayout]', {\n          width,\n          isCapacitorNative,\n          modalClassName,\n          modalStyleKeys: Object.keys(modalStyle || {}),\n          backdropStyleKeys: Object.keys(backdropStyle || {}),\n          modalMaxWidth: modalStyles.maxWidth,\n          modalMinHeight: modalStyles.minHeight,\n          modalHeight: modalStyles.height,\n        });\n      }\n    }\n  } catch (e) {\n    // Never let logging break rendering\n  }\n\n  const handleBackdropClick = (e) => {\n    if (e.target === e.currentTarget) {\n      console.log(' Backdrop clicked outside modal');\n      if (onBackdropClick) {\n        console.log(' Calling onBackdropClick handler');\n        onBackdropClick();\n      } else if (onClose) {\n        console.log(' Calling onClose handler');\n        onClose();\n      }\n    }\n  };\n\n  return (\n    <div \n      style={backdropStyles} \n      onClick={handleBackdropClick}\n      data-onairos-backdrop=\"true\"\n      data-mobile-browser={isMobileBrowser ? 'true' : 'false'}\n      data-capacitor-native={isCapacitorNative ? 'true' : 'false'}\n    >\n      <div \n        style={modalStyles} \n        className={modalClassName}\n        onClick={(e) => e.stopPropagation()}\n        data-onairos-modal=\"true\"\n        data-mobile-browser={isMobileBrowser ? 'true' : 'false'}\n        data-modal-height={modalStyles.height}\n      >\n        <PageLayout\n          showHeader={true}\n          showCloseButton={true}\n          onClose={onClose}\n          {...pageLayoutProps}\n        >\n          {children}\n        </PageLayout>\n      </div>\n    </div>\n  );\n};\n\nexport { ModalPageLayout };\nexport default PageLayout; ","import React, { useEffect, useState } from 'react';\nimport { App } from '@capacitor/app';\nimport { Browser } from '@capacitor/browser';\nimport WelcomeScreen from './components/WelcomeScreen.jsx';\nimport EmailAuth from './components/EmailAuth.js';\nimport UniversalOnboarding from './components/UniversalOnboarding.jsx';\nimport PinSetup from './components/PinSetup.js';\nimport DataRequest from './components/DataRequest.js';\nimport TrainingComponent from './components/TrainingComponent.jsx';\nimport TrainingScreen from './components/TrainingScreen.jsx';\nimport LoadingScreen from './components/LoadingScreen.jsx';\nimport WrappedLoadingPage from './components/WrappedLoadingPage.jsx';\nimport { formatOnairosResponse } from './utils/responseFormatter.js';\nimport { logFormattedUserData } from './utils/userDataFormatter.js';\nimport { ModalPageLayout } from './components/ui/PageLayout.jsx';\nimport { isMobileApp, isMobileBrowser } from './utils/capacitorDetection.js';\n\nexport function OnairosButton({\n  requestData, \n  webpageName, \n  inferenceData = null, \n  onComplete = null, \n  autoFetch = true, // Auto-enabled for seamless testing experience\n  testMode = false, // Production mode by default - set to true for testing\n  proofMode = false, \n  textLayout = 'below', \n  textColor = 'white',\n  login = false,\n  buttonType = 'pill',\n  loginReturn = null,\n  loginType = 'signIn',\n  visualType = 'full',\n  appIcon = null,\n  enableTraining = true,\n  formatResponse = true,\n  responseFormat = { includeDictionary: true, includeArray: true },\n  priorityPlatform = null, // Platform to prioritize (e.g., 'gmail', 'pinterest', 'linkedin')\n  rawMemoriesOnly = false, // Show only LLM connections when true\n  rawMemoriesConfig = null, // Configuration for RAW memories collection\n  time = false // Show time frequency slider (default: false)\n}) {\n\n  const [showOverlay, setShowOverlay] = useState(false);\n  const [currentFlow, setCurrentFlow] = useState('welcome'); // 'welcome' | 'email' | 'onboarding' | 'pin' | 'trainingScreen' | 'dataRequest' | 'wrappedLoading'\n  const [trainingHasStarted, setTrainingHasStarted] = useState(false);\n  const [userData, setUserData] = useState(null);\n  const [error, setError] = useState(null);\n  const [oauthReturnDetected, setOauthReturnDetected] = useState(false);\n  const [returnToDataRequestAfterOnboarding, setReturnToDataRequestAfterOnboarding] = useState(false);\n  \n  // Detect mobile for conditional styling (MOBILE ONLY changes)\n  // Use a safer check that doesn't rely on window/navigator being immediately available\n  const [isMobileDevice, setIsMobileDevice] = useState(false);\n  \n  useEffect(() => {\n    // Determine mobile vs desktop based on viewport width + native runtime,\n    // and keep it updated on resize.\n    const computeMobile = () => {\n      try {\n        const hasWindow = typeof window !== 'undefined';\n        if (!hasWindow) {\n          setIsMobileDevice(false);\n          return;\n        }\n\n        // Base width from current window\n        let width = window.innerWidth || document.documentElement?.clientWidth || document.body?.clientWidth || 0;\n\n        // If running inside an iframe, try to use the parent window width as well\n        // so desktop pages embedding the SDK don't get misclassified as mobile.\n        try {\n          if (window.parent && window.parent !== window && window.parent.innerWidth) {\n            width = Math.max(width, window.parent.innerWidth);\n          }\n        } catch (_) {\n          // Cross-origin access can fail; ignore and fall back to local width.\n        }\n\n        const isCapNative = !!window.Capacitor?.isNativePlatform?.();\n\n        //  Final, explicit rule:\n        // - Capacitor native: ALWAYS mobile\n        // - Otherwise: viewport < 1024px (taking parent if available)  mobile; >= 1024px  desktop\n        const detectedMobile = isCapNative || width < 1024;\n\n        console.log('[Onairos SDK][Layout][MobileDetection simple]', {\n          width,\n          isCapNative,\n          detectedMobile,\n        });\n\n        setIsMobileDevice(detectedMobile);\n      } catch (e) {\n        setIsMobileDevice(false);\n      }\n    };\n\n    computeMobile();\n\n    // Desktop resize listener to keep classification accurate when user resizes window.\n    // This runs in all environments, but the rule above ensures iPhone/Capacitor\n    // keep their correct classification.\n    if (typeof window !== 'undefined') {\n      window.addEventListener('resize', computeMobile);\n      return () => window.removeEventListener('resize', computeMobile);\n    }\n  }, []);\n\n  // Lock background scroll on DESKTOP while modal is open (do not touch mobile/Capacitor)\n  useEffect(() => {\n    if (typeof document === 'undefined') return;\n\n    const body = document.body;\n    if (!body) return;\n\n    if (showOverlay && !isMobileDevice) {\n      // Remember previous overflow so we can restore it precisely\n      if (!body.dataset.onairosPrevOverflow) {\n        body.dataset.onairosPrevOverflow = body.style.overflow || '';\n      }\n      body.style.overflow = 'hidden';\n    } else {\n      // Restore previous overflow when modal closes or when switching back to mobile\n      if (body.dataset.onairosPrevOverflow !== undefined) {\n        body.style.overflow = body.dataset.onairosPrevOverflow;\n        delete body.dataset.onairosPrevOverflow;\n      }\n    }\n  }, [showOverlay, isMobileDevice]);\n\n  //  High-level layout debug for desktop vs mobile\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const width = window.innerWidth;\n    const isDesktop = width >= 1024 && !isMobileDevice;\n    console.log('[Onairos SDK][Layout][OnairosButton state]', {\n      width,\n      isDesktop,\n      isMobileDevice,\n      currentFlow,\n      showOverlay,\n    });\n  }, [isMobileDevice, currentFlow, showOverlay]);\n\n  //  DOM-level layout debug (only on desktop web)\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const width = window.innerWidth;\n    const isDesktopWeb = width >= 1024 && !isMobileDevice && !window.Capacitor?.isNativePlatform?.();\n    if (!isDesktopWeb || !showOverlay) return;\n\n    // Defer to allow React layout to flush\n    const id = window.setTimeout(() => {\n      try {\n        const modal = document.querySelector('.onairos-modal');\n        const pageContent = document.querySelector('.onairos-page-content');\n        const shell = document.querySelector('.onairos-modal-shell');\n\n        const getMetrics = (el) => {\n          if (!el) return null;\n          const rect = el.getBoundingClientRect();\n          const styles = window.getComputedStyle(el);\n          return {\n            width: rect.width,\n            height: rect.height,\n            maxWidth: styles.maxWidth,\n            paddingInline: styles.paddingLeft + ' / ' + styles.paddingRight,\n            classList: Array.from(el.classList || []),\n          };\n        };\n\n        console.log('[Onairos SDK][Layout][DOM snapshot]', {\n          currentFlow,\n          viewportWidth: width,\n          modal: getMetrics(modal),\n          pageContent: getMetrics(pageContent),\n          shell: getMetrics(shell),\n        });\n      } catch (e) {\n        console.log('[Onairos SDK][Layout][DOM snapshot] failed', e?.message);\n      }\n    }, 0);\n\n    return () => window.clearTimeout(id);\n  }, [currentFlow, showOverlay, isMobileDevice]);\n  \n  // Logic to process return URLs (Login & Connectors)\n  const handleDeepLink = (url) => {\n      try {\n        console.log(' Checking URL for OAuth return:', url);\n        \n        // Normalize URL to check for params\n        // For native apps, url might be 'mobiletest://oauth-callback?success=true...'\n        // Also check specifically for Reddit's return format or other providers\n        const hasSuccess = url.includes('success=true') || \n                          url.includes('onairos_oauth_success=true') ||\n                          (url.includes('state=') && url.includes('code='));\n        \n        const hasError = url.includes('error=') || url.includes('onairos_oauth_error=');\n        const isPopup = url.includes('is_popup=true'); // Check for our custom flag\n        \n        // Safety Check: If we are running inside a popup or iframe (desktop), we should close ourselves\n        // and notify the parent. This happens if the callback redirected instead of closing.\n        // We check for window.opener, parent!=window, OR our explicit is_popup flag\n        if ((hasSuccess || hasError) && typeof window !== 'undefined' && \n            (window.opener || window.parent !== window || isPopup)) {\n             console.log(' App loaded inside OAuth popup/iframe (detected via opener/parent/flag) - closing');\n             \n             // Extract params for storage/message\n             let params;\n             try {\n                const qIdx = url.indexOf('?');\n                if (qIdx !== -1) params = new URLSearchParams(url.substring(qIdx + 1));\n                else params = new URL(url).searchParams;\n             } catch(e) { params = new URLSearchParams(''); }\n             \n             const platform = params.get('platform') || params.get('onairos_oauth_platform');\n             const email = params.get('email') || params.get('onairos_oauth_email');\n             \n             // 1. Write to LocalStorage (Same Origin as Parent) - Primary mechanism for cross-origin flow fallback\n             if (hasSuccess && platform) {\n                 localStorage.setItem(`onairos_${platform}_success`, 'true');\n                 localStorage.setItem(`onairos_${platform}_timestamp`, Date.now().toString());\n                 if (email) localStorage.setItem(`onairos_${platform}_email`, email);\n             }\n             \n             // 2. Try postMessage (only works if opener exists)\n             try {\n                const target = window.opener || window.parent;\n                if (target) {\n                    target.postMessage({\n                        type: hasSuccess ? 'oauth-success' : 'oauth-error',\n                        platform: platform,\n                        email: email,\n                        error: params.get('error'),\n                        success: !!hasSuccess\n                    }, '*');\n                }\n             } catch (e) {}\n\n             // 3. Close window\n             window.close();\n             // If window.close() is blocked (scripts can't close windows they didn't open),\n             // show a message asking user to close.\n             setTimeout(() => {\n                 document.body.innerHTML = '<div style=\"display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;font-family:sans-serif;\"><h1>Success!</h1><p>You can close this window now.</p><button onclick=\"window.close()\" style=\"padding:10px 20px;margin-top:20px;cursor:pointer;\">Close Window</button></div>';\n             }, 500);\n             \n             return; // Stop execution here\n        }\n        \n        if (hasSuccess) {\n           console.log(' Deep link/OAuth return detected:', url);\n           \n           // Close browser if open (Capacitor) - Important for Native\n           Browser.close().catch(() => {});\n\n           // Extract params from URL\n           let params;\n           try {\n             // Handle custom schemes that URL() constructor might reject if not fully standard\n             const questionMarkIndex = url.indexOf('?');\n             if (questionMarkIndex !== -1) {\n                params = new URLSearchParams(url.substring(questionMarkIndex + 1));\n             } else {\n                params = new URL(url).searchParams;\n             }\n           } catch (e) {\n             console.warn('URL parsing failed, trying fallback split:', e);\n             params = new URLSearchParams(url.split('?')[1] || '');\n           }\n\n           let platform = params.get('platform') || params.get('onairos_oauth_platform') || 'google';\n           let email = params.get('email') || params.get('onairos_oauth_email');\n           \n           // Fallback for Reddit/others that might rely on state\n           if (!platform || platform === 'null') {\n              const state = params.get('state');\n              if (state) {\n                 try {\n                    // Try to decode state if it's base64\n                    const decoded = JSON.parse(atob(state));\n                    if (decoded.connectionType) platform = decoded.connectionType;\n                    if (decoded.username) email = decoded.username; // Sometimes username is email\n                 } catch (e) {\n                    console.log('State decoding failed (not base64 JSON or invalid)');\n                 }\n              }\n           }\n\n           if (email) email = decodeURIComponent(email);\n           \n           console.log(` Detected return from ${platform} for ${email || 'unknown user'}`);\n           \n           // Set state to restore flow\n           setOauthReturnDetected(true);\n           \n           // 1. SUPPORT UNIVERSAL ONBOARDING (YouTube, LinkedIn, Reddit, etc.)\n           sessionStorage.setItem('onairos_oauth_return_success', 'true');\n           sessionStorage.setItem('onairos_oauth_return_platform', platform);\n\n           // Dispatch event to update UI immediately if component is mounted\n           if (typeof window !== 'undefined') {\n             window.dispatchEvent(new CustomEvent('onairos-oauth-success', { \n               detail: { platform: platform, email: email } \n             }));\n           }\n           \n           if (platform) {\n             localStorage.setItem(`onairos_${platform}_success`, 'true');\n             localStorage.setItem(`onairos_${platform}_timestamp`, Date.now().toString());\n           }\n\n           // 2. SUPPORT EMAIL AUTH (Gmail)\n           if (platform === 'google' || platform === 'gmail') {\n             localStorage.setItem('onairos_gmail_success', 'true');\n             localStorage.setItem('onairos_gmail_timestamp', Date.now().toString());\n             if (email) localStorage.setItem('onairos_gmail_email', email);\n           }\n           \n           // Restore session if possible (only for Login flow really, but safe to update)\n           if (email) {\n             // MERGE with existing userData to preserve connectedAccounts\n             const existingUserData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n             const userData = {\n                ...existingUserData, // Preserve existing data (like connectedAccounts)\n                email: email,\n                verified: true,\n                onboardingComplete: false,\n                provider: platform\n             };\n             console.log(' Merging OAuth return with existing userData:', { existing: existingUserData.connectedAccounts, merged: userData.connectedAccounts });\n             localStorage.setItem('onairosUser', JSON.stringify(userData));\n             setUserData(userData);\n           }\n           \n           // Open modal and go to onboarding immediately\n           setShowOverlay(true);\n           setCurrentFlow('onboarding');\n           \n           // Clean up URL if possible (on web)\n           if (window.history && window.history.replaceState && url.startsWith('http')) {\n             const cleanUrl = window.location.pathname;\n             window.history.replaceState({}, '', cleanUrl);\n           }\n        }\n      } catch (e) {\n        console.error('Error handling deep link:', e);\n      }\n  };\n\n  // Native Deep Link Listener (Runs once, stays active)\n  useEffect(() => {\n    let appListener = null;\n    const setupListener = async () => {\n      // Only run on native platforms (iOS/Android)\n      const isNative = typeof window !== 'undefined' && window.Capacitor?.isNativePlatform?.();\n      if (!isNative) return;\n\n      let AppPlugin = App;\n      if (!AppPlugin || !AppPlugin.addListener) {\n        if (typeof window !== 'undefined' && window.Capacitor?.Plugins?.App) {\n          AppPlugin = window.Capacitor.Plugins.App;\n        }\n      }\n\n      if (!AppPlugin || !AppPlugin.addListener) {\n         console.warn(' App plugin not found for deep linking listener');\n         return;\n      }\n\n      try {\n        appListener = await AppPlugin.addListener('appUrlOpen', (data) => {\n          console.log(' Native deep link received:', data.url);\n          handleDeepLink(data.url);\n        });\n        console.log(' App deep link listener registered successfully');\n      } catch (e) {\n        console.warn(' Failed to setup App listener:', e);\n      }\n    };\n    setupListener();\n    \n    return () => {\n      if (appListener) appListener.remove();\n    };\n  }, []);\n\n  // Web/Initial Check (Respects oauthReturnDetected)\n  useEffect(() => {\n    if (oauthReturnDetected) return;\n    \n    handleDeepLink(window.location.href);\n    \n    const checkWindowUrl = () => handleDeepLink(window.location.href);\n    window.addEventListener('popstate', checkWindowUrl);\n    \n    return () => window.removeEventListener('popstate', checkWindowUrl);\n  }, [oauthReturnDetected]);\n\n  // Check for existing user session\n  useEffect(() => {\n    const checkExistingSession = () => {\n      // In test mode, always start fresh to see the full flow\n      if (testMode) {\n        console.log(' Test mode: Starting fresh flow, clearing any cached user data');\n        localStorage.removeItem('onairosUser');\n        setCurrentFlow('welcome');\n        return;\n      }\n      \n      // If we just kicked off an OAuth connector flow, force return into onboarding\n      // so users can connect multiple apps without getting bounced to DataRequest.\n      const postOAuthFlow = (() => {\n        try { return localStorage.getItem('onairos_post_oauth_flow'); } catch { return null; }\n      })();\n      if (postOAuthFlow === 'onboarding') {\n        try { localStorage.removeItem('onairos_post_oauth_flow'); } catch {}\n        const savedUser = localStorage.getItem('onairosUser');\n        if (savedUser) {\n          try { setUserData(JSON.parse(savedUser)); } catch {}\n        }\n        setShowOverlay(true);\n        setCurrentFlow('onboarding');\n        return;\n      }\n\n      const savedUser = localStorage.getItem('onairosUser');\n      if (savedUser) {\n        try {\n          const user = JSON.parse(savedUser);\n          setUserData(user);\n          // If user has completed onboarding and PIN setup, go directly to data request\n          if (user.onboardingComplete && user.pinCreated) {\n            setCurrentFlow('dataRequest');\n          } else if (user.verified && !user.onboardingComplete) {\n            setCurrentFlow('onboarding');\n          } else if (user.onboardingComplete && !user.pinCreated) {\n            setCurrentFlow('pin');\n          }\n        } catch (error) {\n          console.error('Error parsing saved user data:', error);\n          localStorage.removeItem('onairosUser');\n        }\n      }\n    };\n\n    checkExistingSession();\n  }, [testMode]);\n\n  // Check for OAuth return (Google login redirect back)\n  useEffect(() => {\n    if (oauthReturnDetected) return; // Prevent double-processing\n    \n    const checkOAuthReturn = () => {\n      // Check URL params for OAuth completion\n      const urlParams = new URLSearchParams(window.location.search);\n      const oauthSuccess = urlParams.get('onairos_oauth_success');\n      const oauthPlatform = urlParams.get('onairos_oauth_platform');\n      const oauthEmail = urlParams.get('onairos_oauth_email');\n\n      // Check for generic OAuth return (any platform)\n      if (oauthSuccess === 'true' && oauthPlatform) {\n        setOauthReturnDetected(true);\n        \n        // Clean up URL\n        const newUrl = window.location.pathname;\n        window.history.replaceState({}, '', newUrl);\n        \n        if (oauthPlatform === 'gmail' && oauthEmail) {\n          console.log(' Gmail OAuth return detected in URL params');\n          \n          // Create user data from OAuth\n          const authData = {\n            email: oauthEmail,\n            verified: true,\n            isNewUser: true, // Assume new user for now, backend will correct this\n            provider: 'google'\n          };\n          \n          // Save to localStorage - MERGE with existing to preserve connectedAccounts\n          const existingUserData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n          const userData = {\n            ...existingUserData, // Preserve existing data (like connectedAccounts)\n            email: oauthEmail,\n            verified: true,\n            onboardingComplete: false,\n            provider: 'google'\n          };\n          console.log(' Merging Google OAuth with existing userData:', { existing: existingUserData.connectedAccounts, merged: userData.connectedAccounts });\n          localStorage.setItem('onairosUser', JSON.stringify(userData));\n          setUserData(userData);\n          \n          // Open modal and go to onboarding\n          setShowOverlay(true);\n          setCurrentFlow('onboarding');\n          \n          // Clean up OAuth localStorage\n          localStorage.removeItem('onairos_gmail_success');\n          localStorage.removeItem('onairos_gmail_timestamp');\n          localStorage.removeItem('onairos_oauth_email');\n          localStorage.removeItem('onairos_return_url');\n          localStorage.removeItem('onairos_oauth_context');\n          \n        } else {\n          // Other platforms (Universal Onboarding connectors)\n          console.log(` ${oauthPlatform} OAuth return detected - restoring onboarding flow`);\n          \n          // Ensure we have user session to show the modal correctly\n          // (User should already be logged in if they were connecting apps)\n          const savedUser = localStorage.getItem('onairosUser');\n          if (savedUser) {\n            setUserData(JSON.parse(savedUser));\n          }\n          \n          // Open modal and restore flow\n          setShowOverlay(true);\n          setCurrentFlow('onboarding');\n          \n          // Pass the success signal to UniversalOnboarding via a temporary storage flag\n          // that works even if cross-domain cleared the original context\n          sessionStorage.setItem('onairos_oauth_return_success', 'true');\n          sessionStorage.setItem('onairos_oauth_return_platform', oauthPlatform);\n        }\n        \n        return;\n      }\n\n      // Also check localStorage for OAuth completion (fallback)\n      const gmailSuccess = localStorage.getItem('onairos_gmail_success');\n      const gmailTimestamp = localStorage.getItem('onairos_gmail_timestamp');\n      const gmailEmail = localStorage.getItem('onairos_gmail_email') || localStorage.getItem('onairos_oauth_email');\n\n      if (gmailSuccess === 'true' && gmailTimestamp && gmailEmail) {\n        const now = Date.now();\n        const timestamp = parseInt(gmailTimestamp, 10);\n        \n        // Only process if timestamp is recent (within last 60 seconds)\n        if (now - timestamp < 60000) {\n          console.log(' Gmail OAuth return detected in localStorage');\n          setOauthReturnDetected(true);\n          \n          // Create user data from OAuth - MERGE with existing to preserve connectedAccounts\n          const existingUserData = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n          const userData = {\n            ...existingUserData, // Preserve existing data (like connectedAccounts)\n            email: gmailEmail,\n            verified: true,\n            onboardingComplete: false,\n            provider: 'google'\n          };\n          console.log(' Merging Gmail OAuth with existing userData:', { existing: existingUserData.connectedAccounts, merged: userData.connectedAccounts });\n          localStorage.setItem('onairosUser', JSON.stringify(userData));\n          setUserData(userData);\n          \n          // Open modal and go to onboarding\n          setShowOverlay(true);\n          setCurrentFlow('onboarding');\n          \n          // Clean up OAuth localStorage\n          localStorage.removeItem('onairos_gmail_success');\n          localStorage.removeItem('onairos_gmail_timestamp');\n          localStorage.removeItem('onairos_gmail_email');\n          localStorage.removeItem('onairos_oauth_email');\n          localStorage.removeItem('onairos_return_url');\n          localStorage.removeItem('onairos_oauth_context');\n        }\n      }\n    };\n\n    checkOAuthReturn();\n  }, [oauthReturnDetected]);\n\n  const openTerminal = async () => {\n    try {\n      console.log(' openTerminal called - resetting flow');\n      console.log(' testMode prop:', testMode);\n      console.log(' window.onairosApiKey:', window.onairosApiKey);\n      // ALWAYS reset flow on open to start fresh every time\n      setCurrentFlow('welcome');\n      setUserData(null);\n      try { localStorage.removeItem('onairosUser'); } catch {}\n        setShowOverlay(true);\n    } catch (error) {\n      console.error('Error in openTerminal:', error);\n    }\n  };\n\n  const handleCloseOverlay = () => {\n    setShowOverlay(false);\n    setError(null);\n    // Reset flow and session so next open starts fresh\n    setCurrentFlow('welcome');\n    try { localStorage.removeItem('onairosUser'); } catch {}\n    setUserData(null);\n  };\n\n  // Handle clicks on the backdrop to close modal\n  const handleBackdropClick = (e) => {\n    if (e.target === e.currentTarget) {\n      handleCloseOverlay();\n    }\n  };\n\n  const handleWelcomeContinue = () => {\n    console.log(' Welcome screen continue clicked');\n    setCurrentFlow('email');\n  };\n\n  const handleEmailAuthSuccess = (authData) => {\n    console.log(' Email auth successful:', authData);\n    console.log(' User State:', {\n      isNewUser: authData.isNewUser,\n      userState: authData.userState,\n      flowType: authData.flowType,\n      existingUser: authData.existingUser,\n      hasAccountInfo: !!authData.accountInfo,\n      accountStatus: authData.accountStatus // NEW: Log accountStatus\n    });\n\n    // Save identity-bearing JWT immediately (email/id/userId/sub)\n    try {\n      const candidate = authData.jwtToken || authData.token || authData.accessToken;\n      if (candidate) {\n        const base64 = candidate.split('.')[1];\n        if (base64) {\n          const payload = JSON.parse(decodeURIComponent(atob(base64).split('').map(c => '%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join('')));\n          if (payload && (payload.email || payload.id || payload.userId || payload.sub)) {\n            try { localStorage.setItem('onairos_user_token', candidate); } catch {}\n            console.log(' [OnairosButton] Identity JWT saved from email auth');\n          } else {\n            console.warn(' [OnairosButton] Email auth returned minimal token (no id/email)');\n          }\n        }\n      }\n    } catch (e) {\n      console.warn(' [OnairosButton] Failed to parse/save email auth token');\n    }\n    \n    // NEW: Use accountStatus if available (more reliable than legacy fields)\n    const accountStatus = authData.accountStatus;\n    let isNewUser;\n    \n    if (accountStatus) {\n      // Use the new accountStatus.exists field as the source of truth\n      isNewUser = !accountStatus.exists;\n      console.log(' Using accountStatus.exists for flow determination:', {\n        accountExists: accountStatus.exists,\n        hasTrainedModel: accountStatus.hasTrainedModel,\n        hasPersonalityTraits: accountStatus.hasPersonalityTraits,\n        connectedPlatforms: accountStatus.connectedPlatforms,\n        needsDataConnection: accountStatus.needsDataConnection,\n        needsTraining: accountStatus.needsTraining,\n        canUseInference: accountStatus.canUseInference\n      });\n    } else {\n      // Fallback to legacy field checking if accountStatus not available\n      isNewUser = authData.isNewUser === true || \n                  authData.existingUser === false || \n                  authData.flowType === 'onboarding' || \n                  authData.userState === 'new' ||\n                  !authData.accountInfo;\n      console.log(' Using legacy fields for flow determination (accountStatus not available)');\n    }\n    \n    console.log(' Flow determination:', {\n      finalDecision: isNewUser ? 'NEW USER  onboarding (data connectors)' : 'EXISTING USER  dataRequest (data permissions)',\n      reasoning: {\n        usingAccountStatus: !!accountStatus,\n        accountExists: accountStatus?.exists,\n        isNewUser: authData.isNewUser,\n        existingUserFalse: authData.existingUser === false,\n        flowTypeOnboarding: authData.flowType === 'onboarding',\n        noAccountInfo: !authData.accountInfo\n      }\n    });\n    \n    const newUserData = {\n      ...authData,\n      verified: true,\n      onboardingComplete: !isNewUser, // New users need onboarding, returning users have completed it\n      pinCreated: !isNewUser // Assume returning users have PIN, new users need to create it\n    };\n\n    // If backend provides connected platforms for existing users, carry them into connectedAccounts\n    // so DataRequest/Onboarding can reflect what is already connected.\n    const normalizePlatformName = (p) => {\n      const key = String(p || '').trim().toLowerCase();\n      const map = {\n        instagram: 'Instagram',\n        youtube: 'YouTube',\n        linkedin: 'LinkedIn',\n        reddit: 'Reddit',\n        pinterest: 'Pinterest',\n        github: 'GitHub',\n        gmail: 'Gmail',\n        twitter: 'Twitter',\n        x: 'Twitter',\n        chatgpt: 'ChatGPT',\n        claude: 'Claude',\n        gemini: 'Gemini',\n        grok: 'Grok',\n      };\n      return map[key] || (key ? key.charAt(0).toUpperCase() + key.slice(1) : '');\n    };\n    if (!isNewUser) {\n      const fromAccountStatus = Array.isArray(accountStatus?.connectedPlatforms)\n        ? accountStatus.connectedPlatforms\n        : [];\n      const normalized = fromAccountStatus.map(normalizePlatformName).filter(Boolean);\n      if (normalized.length > 0) {\n        newUserData.connectedAccounts = normalized;\n      }\n    } else {\n      // New user: never pre-populate connected apps.\n      // This prevents stale local state from previous sessions from auto-toggling connectors.\n      newUserData.connectedAccounts = [];\n    }\n    \n    // Ensure token is stored in userData and localStorage\n    const emailToken = authData.token || authData.jwtToken || authData.accessToken;\n    if (emailToken) {\n      newUserData.token = emailToken;\n      try {\n        localStorage.setItem('onairos_user_token', emailToken);\n        console.log(' Token from email verification saved to localStorage');\n      } catch (e) {\n        console.warn(' Could not save token to localStorage:', e);\n      }\n    }\n    \n    setUserData(newUserData);\n    localStorage.setItem('onairosUser', JSON.stringify(newUserData));\n    \n    // Flow decision logic:\n    // - New users: go to UniversalOnboarding (connectors)\n    // - Existing users: go straight to DataRequest (data permissions)\n    if (isNewUser) {\n      console.log(' Auth successful (new user)  Starting onboarding flow (data connectors page)');\n      setCurrentFlow('onboarding');\n    } else {\n      console.log(' Auth successful (existing user)  Going straight to DataRequest (data permissions)');\n      setCurrentFlow('dataRequest');\n    }\n  };\n\n  const handleOnboardingComplete = (onboardingData) => {\n    console.log(' Onboarding completed:', onboardingData);\n    console.log(' Connected accounts from onboarding:', onboardingData.connectedAccounts);\n    const updatedUserData = {\n      ...userData,\n      onboardingComplete: true,\n      connectedAccounts: onboardingData.connectedAccounts || []\n    };\n    console.log(' Saving userData with connectedAccounts:', updatedUserData.connectedAccounts);\n    setUserData(updatedUserData);\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\n    if (returnToDataRequestAfterOnboarding) {\n      setReturnToDataRequestAfterOnboarding(false);\n      setCurrentFlow('dataRequest');\n    } else {\n      setCurrentFlow('pin');\n    }\n  };\n\n  const handlePinSetupComplete = async (pinData) => {\n    console.log('PIN setup completed:', pinData);\n    const updatedUserData = {\n      ...userData,\n      ...pinData,\n      pinCreated: true\n    };\n    setUserData(updatedUserData);\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\n    \n    // Check if this is a wrapped app\n    const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\n    \n    if (isWrappedApp) {\n      // Wrapped apps skip training screen - go directly to data request\n      console.log(' Wrapped app - skipping training screen, going to data request');\n      setCurrentFlow('dataRequest');\n    } else {\n      // Non-wrapped apps show training screen BEFORE data request\n      console.log(' Non-wrapped app - showing training screen');\n      // Reset training start watchdog state\n      setTrainingHasStarted(false);\n      setCurrentFlow('trainingScreen');\n    }\n  };\n\n  // Non-wrapped ONLY: if training does not START within 30s, move forward to DataRequest anyway.\n  // Wrapped apps must NOT do this.\n  useEffect(() => {\n    const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\n    if (isWrappedApp) return;\n\n    if (currentFlow !== 'trainingScreen') return;\n    if (trainingHasStarted) return;\n\n    const timeoutId = setTimeout(() => {\n      // Re-check conditions at fire time (effect cleanup should handle most cases).\n      const stillWrapped = webpageName && webpageName.toLowerCase().includes('wrapped');\n      if (stillWrapped) return;\n      if (currentFlow === 'trainingScreen' && !trainingHasStarted) {\n        console.warn(' Training did not start within 30s (non-wrapped). Continuing to DataRequest.');\n        setCurrentFlow('dataRequest');\n      }\n    }, 30000);\n\n    return () => clearTimeout(timeoutId);\n  }, [currentFlow, trainingHasStarted, webpageName]);\n\n  const handleLoadingComplete = () => {\n    setCurrentFlow('dataRequest');\n  };\n\n  const handleTrainingComplete = (trainingResult) => {\n    console.log(' Training completed:', trainingResult);\n    const updatedUserData = {\n      ...userData,\n      trainingCompleted: true,\n      ...trainingResult\n    };\n    setUserData(updatedUserData);\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\n    \n    // Move to data request after training\n    setCurrentFlow('dataRequest');\n  };\n\n  const handleTrainingScreenComplete = (trainingResult) => {\n    console.log(' Training screen completed:', trainingResult);\n    const updatedUserData = {\n      ...userData,\n      trainingCompleted: true,\n      ...trainingResult\n    };\n    setUserData(updatedUserData);\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\n    \n    // Move to data request after training screen\n    setCurrentFlow('dataRequest');\n  };\n\n  const handleDataRequestComplete = async (requestResult) => {\n    console.log(' OnairosButton: Data request completed:', requestResult);\n    \n    // Check if this is a wrapped app\n    const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\n    \n    // For non-wrapped apps, training and inference already happened in TrainingScreen\n    // No need to run it again here\n    if (!isWrappedApp && requestResult.approved?.length > 0) {\n      console.log(' Non-wrapped app: Training and inference already completed in TrainingScreen');\n      console.log(' Data approval recorded:', requestResult.approved);\n    }\n    \n    // Update user data with request result\n    const updatedUserData = {\n      ...userData,\n      lastDataRequest: requestResult\n    };\n    setUserData(updatedUserData);\n    localStorage.setItem('onairosUser', JSON.stringify(updatedUserData));\n\n    // Handle data fetching if autoFetch is enabled\n    // For non-wrapped apps, training already happened in TrainingScreen, so skip this\n    let finalResult = requestResult;\n    \n    if (autoFetch && requestResult.approved?.length > 0 && isWrappedApp) {\n      console.log(' Auto-fetching data from Onairos API for wrapped app...');\n      \n      try {\n        // 1. Get the API URL from the backend\n        const urlResponse = await fetch('https://api2.onairos.uk/getAPIurlMobile', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            Info: {\n              appId: webpageName,\n              account: userData?.email || userData?.username,\n              confirmations: requestResult.approved.map(id => ({ data: id === 'personality' ? 'Large' : id === 'basic' ? 'Basic' : id })),\n              EncryptedUserPin: userData?.EncryptedUserPin || 'pending_pin_integration',\n              storage: 's3',\n              proofMode: proofMode\n            }\n          })\n        });\n\n        const urlData = await urlResponse.json();\n        console.log(' API URL received:', urlData.apiUrl);\n        console.log(' webpageName sent as appId:', webpageName);\n\n        if (urlData.apiUrl && urlData.token) {\n          // Only show wrapped loading page if app name contains \"wrapped\"\n          const isWrappedApp = webpageName && webpageName.toLowerCase().includes('wrapped');\n          console.log(' Is wrapped app?', isWrappedApp, '(checking:', webpageName, ')');\n          if (isWrappedApp) {\n            setCurrentFlow('wrappedLoading');\n            console.log(' Showing wrapped loading screen for wrapped app');\n          } else {\n            console.log(' Skipping loading screen - not a wrapped app');\n          }\n          \n          // Emit custom event for host app\n          if (typeof window !== 'undefined') {\n            const eventDetail = { apiUrl: urlData.apiUrl, approved: requestResult.approved };\n            window.dispatchEvent(new CustomEvent('onairos-api-call-start', { detail: eventDetail }));\n            console.log(' Emitted onairos-api-call-start event');\n          }\n          \n          // 2. Fetch the actual data\n          // IMPORTANT: This endpoint can take 1-3 minutes as it runs Python LLM scripts\n          // We MUST wait for the actual response before proceeding\n          // Always use POST for consistency and to support body data\n          // traits-only endpoint requires POST\n          const method = 'POST';\n          \n          let fetchUrl = urlData.apiUrl;\n          let fetchBody = {\n             email: userData?.email,\n             includeLlmData: requestResult.approved.includes('rawMemories')\n          };\n\n          // Override for non-wrapped apps (Regular SDK training) to use Training API\n          if (!isWrappedApp) {\n             fetchUrl = 'https://api2.onairos.uk/mobile-training/clean';\n             \n             // Construct training body\n             const connected = [];\n             if (userData?.connectedAccounts) {\n               if (Array.isArray(userData.connectedAccounts)) {\n                 connected.push(...userData.connectedAccounts);\n               } else if (typeof userData.connectedAccounts === 'object') {\n                 connected.push(...Object.keys(userData.connectedAccounts).filter(k => userData.connectedAccounts[k]));\n               }\n             }\n             \n             fetchBody = {\n               Info: {\n                 username: userData?.email || userData?.username,\n                 connectedPlatforms: connected\n               }\n             };\n             \n             console.log(' Switching to Training API for non-wrapped app:', fetchUrl);\n          } else {\n             console.log(' WRAPPED APP DETECTED - Using traits-only endpoint from backend:', fetchUrl);\n             console.log(' This should call the wrapped dashboard generation');\n\n             // Wrapped freshness: ALWAYS request a fresh-per-request variant (even if the same YouTube account is reused).\n             // This avoids \"cached-looking\" dashboards while keeping the core metrics stable.\n             fetchBody = {\n               ...fetchBody,\n               forceFresh: true,\n               cacheBust: Date.now(),\n             };\n             try {\n               const currentEmail = userData?.email;\n               if (currentEmail) localStorage.setItem('onairos_last_wrapped_email', currentEmail);\n             } catch {}\n             console.log(' Wrapped forceFresh enabled (always for wrapped):', { email: userData?.email });\n          }\n          \n          console.log(` Fetching/Training data from ${fetchUrl} (${method})...`);\n          console.log(` Using token: ${urlData.token ? urlData.token.substring(0, 20) + '...' : 'NO TOKEN'}`);\n          try {\n            console.log(' Wrapped fetch request body:', fetchBody);\n          } catch {}\n          console.log(` Waiting for backend response - this may take 1-3 minutes for LLM processing...`);\n          \n          let dataResponse;\n          let apiResponse;\n          let fetchCompleted = false;\n          let fetchError = null;\n          \n          try {\n            // CRITICAL: Wait for the actual fetch response - don't proceed until we get data or a real error\n            // The backend Python script needs time to generate the wrapped dashboard\n            console.log(` Starting fetch request - will wait for complete response...`);\n            \n            // Create abort controller with 10-minute timeout for LLM-heavy endpoints\n            // This prevents the BROWSER from timing out, even if the server might\n            // Note: Gateway/load balancer may timeout earlier (typically 60s), which is expected\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), 600000); // 10 minutes\n\n            try {\n              dataResponse = await fetch(fetchUrl, {\n                method: method,\n                headers: {\n                  'Authorization': `Bearer ${urlData.token}`,\n                  'Content-Type': 'application/json'\n                },\n                // Prevent browser/proxy caching for wrapped dashboards\n                cache: 'no-store',\n                // Only send body for POST\n                body: method === 'POST' ? JSON.stringify(fetchBody) : undefined,\n                signal: controller.signal\n              });\n            } finally {\n              clearTimeout(timeoutId);\n            }\n\n            console.log(` Response status: ${dataResponse.status} ${dataResponse.statusText}`);\n            console.log(` Response headers:`, Object.fromEntries(dataResponse.headers.entries()));\n\n            // Check for 504 Gateway Timeout - implies backend is still working\n            if (dataResponse.status === 504) {\n               console.warn(' 504 Gateway Timeout received - Backend is likely still processing');\n               throw new Error('Gateway Timeout (504) - Backend processing continued');\n            }\n\n            // CRITICAL: Check if response is ok before parsing JSON\n            if (!dataResponse.ok) {\n              throw new Error(`HTTP ${dataResponse.status}: ${dataResponse.statusText}`);\n            }\n\n            // CRITICAL: Wait for JSON parsing to complete\n            apiResponse = await dataResponse.json();\n            \n            console.log(' Parsed API response:', {\n              isWrappedApp,\n              hasStatus: !!apiResponse.status,\n              status: apiResponse.status,\n              hasSlides: !!apiResponse.slides,\n              responseKeys: Object.keys(apiResponse)\n            });\n            \n            // Check if dashboard is still being generated (wrapped app only)\n            if (isWrappedApp && apiResponse.status === 'processing') {\n              console.log(' Dashboard is being generated - starting polling...');\n              const basePollInterval = (apiResponse.poll_interval_seconds || 3) * 1000;\n              // Wrapped generation can take longer (LLM + queue). Be patient.\n              const maxPolls = 300; // ~15 minutes at 3s interval\n              let pollCount = 0;\n              \n              while (pollCount < maxPolls) {\n                pollCount++;\n                console.log(` Polling attempt ${pollCount}/${maxPolls}...`);\n                \n                // Wait before next poll\n                // mild backoff to reduce load on long-running generations\n                const pollInterval = Math.min(15000, Math.round(basePollInterval * (pollCount < 30 ? 1 : pollCount < 120 ? 1.5 : 2)));\n                await new Promise(resolve => setTimeout(resolve, pollInterval));\n                \n                try {\n                  const pollResponse = await fetch(fetchUrl, {\n                    method: method,\n                    headers: {\n                      'Authorization': `Bearer ${urlData.token}`,\n                      'Content-Type': 'application/json'\n                    },\n                    cache: 'no-store',\n                    body: method === 'POST' ? JSON.stringify(fetchBody) : undefined\n                  });\n                  \n                  if (pollResponse.ok) {\n                    const pollData = await pollResponse.json();\n                    \n                    // Check if we have the actual dashboard now\n                    if (pollData.slides) {\n                      console.log(' Dashboard ready! Received slides.');\n                      apiResponse = pollData;\n                      break;\n                    } else if (pollData.status !== 'processing') {\n                      console.warn(' Unexpected response during polling:', pollData);\n                      apiResponse = pollData;\n                      break;\n                    }\n                    \n                    console.log(' Still processing...');\n                  } else {\n                    console.warn(` Poll failed with status ${pollResponse.status}`);\n                  }\n                } catch (pollErr) {\n                  console.warn(' Poll request failed:', pollErr.message);\n                }\n              }\n              \n              if (!apiResponse?.slides && pollCount >= maxPolls) {\n                console.warn(' Wrapped polling reached max attempts; treating as still-processing (do not fail the flow)');\n                requestResult.isTimeout = true;\n                // Preserve processing state so UI continues loading and we avoid firing onComplete prematurely.\n                apiResponse = apiResponse || { status: 'processing' };\n              }\n            }\n            \n            // Mark fetch as completed successfully\n            fetchCompleted = true;\n            \n            console.log(' API Response received and parsed successfully');\n            console.log(' Has slides?', !!apiResponse.slides);\n            if (apiResponse.slides) {\n              console.log(' Slides keys:', Object.keys(apiResponse.slides));\n            }\n            \n          } catch (fetchErr) {\n            // Mark that we encountered an error during fetch\n            fetchError = fetchErr;\n            fetchCompleted = false;\n            \n            console.error(' FETCH ERROR:', fetchErr);\n            console.error(' Error name:', fetchErr.name);\n            console.error(' Error message:', fetchErr.message);\n            \n            // Check if it's a timeout error (504 Gateway Timeout)\n            if (fetchErr.message?.includes('504') || fetchErr.message?.includes('Gateway Timeout')) {\n              console.error(' GATEWAY TIMEOUT (504) - Backend is still processing');\n              console.error(' This means the backend Python LLM script is still running');\n              console.error(' DO NOT fall back to mocks yet - backend is generating data');\n              // Don't set apiResponse to null yet - we want to retry or wait\n              apiResponse = null;\n              \n              // Flag this as a timeout specifically so the app knows to wait/retry\n              requestResult.isTimeout = true;\n            }\n            // If it's a CORS error, the backend is returning data but browser blocks it\n            else if (fetchErr.message?.includes('CORS') || fetchErr.message?.includes('Failed to fetch')) {\n              console.error(' CORS BLOCKING RESPONSE - Backend generated data but browser cannot read it');\n              console.error(' This usually means a 504/502 timeout from load balancer stripping headers');\n              console.error(' Backend successfully generated dashboard (see server logs)');\n              \n              // Even though fetch failed, we still have the token and URL\n              // Set apiResponse to null but keep token and apiUrl for retry\n              apiResponse = null;\n              \n              // Treat CORS errors on this endpoint as timeouts/processing\n              // The backend likely finished but the LB cut the connection\n              requestResult.isTimeout = true;\n            } else {\n              // For other errors, still set to null but log the error\n              console.error(' Fetch failed with error:', fetchErr);\n              apiResponse = null;\n            }\n          }\n          \n          // CRITICAL: Log fetch completion status\n          if (fetchCompleted) {\n            console.log(' Fetch completed - data ready');\n          } else if (requestResult.isTimeout) {\n             console.log(' Request timed out - passing timeout flag to app');\n          } else if (fetchError) {\n            console.error(' Fetch failed:', fetchError.message);\n          }\n\n          // Merge into result - include token and apiUrl even if fetch failed\n          finalResult = {\n            ...requestResult,\n            apiResponse: apiResponse, // Raw response (null if CORS blocked)\n            token: urlData.token,     // Token used - ALWAYS include this\n            apiUrl: urlData.apiUrl    // URL used - ALWAYS include this\n          };\n          \n          console.log(' Final result ready:', {\n            hasApiResponse: !!finalResult.apiResponse,\n            hasSlides: !!finalResult.apiResponse?.slides,\n            hasToken: !!finalResult.token\n          });\n          \n          // Add to updated user data - include token even if apiResponse is null\n          updatedUserData.apiResponse = apiResponse;\n          if (urlData.token) {\n            updatedUserData.token = urlData.token;\n            // Also store in localStorage for persistence\n            try {\n              localStorage.setItem('onairos_user_token', urlData.token);\n            } catch (e) {\n              console.warn(' Could not store token in localStorage:', e);\n            }\n          }\n          setUserData(updatedUserData);\n        } else {\n          console.warn(' Failed to get API URL:', urlData);\n        }\n      } catch (fetchError) {\n        console.error(' Error auto-fetching data:', fetchError);\n        \n        // Check if it's a timeout/abort error\n        if (fetchError.name === 'AbortError' || fetchError.message?.includes('timeout')) {\n          console.error(' Request timed out - backend took longer than 2 minutes');\n        }\n        // Check if it's a CORS error\n        else if (fetchError.message?.includes('CORS') || \n                 fetchError.message?.includes('Failed to fetch') ||\n                 fetchError.name === 'TypeError') {\n          console.error(' CORS ERROR DETECTED');\n          console.error(' Backend needs to allow CORS for:', window.location.origin);\n        }\n        \n        // Continue with what we have - don't block the flow\n        // The app can still proceed without apiResponse\n      }\n    }\n\n    // Format response if requested and API response is present\n    let formattedResult = finalResult;\n    if (formatResponse && finalResult?.apiResponse) {\n      try {\n        formattedResult = {\n          ...finalResult,\n          apiResponse: formatOnairosResponse(finalResult.apiResponse, responseFormat)\n        };\n        console.log(' Response formatted with dictionary:', formattedResult.apiResponse?.personalityDict || 'No personality data');\n      } catch (error) {\n        console.warn(' Error formatting response:', error);\n        // Continue with original result if formatting fails\n      }\n    }\n\n    // Ensure token is included from userData if not already in finalResult\n    if (!finalResult.token && updatedUserData.token) {\n      finalResult.token = updatedUserData.token;\n      console.log(' Added token from userData to finalResult');\n    }\n    \n    // Also check localStorage as fallback\n    if (!finalResult.token) {\n      try {\n        const storedToken = localStorage.getItem('onairos_user_token');\n        if (storedToken) {\n          finalResult.token = storedToken;\n          console.log(' Added token from localStorage to finalResult');\n        }\n      } catch (e) {\n        console.warn(' Could not read token from localStorage:', e);\n      }\n    }\n    \n    // Add user data to the result for comprehensive formatting\n    const completeResult = {\n      ...formattedResult,\n      token: finalResult.token || formattedResult.token || updatedUserData.token, // Ensure token is at root level\n      userData: updatedUserData\n    };\n\n    // Enhanced user data formatting for better display\n    let enhancedResult = completeResult;\n    try {\n    // Log formatted user data for better readability\n        enhancedResult = logFormattedUserData(completeResult);\n    } catch (formatError) {\n        console.warn(' Error formatting user data for display:', formatError);\n        // Continue with unformatted result to ensure app doesn't break\n    }\n    \n    // Ensure token is still present after formatting\n    if (!enhancedResult.token && completeResult.token) {\n      enhancedResult.token = completeResult.token;\n    }\n    if (!enhancedResult.token && updatedUserData.token) {\n      enhancedResult.token = updatedUserData.token;\n    }\n\n    // Call onComplete callback if provided\n    // For non-wrapped apps, onComplete was already called from TrainingScreen\n    // So we only call it here for wrapped apps OR if training screen was skipped\n    // webpageName is already in scope from the component props\n    const isWrappedAppForCallback = webpageName && webpageName.toLowerCase().includes('wrapped');\n    \n    if (onComplete && isWrappedAppForCallback) {\n      try {\n        const hasWrappedDashboard =\n          !!enhancedResult?.apiResponse?.slides ||\n          !!enhancedResult?.apiResponse?.dashboard ||\n          !!enhancedResult?.apiResponse?.data?.dashboard;\n        const stillProcessing =\n          enhancedResult?.isTimeout === true ||\n          enhancedResult?.apiResponse?.status === 'processing' ||\n          !hasWrappedDashboard;\n\n        if (stillProcessing) {\n          // IMPORTANT: Do not call onComplete yet; many consuming apps will navigate away/unmount\n          // the SDK, which looks like the loading modal \"closed prematurely\".\n          console.log(' Wrapped dashboard still processing - keeping loading screen open and NOT calling onComplete yet');\n        } else {\n          console.log(' Calling onComplete for wrapped app with final dashboard data');\n          onComplete(enhancedResult);\n        }\n      } catch (error) {\n        console.error(' Error in onComplete callback:', error);\n      }\n    } else if (onComplete && !isWrappedAppForCallback) {\n      console.log(' Skipping onComplete for non-wrapped app (already called from TrainingScreen)');\n    } else {\n      console.log(' No onComplete callback provided');\n    }\n\n    // WRAPPED APPS: Set up listener for app to signal when dashboard is ready\n    // This is event-driven - overlay stays until dashboard signals it's ready\n    // isWrappedApp already declared above\n    \n    if (isWrappedApp) {\n      console.log(' Wrapped app - waiting for dashboard ready signal');\n      console.log(' Setting up onairos-dashboard-ready event listener');\n      \n      // Listen for custom event from the wrapped app indicating dashboard is ready\n      const handleDashboardReady = (event) => {\n        console.log(' Dashboard ready signal received - closing SDK overlay');\n        console.log(' Event details:', event);\n        handleCloseOverlay();\n        window.removeEventListener('onairos-dashboard-ready', handleDashboardReady);\n      };\n      \n      window.addEventListener('onairos-dashboard-ready', handleDashboardReady);\n      console.log(' Event listener attached, waiting for signal...');\n      \n      // Keep overlay open indefinitely until we get the ready signal\n      // No fallback timeout - if the app doesn't signal, the overlay stays\n      // This ensures we never show a flash of the portal page\n    } else {\n      // For non-wrapped apps, just close the modal - training already happened in TrainingScreen\n      console.log(' Non-wrapped app: Training complete, closing overlay');\n      handleCloseOverlay();\n    }\n  };\n\n  const getFlowTitle = () => {\n    switch (currentFlow) {\n      case 'welcome':\n        return ''; // WelcomeScreen handles its own titles\n      case 'email':\n        return ''; // EmailAuth handles its own titles\n      case 'onboarding':\n        return 'Connect Your Data';\n      case 'pin':\n        return 'Secure Your Account';\n      case 'training':\n        return 'Training Your Model';\n      case 'trainingScreen':\n        return 'Training Your Model';\n      case 'dataRequest':\n        return 'Data Request';\n      default:\n        return '';\n    }\n  };\n\n  const getFlowSubtitle = () => {\n    switch (currentFlow) {\n      case 'welcome':\n        return ''; // WelcomeScreen handles its own subtitles\n      case 'email':\n        return ''; // EmailAuth handles its own subtitles\n      case 'onboarding':\n        return 'Choose which accounts to connect for a personalized experience';\n      case 'pin':\n        return 'Create a secure PIN to protect your data';\n      case 'training':\n        return 'Building your personalized insights';\n      case 'trainingScreen':\n        return 'Building your personalized insights';\n      case 'dataRequest':\n        return `Select the data you want to share with ${webpageName}`;\n      default:\n        return '';\n    }\n  };\n\n  const getFlowIcon = () => {\n    switch (currentFlow) {\n      case 'welcome':\n        return ''; // WelcomeScreen handles its own layout\n      case 'email':\n        return ''; // EmailAuth handles its own layout\n      case 'onboarding':\n        return '';\n      case 'pin':\n        return '';\n      case 'training':\n        return '';\n      case 'trainingScreen':\n        return '';\n      case 'dataRequest':\n        return '';\n      default:\n        return '';\n    }\n  };\n\n  const renderContent = () => {\n    const commonProps = {\n      isMobile: isMobileDevice,\n      testMode: testMode\n    };\n\n    switch (currentFlow) {\n      case 'welcome':\n        return (\n          <WelcomeScreen \n            {...commonProps}\n            onContinue={handleWelcomeContinue}\n            onClose={handleCloseOverlay}\n            webpageName={webpageName}\n            appIcon={appIcon}\n          />\n        );\n      case 'email':\n        return (\n          <div className={isMobileDevice ? \"flex-1 min-h-0 flex flex-col\" : \"flex-1 min-h-0 flex flex-col\"}>\n            <EmailAuth \n              {...commonProps}\n              onSuccess={handleEmailAuthSuccess}\n            />\n          </div>\n        );\n      case 'onboarding':\n        return (\n          <UniversalOnboarding \n            {...commonProps}\n            onComplete={handleOnboardingComplete}\n            onBack={() => {\n              if (returnToDataRequestAfterOnboarding) {\n                setReturnToDataRequestAfterOnboarding(false);\n                // Sync connected apps from storage so DataRequest reflects newly connected platforms\n                try {\n                  const saved = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n                  if (saved && Array.isArray(saved.connectedAccounts)) {\n                    setUserData((prev) => {\n                      const merged = { ...(prev || {}), ...saved, connectedAccounts: saved.connectedAccounts };\n                      try { localStorage.setItem('onairosUser', JSON.stringify(merged)); } catch {}\n                      return merged;\n                    });\n                  }\n                } catch {}\n                setCurrentFlow('dataRequest');\n              } else {\n                setCurrentFlow('email');\n              }\n            }}\n            appIcon={appIcon || \"https://onairos.sirv.com/Images/OnairosBlack.png\"}\n            appName={webpageName}\n            username={userData?.email || userData?.username}\n            priorityPlatform={priorityPlatform}\n            rawMemoriesOnly={rawMemoriesOnly}\n            rawMemoriesConfig={rawMemoriesConfig}\n          />\n        );\n      case 'pin':\n        return (\n          <div className={isMobileDevice ? \"flex-1 min-h-0\" : \"\"}>\n            <PinSetup \n              onComplete={handlePinSetupComplete}\n              onBack={() => setCurrentFlow('onboarding')}\n              userEmail={userData?.email}\n            />\n          </div>\n        );\n      case 'training':\n        return (\n          <TrainingComponent \n            onComplete={handleTrainingComplete}\n            userEmail={userData?.email}\n            appName={webpageName}\n            connectedAccounts={userData?.connectedAccounts || []}\n            testMode={testMode}\n          />\n        );\n      case 'trainingScreen':\n        console.log(' Rendering TrainingScreen with userData:', {\n          hasUserData: !!userData,\n          hasToken: !!userData?.token,\n          tokenPreview: userData?.token ? userData.token.substring(0, 20) + '...' : 'NO TOKEN',\n          email: userData?.email,\n          connectedAccounts: userData?.connectedAccounts\n        });\n        return (\n          <TrainingScreen \n            onComplete={handleTrainingScreenComplete}\n            onTrainingStart={() => setTrainingHasStarted(true)}\n            userEmail={userData?.email}\n            connectedAccounts={userData?.connectedAccounts || []}\n            userToken={userData?.token}\n          />\n        );\n      case 'dataRequest':\n        console.log(' Rendering DataRequest:', {\n          connectedAccounts: userData?.connectedAccounts,\n          isArray: Array.isArray(userData?.connectedAccounts),\n          userData: userData\n        });\n        return (\n          <DataRequest \n            onComplete={handleDataRequestComplete}\n            onConnectMoreApps={() => {\n              // Go back to UniversalOnboarding but return here afterwards.\n              // Connected apps are persisted in localStorage by UniversalOnboarding.\n              setReturnToDataRequestAfterOnboarding(true);\n              setCurrentFlow('onboarding');\n            }}\n            userEmail={userData?.email || userData?.userName}\n            requestData={requestData}\n            appName={webpageName}\n            autoFetch={autoFetch}\n            testMode={testMode}\n            appIcon={appIcon}\n            connectedPlatforms={userData?.connectedAccounts || []}\n            rawMemoriesOnly={rawMemoriesOnly}\n            rawMemoriesConfig={rawMemoriesConfig}\n            showTime={time}\n          />\n        );\n      case 'wrappedLoading':\n        return (\n          <div className=\"flex-1 min-h-0\">\n            <WrappedLoadingPage appName={webpageName} />\n          </div>\n        );\n      case 'loading':\n        return <LoadingScreen onComplete={handleLoadingComplete} />;\n      default:\n        return (\n          <div className=\"flex flex-col items-center space-y-4 p-6\">\n            <div className=\"animate-spin h-8 w-8 border-2 border-blue-600 rounded-full border-t-transparent\"></div>\n            <p className=\"text-gray-600\">Loading...</p>\n          </div>\n        );\n    }\n  };\n\n  // Styling and button class based on visual type\n  const buttonClass = \n    `flex items-center justify-center font-bold rounded cursor-pointer ${\n    buttonType === 'pill' ? 'px-4 py-2' : 'w-12 h-12'\n    } bg-transparent OnairosConnect`;\n\n  const buttonStyle = {\n    flexDirection: textLayout === 'below' ? 'column' : 'row',\n    backgroundColor: 'transparent',\n    color: textColor,\n    border: '1px solid transparent',\n  };\n\n  // Icon and text style based on the visualType\n  const logoStyle = {\n    width: '20px',\n    height: '20px',\n    marginRight: visualType === 'full' ? '12px' : '0',\n  };\n\n  const getText = () => {\n    switch (loginType) {\n      case 'signUp':\n        return 'Sign Up with Onairos';\n      case 'signOut':\n        return 'Sign Out of Onairos';\n      default:\n        return 'Sign In with Onairos';\n    }\n  };\n\n  return (\n    <>\n      <button\n        className={buttonClass}\n        onClick={openTerminal}\n        style={buttonStyle}\n      >\n        {(visualType === 'full' || visualType === 'icon') && (\n          <img\n            src={login ? \"https://onairos.sirv.com/Images/OnairosWhite.png\" : \"https://onairos.sirv.com/Images/OnairosBlack.png\"}\n            alt=\"Onairos Logo\"\n            style={logoStyle}\n          />\n        )}\n        {visualType !== 'icon' && (\n          <span className={`${textColor === 'black' ? 'text-black' : 'text-white'} ${visualType === 'icon' ? 'sr-only' : ''} ${textLayout === 'right' ? 'ml-2' : textLayout === 'left' ? 'mr-2' : ''}`}>\n            {getText()}\n          </span>\n        )}\n      </button>\n\n      {/* Modal with New Design */}\n      {showOverlay && (\n        <>\n          {/** Wrapped-only typography hook */}\n          {/** Adds CSS variables --fontHeading/--fontBody via .onairos-wrapped-fonts */}\n          {isMobileDevice ? (\n            // Mobile Browser: Use ModalPageLayout with mobile-optimized props\n            <ModalPageLayout\n              visible={showOverlay}\n              onClose={handleCloseOverlay}\n              showBackButton={currentFlow !== 'welcome' && currentFlow !== 'email' && currentFlow !== 'loading' && currentFlow !== 'wrappedLoading'}\n              onBack={() => {\n                        if (currentFlow === 'onboarding') {\n                          if (returnToDataRequestAfterOnboarding) {\n                            setReturnToDataRequestAfterOnboarding(false);\n                            // Sync connected apps from storage so DataRequest reflects newly connected platforms\n                            try {\n                              const saved = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n                              if (saved && Array.isArray(saved.connectedAccounts)) {\n                                setUserData((prev) => {\n                                  const merged = { ...(prev || {}), ...saved, connectedAccounts: saved.connectedAccounts };\n                                  try { localStorage.setItem('onairosUser', JSON.stringify(merged)); } catch {}\n                                  return merged;\n                                });\n                              }\n                            } catch {}\n                            setCurrentFlow('dataRequest');\n                          } else {\n                            setCurrentFlow('email');\n                          }\n                        }\n                        else if (currentFlow === 'pin') setCurrentFlow('onboarding');\n                        else if (currentFlow === 'dataRequest') setCurrentFlow('onboarding');\n                        else if (currentFlow === 'training') setCurrentFlow('pin');\n                      }}\n              showCloseButton={currentFlow === 'welcome' || currentFlow === 'email'}\n              title=\"\"\n              subtitle=\"\"\n              icon={null}\n              centerContent={true}\n              contentClassName=\"!p-0\"\n              modalClassName={`onairos-modal onairos-modal-mobile ${(webpageName || '').toLowerCase().includes('wrapped') ? 'onairos-wrapped-fonts' : ''}`}\n            >\n              <div className=\"onairos-modal-shell flex-1 min-h-0 flex flex-col\">\n                  {renderContent()}\n                </div>\n            </ModalPageLayout>\n          ) : (\n            // Desktop Layout\n            <ModalPageLayout\n              visible={showOverlay}\n              onClose={handleCloseOverlay}\n              showBackButton={currentFlow === 'training' || currentFlow === 'onboarding' || currentFlow === 'pin' || currentFlow === 'dataRequest'}\n              onBack={() => {\n                if (currentFlow === 'email') setCurrentFlow('welcome');\n                if (currentFlow === 'onboarding') {\n                  if (returnToDataRequestAfterOnboarding) {\n                    setReturnToDataRequestAfterOnboarding(false);\n                    // Sync connected apps from storage so DataRequest reflects newly connected platforms\n                    try {\n                      const saved = JSON.parse(localStorage.getItem('onairosUser') || '{}');\n                      if (saved && Array.isArray(saved.connectedAccounts)) {\n                        setUserData((prev) => {\n                          const merged = { ...(prev || {}), ...saved, connectedAccounts: saved.connectedAccounts };\n                          try { localStorage.setItem('onairosUser', JSON.stringify(merged)); } catch {}\n                          return merged;\n                        });\n                      }\n                    } catch {}\n                    setCurrentFlow('dataRequest');\n                  } else {\n                    setCurrentFlow('email');\n                  }\n                }\n                if (currentFlow === 'pin') setCurrentFlow('onboarding'); \n                if (currentFlow === 'training') setCurrentFlow('pin');\n                if (currentFlow === 'dataRequest') setCurrentFlow('onboarding');\n              }}\n              title=\"\"\n              subtitle=\"\"\n              icon={null}\n              centerContent={true}\n              contentClassName={currentFlow !== 'welcome' ? \"!p-0\" : \"\"}\n              modalClassName={`onairos-modal ${(webpageName || '').toLowerCase().includes('wrapped') ? 'onairos-wrapped-fonts' : ''}`}\n            >\n              <div className=\"onairos-modal-shell\">\n                {renderContent()}\n              </div>\n            </ModalPageLayout>\n          )}\n        </>\n      )}\n    </>\n  );\n}\n\nexport default OnairosButton;"],"names":["WelcomeScreen","_ref","onContinue","onClose","useEffect","script","document","createElement","src","async","head","appendChild","existingScript","querySelector","removeChild","React","className","style","height","alt","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","COLORS","btnGradStart","btnGradEnd","btnLabel","btnBorder","iconCircleGradientStart","iconCircleGradientEnd","background","backgroundSecondary","textPrimary","textSecondary","textMuted","border","borderLight","success","error","warning","info","hover","pressed","focus","IconCircle","size","children","concat","width","borderRadius","fontSize","color","backgroundColor","_ref2","label","iconRight","loading","disabled","testId","textStyle","centered","props","_objectWithoutProperties","_excluded","setPressed","useState","buttonStyle","_objectSpread","position","overflow","minWidth","maxWidth","margin","cursor","opacity","boxShadow","transition","pressedOverlayStyle","top","left","right","bottom","labelStyle","fontFamily","fontWeight","textAlign","_extends","onMouseDown","handleMouseDown","onMouseUp","handleMouseUp","onMouseLeave","handleMouseLeave","display","justifyContent","alignItems","EmailAuth","onSuccess","testMode","email","setEmail","codeDigits","setCodeDigits","Array","step","setStep","isLoading","setIsLoading","setError","emailSent","setEmailSent","emailServiceMessage","setEmailServiceMessage","code","join","isCodeComplete","every","length","resetCodeDigits","sleep","ms","Promise","resolve","setTimeout","postJson","url","apiKey","body","fetch","method","headers","JSON","stringify","handleOAuthSuccess","console","log","gmailEmail","normalizedEmail","trim","toLowerCase","baseUrl","window","onairosBaseUrl","onairosApiKey","accountInfo","accountStatus","existingUser","accountCheckResponse","Info","identifier","ok","accountData","json","_accountStatus","_accountStatus2","_accountStatus3","_accountStatus4","_accountStatus5","_accountStatus6","_accountStatus7","AccountInfo","exists","hasTrainedModel","hasPersonalityTraits","connectedPlatforms","needsDataConnection","needsTraining","canUseInference","accountCheckError","warn","verified","token","userName","split","isNewUser","flowType","adminMode","userCreated","accountDetails","createdAt","Date","toISOString","ssoProvider","checkGmailOAuthSuccess","gmailSuccess","localStorage","getItem","gmailTimestamp","oauthContext","timestampNum","parseInt","now","removeItem","checkOAuthCompletion","urlParams","URLSearchParams","location","search","oauthSuccess","get","oauthPlatform","oauthEmail","newUrl","pathname","history","replaceState","timestamp","firstInput","handleEmailSubmit","e","preventDefault","test","validateEmail","data","rawEmail","res","action","_unused","legacyRes","msg","err","_unused2","Error","requestEmailVerification","message","handleGoogleSuccess","credential","credentialResponse","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","userInfo","parse","name","picture","email_verified","sdkConfig","response","_authData$body","_authData$body2","authData","undefined","httpStatus","status","_authData$body3","_authData$body4","username","backendError","handleGoogleError","handleCodeSubmit","simulatedResponse","testAccount","_data$existingUserDat","codeToSubmit","rawCode","_ref3","normalizedCode","String","includes","attempt","errMsg","attemptsRemaining","_unused3","verifyEmailCode","userState","hasExistingData","existingUserData","user","jwtToken","enochInstructions","displayMessages","creationDate","provider","type","value","onChange","target","placeholder","WebkitTextFillColor","required","GoogleLogin","onError","text","shape","logo_alignment","lineHeight","borderColor","from","_","index","key","inputMode","pattern","maxLength","autoComplete","onPaste","_e$clipboardData","_e$currentTarget$pare","pasted","clipboardData","getData","nextDigits","i","focusIndex","Math","min","nextInput","currentTarget","parentElement","digitsOnly","_e$target$parentEleme","_e$target$parentEleme2","onKeyDown","_e$currentTarget$pare2","prevInput","caretColor","PrimaryButton","flex","minHeight","Check","isCapacitor","_window$Capacitor","_window$webkit","Capacitor","Plugins","webkit","messageHandlers","bridge","isReactNative","navigator","product","global","nativeModuleProxy","isMobileApp","isMobileBrowser","userAgent","innerWidth","BOOKMARKLET_HREF","ConnectChatGPTModal","open","onConnected","userToken","getUserToken","directToken","userData","substring","bookmarkletHref","createPortal","inset","zIndex","pointerEvents","fillRule","clipRule","animation","href","title","draggable","onDragStart","dataTransfer","setData","effectAllowed","alert","suppressHydrationWarning","handleGotIt","chatgptIcon","claudeIcon","geminiIcon","grokIcon","process","env","REACT_APP_ONAIROS_API_KEY","REACT_APP_ONAIROS_BASE_URL","sdkType","enableHealthMonitoring","enableAutoRefresh","enableConnectionValidation","fadeSlideInKeyframes","UniversalOnboarding","_window$Capacitor$isN","onComplete","onBack","appIcon","appName","priorityPlatform","rawMemoriesOnly","rawMemoriesConfig","isMobile","isMobileProp","lottieRef","useRef","lastFrameRef","rafRef","initialLoadDone","connectedAccounts","setConnectedAccounts","isConnecting","setIsConnecting","connectingPlatform","setConnectingPlatform","selected","setSelected","currentPage","setCurrentPage","showChatGPTModal","setShowChatGPTModal","touchStartX","touchDeltaX","isActualMobileDevice","isNativePlatform","call","vh","setVh","innerHeight","onResize","addEventListener","removeEventListener","INFO_SHEET_MAX_H","isSmallMobile","personaSide","PERSONA_TOP","SLOT","max","floor","CIRCLE","GAP_PAGE1","GAP_PAGE2","ACTIVE_SCALE","ICONS_H","igGradId","round","useId","Brand","ChatGPT","objectFit","Claude","Gemini","Grok","Instagram","id","cx","cy","r","offset","stopColor","YouTube","Reddit","LinkedIn","Twitter","aiLinks","descriptions","allPlatformsDefault","connector","icon","directLink","wrappedPlatforms","isWrappedApp","allPlatforms","canonicalizePlatformName","raw","lower","byConnector","find","p","byName","charAt","toUpperCase","Object","keys","connectedArray","entries","filter","v","k","Boolean","setItem","dispatchEvent","CustomEvent","platforms","page","Set","has","handleAuthSuccess","platform","detail","plat","sessionStorage","currentState","updated","justConnectedTime","isArray","accountsObj","reduce","acc","current","checkOAuthSuccess","sessionSuccess","sessionPlatform","legacySuccess","legacyTs","legacyTsNum","NaN","Number","isFinite","canonical","handleSwitch","_JSON$parse","s","isCapacitorNative","effectiveMobile","returnUrl","origin","sessionPayload","bodyPayload","session","candidates","youtube","linkedin","reddit","pinterest","instagram","github","facebook","gmail","oauthUrl","candidateLower","localStorageKey","Browser","addListener","listenerError","windowName","presentationStyle","popup","closed","messageHandler","event","clearInterval","pollInterval","timestampKey","close","pollCount","maxPolls","setInterval","connectToPlatform","connectedCount","values","totalFrames","personaAnim","progress","start","startTs","performance","t","eased","frame","goToAndStop","requestAnimationFrame","cancelAnimationFrame","scrollbarWidth","msOverflowStyle","transform","Lottie","animationData","autoplay","loop","paddingTop","paddingBottom","onTouchStart","touches","clientX","onTouchMove","onTouchEnd","dx","gridAutoFlow","gridTemplateColumns","columnGap","justifyItems","paddingInline","idx","on","showConnectedStyling","isSel","shift","_window$Capacitor2","_window$Capacitor2$is","hasCapacitor","transformOrigin","marginTop","marginBottom","n","maxHeight","role","stopPropagation","WebkitTapHighlightColor","userSelect","touchAction","overflowY","xmlns","connected","_ref4","_ref5","totalConnections","PinSetup","userEmail","pin","setPin","pinRequirements","setPinRequirements","uppercase","number","allRequirementsMet","handleSubmit","pinCreated","Icon","base","DataTypeToggle","dataType","enabled","onToggle","isNative","handle","options","onConnectMoreApps","showTime","basic","rawMemories","preferences","personality","freq","setFreq","platformIconFailed","setPlatformIconFailed","setPlatforms","normalizePlatformName","twitter","x","chatgpt","claude","gemini","grok","toggle","val","selectedCount","refreshPlatforms","newPlatforms","getConnected","u","normalized","mappedRaw","mapped","_ref6","_ref7","handleConnectedAccountsUpdate","availableOptions","opt","hasLLMConnections","llmPlatforms","some","freqToPercent","f","personaImg","rect","getBoundingClientRect","ratio","WebkitOverflowScrolling","Pinterest","GitHub","Facebook","Gmail","failed","fallbackText","approved","declined","TrainingComponent","_steps$currentStep","_steps$currentStep2","_steps$currentStep3","_steps$currentStep4","_steps$currentStep5","currentStep","setCurrentStep","setProgress","isComplete","setIsComplete","steps","description","duration","interval","stepTimeout","stepDuration","stepProgress","prev","newProgress","completionDelay","trainingComplete","simulatedTraining","clearTimeout","trainingPhrases","TrainingScreen","onTrainingStart","currentPhrase","setCurrentPhrase","currentStage","setCurrentStage","socket","progressTimer","didSignalStart","signalTrainingStarted","storedToken","io","auth","transports","reconnection","timeout","socketId","emit","percentage","stage","result","_result$trainingResul","_result$trainingResul2","_result$trainingResul3","traits","trainingResults","userTraits","hasLlmData","llmData","inferenceResults","disconnect","fallback","reason","runTrainingAndInference","rainAnim","LoadingScreen","dotCount","setDotCount","loadingStates","stateInterval","nextStep","dotInterval","aspectRatio","repeat","WrappedLoadingPage","setAnimationData","messageIndex","setMessageIndex","messages","then","catch","err2","increment","timer","next","messageTimer","PERSONALITY_TYPES","TRAIT_CATEGORIES","formatOnairosResponse","apiResponse","_apiResponse$Inferenc","arguments","includeDictionary","includeArray","formatted","InferenceResult","scores","_apiResponse$Inferenc2","personalityDict","forEach","_formatted$InferenceR","traitResult","traitDict","category","formatUserDataForDisplay","_result$userData","_result$userData2","_result$userData3","_result$userData4","_result$userData5","_result$userData6","_result$userData7","userDataSummary","requestInfo","userHash","dataTypesRequested","approvedData","userProfile","userType","onboardingComplete","modelReady","formatConnectedAccounts","aiData","formatAIResponseData","hasApiResponse","hasErrors","apiError","prettyPrint","lines","push","toLocaleString","summary","hasData","dataTypes","createPrettyPrintVersion","accounts","count","names","a","connectedAt","account","_apiResponse$data","_apiResponse$Inferenc3","available","_apiResponse$data2","_apiResponse$data3","_apiResponse$data4","_apiResponse$data5","_apiResponse$Inferenc4","dashboard","slides","apps","personalityData","preferencesData","output","logFormattedUserData","PageLayout","subtitle","showHeader","showCloseButton","showBackButton","contentClassName","centerContent","isSmallScreen","layoutStyle","flexDirection","headerStyle","padding","contentStyle","titleStyle","subtitleStyle","ModalPageLayout","visible","onBackdropClick","backdropStyle","modalStyle","modalClassName","pageLayoutProps","_excluded2","mobileModalHeightPx","setMobileModalHeightPx","_window$visualViewpor","h","visualViewport","_window$visualViewpor3","_window$visualViewpor4","_window$visualViewpor5","_window$visualViewpor6","compute","_window$visualViewpor2","_window$visualViewpor7","_window$visualViewpor8","_window$visualViewpor9","_window$visualViewpor0","modalHeight","modalMaxHeight","modalMaxWidth","backdropAlign","backdropPadding","backdropStyles","willChange","hasBackdropStyleOverride","backdropStyleOverride","modalStyles","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","marginLeft","marginRight","flexShrink","hasModalStyleOverride","modalStyleWasApplied","modalStyleOverride","modalStyleKeys","backdropStyleKeys","modalMinHeight","OnairosButton","requestData","webpageName","inferenceData","autoFetch","proofMode","textLayout","textColor","login","buttonType","loginReturn","loginType","visualType","enableTraining","formatResponse","responseFormat","time","showOverlay","setShowOverlay","currentFlow","setCurrentFlow","trainingHasStarted","setTrainingHasStarted","setUserData","oauthReturnDetected","setOauthReturnDetected","returnToDataRequestAfterOnboarding","setReturnToDataRequestAfterOnboarding","isMobileDevice","setIsMobileDevice","computeMobile","_document$documentEle","_document$body","documentElement","clientWidth","parent","isCapNative","detectedMobile","dataset","onairosPrevOverflow","isDesktop","modal","pageContent","shell","getMetrics","el","styles","getComputedStyle","paddingLeft","paddingRight","classList","viewportWidth","handleDeepLink","hasSuccess","hasError","isPopup","opener","params","qIdx","indexOf","URL","searchParams","postMessage","innerHTML","questionMarkIndex","state","decoded","connectionType","existing","merged","startsWith","cleanUrl","appListener","_window$Capacitor3","_window$Capacitor3$is","AppPlugin","App","_window$Capacitor4","setupListener","remove","checkWindowUrl","checkExistingSession","savedUser","checkOAuthReturn","handleCloseOverlay","_unused5","handleWelcomeContinue","handleEmailAuthSuccess","hasAccountInfo","candidate","accessToken","payload","userId","sub","_unused6","accountExists","finalDecision","reasoning","usingAccountStatus","existingUserFalse","flowTypeOnboarding","noAccountInfo","newUserData","emailToken","handleOnboardingComplete","onboardingData","updatedUserData","handlePinSetupComplete","pinData","timeoutId","handleLoadingComplete","handleTrainingComplete","trainingResult","trainingCompleted","handleTrainingScreenComplete","handleDataRequestComplete","_requestResult$approv","_requestResult$approv2","_finalResult","requestResult","lastDataRequest","finalResult","urlResponse","appId","confirmations","EncryptedUserPin","storage","urlData","apiUrl","_finalResult$apiRespo","eventDetail","dataResponse","fetchUrl","fetchBody","includeLlmData","forceFresh","cacheBust","currentEmail","_unused7","_unused8","fetchCompleted","fetchError","controller","AbortController","abort","cache","signal","statusText","fromEntries","hasStatus","hasSlides","responseKeys","_apiResponse","basePollInterval","poll_interval_seconds","pollResponse","pollData","pollErr","isTimeout","fetchErr","_fetchErr$message","_fetchErr$message2","_fetchErr$message3","_fetchErr$message4","hasToken","_fetchError$message","_fetchError$message2","_fetchError$message3","formattedResult","_formattedResult$apiR","completeResult","enhancedResult","formatError","isWrappedAppForCallback","_enhancedResult","_enhancedResult2","_enhancedResult3","_enhancedResult4","_enhancedResult5","hasWrappedDashboard","handleDashboardReady","renderContent","commonProps","saved","_unused9","_unused0","hasUserData","tokenPreview","DataRequest","buttonClass","logoStyle","_unused4","getText","_unused1","_unused10","_unused11","_unused12"],"ignoreList":[],"sourceRoot":""}