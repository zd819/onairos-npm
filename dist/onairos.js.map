{"version":3,"file":"onairos.js","names":["_react","_interopRequireDefault","require","_RSA","_getPin","_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","loadSha256","console","log","module","Promise","resolve","then","error","request","response","loadOthentKms","Onairos","_ref","requestData","webpageName","proofMode","validateRequestData","validKeys","requiredProperties","Error","key","prop","trim","OnairosAnime","ConnectOnairos","OnairosPublicKey","domain","window","location","href","othentKms","connect","userDetails","sha256","hashedOthentSub","sub","toString","encryptedPin","getPin","convertToBuffer","string","encodedData","atob","uint8Array","Uint8Array","length","charCodeAt","buffer","bufferPIN","result","decrypt","userPin","rsaEncrypt","encryptedData","postMessage","source","type","HashedOthentSub","EncryptedUserPin","catch","fix","createElement","className","onClick","src","alt"],"sources":["../src/onairos.jsx"],"sourcesContent":["\r\n\r\nimport React from 'react';\r\n// import {connect, decrypt} from '@othent/kms';\r\n// import sha256 from 'crypto-js/sha256';\r\nimport { rsaEncrypt } from './RSA';\r\nimport getPin from './getPin';\r\n// import { Buffer } from 'buffer';\r\n\r\n\r\n// Dynamic import for crypto-js's sha256\r\nconst loadSha256 = async () =>{\r\n  try{\r\n\r\n    console.log(\"loadSha256 loading \")\r\n    const module = await import(/* webpackChunkName: \"sha256\" */ 'crypto-js/sha256');\r\n    console.log(\"loadSha256 loading successful\")\r\n\r\n    return module;\r\n  } catch (e) {\r\n      console.error(\"Error loading Othent:\", e, e.request, e.response);\r\n      throw e; // Rethrow the error to be caught by the caller\r\n  }\r\n};\r\n\r\n// Dynamic import for @othent/kms\r\n// const loadOthentKms = async () =>{\r\nasync function loadOthentKms(){\r\n  try {\r\n    console.log(\"Othent dynamic loading \")\r\n    const module = await import(/* webpackChunkName: \"othent-kms\" */ '@othent/kms');\r\n    console.log(\"Othent loading successful\")\r\n    return module.default;\r\n  } catch (e) {\r\n    console.error(\"Error loading Othent:\", e, e.request, e.response);\r\n    throw e; // Rethrow the error to be caught by the caller\r\n  }\r\n};\r\n\r\n// import Buffer\r\nexport function Onairos( {requestData, webpageName, proofMode=false}) {\r\n\r\n  const validateRequestData = () => {\r\n    const validKeys = ['Small', 'Medium', 'Large'];\r\n    const requiredProperties = ['type', 'descriptions', 'reward'];\r\n    if( typeof webpageName !== 'string'){\r\n      throw new Error(`Property webpageName must be a String`);\r\n\r\n    }\r\n    for (const key of validKeys) {\r\n      if (!(key in requestData)) {\r\n        throw new Error(`Missing key '${key}' in requestData.`);\r\n      }\r\n      for (const prop of requiredProperties) {\r\n        if (!(prop in requestData[key])) {\r\n          throw new Error(`Missing property '${prop}' in requestData.${key}.`);\r\n        }\r\n        if (prop !== 'reward' && typeof requestData[key][prop] !== 'string') {\r\n          throw new Error(`Property '${prop}' in requestData.${key} must be a string.`);\r\n        }\r\n        if (prop !== 'reward' && requestData[key][prop].trim() === '') {\r\n          throw new Error(`Property '${prop}' in requestData.${key} cannot be empty.`);\r\n        }\r\n      }\r\n    }\r\n    // Add any other validation rules as necessary\r\n  };\r\n  \r\n  const OnairosAnime = async () => {\r\n    try {\r\n      console.log('Validating request data...');\r\n      validateRequestData();\r\n      console.log('Connecting to Onairos...');\r\n      await ConnectOnairos();\r\n      console.log('Connected to Onairos.');\r\n    } catch (error) {\r\n      // Handle any errors here\r\n      console.error(\"Error connecting to Onairos\", error);\r\n    }\r\n  };\r\n\r\n  const OnairosPublicKey = `\r\n    -----BEGIN PUBLIC KEY-----\r\n    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4wkWvRPaJiY8CwQ5BoJI\r\n    amcGAYV91Bk8NrvWq4PXM+J/RJugfgTNCYKQ/c6g4xa1YES/tJEzFS7nf0Kdoqxm\r\n    5aav0ru5vS4fc4vCOLTI9W1T7nj02NY91rogsQm2/KMxUQ8DaLeTZKi+0Wjsa9YO\r\n    6XGGd1wh4azgQkj04MWW5J1EBCcBavKoY+C85oA9jkkklQ8nGWgbugmZs7eXHNQb\r\n    qH8/ZHcB9Kx1CZ6XjQuVd6YE/A+swV+DksbkXANcYjr6SY/2TbB8GfpcOMM3bkyN\r\n    Q8e0A51q5a8abfuAkDZXe67MwKMWu/626abwPZhJrKr5HhRZZDwPtnXlktYHhOK6\r\n    lQIDAQAB\r\n    -----END PUBLIC KEY-----\r\n      `;\r\n\r\n  const domain = window.location.href;\r\n\r\n  async function ConnectOnairos(){\r\n\r\n    try{\r\n      // console.log(\"Trying SHa\")\r\n      // Get User Othent Secure Details\r\n      const othentKms = await loadOthentKms();\r\n      const { connect } = othentKms;\r\n      console.log(\"Othent LOADED MOVING ON\")\r\n\r\n      const userDetails = await connect();\r\n      // console.log(\"userDetails : \", hashedOthentSub);\r\n      const sha256 = (await loadSha256()).default;\r\n      const hashedOthentSub = sha256(userDetails.sub).toString();\r\n      const encryptedPin = await getPin(hashedOthentSub);\r\n\r\n      function convertToBuffer(string) {\r\n        try {\r\n          // Decode base64 string\r\n          const encodedData = window.atob(string);\r\n          const uint8Array = new Uint8Array(encodedData.length);\r\n          for (let i = 0; i < encodedData.length; i++) {\r\n            uint8Array[i] = encodedData.charCodeAt(i);\r\n          }\r\n          return uint8Array.buffer; // This is an ArrayBuffer\r\n        } catch (e) {\r\n          console.error(\"Error converting to Buffer :\", e);\r\n        }\r\n      }\r\n      \r\n      const bufferPIN = convertToBuffer(encryptedPin.result);\r\n\r\n      // console.log(\"bufferPIN : \", bufferPIN);\r\n\r\n      const {decrypt }= await loadOthentKms();\r\n      const userPin = await decrypt(bufferPIN);\r\n\r\n      // RSA Encrypt the PIN to transmit to Terminal and backend\r\n      rsaEncrypt(OnairosPublicKey, userPin)\r\n      .then(encryptedData => {\r\n          // Prepare the data to be sent\r\n          window.postMessage({\r\n            source: 'webpage',\r\n            type: 'GET_API_URL',\r\n            webpageName: webpageName,\r\n            domain:domain,\r\n            requestData: requestData,\r\n            proofMode:proofMode,\r\n            HashedOthentSub:hashedOthentSub,\r\n            EncryptedUserPin:encryptedData\r\n          });\r\n      })\r\n      .catch(error => {\r\n          console.error(\"Encryption failed:\", error);\r\n      });\r\n\r\n    }catch(e){\r\n      console.error({fix:\"Please ensure you have stored your model\"});\r\n      console.error(\"Error Sending Data to Terminal: \", e);\r\n    }\r\n\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <button\r\n        className=\"OnairosConnect w-20 h-20 flex flex-col items-center justify-center text-white font-bold py-2 px-4 rounded cursor-pointer\"\r\n        onClick={OnairosAnime}\r\n      >\r\n        <img src={\"https://onairos.sirv.com/Images/OnairosBlack.png\"} \r\n        alt=\"Onairos Logo\" className=\"w-16 h-16 object-contain mb-2\" /> {/* Adjust size as needed */}\r\n        <span className=\"whitespace-nowrap\">Connect to Onairos</span> {/* Prevent text from wrapping */}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\n// // export default Onairos;\r\n\r\n// module.exports = Onairos;"],"mappings":"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"}